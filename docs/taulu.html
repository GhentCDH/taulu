<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>taulu API documentation</title>
            <link rel="icon" href="./favicon.svg"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="./logo.svg" class="logo" alt="project logo"/>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#GridDetector">GridDetector</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GridDetector.__init__">GridDetector</a>
                        </li>
                        <li>
                                <a class="function" href="#GridDetector.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#GridDetector.find_nearest">find_nearest</a>
                        </li>
                        <li>
                                <a class="function" href="#GridDetector.find_table_points">find_table_points</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TableGrid">TableGrid</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TableGrid.__init__">TableGrid</a>
                        </li>
                        <li>
                                <a class="variable" href="#TableGrid.points">points</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.row">row</a>
                        </li>
                        <li>
                                <a class="variable" href="#TableGrid.cols">cols</a>
                        </li>
                        <li>
                                <a class="variable" href="#TableGrid.rows">rows</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.from_split">from_split</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.from_saved">from_saved</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.add_left_col">add_left_col</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.add_top_row">add_top_row</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.cell">cell</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.cell_polygon">cell_polygon</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.region">region</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.visualize_points">visualize_points</a>
                        </li>
                        <li>
                                <a class="function" href="#TableGrid.text_regions">text_regions</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HeaderAligner">HeaderAligner</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HeaderAligner.__init__">HeaderAligner</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeaderAligner.template">template</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderAligner.view_alignment">view_alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderAligner.align">align</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderAligner.template_to_img">template_to_img</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HeaderTemplate">HeaderTemplate</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HeaderTemplate.__init__">HeaderTemplate</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.from_saved">from_saved</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeaderTemplate.cols">cols</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeaderTemplate.rows">rows</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.annotate_image">annotate_image</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.from_vgg_annotation">from_vgg_annotation</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell_width">cell_width</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell_widths">cell_widths</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell_height">cell_height</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell_heights">cell_heights</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.intersection">intersection</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell">cell</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.cell_polygon">cell_polygon</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.region">region</a>
                        </li>
                        <li>
                                <a class="function" href="#HeaderTemplate.text_regions">text_regions</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TableIndexer">TableIndexer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TableIndexer.col_offset">col_offset</a>
                        </li>
                        <li>
                                <a class="variable" href="#TableIndexer.cols">cols</a>
                        </li>
                        <li>
                                <a class="variable" href="#TableIndexer.rows">rows</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.cells">cells</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.cell">cell</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.cell_polygon">cell_polygon</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.highlight_all_cells">highlight_all_cells</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.select_one_cell">select_one_cell</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.show_cells">show_cells</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.region">region</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.crop_region">crop_region</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.text_regions">text_regions</a>
                        </li>
                        <li>
                                <a class="function" href="#TableIndexer.crop_cell">crop_cell</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Split">Split</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Split.__init__">Split</a>
                        </li>
                        <li>
                                <a class="variable" href="#Split.left">left</a>
                        </li>
                        <li>
                                <a class="variable" href="#Split.right">right</a>
                        </li>
                        <li>
                                <a class="function" href="#Split.append">append</a>
                        </li>
                        <li>
                                <a class="function" href="#Split.apply">apply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Taulu">Taulu</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Taulu.__init__">Taulu</a>
                        </li>
                        <li>
                                <a class="function" href="#Taulu.annotate">annotate</a>
                        </li>
                        <li>
                                <a class="function" href="#Taulu.segment_table">segment_table</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
taulu    </h1>

                        <div class="docstring"><p>Taulu - <em>segment tables from images</em></p>

<p>Taulu is a Python package designed to segment images of tables into their constituent rows and columns (and cells).</p>

<p>To use this package, you first need to make an annotation of the headers in your table images.
The idea is that these headers will be similar across your full set of images, and they will be
used as a starting point for the search algorithm that finds the table grid.</p>

<p>Here is an example python script of how to use Taulu:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">():</span>
    <span class="c1"># create an Annotation file of the headers in the image</span>
    <span class="c1"># (one for the left header, one for the right)</span>
    <span class="c1"># and store them in the examples directory</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Annotating the LEFT header...&quot;</span><span class="p">)</span>
    <span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;../data/table_00.png&quot;</span><span class="p">,</span> <span class="s2">&quot;table_00_header_left.png&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Annotating the RIGHT header...&quot;</span><span class="p">)</span>
    <span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;../data/table_00.png&quot;</span><span class="p">,</span> <span class="s2">&quot;table_00_header_right.png&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">((</span><span class="s2">&quot;table_00_header_left.png&quot;</span><span class="p">,</span> <span class="s2">&quot;table_00_header_right.png&quot;</span><span class="p">))</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;../data/table_00.png&quot;</span><span class="p">,</span>  <span class="n">cell_height_factor</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">debug_view</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">show_cells</span><span class="p">(</span><span class="s2">&quot;../data/table_00.png&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;table_00_header_left.png&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
        <span class="s2">&quot;table_00_header_right.png&quot;</span>
    <span class="p">):</span>
        <span class="n">main</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">setup</span><span class="p">()</span>
        <span class="n">main</span><span class="p">()</span>
</code></pre>
</div>

<p>If you want a high-level overview of how to use Taulu, see <a href="./taulu.html#taulu<a href="#Taulu">.taulu.Taulu</a>">the Taulu class</a></p>
</div>

                        <input id="mod-taulu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-taulu-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">Taulu - *segment tables from images*</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">Taulu is a Python package designed to segment images of tables into their constituent rows and columns (and cells).</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">To use this package, you first need to make an annotation of the headers in your table images.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">The idea is that these headers will be similar across your full set of images, and they will be</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="sd">used as a starting point for the search algorithm that finds the table grid.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="sd">Here is an example python script of how to use Taulu:</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="sd">```python</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="sd">from taulu import Taulu</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="sd">import os</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="sd">def setup():</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="sd">    # create an Annotation file of the headers in the image</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="sd">    # (one for the left header, one for the right)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="sd">    # and store them in the examples directory</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="sd">    print(&quot;Annotating the LEFT header...&quot;)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a><span class="sd">    Taulu.annotate(&quot;../data/table_00.png&quot;, &quot;table_00_header_left.png&quot;)</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="sd">    print(&quot;Annotating the RIGHT header...&quot;)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="sd">    Taulu.annotate(&quot;../data/table_00.png&quot;, &quot;table_00_header_right.png&quot;)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="sd">def main():</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="sd">    taulu = Taulu((&quot;table_00_header_left.png&quot;, &quot;table_00_header_right.png&quot;))</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="sd">    table = taulu.segment_table(&quot;../data/table_00.png&quot;,  cell_height_factor=0.8, debug_view=True)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="sd">    table.show_cells(&quot;../data/table_00.png&quot;)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a><span class="sd">if __name__ == &quot;__main__&quot;:</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a><span class="sd">    if os.path.exists(&quot;table_00_header_left.png&quot;) and os.path.exists(</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a><span class="sd">        &quot;table_00_header_right.png&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a><span class="sd">    ):</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a><span class="sd">        main()</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a><span class="sd">    else:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a><span class="sd">        setup()</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a><span class="sd">        main()</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a><span class="sd">```</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a><span class="sd">If you want a high-level overview of how to use Taulu, see [the Taulu class](./taulu.html#taulu.taulu.Taulu)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.grid</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridDetector</span><span class="p">,</span> <span class="n">TableGrid</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.header_aligner</span><span class="w"> </span><span class="kn">import</span> <span class="n">HeaderAligner</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.header_template</span><span class="w"> </span><span class="kn">import</span> <span class="n">HeaderTemplate</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.table_indexer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TableIndexer</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.split</span><span class="w"> </span><span class="kn">import</span> <span class="n">Split</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a><span class="n">__pdoc__</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;constants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;decorators&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a><span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;img_util&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">63</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">64</span></a>    <span class="s2">&quot;GridDetector&quot;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">65</span></a>    <span class="s2">&quot;TableGrid&quot;</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">66</span></a>    <span class="s2">&quot;HeaderAligner&quot;</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">67</span></a>    <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">68</span></a>    <span class="s2">&quot;TableIndexer&quot;</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">69</span></a>    <span class="s2">&quot;Split&quot;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">70</span></a>    <span class="s2">&quot;Taulu&quot;</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">71</span></a><span class="p">]</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">73</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">74</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">gpu</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">76</span></a>    <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;gpu&quot;</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">77</span></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">78</span></a>    <span class="k">pass</span>
</span></pre></div>


            </section>
                <section id="GridDetector">
                            <input id="GridDetector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GridDetector</span>:

                <label class="view-source-button" for="GridDetector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridDetector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridDetector-119"><a href="#GridDetector-119"><span class="linenos">119</span></a><span class="k">class</span><span class="w"> </span><span class="nc">GridDetector</span><span class="p">:</span>
</span><span id="GridDetector-120"><a href="#GridDetector-120"><span class="linenos">120</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-121"><a href="#GridDetector-121"><span class="linenos">121</span></a><span class="sd">    Detects table grid intersections using morphological filtering and template matching.</span>
</span><span id="GridDetector-122"><a href="#GridDetector-122"><span class="linenos">122</span></a>
</span><span id="GridDetector-123"><a href="#GridDetector-123"><span class="linenos">123</span></a><span class="sd">    This detector implements a multi-stage pipeline:</span>
</span><span id="GridDetector-124"><a href="#GridDetector-124"><span class="linenos">124</span></a>
</span><span id="GridDetector-125"><a href="#GridDetector-125"><span class="linenos">125</span></a><span class="sd">    1. **Binarization**: Sauvola adaptive thresholding to handle varying lighting</span>
</span><span id="GridDetector-126"><a href="#GridDetector-126"><span class="linenos">126</span></a><span class="sd">    2. **Morphological operations**: Dilation to connect broken rule segments</span>
</span><span id="GridDetector-127"><a href="#GridDetector-127"><span class="linenos">127</span></a><span class="sd">    3. **Cross-kernel matching**: Template matching with a cross-shaped kernel to find</span>
</span><span id="GridDetector-128"><a href="#GridDetector-128"><span class="linenos">128</span></a><span class="sd">       rule intersections where horizontal and vertical lines meet</span>
</span><span id="GridDetector-129"><a href="#GridDetector-129"><span class="linenos">129</span></a><span class="sd">    4. **Grid growing**: Iterative point detection starting from a known seed point</span>
</span><span id="GridDetector-130"><a href="#GridDetector-130"><span class="linenos">130</span></a>
</span><span id="GridDetector-131"><a href="#GridDetector-131"><span class="linenos">131</span></a><span class="sd">    The cross-kernel is designed to match the specific geometry of your table rules.</span>
</span><span id="GridDetector-132"><a href="#GridDetector-132"><span class="linenos">132</span></a><span class="sd">    It should be sized so that after morphology, it aligns with actual corner shapes.</span>
</span><span id="GridDetector-133"><a href="#GridDetector-133"><span class="linenos">133</span></a>
</span><span id="GridDetector-134"><a href="#GridDetector-134"><span class="linenos">134</span></a><span class="sd">    ## Tuning Guidelines</span>
</span><span id="GridDetector-135"><a href="#GridDetector-135"><span class="linenos">135</span></a>
</span><span id="GridDetector-136"><a href="#GridDetector-136"><span class="linenos">136</span></a><span class="sd">    - **kernel_size**: Increase if you need more selectivity (fewer false positives)</span>
</span><span id="GridDetector-137"><a href="#GridDetector-137"><span class="linenos">137</span></a><span class="sd">    - **cross_width/height**: Should match rule thickness after morphology</span>
</span><span id="GridDetector-138"><a href="#GridDetector-138"><span class="linenos">138</span></a><span class="sd">    - **morph_size**: Increase to connect more broken lines, but this thickens rules</span>
</span><span id="GridDetector-139"><a href="#GridDetector-139"><span class="linenos">139</span></a><span class="sd">    - **sauvola_k**: Increase to threshold more aggressively (remove noise)</span>
</span><span id="GridDetector-140"><a href="#GridDetector-140"><span class="linenos">140</span></a><span class="sd">    - **search_region**: Increase for documents with more warping/distortion</span>
</span><span id="GridDetector-141"><a href="#GridDetector-141"><span class="linenos">141</span></a><span class="sd">    - **distance_penalty**: Increase to prefer corners closer to expected positions</span>
</span><span id="GridDetector-142"><a href="#GridDetector-142"><span class="linenos">142</span></a>
</span><span id="GridDetector-143"><a href="#GridDetector-143"><span class="linenos">143</span></a><span class="sd">    ## Visual Debugging</span>
</span><span id="GridDetector-144"><a href="#GridDetector-144"><span class="linenos">144</span></a>
</span><span id="GridDetector-145"><a href="#GridDetector-145"><span class="linenos">145</span></a><span class="sd">    Set `visual=True` in methods to see intermediate results and tune parameters.</span>
</span><span id="GridDetector-146"><a href="#GridDetector-146"><span class="linenos">146</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GridDetector-147"><a href="#GridDetector-147"><span class="linenos">147</span></a>
</span><span id="GridDetector-148"><a href="#GridDetector-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GridDetector-149"><a href="#GridDetector-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector-150"><a href="#GridDetector-150"><span class="linenos">150</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
</span><span id="GridDetector-151"><a href="#GridDetector-151"><span class="linenos">151</span></a>        <span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GridDetector-152"><a href="#GridDetector-152"><span class="linenos">152</span></a>        <span class="n">cross_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-153"><a href="#GridDetector-153"><span class="linenos">153</span></a>        <span class="n">morph_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-154"><a href="#GridDetector-154"><span class="linenos">154</span></a>        <span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="GridDetector-155"><a href="#GridDetector-155"><span class="linenos">155</span></a>        <span class="n">sauvola_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="GridDetector-156"><a href="#GridDetector-156"><span class="linenos">156</span></a>        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="GridDetector-157"><a href="#GridDetector-157"><span class="linenos">157</span></a>        <span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
</span><span id="GridDetector-158"><a href="#GridDetector-158"><span class="linenos">158</span></a>        <span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="GridDetector-159"><a href="#GridDetector-159"><span class="linenos">159</span></a>        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GridDetector-160"><a href="#GridDetector-160"><span class="linenos">160</span></a>        <span class="n">grow_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="GridDetector-161"><a href="#GridDetector-161"><span class="linenos">161</span></a>        <span class="n">look_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="GridDetector-162"><a href="#GridDetector-162"><span class="linenos">162</span></a>    <span class="p">):</span>
</span><span id="GridDetector-163"><a href="#GridDetector-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-164"><a href="#GridDetector-164"><span class="linenos">164</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector-165"><a href="#GridDetector-165"><span class="linenos">165</span></a><span class="sd">            kernel_size (int): the size of the cross kernel</span>
</span><span id="GridDetector-166"><a href="#GridDetector-166"><span class="linenos">166</span></a><span class="sd">                a larger kernel size often means that more penalty is applied, often leading</span>
</span><span id="GridDetector-167"><a href="#GridDetector-167"><span class="linenos">167</span></a><span class="sd">                to more sparse results</span>
</span><span id="GridDetector-168"><a href="#GridDetector-168"><span class="linenos">168</span></a><span class="sd">            cross_width (int): the width of one of the edges in the cross filter, should be</span>
</span><span id="GridDetector-169"><a href="#GridDetector-169"><span class="linenos">169</span></a><span class="sd">                roughly equal to the width of the rules in the image after morphology is applied</span>
</span><span id="GridDetector-170"><a href="#GridDetector-170"><span class="linenos">170</span></a><span class="sd">            cross_height (int | None): useful if the horizontal rules and vertical rules</span>
</span><span id="GridDetector-171"><a href="#GridDetector-171"><span class="linenos">171</span></a><span class="sd">                have different sizes</span>
</span><span id="GridDetector-172"><a href="#GridDetector-172"><span class="linenos">172</span></a><span class="sd">            morph_size (int | None): the size of the morphology operators that are applied before</span>
</span><span id="GridDetector-173"><a href="#GridDetector-173"><span class="linenos">173</span></a><span class="sd">                the cross kernel. &#39;bridges the gaps&#39; of broken-up lines</span>
</span><span id="GridDetector-174"><a href="#GridDetector-174"><span class="linenos">174</span></a><span class="sd">            sauvola_k (float): threshold parameter for sauvola thresholding</span>
</span><span id="GridDetector-175"><a href="#GridDetector-175"><span class="linenos">175</span></a><span class="sd">            sauvola_window (int): window_size parameter for sauvola thresholding</span>
</span><span id="GridDetector-176"><a href="#GridDetector-176"><span class="linenos">176</span></a><span class="sd">            scale (float): image scale factor to do calculations on (useful for increasing calculation speed mostly)</span>
</span><span id="GridDetector-177"><a href="#GridDetector-177"><span class="linenos">177</span></a><span class="sd">            search_region (int): area in which to search for a new max value in `find_nearest` etc.</span>
</span><span id="GridDetector-178"><a href="#GridDetector-178"><span class="linenos">178</span></a><span class="sd">            distance_penalty (float): how much the point finding algorithm penalizes points that are further in the region [0, 1]</span>
</span><span id="GridDetector-179"><a href="#GridDetector-179"><span class="linenos">179</span></a><span class="sd">            min_rows (int): minimum number of rows to find before stopping the table finding algorithm</span>
</span><span id="GridDetector-180"><a href="#GridDetector-180"><span class="linenos">180</span></a><span class="sd">            grow_threshold (float): the threshold for accepting a new point when growing the table</span>
</span><span id="GridDetector-181"><a href="#GridDetector-181"><span class="linenos">181</span></a><span class="sd">            look_distance (int): how many points away to look when calculating the median slope</span>
</span><span id="GridDetector-182"><a href="#GridDetector-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-183"><a href="#GridDetector-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_parameters</span><span class="p">(</span>
</span><span id="GridDetector-184"><a href="#GridDetector-184"><span class="linenos">184</span></a>            <span class="n">kernel_size</span><span class="p">,</span>
</span><span id="GridDetector-185"><a href="#GridDetector-185"><span class="linenos">185</span></a>            <span class="n">cross_width</span><span class="p">,</span>
</span><span id="GridDetector-186"><a href="#GridDetector-186"><span class="linenos">186</span></a>            <span class="n">cross_height</span><span class="p">,</span>
</span><span id="GridDetector-187"><a href="#GridDetector-187"><span class="linenos">187</span></a>            <span class="n">morph_size</span><span class="p">,</span>
</span><span id="GridDetector-188"><a href="#GridDetector-188"><span class="linenos">188</span></a>            <span class="n">search_region</span><span class="p">,</span>
</span><span id="GridDetector-189"><a href="#GridDetector-189"><span class="linenos">189</span></a>            <span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="GridDetector-190"><a href="#GridDetector-190"><span class="linenos">190</span></a>            <span class="n">sauvola_window</span><span class="p">,</span>
</span><span id="GridDetector-191"><a href="#GridDetector-191"><span class="linenos">191</span></a>            <span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="GridDetector-192"><a href="#GridDetector-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="GridDetector-193"><a href="#GridDetector-193"><span class="linenos">193</span></a>
</span><span id="GridDetector-194"><a href="#GridDetector-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span> <span class="o">=</span> <span class="n">kernel_size</span>
</span><span id="GridDetector-195"><a href="#GridDetector-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_width</span> <span class="o">=</span> <span class="n">cross_width</span>
</span><span id="GridDetector-196"><a href="#GridDetector-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_height</span> <span class="o">=</span> <span class="n">cross_width</span> <span class="k">if</span> <span class="n">cross_height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cross_height</span>
</span><span id="GridDetector-197"><a href="#GridDetector-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_morph_size</span> <span class="o">=</span> <span class="n">morph_size</span> <span class="k">if</span> <span class="n">morph_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cross_width</span>
</span><span id="GridDetector-198"><a href="#GridDetector-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">=</span> <span class="n">search_region</span>
</span><span id="GridDetector-199"><a href="#GridDetector-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_k</span> <span class="o">=</span> <span class="n">sauvola_k</span>
</span><span id="GridDetector-200"><a href="#GridDetector-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_window</span> <span class="o">=</span> <span class="n">sauvola_window</span>
</span><span id="GridDetector-201"><a href="#GridDetector-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span> <span class="o">=</span> <span class="n">distance_penalty</span>
</span><span id="GridDetector-202"><a href="#GridDetector-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="GridDetector-203"><a href="#GridDetector-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_min_rows</span> <span class="o">=</span> <span class="n">min_rows</span>
</span><span id="GridDetector-204"><a href="#GridDetector-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span> <span class="o">=</span> <span class="n">grow_threshold</span>
</span><span id="GridDetector-205"><a href="#GridDetector-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span> <span class="o">=</span> <span class="n">look_distance</span>
</span><span id="GridDetector-206"><a href="#GridDetector-206"><span class="linenos">206</span></a>
</span><span id="GridDetector-207"><a href="#GridDetector-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cross_kernel</span><span class="p">()</span>
</span><span id="GridDetector-208"><a href="#GridDetector-208"><span class="linenos">208</span></a>
</span><span id="GridDetector-209"><a href="#GridDetector-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_parameters</span><span class="p">(</span>
</span><span id="GridDetector-210"><a href="#GridDetector-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector-211"><a href="#GridDetector-211"><span class="linenos">211</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector-212"><a href="#GridDetector-212"><span class="linenos">212</span></a>        <span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector-213"><a href="#GridDetector-213"><span class="linenos">213</span></a>        <span class="n">cross_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="GridDetector-214"><a href="#GridDetector-214"><span class="linenos">214</span></a>        <span class="n">morph_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="GridDetector-215"><a href="#GridDetector-215"><span class="linenos">215</span></a>        <span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector-216"><a href="#GridDetector-216"><span class="linenos">216</span></a>        <span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="GridDetector-217"><a href="#GridDetector-217"><span class="linenos">217</span></a>        <span class="n">sauvola_window</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector-218"><a href="#GridDetector-218"><span class="linenos">218</span></a>        <span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="GridDetector-219"><a href="#GridDetector-219"><span class="linenos">219</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-220"><a href="#GridDetector-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate initialization parameters.&quot;&quot;&quot;</span>
</span><span id="GridDetector-221"><a href="#GridDetector-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="n">kernel_size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-222"><a href="#GridDetector-222"><span class="linenos">222</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;kernel_size must be odd&quot;</span><span class="p">)</span>
</span><span id="GridDetector-223"><a href="#GridDetector-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GridDetector-224"><a href="#GridDetector-224"><span class="linenos">224</span></a>            <span class="n">kernel_size</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GridDetector-225"><a href="#GridDetector-225"><span class="linenos">225</span></a>            <span class="ow">or</span> <span class="n">cross_width</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GridDetector-226"><a href="#GridDetector-226"><span class="linenos">226</span></a>            <span class="ow">or</span> <span class="n">search_region</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GridDetector-227"><a href="#GridDetector-227"><span class="linenos">227</span></a>            <span class="ow">or</span> <span class="n">sauvola_window</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GridDetector-228"><a href="#GridDetector-228"><span class="linenos">228</span></a>        <span class="p">):</span>
</span><span id="GridDetector-229"><a href="#GridDetector-229"><span class="linenos">229</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Size parameters must be positive&quot;</span><span class="p">)</span>
</span><span id="GridDetector-230"><a href="#GridDetector-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="n">cross_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cross_height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-231"><a href="#GridDetector-231"><span class="linenos">231</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cross_height must be positive&quot;</span><span class="p">)</span>
</span><span id="GridDetector-232"><a href="#GridDetector-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">morph_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">morph_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-233"><a href="#GridDetector-233"><span class="linenos">233</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;morph_size must be positive&quot;</span><span class="p">)</span>
</span><span id="GridDetector-234"><a href="#GridDetector-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">distance_penalty</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GridDetector-235"><a href="#GridDetector-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;distance_penalty must be in [0, 1]&quot;</span><span class="p">)</span>
</span><span id="GridDetector-236"><a href="#GridDetector-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="n">sauvola_k</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-237"><a href="#GridDetector-237"><span class="linenos">237</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sauvola_k must be positive&quot;</span><span class="p">)</span>
</span><span id="GridDetector-238"><a href="#GridDetector-238"><span class="linenos">238</span></a>
</span><span id="GridDetector-239"><a href="#GridDetector-239"><span class="linenos">239</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_gaussian_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="GridDetector-240"><a href="#GridDetector-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-241"><a href="#GridDetector-241"><span class="linenos">241</span></a><span class="sd">        Create a 2D Gaussian weight mask.</span>
</span><span id="GridDetector-242"><a href="#GridDetector-242"><span class="linenos">242</span></a>
</span><span id="GridDetector-243"><a href="#GridDetector-243"><span class="linenos">243</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector-244"><a href="#GridDetector-244"><span class="linenos">244</span></a><span class="sd">            shape (tuple[int, int]): Shape of the region (height, width)</span>
</span><span id="GridDetector-245"><a href="#GridDetector-245"><span class="linenos">245</span></a><span class="sd">            p (float): Minimum value at the edge = 1 - p</span>
</span><span id="GridDetector-246"><a href="#GridDetector-246"><span class="linenos">246</span></a>
</span><span id="GridDetector-247"><a href="#GridDetector-247"><span class="linenos">247</span></a><span class="sd">        Returns:</span>
</span><span id="GridDetector-248"><a href="#GridDetector-248"><span class="linenos">248</span></a><span class="sd">            NDArray: Gaussian weight mask</span>
</span><span id="GridDetector-249"><a href="#GridDetector-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-250"><a href="#GridDetector-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-251"><a href="#GridDetector-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">region_size</span><span class="p">,</span> <span class="n">region_size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="GridDetector-252"><a href="#GridDetector-252"><span class="linenos">252</span></a>
</span><span id="GridDetector-253"><a href="#GridDetector-253"><span class="linenos">253</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector-254"><a href="#GridDetector-254"><span class="linenos">254</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector-255"><a href="#GridDetector-255"><span class="linenos">255</span></a>        <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GridDetector-256"><a href="#GridDetector-256"><span class="linenos">256</span></a>        <span class="n">dist_squared</span> <span class="o">=</span> <span class="n">xv</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yv</span><span class="o">**</span><span class="mi">2</span>
</span><span id="GridDetector-257"><a href="#GridDetector-257"><span class="linenos">257</span></a>
</span><span id="GridDetector-258"><a href="#GridDetector-258"><span class="linenos">258</span></a>        <span class="c1"># Prevent log(0) when distance_penalty is 1</span>
</span><span id="GridDetector-259"><a href="#GridDetector-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span> <span class="o">&gt;=</span> <span class="mf">0.999</span><span class="p">:</span>
</span><span id="GridDetector-260"><a href="#GridDetector-260"><span class="linenos">260</span></a>            <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Small sigma for very sharp peak</span>
</span><span id="GridDetector-261"><a href="#GridDetector-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-262"><a href="#GridDetector-262"><span class="linenos">262</span></a>            <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span><span class="p">)))</span>
</span><span id="GridDetector-263"><a href="#GridDetector-263"><span class="linenos">263</span></a>
</span><span id="GridDetector-264"><a href="#GridDetector-264"><span class="linenos">264</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dist_squared</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</span><span id="GridDetector-265"><a href="#GridDetector-265"><span class="linenos">265</span></a>
</span><span id="GridDetector-266"><a href="#GridDetector-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="n">weights</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="GridDetector-267"><a href="#GridDetector-267"><span class="linenos">267</span></a>
</span><span id="GridDetector-268"><a href="#GridDetector-268"><span class="linenos">268</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_cross_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="GridDetector-269"><a href="#GridDetector-269"><span class="linenos">269</span></a>        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="GridDetector-270"><a href="#GridDetector-270"><span class="linenos">270</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-271"><a href="#GridDetector-271"><span class="linenos">271</span></a>
</span><span id="GridDetector-272"><a href="#GridDetector-272"><span class="linenos">272</span></a>        <span class="c1"># Create horizontal bar</span>
</span><span id="GridDetector-273"><a href="#GridDetector-273"><span class="linenos">273</span></a>        <span class="n">h_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-274"><a href="#GridDetector-274"><span class="linenos">274</span></a>        <span class="n">h_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cross_height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-275"><a href="#GridDetector-275"><span class="linenos">275</span></a>        <span class="n">kernel</span><span class="p">[</span><span class="n">h_start</span><span class="p">:</span><span class="n">h_end</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">255</span>
</span><span id="GridDetector-276"><a href="#GridDetector-276"><span class="linenos">276</span></a>
</span><span id="GridDetector-277"><a href="#GridDetector-277"><span class="linenos">277</span></a>        <span class="c1"># Create vertical bar</span>
</span><span id="GridDetector-278"><a href="#GridDetector-278"><span class="linenos">278</span></a>        <span class="n">v_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-279"><a href="#GridDetector-279"><span class="linenos">279</span></a>        <span class="n">v_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cross_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-280"><a href="#GridDetector-280"><span class="linenos">280</span></a>        <span class="n">kernel</span><span class="p">[:,</span> <span class="n">v_start</span><span class="p">:</span><span class="n">v_end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
</span><span id="GridDetector-281"><a href="#GridDetector-281"><span class="linenos">281</span></a>
</span><span id="GridDetector-282"><a href="#GridDetector-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="n">kernel</span>
</span><span id="GridDetector-283"><a href="#GridDetector-283"><span class="linenos">283</span></a>
</span><span id="GridDetector-284"><a href="#GridDetector-284"><span class="linenos">284</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_morphology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="GridDetector-285"><a href="#GridDetector-285"><span class="linenos">285</span></a>        <span class="c1"># Define a horizontal kernel (adjust width as needed)</span>
</span><span id="GridDetector-286"><a href="#GridDetector-286"><span class="linenos">286</span></a>        <span class="n">kernel_hor</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_morph_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="GridDetector-287"><a href="#GridDetector-287"><span class="linenos">287</span></a>        <span class="n">kernel_ver</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_morph_size</span><span class="p">))</span>
</span><span id="GridDetector-288"><a href="#GridDetector-288"><span class="linenos">288</span></a>
</span><span id="GridDetector-289"><a href="#GridDetector-289"><span class="linenos">289</span></a>        <span class="c1"># Apply dilation</span>
</span><span id="GridDetector-290"><a href="#GridDetector-290"><span class="linenos">290</span></a>        <span class="n">dilated</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">kernel_hor</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GridDetector-291"><a href="#GridDetector-291"><span class="linenos">291</span></a>        <span class="n">dilated</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">dilated</span><span class="p">,</span> <span class="n">kernel_ver</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GridDetector-292"><a href="#GridDetector-292"><span class="linenos">292</span></a>
</span><span id="GridDetector-293"><a href="#GridDetector-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">dilated</span>
</span><span id="GridDetector-294"><a href="#GridDetector-294"><span class="linenos">294</span></a>
</span><span id="GridDetector-295"><a href="#GridDetector-295"><span class="linenos">295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_cross_matching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="GridDetector-296"><a href="#GridDetector-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply cross kernel template matching.&quot;&quot;&quot;</span>
</span><span id="GridDetector-297"><a href="#GridDetector-297"><span class="linenos">297</span></a>        <span class="n">pad_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-298"><a href="#GridDetector-298"><span class="linenos">298</span></a>        <span class="n">pad_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_kernel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-299"><a href="#GridDetector-299"><span class="linenos">299</span></a>
</span><span id="GridDetector-300"><a href="#GridDetector-300"><span class="linenos">300</span></a>        <span class="n">padded</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span>
</span><span id="GridDetector-301"><a href="#GridDetector-301"><span class="linenos">301</span></a>            <span class="n">img</span><span class="p">,</span> <span class="n">pad_y</span><span class="p">,</span> <span class="n">pad_y</span><span class="p">,</span> <span class="n">pad_x</span><span class="p">,</span> <span class="n">pad_x</span><span class="p">,</span> <span class="n">borderType</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GridDetector-302"><a href="#GridDetector-302"><span class="linenos">302</span></a>        <span class="p">)</span>
</span><span id="GridDetector-303"><a href="#GridDetector-303"><span class="linenos">303</span></a>
</span><span id="GridDetector-304"><a href="#GridDetector-304"><span class="linenos">304</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_kernel</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">TM_SQDIFF_NORMED</span><span class="p">)</span>
</span><span id="GridDetector-305"><a href="#GridDetector-305"><span class="linenos">305</span></a>        <span class="c1"># Invert and normalize to 0-255 range</span>
</span><span id="GridDetector-306"><a href="#GridDetector-306"><span class="linenos">306</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">filtered</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>
</span><span id="GridDetector-307"><a href="#GridDetector-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">filtered</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="GridDetector-308"><a href="#GridDetector-308"><span class="linenos">308</span></a>
</span><span id="GridDetector-309"><a href="#GridDetector-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="GridDetector-310"><a href="#GridDetector-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-311"><a href="#GridDetector-311"><span class="linenos">311</span></a><span class="sd">        Apply the grid detection filter to the input image.</span>
</span><span id="GridDetector-312"><a href="#GridDetector-312"><span class="linenos">312</span></a>
</span><span id="GridDetector-313"><a href="#GridDetector-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector-314"><a href="#GridDetector-314"><span class="linenos">314</span></a><span class="sd">            img (MatLike): the input image</span>
</span><span id="GridDetector-315"><a href="#GridDetector-315"><span class="linenos">315</span></a><span class="sd">            visual (bool): whether to show intermediate steps</span>
</span><span id="GridDetector-316"><a href="#GridDetector-316"><span class="linenos">316</span></a>
</span><span id="GridDetector-317"><a href="#GridDetector-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="GridDetector-318"><a href="#GridDetector-318"><span class="linenos">318</span></a><span class="sd">            MatLike: the filtered image, with high values (whiter pixels) at intersections of horizontal and vertical rules</span>
</span><span id="GridDetector-319"><a href="#GridDetector-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-320"><a href="#GridDetector-320"><span class="linenos">320</span></a>
</span><span id="GridDetector-321"><a href="#GridDetector-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-322"><a href="#GridDetector-322"><span class="linenos">322</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input image is empty or None&quot;</span><span class="p">)</span>
</span><span id="GridDetector-323"><a href="#GridDetector-323"><span class="linenos">323</span></a>
</span><span id="GridDetector-324"><a href="#GridDetector-324"><span class="linenos">324</span></a>        <span class="n">binary</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">sauvola</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_k</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_window</span><span class="p">)</span>
</span><span id="GridDetector-325"><a href="#GridDetector-325"><span class="linenos">325</span></a>
</span><span id="GridDetector-326"><a href="#GridDetector-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector-327"><a href="#GridDetector-327"><span class="linenos">327</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;thresholded&quot;</span><span class="p">)</span>
</span><span id="GridDetector-328"><a href="#GridDetector-328"><span class="linenos">328</span></a>
</span><span id="GridDetector-329"><a href="#GridDetector-329"><span class="linenos">329</span></a>        <span class="n">binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_morphology</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
</span><span id="GridDetector-330"><a href="#GridDetector-330"><span class="linenos">330</span></a>
</span><span id="GridDetector-331"><a href="#GridDetector-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector-332"><a href="#GridDetector-332"><span class="linenos">332</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;dilated&quot;</span><span class="p">)</span>
</span><span id="GridDetector-333"><a href="#GridDetector-333"><span class="linenos">333</span></a>
</span><span id="GridDetector-334"><a href="#GridDetector-334"><span class="linenos">334</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_cross_matching</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
</span><span id="GridDetector-335"><a href="#GridDetector-335"><span class="linenos">335</span></a>
</span><span id="GridDetector-336"><a href="#GridDetector-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="n">filtered</span>
</span><span id="GridDetector-337"><a href="#GridDetector-337"><span class="linenos">337</span></a>
</span><span id="GridDetector-338"><a href="#GridDetector-338"><span class="linenos">338</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector-339"><a href="#GridDetector-339"><span class="linenos">339</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_nearest</span><span class="p">(</span>
</span><span id="GridDetector-340"><a href="#GridDetector-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">filtered</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GridDetector-341"><a href="#GridDetector-341"><span class="linenos">341</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="GridDetector-342"><a href="#GridDetector-342"><span class="linenos">342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-343"><a href="#GridDetector-343"><span class="linenos">343</span></a><span class="sd">        Find the nearest &#39;corner match&#39; in the image, along with its score [0,1]</span>
</span><span id="GridDetector-344"><a href="#GridDetector-344"><span class="linenos">344</span></a>
</span><span id="GridDetector-345"><a href="#GridDetector-345"><span class="linenos">345</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector-346"><a href="#GridDetector-346"><span class="linenos">346</span></a><span class="sd">            filtered (MatLike): the filtered image (obtained through `apply`)</span>
</span><span id="GridDetector-347"><a href="#GridDetector-347"><span class="linenos">347</span></a><span class="sd">            point (tuple[int, int]): the approximate target point (x, y)</span>
</span><span id="GridDetector-348"><a href="#GridDetector-348"><span class="linenos">348</span></a><span class="sd">            region (None | int): alternative value for search region,</span>
</span><span id="GridDetector-349"><a href="#GridDetector-349"><span class="linenos">349</span></a><span class="sd">                overwriting the `__init__` parameter `region`</span>
</span><span id="GridDetector-350"><a href="#GridDetector-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-351"><a href="#GridDetector-351"><span class="linenos">351</span></a>
</span><span id="GridDetector-352"><a href="#GridDetector-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="n">filtered</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filtered</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-353"><a href="#GridDetector-353"><span class="linenos">353</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Filtered image is empty or None&quot;</span><span class="p">)</span>
</span><span id="GridDetector-354"><a href="#GridDetector-354"><span class="linenos">354</span></a>
</span><span id="GridDetector-355"><a href="#GridDetector-355"><span class="linenos">355</span></a>        <span class="n">region_size</span> <span class="o">=</span> <span class="n">region</span> <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span>
</span><span id="GridDetector-356"><a href="#GridDetector-356"><span class="linenos">356</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
</span><span id="GridDetector-357"><a href="#GridDetector-357"><span class="linenos">357</span></a>
</span><span id="GridDetector-358"><a href="#GridDetector-358"><span class="linenos">358</span></a>        <span class="c1"># Calculate crop boundaries</span>
</span><span id="GridDetector-359"><a href="#GridDetector-359"><span class="linenos">359</span></a>        <span class="n">crop_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-360"><a href="#GridDetector-360"><span class="linenos">360</span></a>        <span class="n">crop_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-361"><a href="#GridDetector-361"><span class="linenos">361</span></a>        <span class="n">crop_width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">region_size</span><span class="p">,</span> <span class="n">filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">crop_x</span><span class="p">)</span>
</span><span id="GridDetector-362"><a href="#GridDetector-362"><span class="linenos">362</span></a>        <span class="n">crop_height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">region_size</span><span class="p">,</span> <span class="n">filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">crop_y</span><span class="p">)</span>
</span><span id="GridDetector-363"><a href="#GridDetector-363"><span class="linenos">363</span></a>
</span><span id="GridDetector-364"><a href="#GridDetector-364"><span class="linenos">364</span></a>        <span class="c1"># Handle edge cases</span>
</span><span id="GridDetector-365"><a href="#GridDetector-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="n">crop_width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">crop_height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-366"><a href="#GridDetector-366"><span class="linenos">366</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2"> is outside image bounds&quot;</span><span class="p">)</span>
</span><span id="GridDetector-367"><a href="#GridDetector-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="n">point</span><span class="p">,</span> <span class="mf">0.0</span>
</span><span id="GridDetector-368"><a href="#GridDetector-368"><span class="linenos">368</span></a>
</span><span id="GridDetector-369"><a href="#GridDetector-369"><span class="linenos">369</span></a>        <span class="n">cropped</span> <span class="o">=</span> <span class="n">filtered</span><span class="p">[</span><span class="n">crop_y</span> <span class="p">:</span> <span class="n">crop_y</span> <span class="o">+</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">crop_x</span> <span class="p">:</span> <span class="n">crop_x</span> <span class="o">+</span> <span class="n">crop_width</span><span class="p">]</span>
</span><span id="GridDetector-370"><a href="#GridDetector-370"><span class="linenos">370</span></a>
</span><span id="GridDetector-371"><a href="#GridDetector-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="n">cropped</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-372"><a href="#GridDetector-372"><span class="linenos">372</span></a>            <span class="k">return</span> <span class="n">point</span><span class="p">,</span> <span class="mf">0.0</span>
</span><span id="GridDetector-373"><a href="#GridDetector-373"><span class="linenos">373</span></a>
</span><span id="GridDetector-374"><a href="#GridDetector-374"><span class="linenos">374</span></a>        <span class="c1"># Always apply Gaussian weighting by extending crop if needed</span>
</span><span id="GridDetector-375"><a href="#GridDetector-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">region_size</span> <span class="ow">and</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">region_size</span><span class="p">:</span>
</span><span id="GridDetector-376"><a href="#GridDetector-376"><span class="linenos">376</span></a>            <span class="c1"># Perfect size - apply weights directly</span>
</span><span id="GridDetector-377"><a href="#GridDetector-377"><span class="linenos">377</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_gaussian_weights</span><span class="p">(</span><span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector-378"><a href="#GridDetector-378"><span class="linenos">378</span></a>            <span class="n">weighted</span> <span class="o">=</span> <span class="n">cropped</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
</span><span id="GridDetector-379"><a href="#GridDetector-379"><span class="linenos">379</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-380"><a href="#GridDetector-380"><span class="linenos">380</span></a>            <span class="c1"># Extend crop to match region_size, apply weights, then restore</span>
</span><span id="GridDetector-381"><a href="#GridDetector-381"><span class="linenos">381</span></a>            <span class="n">extended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">region_size</span><span class="p">,</span> <span class="n">region_size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">cropped</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="GridDetector-382"><a href="#GridDetector-382"><span class="linenos">382</span></a>
</span><span id="GridDetector-383"><a href="#GridDetector-383"><span class="linenos">383</span></a>            <span class="c1"># Calculate offset to center the cropped region in extended array</span>
</span><span id="GridDetector-384"><a href="#GridDetector-384"><span class="linenos">384</span></a>            <span class="n">offset_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_size</span> <span class="o">-</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-385"><a href="#GridDetector-385"><span class="linenos">385</span></a>            <span class="n">offset_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_size</span> <span class="o">-</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-386"><a href="#GridDetector-386"><span class="linenos">386</span></a>
</span><span id="GridDetector-387"><a href="#GridDetector-387"><span class="linenos">387</span></a>            <span class="c1"># Place cropped region in center of extended array</span>
</span><span id="GridDetector-388"><a href="#GridDetector-388"><span class="linenos">388</span></a>            <span class="n">extended</span><span class="p">[</span>
</span><span id="GridDetector-389"><a href="#GridDetector-389"><span class="linenos">389</span></a>                <span class="n">offset_y</span> <span class="p">:</span> <span class="n">offset_y</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="GridDetector-390"><a href="#GridDetector-390"><span class="linenos">390</span></a>                <span class="n">offset_x</span> <span class="p">:</span> <span class="n">offset_x</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="GridDetector-391"><a href="#GridDetector-391"><span class="linenos">391</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">cropped</span>
</span><span id="GridDetector-392"><a href="#GridDetector-392"><span class="linenos">392</span></a>
</span><span id="GridDetector-393"><a href="#GridDetector-393"><span class="linenos">393</span></a>            <span class="c1"># Apply Gaussian weights to extended array</span>
</span><span id="GridDetector-394"><a href="#GridDetector-394"><span class="linenos">394</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_gaussian_weights</span><span class="p">(</span><span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector-395"><a href="#GridDetector-395"><span class="linenos">395</span></a>            <span class="n">weighted_extended</span> <span class="o">=</span> <span class="n">extended</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
</span><span id="GridDetector-396"><a href="#GridDetector-396"><span class="linenos">396</span></a>
</span><span id="GridDetector-397"><a href="#GridDetector-397"><span class="linenos">397</span></a>            <span class="c1"># Extract the original region back out</span>
</span><span id="GridDetector-398"><a href="#GridDetector-398"><span class="linenos">398</span></a>            <span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted_extended</span><span class="p">[</span>
</span><span id="GridDetector-399"><a href="#GridDetector-399"><span class="linenos">399</span></a>                <span class="n">offset_y</span> <span class="p">:</span> <span class="n">offset_y</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="GridDetector-400"><a href="#GridDetector-400"><span class="linenos">400</span></a>                <span class="n">offset_x</span> <span class="p">:</span> <span class="n">offset_x</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="GridDetector-401"><a href="#GridDetector-401"><span class="linenos">401</span></a>            <span class="p">]</span>
</span><span id="GridDetector-402"><a href="#GridDetector-402"><span class="linenos">402</span></a>
</span><span id="GridDetector-403"><a href="#GridDetector-403"><span class="linenos">403</span></a>        <span class="n">best_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">weighted</span><span class="p">)</span>
</span><span id="GridDetector-404"><a href="#GridDetector-404"><span class="linenos">404</span></a>        <span class="n">best_y</span><span class="p">,</span> <span class="n">best_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">best_idx</span><span class="p">,</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="GridDetector-405"><a href="#GridDetector-405"><span class="linenos">405</span></a>
</span><span id="GridDetector-406"><a href="#GridDetector-406"><span class="linenos">406</span></a>        <span class="n">result_point</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector-407"><a href="#GridDetector-407"><span class="linenos">407</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">crop_x</span> <span class="o">+</span> <span class="n">best_x</span><span class="p">),</span>
</span><span id="GridDetector-408"><a href="#GridDetector-408"><span class="linenos">408</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">crop_y</span> <span class="o">+</span> <span class="n">best_y</span><span class="p">),</span>
</span><span id="GridDetector-409"><a href="#GridDetector-409"><span class="linenos">409</span></a>        <span class="p">)</span>
</span><span id="GridDetector-410"><a href="#GridDetector-410"><span class="linenos">410</span></a>        <span class="n">result_confidence</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">weighted</span><span class="p">[</span><span class="n">best_y</span><span class="p">,</span> <span class="n">best_x</span><span class="p">])</span> <span class="o">/</span> <span class="mf">255.0</span>
</span><span id="GridDetector-411"><a href="#GridDetector-411"><span class="linenos">411</span></a>
</span><span id="GridDetector-412"><a href="#GridDetector-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="n">result_point</span><span class="p">,</span> <span class="n">result_confidence</span>
</span><span id="GridDetector-413"><a href="#GridDetector-413"><span class="linenos">413</span></a>
</span><span id="GridDetector-414"><a href="#GridDetector-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_table_points</span><span class="p">(</span>
</span><span id="GridDetector-415"><a href="#GridDetector-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector-416"><a href="#GridDetector-416"><span class="linenos">416</span></a>        <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="GridDetector-417"><a href="#GridDetector-417"><span class="linenos">417</span></a>        <span class="n">left_top</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
</span><span id="GridDetector-418"><a href="#GridDetector-418"><span class="linenos">418</span></a>        <span class="n">cell_widths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="GridDetector-419"><a href="#GridDetector-419"><span class="linenos">419</span></a>        <span class="n">cell_heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector-420"><a href="#GridDetector-420"><span class="linenos">420</span></a>        <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GridDetector-421"><a href="#GridDetector-421"><span class="linenos">421</span></a>        <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span><span class="p">,</span>
</span><span id="GridDetector-422"><a href="#GridDetector-422"><span class="linenos">422</span></a>        <span class="n">goals_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-423"><a href="#GridDetector-423"><span class="linenos">423</span></a>        <span class="n">filtered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-424"><a href="#GridDetector-424"><span class="linenos">424</span></a>        <span class="n">smooth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GridDetector-425"><a href="#GridDetector-425"><span class="linenos">425</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="GridDetector-426"><a href="#GridDetector-426"><span class="linenos">426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-427"><a href="#GridDetector-427"><span class="linenos">427</span></a><span class="sd">        Parse the image to a `TableGrid` structure that holds all of the</span>
</span><span id="GridDetector-428"><a href="#GridDetector-428"><span class="linenos">428</span></a><span class="sd">        intersections between horizontal and vertical rules, starting near the `left_top` point</span>
</span><span id="GridDetector-429"><a href="#GridDetector-429"><span class="linenos">429</span></a>
</span><span id="GridDetector-430"><a href="#GridDetector-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector-431"><a href="#GridDetector-431"><span class="linenos">431</span></a><span class="sd">            img (MatLike): the input image of a table</span>
</span><span id="GridDetector-432"><a href="#GridDetector-432"><span class="linenos">432</span></a><span class="sd">            left_top (tuple[int, int]): the starting point of the algorithm</span>
</span><span id="GridDetector-433"><a href="#GridDetector-433"><span class="linenos">433</span></a><span class="sd">            cell_widths (list[int]): the expected widths of the cells (based on a header template)</span>
</span><span id="GridDetector-434"><a href="#GridDetector-434"><span class="linenos">434</span></a><span class="sd">            cell_heights (list[int]): the expected height of the rows of data.</span>
</span><span id="GridDetector-435"><a href="#GridDetector-435"><span class="linenos">435</span></a><span class="sd">                The last value from this list is used until the image has no more vertical space.</span>
</span><span id="GridDetector-436"><a href="#GridDetector-436"><span class="linenos">436</span></a><span class="sd">            visual (bool): whether to show intermediate steps</span>
</span><span id="GridDetector-437"><a href="#GridDetector-437"><span class="linenos">437</span></a><span class="sd">            window (str): the name of the OpenCV window to use for visualization</span>
</span><span id="GridDetector-438"><a href="#GridDetector-438"><span class="linenos">438</span></a><span class="sd">            goals_width (int | None): the width of the goal region when searching for the next point.</span>
</span><span id="GridDetector-439"><a href="#GridDetector-439"><span class="linenos">439</span></a><span class="sd">                If None, defaults to 1.5 * search_region</span>
</span><span id="GridDetector-440"><a href="#GridDetector-440"><span class="linenos">440</span></a><span class="sd">            filtered (MatLike | PathLike[str] | None): if provided, this image is used instead of</span>
</span><span id="GridDetector-441"><a href="#GridDetector-441"><span class="linenos">441</span></a><span class="sd">                calculating the filtered image from scratch</span>
</span><span id="GridDetector-442"><a href="#GridDetector-442"><span class="linenos">442</span></a><span class="sd">            smooth (bool): if True, smooth the grid after detection, using local heuristics</span>
</span><span id="GridDetector-443"><a href="#GridDetector-443"><span class="linenos">443</span></a>
</span><span id="GridDetector-444"><a href="#GridDetector-444"><span class="linenos">444</span></a><span class="sd">        Returns:</span>
</span><span id="GridDetector-445"><a href="#GridDetector-445"><span class="linenos">445</span></a><span class="sd">            a TableGrid object</span>
</span><span id="GridDetector-446"><a href="#GridDetector-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-447"><a href="#GridDetector-447"><span class="linenos">447</span></a>
</span><span id="GridDetector-448"><a href="#GridDetector-448"><span class="linenos">448</span></a>        <span class="k">if</span> <span class="n">goals_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-449"><a href="#GridDetector-449"><span class="linenos">449</span></a>            <span class="n">goals_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector-450"><a href="#GridDetector-450"><span class="linenos">450</span></a>
</span><span id="GridDetector-451"><a href="#GridDetector-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell_widths</span><span class="p">:</span>
</span><span id="GridDetector-452"><a href="#GridDetector-452"><span class="linenos">452</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cell_widths must contain at least one value&quot;</span><span class="p">)</span>
</span><span id="GridDetector-453"><a href="#GridDetector-453"><span class="linenos">453</span></a>
</span><span id="GridDetector-454"><a href="#GridDetector-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="GridDetector-455"><a href="#GridDetector-455"><span class="linenos">455</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
</span><span id="GridDetector-456"><a href="#GridDetector-456"><span class="linenos">456</span></a>
</span><span id="GridDetector-457"><a href="#GridDetector-457"><span class="linenos">457</span></a>        <span class="k">if</span> <span class="n">filtered</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-458"><a href="#GridDetector-458"><span class="linenos">458</span></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">)</span>
</span><span id="GridDetector-459"><a href="#GridDetector-459"><span class="linenos">459</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-460"><a href="#GridDetector-460"><span class="linenos">460</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="GridDetector-461"><a href="#GridDetector-461"><span class="linenos">461</span></a>                <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filtered</span><span class="p">))</span>
</span><span id="GridDetector-462"><a href="#GridDetector-462"><span class="linenos">462</span></a>
</span><span id="GridDetector-463"><a href="#GridDetector-463"><span class="linenos">463</span></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
</span><span id="GridDetector-464"><a href="#GridDetector-464"><span class="linenos">464</span></a>
</span><span id="GridDetector-465"><a href="#GridDetector-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector-466"><a href="#GridDetector-466"><span class="linenos">466</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
</span><span id="GridDetector-467"><a href="#GridDetector-467"><span class="linenos">467</span></a>
</span><span id="GridDetector-468"><a href="#GridDetector-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell_heights</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="GridDetector-469"><a href="#GridDetector-469"><span class="linenos">469</span></a>            <span class="n">cell_heights</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell_heights</span><span class="p">]</span>
</span><span id="GridDetector-470"><a href="#GridDetector-470"><span class="linenos">470</span></a>
</span><span id="GridDetector-471"><a href="#GridDetector-471"><span class="linenos">471</span></a>        <span class="n">left_top</span><span class="p">,</span> <span class="n">confidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span>
</span><span id="GridDetector-472"><a href="#GridDetector-472"><span class="linenos">472</span></a>            <span class="n">filtered</span><span class="p">,</span> <span class="n">left_top</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="GridDetector-473"><a href="#GridDetector-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="GridDetector-474"><a href="#GridDetector-474"><span class="linenos">474</span></a>
</span><span id="GridDetector-475"><a href="#GridDetector-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
</span><span id="GridDetector-476"><a href="#GridDetector-476"><span class="linenos">476</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="GridDetector-477"><a href="#GridDetector-477"><span class="linenos">477</span></a>                <span class="sa">f</span><span class="s2">&quot;Low confidence for the starting point: </span><span class="si">{</span><span class="n">confidence</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">left_top</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GridDetector-478"><a href="#GridDetector-478"><span class="linenos">478</span></a>            <span class="p">)</span>
</span><span id="GridDetector-479"><a href="#GridDetector-479"><span class="linenos">479</span></a>
</span><span id="GridDetector-480"><a href="#GridDetector-480"><span class="linenos">480</span></a>        <span class="c1"># resize all parameters according to scale</span>
</span><span id="GridDetector-481"><a href="#GridDetector-481"><span class="linenos">481</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector-482"><a href="#GridDetector-482"><span class="linenos">482</span></a>
</span><span id="GridDetector-483"><a href="#GridDetector-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector-484"><a href="#GridDetector-484"><span class="linenos">484</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector-485"><a href="#GridDetector-485"><span class="linenos">485</span></a>
</span><span id="GridDetector-486"><a href="#GridDetector-486"><span class="linenos">486</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector-487"><a href="#GridDetector-487"><span class="linenos">487</span></a>        <span class="n">cell_widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">cell_widths</span><span class="p">]</span>
</span><span id="GridDetector-488"><a href="#GridDetector-488"><span class="linenos">488</span></a>        <span class="n">cell_heights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">cell_heights</span><span class="p">]</span>
</span><span id="GridDetector-489"><a href="#GridDetector-489"><span class="linenos">489</span></a>        <span class="n">left_top</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span>
</span><span id="GridDetector-490"><a href="#GridDetector-490"><span class="linenos">490</span></a>        <span class="n">search_region</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector-491"><a href="#GridDetector-491"><span class="linenos">491</span></a>
</span><span id="GridDetector-492"><a href="#GridDetector-492"><span class="linenos">492</span></a>        <span class="n">img_gray</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector-493"><a href="#GridDetector-493"><span class="linenos">493</span></a>        <span class="n">filtered_gray</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
</span><span id="GridDetector-494"><a href="#GridDetector-494"><span class="linenos">494</span></a>
</span><span id="GridDetector-495"><a href="#GridDetector-495"><span class="linenos">495</span></a>        <span class="n">table_grower</span> <span class="o">=</span> <span class="n">TableGrower</span><span class="p">(</span>
</span><span id="GridDetector-496"><a href="#GridDetector-496"><span class="linenos">496</span></a>            <span class="n">img_gray</span><span class="p">,</span>
</span><span id="GridDetector-497"><a href="#GridDetector-497"><span class="linenos">497</span></a>            <span class="n">filtered_gray</span><span class="p">,</span>
</span><span id="GridDetector-498"><a href="#GridDetector-498"><span class="linenos">498</span></a>            <span class="n">cell_widths</span><span class="p">,</span>  <span class="c1"># pyright: ignore</span>
</span><span id="GridDetector-499"><a href="#GridDetector-499"><span class="linenos">499</span></a>            <span class="n">cell_heights</span><span class="p">,</span>  <span class="c1"># pyright: ignore</span>
</span><span id="GridDetector-500"><a href="#GridDetector-500"><span class="linenos">500</span></a>            <span class="n">left_top</span><span class="p">,</span>
</span><span id="GridDetector-501"><a href="#GridDetector-501"><span class="linenos">501</span></a>            <span class="n">search_region</span><span class="p">,</span>
</span><span id="GridDetector-502"><a href="#GridDetector-502"><span class="linenos">502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span><span class="p">,</span>
</span><span id="GridDetector-503"><a href="#GridDetector-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span><span class="p">,</span>
</span><span id="GridDetector-504"><a href="#GridDetector-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span><span class="p">,</span>
</span><span id="GridDetector-505"><a href="#GridDetector-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_min_rows</span><span class="p">,</span>
</span><span id="GridDetector-506"><a href="#GridDetector-506"><span class="linenos">506</span></a>        <span class="p">)</span>
</span><span id="GridDetector-507"><a href="#GridDetector-507"><span class="linenos">507</span></a>
</span><span id="GridDetector-508"><a href="#GridDetector-508"><span class="linenos">508</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">show_grower_progress</span><span class="p">(</span><span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="GridDetector-509"><a href="#GridDetector-509"><span class="linenos">509</span></a>            <span class="n">img_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector-510"><a href="#GridDetector-510"><span class="linenos">510</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_all_corners</span><span class="p">()</span>
</span><span id="GridDetector-511"><a href="#GridDetector-511"><span class="linenos">511</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)):</span>
</span><span id="GridDetector-512"><a href="#GridDetector-512"><span class="linenos">512</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">])):</span>
</span><span id="GridDetector-513"><a href="#GridDetector-513"><span class="linenos">513</span></a>                    <span class="k">if</span> <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-514"><a href="#GridDetector-514"><span class="linenos">514</span></a>                        <span class="n">img_orig</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span>
</span><span id="GridDetector-515"><a href="#GridDetector-515"><span class="linenos">515</span></a>                            <span class="n">img_orig</span><span class="p">,</span>
</span><span id="GridDetector-516"><a href="#GridDetector-516"><span class="linenos">516</span></a>                            <span class="p">[</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]],</span>
</span><span id="GridDetector-517"><a href="#GridDetector-517"><span class="linenos">517</span></a>                            <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="GridDetector-518"><a href="#GridDetector-518"><span class="linenos">518</span></a>                            <span class="n">thickness</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="GridDetector-519"><a href="#GridDetector-519"><span class="linenos">519</span></a>                        <span class="p">)</span>
</span><span id="GridDetector-520"><a href="#GridDetector-520"><span class="linenos">520</span></a>
</span><span id="GridDetector-521"><a href="#GridDetector-521"><span class="linenos">521</span></a>            <span class="n">edge</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_edge_points</span><span class="p">()</span>
</span><span id="GridDetector-522"><a href="#GridDetector-522"><span class="linenos">522</span></a>
</span><span id="GridDetector-523"><a href="#GridDetector-523"><span class="linenos">523</span></a>            <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">:</span>
</span><span id="GridDetector-524"><a href="#GridDetector-524"><span class="linenos">524</span></a>                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">score</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="GridDetector-525"><a href="#GridDetector-525"><span class="linenos">525</span></a>                <span class="n">imu</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">img_orig</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="GridDetector-526"><a href="#GridDetector-526"><span class="linenos">526</span></a>
</span><span id="GridDetector-527"><a href="#GridDetector-527"><span class="linenos">527</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_orig</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
</span><span id="GridDetector-528"><a href="#GridDetector-528"><span class="linenos">528</span></a>
</span><span id="GridDetector-529"><a href="#GridDetector-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector-530"><a href="#GridDetector-530"><span class="linenos">530</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span>
</span><span id="GridDetector-531"><a href="#GridDetector-531"><span class="linenos">531</span></a>            <span class="n">look_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span>
</span><span id="GridDetector-532"><a href="#GridDetector-532"><span class="linenos">532</span></a>
</span><span id="GridDetector-533"><a href="#GridDetector-533"><span class="linenos">533</span></a>            <span class="c1"># python implementation of rust loops, for visualization purposes</span>
</span><span id="GridDetector-534"><a href="#GridDetector-534"><span class="linenos">534</span></a>            <span class="c1"># note this is a LOT slower</span>
</span><span id="GridDetector-535"><a href="#GridDetector-535"><span class="linenos">535</span></a>            <span class="k">while</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-536"><a href="#GridDetector-536"><span class="linenos">536</span></a>                <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector-537"><a href="#GridDetector-537"><span class="linenos">537</span></a>
</span><span id="GridDetector-538"><a href="#GridDetector-538"><span class="linenos">538</span></a>            <span class="n">show_grower_progress</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector-539"><a href="#GridDetector-539"><span class="linenos">539</span></a>
</span><span id="GridDetector-540"><a href="#GridDetector-540"><span class="linenos">540</span></a>            <span class="n">original_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
</span><span id="GridDetector-541"><a href="#GridDetector-541"><span class="linenos">541</span></a>
</span><span id="GridDetector-542"><a href="#GridDetector-542"><span class="linenos">542</span></a>            <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector-543"><a href="#GridDetector-543"><span class="linenos">543</span></a>
</span><span id="GridDetector-544"><a href="#GridDetector-544"><span class="linenos">544</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">is_table_complete</span><span class="p">():</span>
</span><span id="GridDetector-545"><a href="#GridDetector-545"><span class="linenos">545</span></a>                <span class="n">loops_without_change</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="GridDetector-546"><a href="#GridDetector-546"><span class="linenos">546</span></a>
</span><span id="GridDetector-547"><a href="#GridDetector-547"><span class="linenos">547</span></a>                <span class="k">if</span> <span class="n">loops_without_change</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="GridDetector-548"><a href="#GridDetector-548"><span class="linenos">548</span></a>                    <span class="k">break</span>
</span><span id="GridDetector-549"><a href="#GridDetector-549"><span class="linenos">549</span></a>
</span><span id="GridDetector-550"><a href="#GridDetector-550"><span class="linenos">550</span></a>                <span class="k">if</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">extrapolate_one</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-551"><a href="#GridDetector-551"><span class="linenos">551</span></a>                    <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector-552"><a href="#GridDetector-552"><span class="linenos">552</span></a>
</span><span id="GridDetector-553"><a href="#GridDetector-553"><span class="linenos">553</span></a>                    <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector-554"><a href="#GridDetector-554"><span class="linenos">554</span></a>
</span><span id="GridDetector-555"><a href="#GridDetector-555"><span class="linenos">555</span></a>                    <span class="n">grown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GridDetector-556"><a href="#GridDetector-556"><span class="linenos">556</span></a>                    <span class="k">while</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-557"><a href="#GridDetector-557"><span class="linenos">557</span></a>                        <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector-558"><a href="#GridDetector-558"><span class="linenos">558</span></a>                        <span class="n">grown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GridDetector-559"><a href="#GridDetector-559"><span class="linenos">559</span></a>                        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">original_threshold</span><span class="p">)</span>
</span><span id="GridDetector-560"><a href="#GridDetector-560"><span class="linenos">560</span></a>                        <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector-561"><a href="#GridDetector-561"><span class="linenos">561</span></a>
</span><span id="GridDetector-562"><a href="#GridDetector-562"><span class="linenos">562</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">grown</span><span class="p">:</span>
</span><span id="GridDetector-563"><a href="#GridDetector-563"><span class="linenos">563</span></a>                        <span class="n">threshold</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="GridDetector-564"><a href="#GridDetector-564"><span class="linenos">564</span></a>                        <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector-565"><a href="#GridDetector-565"><span class="linenos">565</span></a>
</span><span id="GridDetector-566"><a href="#GridDetector-566"><span class="linenos">566</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-567"><a href="#GridDetector-567"><span class="linenos">567</span></a>                    <span class="n">threshold</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="GridDetector-568"><a href="#GridDetector-568"><span class="linenos">568</span></a>                    <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector-569"><a href="#GridDetector-569"><span class="linenos">569</span></a>
</span><span id="GridDetector-570"><a href="#GridDetector-570"><span class="linenos">570</span></a>                    <span class="k">if</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-571"><a href="#GridDetector-571"><span class="linenos">571</span></a>                        <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector-572"><a href="#GridDetector-572"><span class="linenos">572</span></a>                        <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector-573"><a href="#GridDetector-573"><span class="linenos">573</span></a>
</span><span id="GridDetector-574"><a href="#GridDetector-574"><span class="linenos">574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-575"><a href="#GridDetector-575"><span class="linenos">575</span></a>            <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_table</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span>
</span><span id="GridDetector-576"><a href="#GridDetector-576"><span class="linenos">576</span></a>
</span><span id="GridDetector-577"><a href="#GridDetector-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="n">smooth</span><span class="p">:</span>
</span><span id="GridDetector-578"><a href="#GridDetector-578"><span class="linenos">578</span></a>            <span class="n">table_grower</span><span class="o">.</span><span class="n">smooth_grid</span><span class="p">()</span>
</span><span id="GridDetector-579"><a href="#GridDetector-579"><span class="linenos">579</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_all_corners</span><span class="p">()</span>
</span><span id="GridDetector-580"><a href="#GridDetector-580"><span class="linenos">580</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="GridDetector-581"><a href="#GridDetector-581"><span class="linenos">581</span></a>            <span class="sa">f</span><span class="s2">&quot;Table growth complete, found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> columns&quot;</span>
</span><span id="GridDetector-582"><a href="#GridDetector-582"><span class="linenos">582</span></a>        <span class="p">)</span>
</span><span id="GridDetector-583"><a href="#GridDetector-583"><span class="linenos">583</span></a>        <span class="c1"># rescale corners back to original size</span>
</span><span id="GridDetector-584"><a href="#GridDetector-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="GridDetector-585"><a href="#GridDetector-585"><span class="linenos">585</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)):</span>
</span><span id="GridDetector-586"><a href="#GridDetector-586"><span class="linenos">586</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">])):</span>
</span><span id="GridDetector-587"><a href="#GridDetector-587"><span class="linenos">587</span></a>                    <span class="k">if</span> <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-588"><a href="#GridDetector-588"><span class="linenos">588</span></a>                        <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector-589"><a href="#GridDetector-589"><span class="linenos">589</span></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span>  <span class="c1"># pyright:ignore</span>
</span><span id="GridDetector-590"><a href="#GridDetector-590"><span class="linenos">590</span></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span>  <span class="c1"># pyright:ignore</span>
</span><span id="GridDetector-591"><a href="#GridDetector-591"><span class="linenos">591</span></a>                        <span class="p">)</span>
</span><span id="GridDetector-592"><a href="#GridDetector-592"><span class="linenos">592</span></a>
</span><span id="GridDetector-593"><a href="#GridDetector-593"><span class="linenos">593</span></a>        <span class="k">return</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span><span id="GridDetector-594"><a href="#GridDetector-594"><span class="linenos">594</span></a>
</span><span id="GridDetector-595"><a href="#GridDetector-595"><span class="linenos">595</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-596"><a href="#GridDetector-596"><span class="linenos">596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the detected grid points.&quot;&quot;&quot;</span>
</span><span id="GridDetector-597"><a href="#GridDetector-597"><span class="linenos">597</span></a>        <span class="n">all_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
</span><span id="GridDetector-598"><a href="#GridDetector-598"><span class="linenos">598</span></a>        <span class="n">drawn</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">all_points</span><span class="p">)</span>
</span><span id="GridDetector-599"><a href="#GridDetector-599"><span class="linenos">599</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">drawn</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector-600"><a href="#GridDetector-600"><span class="linenos">600</span></a>
</span><span id="GridDetector-601"><a href="#GridDetector-601"><span class="linenos">601</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize_path_finding</span><span class="p">(</span>
</span><span id="GridDetector-602"><a href="#GridDetector-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector-603"><a href="#GridDetector-603"><span class="linenos">603</span></a>        <span class="n">path</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
</span><span id="GridDetector-604"><a href="#GridDetector-604"><span class="linenos">604</span></a>        <span class="n">current</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
</span><span id="GridDetector-605"><a href="#GridDetector-605"><span class="linenos">605</span></a>        <span class="n">next_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
</span><span id="GridDetector-606"><a href="#GridDetector-606"><span class="linenos">606</span></a>        <span class="n">previous_row_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-607"><a href="#GridDetector-607"><span class="linenos">607</span></a>        <span class="n">region_center</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-608"><a href="#GridDetector-608"><span class="linenos">608</span></a>        <span class="n">region_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector-609"><a href="#GridDetector-609"><span class="linenos">609</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-610"><a href="#GridDetector-610"><span class="linenos">610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the path finding process for debugging.&quot;&quot;&quot;</span>
</span><span id="GridDetector-611"><a href="#GridDetector-611"><span class="linenos">611</span></a>        <span class="k">global</span> <span class="n">show_time</span>
</span><span id="GridDetector-612"><a href="#GridDetector-612"><span class="linenos">612</span></a>
</span><span id="GridDetector-613"><a href="#GridDetector-613"><span class="linenos">613</span></a>        <span class="n">screen</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="GridDetector-614"><a href="#GridDetector-614"><span class="linenos">614</span></a>
</span><span id="GridDetector-615"><a href="#GridDetector-615"><span class="linenos">615</span></a>        <span class="c1"># if gray, convert to BGR</span>
</span><span id="GridDetector-616"><a href="#GridDetector-616"><span class="linenos">616</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">screen</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">screen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GridDetector-617"><a href="#GridDetector-617"><span class="linenos">617</span></a>            <span class="n">debug_img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">COLOR_GRAY2BGR</span><span class="p">)</span>
</span><span id="GridDetector-618"><a href="#GridDetector-618"><span class="linenos">618</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector-619"><a href="#GridDetector-619"><span class="linenos">619</span></a>            <span class="n">debug_img</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">screen</span><span class="p">)</span>
</span><span id="GridDetector-620"><a href="#GridDetector-620"><span class="linenos">620</span></a>
</span><span id="GridDetector-621"><a href="#GridDetector-621"><span class="linenos">621</span></a>        <span class="n">debug_img</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span><span class="n">debug_img</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector-622"><a href="#GridDetector-622"><span class="linenos">622</span></a>        <span class="n">debug_img</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span>
</span><span id="GridDetector-623"><a href="#GridDetector-623"><span class="linenos">623</span></a>            <span class="n">debug_img</span><span class="p">,</span> <span class="p">[</span><span class="n">current</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">3</span>
</span><span id="GridDetector-624"><a href="#GridDetector-624"><span class="linenos">624</span></a>        <span class="p">)</span>
</span><span id="GridDetector-625"><a href="#GridDetector-625"><span class="linenos">625</span></a>        <span class="n">debug_img</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span>
</span><span id="GridDetector-626"><a href="#GridDetector-626"><span class="linenos">626</span></a>            <span class="n">debug_img</span><span class="p">,</span> <span class="p">[</span><span class="n">next_point</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span>
</span><span id="GridDetector-627"><a href="#GridDetector-627"><span class="linenos">627</span></a>        <span class="p">)</span>
</span><span id="GridDetector-628"><a href="#GridDetector-628"><span class="linenos">628</span></a>
</span><span id="GridDetector-629"><a href="#GridDetector-629"><span class="linenos">629</span></a>        <span class="c1"># Draw previous row target if available</span>
</span><span id="GridDetector-630"><a href="#GridDetector-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="n">previous_row_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-631"><a href="#GridDetector-631"><span class="linenos">631</span></a>            <span class="n">debug_img</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span>
</span><span id="GridDetector-632"><a href="#GridDetector-632"><span class="linenos">632</span></a>                <span class="n">debug_img</span><span class="p">,</span> <span class="p">[</span><span class="n">previous_row_target</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span>
</span><span id="GridDetector-633"><a href="#GridDetector-633"><span class="linenos">633</span></a>            <span class="p">)</span>
</span><span id="GridDetector-634"><a href="#GridDetector-634"><span class="linenos">634</span></a>
</span><span id="GridDetector-635"><a href="#GridDetector-635"><span class="linenos">635</span></a>        <span class="c1"># Draw search region if available</span>
</span><span id="GridDetector-636"><a href="#GridDetector-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="n">region_center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">region_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-637"><a href="#GridDetector-637"><span class="linenos">637</span></a>            <span class="n">top_left</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector-638"><a href="#GridDetector-638"><span class="linenos">638</span></a>                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">region_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="GridDetector-639"><a href="#GridDetector-639"><span class="linenos">639</span></a>                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">region_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="GridDetector-640"><a href="#GridDetector-640"><span class="linenos">640</span></a>            <span class="p">)</span>
</span><span id="GridDetector-641"><a href="#GridDetector-641"><span class="linenos">641</span></a>            <span class="n">bottom_right</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector-642"><a href="#GridDetector-642"><span class="linenos">642</span></a>                <span class="nb">min</span><span class="p">(</span><span class="n">debug_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">region_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="GridDetector-643"><a href="#GridDetector-643"><span class="linenos">643</span></a>                <span class="nb">min</span><span class="p">(</span><span class="n">debug_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="GridDetector-644"><a href="#GridDetector-644"><span class="linenos">644</span></a>            <span class="p">)</span>
</span><span id="GridDetector-645"><a href="#GridDetector-645"><span class="linenos">645</span></a>            <span class="n">cv</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span>
</span><span id="GridDetector-646"><a href="#GridDetector-646"><span class="linenos">646</span></a>                <span class="n">debug_img</span><span class="p">,</span>
</span><span id="GridDetector-647"><a href="#GridDetector-647"><span class="linenos">647</span></a>                <span class="n">top_left</span><span class="p">,</span>
</span><span id="GridDetector-648"><a href="#GridDetector-648"><span class="linenos">648</span></a>                <span class="n">bottom_right</span><span class="p">,</span>
</span><span id="GridDetector-649"><a href="#GridDetector-649"><span class="linenos">649</span></a>                <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="GridDetector-650"><a href="#GridDetector-650"><span class="linenos">650</span></a>                <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="GridDetector-651"><a href="#GridDetector-651"><span class="linenos">651</span></a>                <span class="n">lineType</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span>
</span><span id="GridDetector-652"><a href="#GridDetector-652"><span class="linenos">652</span></a>            <span class="p">)</span>
</span><span id="GridDetector-653"><a href="#GridDetector-653"><span class="linenos">653</span></a>
</span><span id="GridDetector-654"><a href="#GridDetector-654"><span class="linenos">654</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">debug_img</span><span class="p">)</span>
</span><span id="GridDetector-655"><a href="#GridDetector-655"><span class="linenos">655</span></a>
</span><span id="GridDetector-656"><a href="#GridDetector-656"><span class="linenos">656</span></a>        <span class="n">show_time</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="GridDetector-657"><a href="#GridDetector-657"><span class="linenos">657</span></a>        <span class="k">if</span> <span class="n">show_time</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GridDetector-658"><a href="#GridDetector-658"><span class="linenos">658</span></a>            <span class="k">return</span>
</span><span id="GridDetector-659"><a href="#GridDetector-659"><span class="linenos">659</span></a>
</span><span id="GridDetector-660"><a href="#GridDetector-660"><span class="linenos">660</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">debug_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Next column point&quot;</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GridDetector-661"><a href="#GridDetector-661"><span class="linenos">661</span></a>        <span class="c1"># time.sleep(0.003)</span>
</span><span id="GridDetector-662"><a href="#GridDetector-662"><span class="linenos">662</span></a>
</span><span id="GridDetector-663"><a href="#GridDetector-663"><span class="linenos">663</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector-664"><a href="#GridDetector-664"><span class="linenos">664</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_astar</span><span class="p">(</span>
</span><span id="GridDetector-665"><a href="#GridDetector-665"><span class="linenos">665</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector-666"><a href="#GridDetector-666"><span class="linenos">666</span></a>        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="GridDetector-667"><a href="#GridDetector-667"><span class="linenos">667</span></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="GridDetector-668"><a href="#GridDetector-668"><span class="linenos">668</span></a>        <span class="n">goals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="GridDetector-669"><a href="#GridDetector-669"><span class="linenos">669</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GridDetector-670"><a href="#GridDetector-670"><span class="linenos">670</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]]:</span>
</span><span id="GridDetector-671"><a href="#GridDetector-671"><span class="linenos">671</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector-672"><a href="#GridDetector-672"><span class="linenos">672</span></a><span class="sd">        Find the best path between the start point and one of the goal points on the image</span>
</span><span id="GridDetector-673"><a href="#GridDetector-673"><span class="linenos">673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector-674"><a href="#GridDetector-674"><span class="linenos">674</span></a>
</span><span id="GridDetector-675"><a href="#GridDetector-675"><span class="linenos">675</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">goals</span><span class="p">:</span>
</span><span id="GridDetector-676"><a href="#GridDetector-676"><span class="linenos">676</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GridDetector-677"><a href="#GridDetector-677"><span class="linenos">677</span></a>
</span><span id="GridDetector-678"><a href="#GridDetector-678"><span class="linenos">678</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="GridDetector-679"><a href="#GridDetector-679"><span class="linenos">679</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector-680"><a href="#GridDetector-680"><span class="linenos">680</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span>
</span><span id="GridDetector-681"><a href="#GridDetector-681"><span class="linenos">681</span></a>            <span class="n">goals</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">goals</span><span class="p">]</span>
</span><span id="GridDetector-682"><a href="#GridDetector-682"><span class="linenos">682</span></a>
</span><span id="GridDetector-683"><a href="#GridDetector-683"><span class="linenos">683</span></a>        <span class="c1"># calculate bounding box with margin</span>
</span><span id="GridDetector-684"><a href="#GridDetector-684"><span class="linenos">684</span></a>        <span class="n">all_points</span> <span class="o">=</span> <span class="n">goals</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
</span><span id="GridDetector-685"><a href="#GridDetector-685"><span class="linenos">685</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="GridDetector-686"><a href="#GridDetector-686"><span class="linenos">686</span></a>        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="GridDetector-687"><a href="#GridDetector-687"><span class="linenos">687</span></a>
</span><span id="GridDetector-688"><a href="#GridDetector-688"><span class="linenos">688</span></a>        <span class="n">margin</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="GridDetector-689"><a href="#GridDetector-689"><span class="linenos">689</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span><span class="p">))</span>
</span><span id="GridDetector-690"><a href="#GridDetector-690"><span class="linenos">690</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector-691"><a href="#GridDetector-691"><span class="linenos">691</span></a>            <span class="nb">min</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span><span class="p">),</span>
</span><span id="GridDetector-692"><a href="#GridDetector-692"><span class="linenos">692</span></a>            <span class="nb">min</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span><span class="p">),</span>
</span><span id="GridDetector-693"><a href="#GridDetector-693"><span class="linenos">693</span></a>        <span class="p">)</span>
</span><span id="GridDetector-694"><a href="#GridDetector-694"><span class="linenos">694</span></a>
</span><span id="GridDetector-695"><a href="#GridDetector-695"><span class="linenos">695</span></a>        <span class="c1"># check bounds</span>
</span><span id="GridDetector-696"><a href="#GridDetector-696"><span class="linenos">696</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GridDetector-697"><a href="#GridDetector-697"><span class="linenos">697</span></a>            <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GridDetector-698"><a href="#GridDetector-698"><span class="linenos">698</span></a>            <span class="ow">or</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GridDetector-699"><a href="#GridDetector-699"><span class="linenos">699</span></a>            <span class="ow">or</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GridDetector-700"><a href="#GridDetector-700"><span class="linenos">700</span></a>            <span class="ow">or</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GridDetector-701"><a href="#GridDetector-701"><span class="linenos">701</span></a>        <span class="p">):</span>
</span><span id="GridDetector-702"><a href="#GridDetector-702"><span class="linenos">702</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GridDetector-703"><a href="#GridDetector-703"><span class="linenos">703</span></a>
</span><span id="GridDetector-704"><a href="#GridDetector-704"><span class="linenos">704</span></a>        <span class="c1"># transform coordinates to cropped image</span>
</span><span id="GridDetector-705"><a href="#GridDetector-705"><span class="linenos">705</span></a>        <span class="n">start_local</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="GridDetector-706"><a href="#GridDetector-706"><span class="linenos">706</span></a>        <span class="n">goals_local</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">goals</span><span class="p">]</span>
</span><span id="GridDetector-707"><a href="#GridDetector-707"><span class="linenos">707</span></a>
</span><span id="GridDetector-708"><a href="#GridDetector-708"><span class="linenos">708</span></a>        <span class="n">cropped</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">bottom_right</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">bottom_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="GridDetector-709"><a href="#GridDetector-709"><span class="linenos">709</span></a>
</span><span id="GridDetector-710"><a href="#GridDetector-710"><span class="linenos">710</span></a>        <span class="k">if</span> <span class="n">cropped</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector-711"><a href="#GridDetector-711"><span class="linenos">711</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GridDetector-712"><a href="#GridDetector-712"><span class="linenos">712</span></a>
</span><span id="GridDetector-713"><a href="#GridDetector-713"><span class="linenos">713</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">rust_astar</span><span class="p">(</span><span class="n">cropped</span><span class="p">,</span> <span class="n">start_local</span><span class="p">,</span> <span class="n">goals_local</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span><span id="GridDetector-714"><a href="#GridDetector-714"><span class="linenos">714</span></a>
</span><span id="GridDetector-715"><a href="#GridDetector-715"><span class="linenos">715</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector-716"><a href="#GridDetector-716"><span class="linenos">716</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GridDetector-717"><a href="#GridDetector-717"><span class="linenos">717</span></a>
</span><span id="GridDetector-718"><a href="#GridDetector-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="GridDetector-719"><a href="#GridDetector-719"><span class="linenos">719</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
</span><span id="GridDetector-720"><a href="#GridDetector-720"><span class="linenos">720</span></a>            <span class="n">top_left</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span>
</span><span id="GridDetector-721"><a href="#GridDetector-721"><span class="linenos">721</span></a>
</span><span id="GridDetector-722"><a href="#GridDetector-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Detects table grid intersections using morphological filtering and template matching.</p>

<p>This detector implements a multi-stage pipeline:</p>

<ol>
<li><strong>Binarization</strong>: Sauvola adaptive thresholding to handle varying lighting</li>
<li><strong>Morphological operations</strong>: Dilation to connect broken rule segments</li>
<li><strong>Cross-kernel matching</strong>: Template matching with a cross-shaped kernel to find
rule intersections where horizontal and vertical lines meet</li>
<li><strong>Grid growing</strong>: Iterative point detection starting from a known seed point</li>
</ol>

<p>The cross-kernel is designed to match the specific geometry of your table rules.
It should be sized so that after morphology, it aligns with actual corner shapes.</p>

<h2 id="tuning-guidelines">Tuning Guidelines</h2>

<ul>
<li><strong>kernel_size</strong>: Increase if you need more selectivity (fewer false positives)</li>
<li><strong>cross_width/height</strong>: Should match rule thickness after morphology</li>
<li><strong>morph_size</strong>: Increase to connect more broken lines, but this thickens rules</li>
<li><strong>sauvola_k</strong>: Increase to threshold more aggressively (remove noise)</li>
<li><strong>search_region</strong>: Increase for documents with more warping/distortion</li>
<li><strong>distance_penalty</strong>: Increase to prefer corners closer to expected positions</li>
</ul>

<h2 id="visual-debugging">Visual Debugging</h2>

<p>Set <code>visual=True</code> in methods to see intermediate results and tune parameters.</p>
</div>


                            <div id="GridDetector.__init__" class="classattr">
                                        <input id="GridDetector.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GridDetector</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">21</span>,</span><span class="param">	<span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>,</span><span class="param">	<span class="n">cross_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">morph_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span>,</span><span class="param">	<span class="n">sauvola_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>,</span><span class="param">	<span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span>,</span><span class="param">	<span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">grow_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">look_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span></span>)</span>

                <label class="view-source-button" for="GridDetector.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridDetector.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridDetector.__init__-148"><a href="#GridDetector.__init__-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GridDetector.__init__-149"><a href="#GridDetector.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector.__init__-150"><a href="#GridDetector.__init__-150"><span class="linenos">150</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
</span><span id="GridDetector.__init__-151"><a href="#GridDetector.__init__-151"><span class="linenos">151</span></a>        <span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GridDetector.__init__-152"><a href="#GridDetector.__init__-152"><span class="linenos">152</span></a>        <span class="n">cross_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector.__init__-153"><a href="#GridDetector.__init__-153"><span class="linenos">153</span></a>        <span class="n">morph_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector.__init__-154"><a href="#GridDetector.__init__-154"><span class="linenos">154</span></a>        <span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="GridDetector.__init__-155"><a href="#GridDetector.__init__-155"><span class="linenos">155</span></a>        <span class="n">sauvola_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="GridDetector.__init__-156"><a href="#GridDetector.__init__-156"><span class="linenos">156</span></a>        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="GridDetector.__init__-157"><a href="#GridDetector.__init__-157"><span class="linenos">157</span></a>        <span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
</span><span id="GridDetector.__init__-158"><a href="#GridDetector.__init__-158"><span class="linenos">158</span></a>        <span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="GridDetector.__init__-159"><a href="#GridDetector.__init__-159"><span class="linenos">159</span></a>        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GridDetector.__init__-160"><a href="#GridDetector.__init__-160"><span class="linenos">160</span></a>        <span class="n">grow_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="GridDetector.__init__-161"><a href="#GridDetector.__init__-161"><span class="linenos">161</span></a>        <span class="n">look_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="GridDetector.__init__-162"><a href="#GridDetector.__init__-162"><span class="linenos">162</span></a>    <span class="p">):</span>
</span><span id="GridDetector.__init__-163"><a href="#GridDetector.__init__-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector.__init__-164"><a href="#GridDetector.__init__-164"><span class="linenos">164</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector.__init__-165"><a href="#GridDetector.__init__-165"><span class="linenos">165</span></a><span class="sd">            kernel_size (int): the size of the cross kernel</span>
</span><span id="GridDetector.__init__-166"><a href="#GridDetector.__init__-166"><span class="linenos">166</span></a><span class="sd">                a larger kernel size often means that more penalty is applied, often leading</span>
</span><span id="GridDetector.__init__-167"><a href="#GridDetector.__init__-167"><span class="linenos">167</span></a><span class="sd">                to more sparse results</span>
</span><span id="GridDetector.__init__-168"><a href="#GridDetector.__init__-168"><span class="linenos">168</span></a><span class="sd">            cross_width (int): the width of one of the edges in the cross filter, should be</span>
</span><span id="GridDetector.__init__-169"><a href="#GridDetector.__init__-169"><span class="linenos">169</span></a><span class="sd">                roughly equal to the width of the rules in the image after morphology is applied</span>
</span><span id="GridDetector.__init__-170"><a href="#GridDetector.__init__-170"><span class="linenos">170</span></a><span class="sd">            cross_height (int | None): useful if the horizontal rules and vertical rules</span>
</span><span id="GridDetector.__init__-171"><a href="#GridDetector.__init__-171"><span class="linenos">171</span></a><span class="sd">                have different sizes</span>
</span><span id="GridDetector.__init__-172"><a href="#GridDetector.__init__-172"><span class="linenos">172</span></a><span class="sd">            morph_size (int | None): the size of the morphology operators that are applied before</span>
</span><span id="GridDetector.__init__-173"><a href="#GridDetector.__init__-173"><span class="linenos">173</span></a><span class="sd">                the cross kernel. &#39;bridges the gaps&#39; of broken-up lines</span>
</span><span id="GridDetector.__init__-174"><a href="#GridDetector.__init__-174"><span class="linenos">174</span></a><span class="sd">            sauvola_k (float): threshold parameter for sauvola thresholding</span>
</span><span id="GridDetector.__init__-175"><a href="#GridDetector.__init__-175"><span class="linenos">175</span></a><span class="sd">            sauvola_window (int): window_size parameter for sauvola thresholding</span>
</span><span id="GridDetector.__init__-176"><a href="#GridDetector.__init__-176"><span class="linenos">176</span></a><span class="sd">            scale (float): image scale factor to do calculations on (useful for increasing calculation speed mostly)</span>
</span><span id="GridDetector.__init__-177"><a href="#GridDetector.__init__-177"><span class="linenos">177</span></a><span class="sd">            search_region (int): area in which to search for a new max value in `find_nearest` etc.</span>
</span><span id="GridDetector.__init__-178"><a href="#GridDetector.__init__-178"><span class="linenos">178</span></a><span class="sd">            distance_penalty (float): how much the point finding algorithm penalizes points that are further in the region [0, 1]</span>
</span><span id="GridDetector.__init__-179"><a href="#GridDetector.__init__-179"><span class="linenos">179</span></a><span class="sd">            min_rows (int): minimum number of rows to find before stopping the table finding algorithm</span>
</span><span id="GridDetector.__init__-180"><a href="#GridDetector.__init__-180"><span class="linenos">180</span></a><span class="sd">            grow_threshold (float): the threshold for accepting a new point when growing the table</span>
</span><span id="GridDetector.__init__-181"><a href="#GridDetector.__init__-181"><span class="linenos">181</span></a><span class="sd">            look_distance (int): how many points away to look when calculating the median slope</span>
</span><span id="GridDetector.__init__-182"><a href="#GridDetector.__init__-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector.__init__-183"><a href="#GridDetector.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_parameters</span><span class="p">(</span>
</span><span id="GridDetector.__init__-184"><a href="#GridDetector.__init__-184"><span class="linenos">184</span></a>            <span class="n">kernel_size</span><span class="p">,</span>
</span><span id="GridDetector.__init__-185"><a href="#GridDetector.__init__-185"><span class="linenos">185</span></a>            <span class="n">cross_width</span><span class="p">,</span>
</span><span id="GridDetector.__init__-186"><a href="#GridDetector.__init__-186"><span class="linenos">186</span></a>            <span class="n">cross_height</span><span class="p">,</span>
</span><span id="GridDetector.__init__-187"><a href="#GridDetector.__init__-187"><span class="linenos">187</span></a>            <span class="n">morph_size</span><span class="p">,</span>
</span><span id="GridDetector.__init__-188"><a href="#GridDetector.__init__-188"><span class="linenos">188</span></a>            <span class="n">search_region</span><span class="p">,</span>
</span><span id="GridDetector.__init__-189"><a href="#GridDetector.__init__-189"><span class="linenos">189</span></a>            <span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="GridDetector.__init__-190"><a href="#GridDetector.__init__-190"><span class="linenos">190</span></a>            <span class="n">sauvola_window</span><span class="p">,</span>
</span><span id="GridDetector.__init__-191"><a href="#GridDetector.__init__-191"><span class="linenos">191</span></a>            <span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="GridDetector.__init__-192"><a href="#GridDetector.__init__-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="GridDetector.__init__-193"><a href="#GridDetector.__init__-193"><span class="linenos">193</span></a>
</span><span id="GridDetector.__init__-194"><a href="#GridDetector.__init__-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_size</span> <span class="o">=</span> <span class="n">kernel_size</span>
</span><span id="GridDetector.__init__-195"><a href="#GridDetector.__init__-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_width</span> <span class="o">=</span> <span class="n">cross_width</span>
</span><span id="GridDetector.__init__-196"><a href="#GridDetector.__init__-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_height</span> <span class="o">=</span> <span class="n">cross_width</span> <span class="k">if</span> <span class="n">cross_height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cross_height</span>
</span><span id="GridDetector.__init__-197"><a href="#GridDetector.__init__-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_morph_size</span> <span class="o">=</span> <span class="n">morph_size</span> <span class="k">if</span> <span class="n">morph_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cross_width</span>
</span><span id="GridDetector.__init__-198"><a href="#GridDetector.__init__-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">=</span> <span class="n">search_region</span>
</span><span id="GridDetector.__init__-199"><a href="#GridDetector.__init__-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_k</span> <span class="o">=</span> <span class="n">sauvola_k</span>
</span><span id="GridDetector.__init__-200"><a href="#GridDetector.__init__-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_window</span> <span class="o">=</span> <span class="n">sauvola_window</span>
</span><span id="GridDetector.__init__-201"><a href="#GridDetector.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span> <span class="o">=</span> <span class="n">distance_penalty</span>
</span><span id="GridDetector.__init__-202"><a href="#GridDetector.__init__-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="GridDetector.__init__-203"><a href="#GridDetector.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_min_rows</span> <span class="o">=</span> <span class="n">min_rows</span>
</span><span id="GridDetector.__init__-204"><a href="#GridDetector.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span> <span class="o">=</span> <span class="n">grow_threshold</span>
</span><span id="GridDetector.__init__-205"><a href="#GridDetector.__init__-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span> <span class="o">=</span> <span class="n">look_distance</span>
</span><span id="GridDetector.__init__-206"><a href="#GridDetector.__init__-206"><span class="linenos">206</span></a>
</span><span id="GridDetector.__init__-207"><a href="#GridDetector.__init__-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cross_kernel</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>kernel_size (int):</strong>  the size of the cross kernel
a larger kernel size often means that more penalty is applied, often leading
to more sparse results</li>
<li><strong>cross_width (int):</strong>  the width of one of the edges in the cross filter, should be
roughly equal to the width of the rules in the image after morphology is applied</li>
<li><strong>cross_height (int | None):</strong>  useful if the horizontal rules and vertical rules
have different sizes</li>
<li><strong>morph_size (int | None):</strong>  the size of the morphology operators that are applied before
the cross kernel. 'bridges the gaps' of broken-up lines</li>
<li><strong>sauvola_k (float):</strong>  threshold parameter for sauvola thresholding</li>
<li><strong>sauvola_window (int):</strong>  window_size parameter for sauvola thresholding</li>
<li><strong>scale (float):</strong>  image scale factor to do calculations on (useful for increasing calculation speed mostly)</li>
<li><strong>search_region (int):</strong>  area in which to search for a new max value in <code><a href="#GridDetector.find_nearest">find_nearest</a></code> etc.</li>
<li><strong>distance_penalty (float):</strong>  how much the point finding algorithm penalizes points that are further in the region [0, 1]</li>
<li><strong>min_rows (int):</strong>  minimum number of rows to find before stopping the table finding algorithm</li>
<li><strong>grow_threshold (float):</strong>  the threshold for accepting a new point when growing the table</li>
<li><strong>look_distance (int):</strong>  how many points away to look when calculating the median slope</li>
</ul>
</div>


                            </div>
                            <div id="GridDetector.apply" class="classattr">
                                        <input id="GridDetector.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GridDetector.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridDetector.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridDetector.apply-309"><a href="#GridDetector.apply-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="GridDetector.apply-310"><a href="#GridDetector.apply-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector.apply-311"><a href="#GridDetector.apply-311"><span class="linenos">311</span></a><span class="sd">        Apply the grid detection filter to the input image.</span>
</span><span id="GridDetector.apply-312"><a href="#GridDetector.apply-312"><span class="linenos">312</span></a>
</span><span id="GridDetector.apply-313"><a href="#GridDetector.apply-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector.apply-314"><a href="#GridDetector.apply-314"><span class="linenos">314</span></a><span class="sd">            img (MatLike): the input image</span>
</span><span id="GridDetector.apply-315"><a href="#GridDetector.apply-315"><span class="linenos">315</span></a><span class="sd">            visual (bool): whether to show intermediate steps</span>
</span><span id="GridDetector.apply-316"><a href="#GridDetector.apply-316"><span class="linenos">316</span></a>
</span><span id="GridDetector.apply-317"><a href="#GridDetector.apply-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="GridDetector.apply-318"><a href="#GridDetector.apply-318"><span class="linenos">318</span></a><span class="sd">            MatLike: the filtered image, with high values (whiter pixels) at intersections of horizontal and vertical rules</span>
</span><span id="GridDetector.apply-319"><a href="#GridDetector.apply-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector.apply-320"><a href="#GridDetector.apply-320"><span class="linenos">320</span></a>
</span><span id="GridDetector.apply-321"><a href="#GridDetector.apply-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector.apply-322"><a href="#GridDetector.apply-322"><span class="linenos">322</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input image is empty or None&quot;</span><span class="p">)</span>
</span><span id="GridDetector.apply-323"><a href="#GridDetector.apply-323"><span class="linenos">323</span></a>
</span><span id="GridDetector.apply-324"><a href="#GridDetector.apply-324"><span class="linenos">324</span></a>        <span class="n">binary</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">sauvola</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_k</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sauvola_window</span><span class="p">)</span>
</span><span id="GridDetector.apply-325"><a href="#GridDetector.apply-325"><span class="linenos">325</span></a>
</span><span id="GridDetector.apply-326"><a href="#GridDetector.apply-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector.apply-327"><a href="#GridDetector.apply-327"><span class="linenos">327</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;thresholded&quot;</span><span class="p">)</span>
</span><span id="GridDetector.apply-328"><a href="#GridDetector.apply-328"><span class="linenos">328</span></a>
</span><span id="GridDetector.apply-329"><a href="#GridDetector.apply-329"><span class="linenos">329</span></a>        <span class="n">binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_morphology</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
</span><span id="GridDetector.apply-330"><a href="#GridDetector.apply-330"><span class="linenos">330</span></a>
</span><span id="GridDetector.apply-331"><a href="#GridDetector.apply-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector.apply-332"><a href="#GridDetector.apply-332"><span class="linenos">332</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;dilated&quot;</span><span class="p">)</span>
</span><span id="GridDetector.apply-333"><a href="#GridDetector.apply-333"><span class="linenos">333</span></a>
</span><span id="GridDetector.apply-334"><a href="#GridDetector.apply-334"><span class="linenos">334</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_cross_matching</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
</span><span id="GridDetector.apply-335"><a href="#GridDetector.apply-335"><span class="linenos">335</span></a>
</span><span id="GridDetector.apply-336"><a href="#GridDetector.apply-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="n">filtered</span>
</span></pre></div>


            <div class="docstring"><p>Apply the grid detection filter to the input image.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>img (MatLike):</strong>  the input image</li>
<li><strong>visual (bool):</strong>  whether to show intermediate steps</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>MatLike: the filtered image, with high values (whiter pixels) at intersections of horizontal and vertical rules</p>
</blockquote>
</div>


                            </div>
                            <div id="GridDetector.find_nearest" class="classattr">
                                        <input id="GridDetector.find_nearest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-log_calls">@log_calls(level=logging.DEBUG, include_return=True)</div>

        <span class="def">def</span>
        <span class="name">find_nearest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filtered</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">point</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GridDetector.find_nearest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridDetector.find_nearest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridDetector.find_nearest-338"><a href="#GridDetector.find_nearest-338"><span class="linenos">338</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-339"><a href="#GridDetector.find_nearest-339"><span class="linenos">339</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_nearest</span><span class="p">(</span>
</span><span id="GridDetector.find_nearest-340"><a href="#GridDetector.find_nearest-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">filtered</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GridDetector.find_nearest-341"><a href="#GridDetector.find_nearest-341"><span class="linenos">341</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="GridDetector.find_nearest-342"><a href="#GridDetector.find_nearest-342"><span class="linenos">342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector.find_nearest-343"><a href="#GridDetector.find_nearest-343"><span class="linenos">343</span></a><span class="sd">        Find the nearest &#39;corner match&#39; in the image, along with its score [0,1]</span>
</span><span id="GridDetector.find_nearest-344"><a href="#GridDetector.find_nearest-344"><span class="linenos">344</span></a>
</span><span id="GridDetector.find_nearest-345"><a href="#GridDetector.find_nearest-345"><span class="linenos">345</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector.find_nearest-346"><a href="#GridDetector.find_nearest-346"><span class="linenos">346</span></a><span class="sd">            filtered (MatLike): the filtered image (obtained through `apply`)</span>
</span><span id="GridDetector.find_nearest-347"><a href="#GridDetector.find_nearest-347"><span class="linenos">347</span></a><span class="sd">            point (tuple[int, int]): the approximate target point (x, y)</span>
</span><span id="GridDetector.find_nearest-348"><a href="#GridDetector.find_nearest-348"><span class="linenos">348</span></a><span class="sd">            region (None | int): alternative value for search region,</span>
</span><span id="GridDetector.find_nearest-349"><a href="#GridDetector.find_nearest-349"><span class="linenos">349</span></a><span class="sd">                overwriting the `__init__` parameter `region`</span>
</span><span id="GridDetector.find_nearest-350"><a href="#GridDetector.find_nearest-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector.find_nearest-351"><a href="#GridDetector.find_nearest-351"><span class="linenos">351</span></a>
</span><span id="GridDetector.find_nearest-352"><a href="#GridDetector.find_nearest-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="n">filtered</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filtered</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector.find_nearest-353"><a href="#GridDetector.find_nearest-353"><span class="linenos">353</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Filtered image is empty or None&quot;</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-354"><a href="#GridDetector.find_nearest-354"><span class="linenos">354</span></a>
</span><span id="GridDetector.find_nearest-355"><a href="#GridDetector.find_nearest-355"><span class="linenos">355</span></a>        <span class="n">region_size</span> <span class="o">=</span> <span class="n">region</span> <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span>
</span><span id="GridDetector.find_nearest-356"><a href="#GridDetector.find_nearest-356"><span class="linenos">356</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
</span><span id="GridDetector.find_nearest-357"><a href="#GridDetector.find_nearest-357"><span class="linenos">357</span></a>
</span><span id="GridDetector.find_nearest-358"><a href="#GridDetector.find_nearest-358"><span class="linenos">358</span></a>        <span class="c1"># Calculate crop boundaries</span>
</span><span id="GridDetector.find_nearest-359"><a href="#GridDetector.find_nearest-359"><span class="linenos">359</span></a>        <span class="n">crop_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-360"><a href="#GridDetector.find_nearest-360"><span class="linenos">360</span></a>        <span class="n">crop_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">region_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-361"><a href="#GridDetector.find_nearest-361"><span class="linenos">361</span></a>        <span class="n">crop_width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">region_size</span><span class="p">,</span> <span class="n">filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">crop_x</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-362"><a href="#GridDetector.find_nearest-362"><span class="linenos">362</span></a>        <span class="n">crop_height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">region_size</span><span class="p">,</span> <span class="n">filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">crop_y</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-363"><a href="#GridDetector.find_nearest-363"><span class="linenos">363</span></a>
</span><span id="GridDetector.find_nearest-364"><a href="#GridDetector.find_nearest-364"><span class="linenos">364</span></a>        <span class="c1"># Handle edge cases</span>
</span><span id="GridDetector.find_nearest-365"><a href="#GridDetector.find_nearest-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="n">crop_width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">crop_height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector.find_nearest-366"><a href="#GridDetector.find_nearest-366"><span class="linenos">366</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2"> is outside image bounds&quot;</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-367"><a href="#GridDetector.find_nearest-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="n">point</span><span class="p">,</span> <span class="mf">0.0</span>
</span><span id="GridDetector.find_nearest-368"><a href="#GridDetector.find_nearest-368"><span class="linenos">368</span></a>
</span><span id="GridDetector.find_nearest-369"><a href="#GridDetector.find_nearest-369"><span class="linenos">369</span></a>        <span class="n">cropped</span> <span class="o">=</span> <span class="n">filtered</span><span class="p">[</span><span class="n">crop_y</span> <span class="p">:</span> <span class="n">crop_y</span> <span class="o">+</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">crop_x</span> <span class="p">:</span> <span class="n">crop_x</span> <span class="o">+</span> <span class="n">crop_width</span><span class="p">]</span>
</span><span id="GridDetector.find_nearest-370"><a href="#GridDetector.find_nearest-370"><span class="linenos">370</span></a>
</span><span id="GridDetector.find_nearest-371"><a href="#GridDetector.find_nearest-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="n">cropped</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GridDetector.find_nearest-372"><a href="#GridDetector.find_nearest-372"><span class="linenos">372</span></a>            <span class="k">return</span> <span class="n">point</span><span class="p">,</span> <span class="mf">0.0</span>
</span><span id="GridDetector.find_nearest-373"><a href="#GridDetector.find_nearest-373"><span class="linenos">373</span></a>
</span><span id="GridDetector.find_nearest-374"><a href="#GridDetector.find_nearest-374"><span class="linenos">374</span></a>        <span class="c1"># Always apply Gaussian weighting by extending crop if needed</span>
</span><span id="GridDetector.find_nearest-375"><a href="#GridDetector.find_nearest-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">region_size</span> <span class="ow">and</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">region_size</span><span class="p">:</span>
</span><span id="GridDetector.find_nearest-376"><a href="#GridDetector.find_nearest-376"><span class="linenos">376</span></a>            <span class="c1"># Perfect size - apply weights directly</span>
</span><span id="GridDetector.find_nearest-377"><a href="#GridDetector.find_nearest-377"><span class="linenos">377</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_gaussian_weights</span><span class="p">(</span><span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-378"><a href="#GridDetector.find_nearest-378"><span class="linenos">378</span></a>            <span class="n">weighted</span> <span class="o">=</span> <span class="n">cropped</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
</span><span id="GridDetector.find_nearest-379"><a href="#GridDetector.find_nearest-379"><span class="linenos">379</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector.find_nearest-380"><a href="#GridDetector.find_nearest-380"><span class="linenos">380</span></a>            <span class="c1"># Extend crop to match region_size, apply weights, then restore</span>
</span><span id="GridDetector.find_nearest-381"><a href="#GridDetector.find_nearest-381"><span class="linenos">381</span></a>            <span class="n">extended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">region_size</span><span class="p">,</span> <span class="n">region_size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">cropped</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-382"><a href="#GridDetector.find_nearest-382"><span class="linenos">382</span></a>
</span><span id="GridDetector.find_nearest-383"><a href="#GridDetector.find_nearest-383"><span class="linenos">383</span></a>            <span class="c1"># Calculate offset to center the cropped region in extended array</span>
</span><span id="GridDetector.find_nearest-384"><a href="#GridDetector.find_nearest-384"><span class="linenos">384</span></a>            <span class="n">offset_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_size</span> <span class="o">-</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector.find_nearest-385"><a href="#GridDetector.find_nearest-385"><span class="linenos">385</span></a>            <span class="n">offset_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_size</span> <span class="o">-</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector.find_nearest-386"><a href="#GridDetector.find_nearest-386"><span class="linenos">386</span></a>
</span><span id="GridDetector.find_nearest-387"><a href="#GridDetector.find_nearest-387"><span class="linenos">387</span></a>            <span class="c1"># Place cropped region in center of extended array</span>
</span><span id="GridDetector.find_nearest-388"><a href="#GridDetector.find_nearest-388"><span class="linenos">388</span></a>            <span class="n">extended</span><span class="p">[</span>
</span><span id="GridDetector.find_nearest-389"><a href="#GridDetector.find_nearest-389"><span class="linenos">389</span></a>                <span class="n">offset_y</span> <span class="p">:</span> <span class="n">offset_y</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="GridDetector.find_nearest-390"><a href="#GridDetector.find_nearest-390"><span class="linenos">390</span></a>                <span class="n">offset_x</span> <span class="p">:</span> <span class="n">offset_x</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="GridDetector.find_nearest-391"><a href="#GridDetector.find_nearest-391"><span class="linenos">391</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">cropped</span>
</span><span id="GridDetector.find_nearest-392"><a href="#GridDetector.find_nearest-392"><span class="linenos">392</span></a>
</span><span id="GridDetector.find_nearest-393"><a href="#GridDetector.find_nearest-393"><span class="linenos">393</span></a>            <span class="c1"># Apply Gaussian weights to extended array</span>
</span><span id="GridDetector.find_nearest-394"><a href="#GridDetector.find_nearest-394"><span class="linenos">394</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_gaussian_weights</span><span class="p">(</span><span class="n">region_size</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-395"><a href="#GridDetector.find_nearest-395"><span class="linenos">395</span></a>            <span class="n">weighted_extended</span> <span class="o">=</span> <span class="n">extended</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
</span><span id="GridDetector.find_nearest-396"><a href="#GridDetector.find_nearest-396"><span class="linenos">396</span></a>
</span><span id="GridDetector.find_nearest-397"><a href="#GridDetector.find_nearest-397"><span class="linenos">397</span></a>            <span class="c1"># Extract the original region back out</span>
</span><span id="GridDetector.find_nearest-398"><a href="#GridDetector.find_nearest-398"><span class="linenos">398</span></a>            <span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted_extended</span><span class="p">[</span>
</span><span id="GridDetector.find_nearest-399"><a href="#GridDetector.find_nearest-399"><span class="linenos">399</span></a>                <span class="n">offset_y</span> <span class="p">:</span> <span class="n">offset_y</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="GridDetector.find_nearest-400"><a href="#GridDetector.find_nearest-400"><span class="linenos">400</span></a>                <span class="n">offset_x</span> <span class="p">:</span> <span class="n">offset_x</span> <span class="o">+</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="GridDetector.find_nearest-401"><a href="#GridDetector.find_nearest-401"><span class="linenos">401</span></a>            <span class="p">]</span>
</span><span id="GridDetector.find_nearest-402"><a href="#GridDetector.find_nearest-402"><span class="linenos">402</span></a>
</span><span id="GridDetector.find_nearest-403"><a href="#GridDetector.find_nearest-403"><span class="linenos">403</span></a>        <span class="n">best_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">weighted</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-404"><a href="#GridDetector.find_nearest-404"><span class="linenos">404</span></a>        <span class="n">best_y</span><span class="p">,</span> <span class="n">best_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">best_idx</span><span class="p">,</span> <span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="GridDetector.find_nearest-405"><a href="#GridDetector.find_nearest-405"><span class="linenos">405</span></a>
</span><span id="GridDetector.find_nearest-406"><a href="#GridDetector.find_nearest-406"><span class="linenos">406</span></a>        <span class="n">result_point</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector.find_nearest-407"><a href="#GridDetector.find_nearest-407"><span class="linenos">407</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">crop_x</span> <span class="o">+</span> <span class="n">best_x</span><span class="p">),</span>
</span><span id="GridDetector.find_nearest-408"><a href="#GridDetector.find_nearest-408"><span class="linenos">408</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">crop_y</span> <span class="o">+</span> <span class="n">best_y</span><span class="p">),</span>
</span><span id="GridDetector.find_nearest-409"><a href="#GridDetector.find_nearest-409"><span class="linenos">409</span></a>        <span class="p">)</span>
</span><span id="GridDetector.find_nearest-410"><a href="#GridDetector.find_nearest-410"><span class="linenos">410</span></a>        <span class="n">result_confidence</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">weighted</span><span class="p">[</span><span class="n">best_y</span><span class="p">,</span> <span class="n">best_x</span><span class="p">])</span> <span class="o">/</span> <span class="mf">255.0</span>
</span><span id="GridDetector.find_nearest-411"><a href="#GridDetector.find_nearest-411"><span class="linenos">411</span></a>
</span><span id="GridDetector.find_nearest-412"><a href="#GridDetector.find_nearest-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="n">result_point</span><span class="p">,</span> <span class="n">result_confidence</span>
</span></pre></div>


            <div class="docstring"><p>Find the nearest 'corner match' in the image, along with its score [0,1]</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>filtered (MatLike):</strong>  the filtered image (obtained through <code><a href="#GridDetector.apply">apply</a></code>)</li>
<li><strong>point (tuple[int, int]):</strong>  the approximate target point (x, y)</li>
<li><strong>region (None | int):</strong>  alternative value for search region,
overwriting the <code><a href="#GridDetector.__init__">__init__</a></code> parameter <code>region</code></li>
</ul>
</div>


                            </div>
                            <div id="GridDetector.find_table_points" class="classattr">
                                        <input id="GridDetector.find_table_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_table_points</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">left_top</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">cell_widths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">cell_heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;taulu&#39;</span>,</span><span class="param">	<span class="n">goals_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filtered</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">smooth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#TableGrid">TableGrid</a></span>:</span></span>

                <label class="view-source-button" for="GridDetector.find_table_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridDetector.find_table_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridDetector.find_table_points-414"><a href="#GridDetector.find_table_points-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_table_points</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-415"><a href="#GridDetector.find_table_points-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-416"><a href="#GridDetector.find_table_points-416"><span class="linenos">416</span></a>        <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="GridDetector.find_table_points-417"><a href="#GridDetector.find_table_points-417"><span class="linenos">417</span></a>        <span class="n">left_top</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-418"><a href="#GridDetector.find_table_points-418"><span class="linenos">418</span></a>        <span class="n">cell_widths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="GridDetector.find_table_points-419"><a href="#GridDetector.find_table_points-419"><span class="linenos">419</span></a>        <span class="n">cell_heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-420"><a href="#GridDetector.find_table_points-420"><span class="linenos">420</span></a>        <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-421"><a href="#GridDetector.find_table_points-421"><span class="linenos">421</span></a>        <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-422"><a href="#GridDetector.find_table_points-422"><span class="linenos">422</span></a>        <span class="n">goals_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-423"><a href="#GridDetector.find_table_points-423"><span class="linenos">423</span></a>        <span class="n">filtered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-424"><a href="#GridDetector.find_table_points-424"><span class="linenos">424</span></a>        <span class="n">smooth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GridDetector.find_table_points-425"><a href="#GridDetector.find_table_points-425"><span class="linenos">425</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-426"><a href="#GridDetector.find_table_points-426"><span class="linenos">426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridDetector.find_table_points-427"><a href="#GridDetector.find_table_points-427"><span class="linenos">427</span></a><span class="sd">        Parse the image to a `TableGrid` structure that holds all of the</span>
</span><span id="GridDetector.find_table_points-428"><a href="#GridDetector.find_table_points-428"><span class="linenos">428</span></a><span class="sd">        intersections between horizontal and vertical rules, starting near the `left_top` point</span>
</span><span id="GridDetector.find_table_points-429"><a href="#GridDetector.find_table_points-429"><span class="linenos">429</span></a>
</span><span id="GridDetector.find_table_points-430"><a href="#GridDetector.find_table_points-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="GridDetector.find_table_points-431"><a href="#GridDetector.find_table_points-431"><span class="linenos">431</span></a><span class="sd">            img (MatLike): the input image of a table</span>
</span><span id="GridDetector.find_table_points-432"><a href="#GridDetector.find_table_points-432"><span class="linenos">432</span></a><span class="sd">            left_top (tuple[int, int]): the starting point of the algorithm</span>
</span><span id="GridDetector.find_table_points-433"><a href="#GridDetector.find_table_points-433"><span class="linenos">433</span></a><span class="sd">            cell_widths (list[int]): the expected widths of the cells (based on a header template)</span>
</span><span id="GridDetector.find_table_points-434"><a href="#GridDetector.find_table_points-434"><span class="linenos">434</span></a><span class="sd">            cell_heights (list[int]): the expected height of the rows of data.</span>
</span><span id="GridDetector.find_table_points-435"><a href="#GridDetector.find_table_points-435"><span class="linenos">435</span></a><span class="sd">                The last value from this list is used until the image has no more vertical space.</span>
</span><span id="GridDetector.find_table_points-436"><a href="#GridDetector.find_table_points-436"><span class="linenos">436</span></a><span class="sd">            visual (bool): whether to show intermediate steps</span>
</span><span id="GridDetector.find_table_points-437"><a href="#GridDetector.find_table_points-437"><span class="linenos">437</span></a><span class="sd">            window (str): the name of the OpenCV window to use for visualization</span>
</span><span id="GridDetector.find_table_points-438"><a href="#GridDetector.find_table_points-438"><span class="linenos">438</span></a><span class="sd">            goals_width (int | None): the width of the goal region when searching for the next point.</span>
</span><span id="GridDetector.find_table_points-439"><a href="#GridDetector.find_table_points-439"><span class="linenos">439</span></a><span class="sd">                If None, defaults to 1.5 * search_region</span>
</span><span id="GridDetector.find_table_points-440"><a href="#GridDetector.find_table_points-440"><span class="linenos">440</span></a><span class="sd">            filtered (MatLike | PathLike[str] | None): if provided, this image is used instead of</span>
</span><span id="GridDetector.find_table_points-441"><a href="#GridDetector.find_table_points-441"><span class="linenos">441</span></a><span class="sd">                calculating the filtered image from scratch</span>
</span><span id="GridDetector.find_table_points-442"><a href="#GridDetector.find_table_points-442"><span class="linenos">442</span></a><span class="sd">            smooth (bool): if True, smooth the grid after detection, using local heuristics</span>
</span><span id="GridDetector.find_table_points-443"><a href="#GridDetector.find_table_points-443"><span class="linenos">443</span></a>
</span><span id="GridDetector.find_table_points-444"><a href="#GridDetector.find_table_points-444"><span class="linenos">444</span></a><span class="sd">        Returns:</span>
</span><span id="GridDetector.find_table_points-445"><a href="#GridDetector.find_table_points-445"><span class="linenos">445</span></a><span class="sd">            a TableGrid object</span>
</span><span id="GridDetector.find_table_points-446"><a href="#GridDetector.find_table_points-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridDetector.find_table_points-447"><a href="#GridDetector.find_table_points-447"><span class="linenos">447</span></a>
</span><span id="GridDetector.find_table_points-448"><a href="#GridDetector.find_table_points-448"><span class="linenos">448</span></a>        <span class="k">if</span> <span class="n">goals_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-449"><a href="#GridDetector.find_table_points-449"><span class="linenos">449</span></a>            <span class="n">goals_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="GridDetector.find_table_points-450"><a href="#GridDetector.find_table_points-450"><span class="linenos">450</span></a>
</span><span id="GridDetector.find_table_points-451"><a href="#GridDetector.find_table_points-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell_widths</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-452"><a href="#GridDetector.find_table_points-452"><span class="linenos">452</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cell_widths must contain at least one value&quot;</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-453"><a href="#GridDetector.find_table_points-453"><span class="linenos">453</span></a>
</span><span id="GridDetector.find_table_points-454"><a href="#GridDetector.find_table_points-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="GridDetector.find_table_points-455"><a href="#GridDetector.find_table_points-455"><span class="linenos">455</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
</span><span id="GridDetector.find_table_points-456"><a href="#GridDetector.find_table_points-456"><span class="linenos">456</span></a>
</span><span id="GridDetector.find_table_points-457"><a href="#GridDetector.find_table_points-457"><span class="linenos">457</span></a>        <span class="k">if</span> <span class="n">filtered</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-458"><a href="#GridDetector.find_table_points-458"><span class="linenos">458</span></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-459"><a href="#GridDetector.find_table_points-459"><span class="linenos">459</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-460"><a href="#GridDetector.find_table_points-460"><span class="linenos">460</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="GridDetector.find_table_points-461"><a href="#GridDetector.find_table_points-461"><span class="linenos">461</span></a>                <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filtered</span><span class="p">))</span>
</span><span id="GridDetector.find_table_points-462"><a href="#GridDetector.find_table_points-462"><span class="linenos">462</span></a>
</span><span id="GridDetector.find_table_points-463"><a href="#GridDetector.find_table_points-463"><span class="linenos">463</span></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-464"><a href="#GridDetector.find_table_points-464"><span class="linenos">464</span></a>
</span><span id="GridDetector.find_table_points-465"><a href="#GridDetector.find_table_points-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-466"><a href="#GridDetector.find_table_points-466"><span class="linenos">466</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-467"><a href="#GridDetector.find_table_points-467"><span class="linenos">467</span></a>
</span><span id="GridDetector.find_table_points-468"><a href="#GridDetector.find_table_points-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell_heights</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="GridDetector.find_table_points-469"><a href="#GridDetector.find_table_points-469"><span class="linenos">469</span></a>            <span class="n">cell_heights</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell_heights</span><span class="p">]</span>
</span><span id="GridDetector.find_table_points-470"><a href="#GridDetector.find_table_points-470"><span class="linenos">470</span></a>
</span><span id="GridDetector.find_table_points-471"><a href="#GridDetector.find_table_points-471"><span class="linenos">471</span></a>        <span class="n">left_top</span><span class="p">,</span> <span class="n">confidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-472"><a href="#GridDetector.find_table_points-472"><span class="linenos">472</span></a>            <span class="n">filtered</span><span class="p">,</span> <span class="n">left_top</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-473"><a href="#GridDetector.find_table_points-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="GridDetector.find_table_points-474"><a href="#GridDetector.find_table_points-474"><span class="linenos">474</span></a>
</span><span id="GridDetector.find_table_points-475"><a href="#GridDetector.find_table_points-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-476"><a href="#GridDetector.find_table_points-476"><span class="linenos">476</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-477"><a href="#GridDetector.find_table_points-477"><span class="linenos">477</span></a>                <span class="sa">f</span><span class="s2">&quot;Low confidence for the starting point: </span><span class="si">{</span><span class="n">confidence</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">left_top</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GridDetector.find_table_points-478"><a href="#GridDetector.find_table_points-478"><span class="linenos">478</span></a>            <span class="p">)</span>
</span><span id="GridDetector.find_table_points-479"><a href="#GridDetector.find_table_points-479"><span class="linenos">479</span></a>
</span><span id="GridDetector.find_table_points-480"><a href="#GridDetector.find_table_points-480"><span class="linenos">480</span></a>        <span class="c1"># resize all parameters according to scale</span>
</span><span id="GridDetector.find_table_points-481"><a href="#GridDetector.find_table_points-481"><span class="linenos">481</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-482"><a href="#GridDetector.find_table_points-482"><span class="linenos">482</span></a>
</span><span id="GridDetector.find_table_points-483"><a href="#GridDetector.find_table_points-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-484"><a href="#GridDetector.find_table_points-484"><span class="linenos">484</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-485"><a href="#GridDetector.find_table_points-485"><span class="linenos">485</span></a>
</span><span id="GridDetector.find_table_points-486"><a href="#GridDetector.find_table_points-486"><span class="linenos">486</span></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-487"><a href="#GridDetector.find_table_points-487"><span class="linenos">487</span></a>        <span class="n">cell_widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">cell_widths</span><span class="p">]</span>
</span><span id="GridDetector.find_table_points-488"><a href="#GridDetector.find_table_points-488"><span class="linenos">488</span></a>        <span class="n">cell_heights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">cell_heights</span><span class="p">]</span>
</span><span id="GridDetector.find_table_points-489"><a href="#GridDetector.find_table_points-489"><span class="linenos">489</span></a>        <span class="n">left_top</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">))</span>
</span><span id="GridDetector.find_table_points-490"><a href="#GridDetector.find_table_points-490"><span class="linenos">490</span></a>        <span class="n">search_region</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_region</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-491"><a href="#GridDetector.find_table_points-491"><span class="linenos">491</span></a>
</span><span id="GridDetector.find_table_points-492"><a href="#GridDetector.find_table_points-492"><span class="linenos">492</span></a>        <span class="n">img_gray</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-493"><a href="#GridDetector.find_table_points-493"><span class="linenos">493</span></a>        <span class="n">filtered_gray</span> <span class="o">=</span> <span class="n">ensure_gray</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-494"><a href="#GridDetector.find_table_points-494"><span class="linenos">494</span></a>
</span><span id="GridDetector.find_table_points-495"><a href="#GridDetector.find_table_points-495"><span class="linenos">495</span></a>        <span class="n">table_grower</span> <span class="o">=</span> <span class="n">TableGrower</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-496"><a href="#GridDetector.find_table_points-496"><span class="linenos">496</span></a>            <span class="n">img_gray</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-497"><a href="#GridDetector.find_table_points-497"><span class="linenos">497</span></a>            <span class="n">filtered_gray</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-498"><a href="#GridDetector.find_table_points-498"><span class="linenos">498</span></a>            <span class="n">cell_widths</span><span class="p">,</span>  <span class="c1"># pyright: ignore</span>
</span><span id="GridDetector.find_table_points-499"><a href="#GridDetector.find_table_points-499"><span class="linenos">499</span></a>            <span class="n">cell_heights</span><span class="p">,</span>  <span class="c1"># pyright: ignore</span>
</span><span id="GridDetector.find_table_points-500"><a href="#GridDetector.find_table_points-500"><span class="linenos">500</span></a>            <span class="n">left_top</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-501"><a href="#GridDetector.find_table_points-501"><span class="linenos">501</span></a>            <span class="n">search_region</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-502"><a href="#GridDetector.find_table_points-502"><span class="linenos">502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_distance_penalty</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-503"><a href="#GridDetector.find_table_points-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-504"><a href="#GridDetector.find_table_points-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-505"><a href="#GridDetector.find_table_points-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_min_rows</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-506"><a href="#GridDetector.find_table_points-506"><span class="linenos">506</span></a>        <span class="p">)</span>
</span><span id="GridDetector.find_table_points-507"><a href="#GridDetector.find_table_points-507"><span class="linenos">507</span></a>
</span><span id="GridDetector.find_table_points-508"><a href="#GridDetector.find_table_points-508"><span class="linenos">508</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">show_grower_progress</span><span class="p">(</span><span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="GridDetector.find_table_points-509"><a href="#GridDetector.find_table_points-509"><span class="linenos">509</span></a>            <span class="n">img_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-510"><a href="#GridDetector.find_table_points-510"><span class="linenos">510</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_all_corners</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-511"><a href="#GridDetector.find_table_points-511"><span class="linenos">511</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)):</span>
</span><span id="GridDetector.find_table_points-512"><a href="#GridDetector.find_table_points-512"><span class="linenos">512</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">])):</span>
</span><span id="GridDetector.find_table_points-513"><a href="#GridDetector.find_table_points-513"><span class="linenos">513</span></a>                    <span class="k">if</span> <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-514"><a href="#GridDetector.find_table_points-514"><span class="linenos">514</span></a>                        <span class="n">img_orig</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">draw_points</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-515"><a href="#GridDetector.find_table_points-515"><span class="linenos">515</span></a>                            <span class="n">img_orig</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-516"><a href="#GridDetector.find_table_points-516"><span class="linenos">516</span></a>                            <span class="p">[</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]],</span>
</span><span id="GridDetector.find_table_points-517"><a href="#GridDetector.find_table_points-517"><span class="linenos">517</span></a>                            <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="GridDetector.find_table_points-518"><a href="#GridDetector.find_table_points-518"><span class="linenos">518</span></a>                            <span class="n">thickness</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="GridDetector.find_table_points-519"><a href="#GridDetector.find_table_points-519"><span class="linenos">519</span></a>                        <span class="p">)</span>
</span><span id="GridDetector.find_table_points-520"><a href="#GridDetector.find_table_points-520"><span class="linenos">520</span></a>
</span><span id="GridDetector.find_table_points-521"><a href="#GridDetector.find_table_points-521"><span class="linenos">521</span></a>            <span class="n">edge</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_edge_points</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-522"><a href="#GridDetector.find_table_points-522"><span class="linenos">522</span></a>
</span><span id="GridDetector.find_table_points-523"><a href="#GridDetector.find_table_points-523"><span class="linenos">523</span></a>            <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-524"><a href="#GridDetector.find_table_points-524"><span class="linenos">524</span></a>                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">score</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-525"><a href="#GridDetector.find_table_points-525"><span class="linenos">525</span></a>                <span class="n">imu</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">img_orig</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-526"><a href="#GridDetector.find_table_points-526"><span class="linenos">526</span></a>
</span><span id="GridDetector.find_table_points-527"><a href="#GridDetector.find_table_points-527"><span class="linenos">527</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_orig</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-528"><a href="#GridDetector.find_table_points-528"><span class="linenos">528</span></a>
</span><span id="GridDetector.find_table_points-529"><a href="#GridDetector.find_table_points-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-530"><a href="#GridDetector.find_table_points-530"><span class="linenos">530</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grow_threshold</span>
</span><span id="GridDetector.find_table_points-531"><a href="#GridDetector.find_table_points-531"><span class="linenos">531</span></a>            <span class="n">look_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_look_distance</span>
</span><span id="GridDetector.find_table_points-532"><a href="#GridDetector.find_table_points-532"><span class="linenos">532</span></a>
</span><span id="GridDetector.find_table_points-533"><a href="#GridDetector.find_table_points-533"><span class="linenos">533</span></a>            <span class="c1"># python implementation of rust loops, for visualization purposes</span>
</span><span id="GridDetector.find_table_points-534"><a href="#GridDetector.find_table_points-534"><span class="linenos">534</span></a>            <span class="c1"># note this is a LOT slower</span>
</span><span id="GridDetector.find_table_points-535"><a href="#GridDetector.find_table_points-535"><span class="linenos">535</span></a>            <span class="k">while</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-536"><a href="#GridDetector.find_table_points-536"><span class="linenos">536</span></a>                <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-537"><a href="#GridDetector.find_table_points-537"><span class="linenos">537</span></a>
</span><span id="GridDetector.find_table_points-538"><a href="#GridDetector.find_table_points-538"><span class="linenos">538</span></a>            <span class="n">show_grower_progress</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-539"><a href="#GridDetector.find_table_points-539"><span class="linenos">539</span></a>
</span><span id="GridDetector.find_table_points-540"><a href="#GridDetector.find_table_points-540"><span class="linenos">540</span></a>            <span class="n">original_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
</span><span id="GridDetector.find_table_points-541"><a href="#GridDetector.find_table_points-541"><span class="linenos">541</span></a>
</span><span id="GridDetector.find_table_points-542"><a href="#GridDetector.find_table_points-542"><span class="linenos">542</span></a>            <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector.find_table_points-543"><a href="#GridDetector.find_table_points-543"><span class="linenos">543</span></a>
</span><span id="GridDetector.find_table_points-544"><a href="#GridDetector.find_table_points-544"><span class="linenos">544</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">is_table_complete</span><span class="p">():</span>
</span><span id="GridDetector.find_table_points-545"><a href="#GridDetector.find_table_points-545"><span class="linenos">545</span></a>                <span class="n">loops_without_change</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="GridDetector.find_table_points-546"><a href="#GridDetector.find_table_points-546"><span class="linenos">546</span></a>
</span><span id="GridDetector.find_table_points-547"><a href="#GridDetector.find_table_points-547"><span class="linenos">547</span></a>                <span class="k">if</span> <span class="n">loops_without_change</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-548"><a href="#GridDetector.find_table_points-548"><span class="linenos">548</span></a>                    <span class="k">break</span>
</span><span id="GridDetector.find_table_points-549"><a href="#GridDetector.find_table_points-549"><span class="linenos">549</span></a>
</span><span id="GridDetector.find_table_points-550"><a href="#GridDetector.find_table_points-550"><span class="linenos">550</span></a>                <span class="k">if</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">extrapolate_one</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-551"><a href="#GridDetector.find_table_points-551"><span class="linenos">551</span></a>                    <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-552"><a href="#GridDetector.find_table_points-552"><span class="linenos">552</span></a>
</span><span id="GridDetector.find_table_points-553"><a href="#GridDetector.find_table_points-553"><span class="linenos">553</span></a>                    <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector.find_table_points-554"><a href="#GridDetector.find_table_points-554"><span class="linenos">554</span></a>
</span><span id="GridDetector.find_table_points-555"><a href="#GridDetector.find_table_points-555"><span class="linenos">555</span></a>                    <span class="n">grown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GridDetector.find_table_points-556"><a href="#GridDetector.find_table_points-556"><span class="linenos">556</span></a>                    <span class="k">while</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-557"><a href="#GridDetector.find_table_points-557"><span class="linenos">557</span></a>                        <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-558"><a href="#GridDetector.find_table_points-558"><span class="linenos">558</span></a>                        <span class="n">grown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GridDetector.find_table_points-559"><a href="#GridDetector.find_table_points-559"><span class="linenos">559</span></a>                        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">original_threshold</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-560"><a href="#GridDetector.find_table_points-560"><span class="linenos">560</span></a>                        <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-561"><a href="#GridDetector.find_table_points-561"><span class="linenos">561</span></a>
</span><span id="GridDetector.find_table_points-562"><a href="#GridDetector.find_table_points-562"><span class="linenos">562</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">grown</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-563"><a href="#GridDetector.find_table_points-563"><span class="linenos">563</span></a>                        <span class="n">threshold</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="GridDetector.find_table_points-564"><a href="#GridDetector.find_table_points-564"><span class="linenos">564</span></a>                        <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-565"><a href="#GridDetector.find_table_points-565"><span class="linenos">565</span></a>
</span><span id="GridDetector.find_table_points-566"><a href="#GridDetector.find_table_points-566"><span class="linenos">566</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-567"><a href="#GridDetector.find_table_points-567"><span class="linenos">567</span></a>                    <span class="n">threshold</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="GridDetector.find_table_points-568"><a href="#GridDetector.find_table_points-568"><span class="linenos">568</span></a>                    <span class="n">table_grower</span><span class="o">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-569"><a href="#GridDetector.find_table_points-569"><span class="linenos">569</span></a>
</span><span id="GridDetector.find_table_points-570"><a href="#GridDetector.find_table_points-570"><span class="linenos">570</span></a>                    <span class="k">if</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_point</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-571"><a href="#GridDetector.find_table_points-571"><span class="linenos">571</span></a>                        <span class="n">show_grower_progress</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-572"><a href="#GridDetector.find_table_points-572"><span class="linenos">572</span></a>                        <span class="n">loops_without_change</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GridDetector.find_table_points-573"><a href="#GridDetector.find_table_points-573"><span class="linenos">573</span></a>
</span><span id="GridDetector.find_table_points-574"><a href="#GridDetector.find_table_points-574"><span class="linenos">574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-575"><a href="#GridDetector.find_table_points-575"><span class="linenos">575</span></a>            <span class="n">table_grower</span><span class="o">.</span><span class="n">grow_table</span><span class="p">(</span><span class="n">img_gray</span><span class="p">,</span> <span class="n">filtered_gray</span><span class="p">)</span>
</span><span id="GridDetector.find_table_points-576"><a href="#GridDetector.find_table_points-576"><span class="linenos">576</span></a>
</span><span id="GridDetector.find_table_points-577"><a href="#GridDetector.find_table_points-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="n">smooth</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-578"><a href="#GridDetector.find_table_points-578"><span class="linenos">578</span></a>            <span class="n">table_grower</span><span class="o">.</span><span class="n">smooth_grid</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-579"><a href="#GridDetector.find_table_points-579"><span class="linenos">579</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="n">table_grower</span><span class="o">.</span><span class="n">get_all_corners</span><span class="p">()</span>
</span><span id="GridDetector.find_table_points-580"><a href="#GridDetector.find_table_points-580"><span class="linenos">580</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="GridDetector.find_table_points-581"><a href="#GridDetector.find_table_points-581"><span class="linenos">581</span></a>            <span class="sa">f</span><span class="s2">&quot;Table growth complete, found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> columns&quot;</span>
</span><span id="GridDetector.find_table_points-582"><a href="#GridDetector.find_table_points-582"><span class="linenos">582</span></a>        <span class="p">)</span>
</span><span id="GridDetector.find_table_points-583"><a href="#GridDetector.find_table_points-583"><span class="linenos">583</span></a>        <span class="c1"># rescale corners back to original size</span>
</span><span id="GridDetector.find_table_points-584"><a href="#GridDetector.find_table_points-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-585"><a href="#GridDetector.find_table_points-585"><span class="linenos">585</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)):</span>
</span><span id="GridDetector.find_table_points-586"><a href="#GridDetector.find_table_points-586"><span class="linenos">586</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">])):</span>
</span><span id="GridDetector.find_table_points-587"><a href="#GridDetector.find_table_points-587"><span class="linenos">587</span></a>                    <span class="k">if</span> <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridDetector.find_table_points-588"><a href="#GridDetector.find_table_points-588"><span class="linenos">588</span></a>                        <span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GridDetector.find_table_points-589"><a href="#GridDetector.find_table_points-589"><span class="linenos">589</span></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span>  <span class="c1"># pyright:ignore</span>
</span><span id="GridDetector.find_table_points-590"><a href="#GridDetector.find_table_points-590"><span class="linenos">590</span></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">),</span>  <span class="c1"># pyright:ignore</span>
</span><span id="GridDetector.find_table_points-591"><a href="#GridDetector.find_table_points-591"><span class="linenos">591</span></a>                        <span class="p">)</span>
</span><span id="GridDetector.find_table_points-592"><a href="#GridDetector.find_table_points-592"><span class="linenos">592</span></a>
</span><span id="GridDetector.find_table_points-593"><a href="#GridDetector.find_table_points-593"><span class="linenos">593</span></a>        <span class="k">return</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Parse the image to a <code><a href="#TableGrid">TableGrid</a></code> structure that holds all of the
intersections between horizontal and vertical rules, starting near the <code>left_top</code> point</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>img (MatLike):</strong>  the input image of a table</li>
<li><strong>left_top (tuple[int, int]):</strong>  the starting point of the algorithm</li>
<li><strong>cell_widths (list[int]):</strong>  the expected widths of the cells (based on a header template)</li>
<li><strong>cell_heights (list[int]):</strong>  the expected height of the rows of data.
The last value from this list is used until the image has no more vertical space.</li>
<li><strong>visual (bool):</strong>  whether to show intermediate steps</li>
<li><strong>window (str):</strong>  the name of the OpenCV window to use for visualization</li>
<li><strong>goals_width (int | None):</strong>  the width of the goal region when searching for the next point.
If None, defaults to 1.5 * search_region</li>
<li><strong>filtered (MatLike | PathLike[str] | None):</strong>  if provided, this image is used instead of
calculating the filtered image from scratch</li>
<li><strong>smooth (bool):</strong>  if True, smooth the grid after detection, using local heuristics</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>a TableGrid object</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="TableGrid">
                            <input id="TableGrid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TableGrid</span><wbr>(<span class="base"><a href="#TableIndexer">taulu.TableIndexer</a></span>):

                <label class="view-source-button" for="TableGrid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid-725"><a href="#TableGrid-725"><span class="linenos">725</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TableGrid</span><span class="p">(</span><span class="n">TableIndexer</span><span class="p">):</span>
</span><span id="TableGrid-726"><a href="#TableGrid-726"><span class="linenos">726</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid-727"><a href="#TableGrid-727"><span class="linenos">727</span></a><span class="sd">    A data class that allows segmenting the image into cells</span>
</span><span id="TableGrid-728"><a href="#TableGrid-728"><span class="linenos">728</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TableGrid-729"><a href="#TableGrid-729"><span class="linenos">729</span></a>
</span><span id="TableGrid-730"><a href="#TableGrid-730"><span class="linenos">730</span></a>    <span class="n">_right_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TableGrid-731"><a href="#TableGrid-731"><span class="linenos">731</span></a>
</span><span id="TableGrid-732"><a href="#TableGrid-732"><span class="linenos">732</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]],</span> <span class="n">right_offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TableGrid-733"><a href="#TableGrid-733"><span class="linenos">733</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid-734"><a href="#TableGrid-734"><span class="linenos">734</span></a><span class="sd">        Args:</span>
</span><span id="TableGrid-735"><a href="#TableGrid-735"><span class="linenos">735</span></a><span class="sd">            points: a 2D list of intersections between hor. and vert. rules</span>
</span><span id="TableGrid-736"><a href="#TableGrid-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid-737"><a href="#TableGrid-737"><span class="linenos">737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="TableGrid-738"><a href="#TableGrid-738"><span class="linenos">738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="o">=</span> <span class="n">right_offset</span>
</span><span id="TableGrid-739"><a href="#TableGrid-739"><span class="linenos">739</span></a>
</span><span id="TableGrid-740"><a href="#TableGrid-740"><span class="linenos">740</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid-741"><a href="#TableGrid-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]]:</span>
</span><span id="TableGrid-742"><a href="#TableGrid-742"><span class="linenos">742</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span>
</span><span id="TableGrid-743"><a href="#TableGrid-743"><span class="linenos">743</span></a>
</span><span id="TableGrid-744"><a href="#TableGrid-744"><span class="linenos">744</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid-745"><a href="#TableGrid-745"><span class="linenos">745</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span>
</span><span id="TableGrid-746"><a href="#TableGrid-746"><span class="linenos">746</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TableGrid-747"><a href="#TableGrid-747"><span class="linenos">747</span></a>
</span><span id="TableGrid-748"><a href="#TableGrid-748"><span class="linenos">748</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid-749"><a href="#TableGrid-749"><span class="linenos">749</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableGrid-750"><a href="#TableGrid-750"><span class="linenos">750</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid-751"><a href="#TableGrid-751"><span class="linenos">751</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="TableGrid-752"><a href="#TableGrid-752"><span class="linenos">752</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TableGrid-753"><a href="#TableGrid-753"><span class="linenos">753</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="TableGrid-754"><a href="#TableGrid-754"><span class="linenos">754</span></a>
</span><span id="TableGrid-755"><a href="#TableGrid-755"><span class="linenos">755</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid-756"><a href="#TableGrid-756"><span class="linenos">756</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableGrid-757"><a href="#TableGrid-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="TableGrid-758"><a href="#TableGrid-758"><span class="linenos">758</span></a>
</span><span id="TableGrid-759"><a href="#TableGrid-759"><span class="linenos">759</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TableGrid-760"><a href="#TableGrid-760"><span class="linenos">760</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_split</span><span class="p">(</span>
</span><span id="TableGrid-761"><a href="#TableGrid-761"><span class="linenos">761</span></a>        <span class="n">split_grids</span><span class="p">:</span> <span class="n">Split</span><span class="p">[</span><span class="s2">&quot;TableGrid&quot;</span><span class="p">],</span> <span class="n">offsets</span><span class="p">:</span> <span class="n">Split</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span>
</span><span id="TableGrid-762"><a href="#TableGrid-762"><span class="linenos">762</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="TableGrid-763"><a href="#TableGrid-763"><span class="linenos">763</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid-764"><a href="#TableGrid-764"><span class="linenos">764</span></a><span class="sd">        Convert two ``TableGrid`` objects into one, that is able to segment the original (non-cropped) image</span>
</span><span id="TableGrid-765"><a href="#TableGrid-765"><span class="linenos">765</span></a>
</span><span id="TableGrid-766"><a href="#TableGrid-766"><span class="linenos">766</span></a><span class="sd">        Args:</span>
</span><span id="TableGrid-767"><a href="#TableGrid-767"><span class="linenos">767</span></a><span class="sd">            split_grids (Split[TableGrid]): a Split of TableGrid objects of the left and right part of the table</span>
</span><span id="TableGrid-768"><a href="#TableGrid-768"><span class="linenos">768</span></a><span class="sd">            offsets (Split[tuple[int, int]]): a Split of the offsets in the image where the crop happened</span>
</span><span id="TableGrid-769"><a href="#TableGrid-769"><span class="linenos">769</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid-770"><a href="#TableGrid-770"><span class="linenos">770</span></a>
</span><span id="TableGrid-771"><a href="#TableGrid-771"><span class="linenos">771</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">offset_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="TableGrid-772"><a href="#TableGrid-772"><span class="linenos">772</span></a>            <span class="k">return</span> <span class="p">[</span>
</span><span id="TableGrid-773"><a href="#TableGrid-773"><span class="linenos">773</span></a>                <span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">points</span>
</span><span id="TableGrid-774"><a href="#TableGrid-774"><span class="linenos">774</span></a>            <span class="p">]</span>
</span><span id="TableGrid-775"><a href="#TableGrid-775"><span class="linenos">775</span></a>
</span><span id="TableGrid-776"><a href="#TableGrid-776"><span class="linenos">776</span></a>        <span class="n">split_points</span> <span class="o">=</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="TableGrid-777"><a href="#TableGrid-777"><span class="linenos">777</span></a>            <span class="k">lambda</span> <span class="n">grid</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="n">offset_points</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span> <span class="n">offsets</span>
</span><span id="TableGrid-778"><a href="#TableGrid-778"><span class="linenos">778</span></a>        <span class="p">)</span>
</span><span id="TableGrid-779"><a href="#TableGrid-779"><span class="linenos">779</span></a>
</span><span id="TableGrid-780"><a href="#TableGrid-780"><span class="linenos">780</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid-781"><a href="#TableGrid-781"><span class="linenos">781</span></a>
</span><span id="TableGrid-782"><a href="#TableGrid-782"><span class="linenos">782</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">split_grids</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
</span><span id="TableGrid-783"><a href="#TableGrid-783"><span class="linenos">783</span></a>
</span><span id="TableGrid-784"><a href="#TableGrid-784"><span class="linenos">784</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid-785"><a href="#TableGrid-785"><span class="linenos">785</span></a>            <span class="n">row_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid-786"><a href="#TableGrid-786"><span class="linenos">786</span></a>
</span><span id="TableGrid-787"><a href="#TableGrid-787"><span class="linenos">787</span></a>            <span class="n">row_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_points</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
</span><span id="TableGrid-788"><a href="#TableGrid-788"><span class="linenos">788</span></a>            <span class="n">row_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_points</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
</span><span id="TableGrid-789"><a href="#TableGrid-789"><span class="linenos">789</span></a>
</span><span id="TableGrid-790"><a href="#TableGrid-790"><span class="linenos">790</span></a>            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_points</span><span class="p">)</span>
</span><span id="TableGrid-791"><a href="#TableGrid-791"><span class="linenos">791</span></a>
</span><span id="TableGrid-792"><a href="#TableGrid-792"><span class="linenos">792</span></a>        <span class="n">table_grid</span> <span class="o">=</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
</span><span id="TableGrid-793"><a href="#TableGrid-793"><span class="linenos">793</span></a>
</span><span id="TableGrid-794"><a href="#TableGrid-794"><span class="linenos">794</span></a>        <span class="k">return</span> <span class="n">table_grid</span>
</span><span id="TableGrid-795"><a href="#TableGrid-795"><span class="linenos">795</span></a>
</span><span id="TableGrid-796"><a href="#TableGrid-796"><span class="linenos">796</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="TableGrid-797"><a href="#TableGrid-797"><span class="linenos">797</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TableGrid-798"><a href="#TableGrid-798"><span class="linenos">798</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="s2">&quot;right_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
</span><span id="TableGrid-799"><a href="#TableGrid-799"><span class="linenos">799</span></a>
</span><span id="TableGrid-800"><a href="#TableGrid-800"><span class="linenos">800</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TableGrid-801"><a href="#TableGrid-801"><span class="linenos">801</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_saved</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="TableGrid-802"><a href="#TableGrid-802"><span class="linenos">802</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TableGrid-803"><a href="#TableGrid-803"><span class="linenos">803</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TableGrid-804"><a href="#TableGrid-804"><span class="linenos">804</span></a>            <span class="n">right_offset</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;right_offset&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TableGrid-805"><a href="#TableGrid-805"><span class="linenos">805</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="p">[[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pointes</span><span class="p">]</span> <span class="k">for</span> <span class="n">pointes</span> <span class="ow">in</span> <span class="n">points</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]]</span>
</span><span id="TableGrid-806"><a href="#TableGrid-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">right_offset</span><span class="p">)</span>
</span><span id="TableGrid-807"><a href="#TableGrid-807"><span class="linenos">807</span></a>
</span><span id="TableGrid-808"><a href="#TableGrid-808"><span class="linenos">808</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_left_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid-809"><a href="#TableGrid-809"><span class="linenos">809</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">:</span>
</span><span id="TableGrid-810"><a href="#TableGrid-810"><span class="linenos">810</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TableGrid-811"><a href="#TableGrid-811"><span class="linenos">811</span></a>            <span class="n">new_first</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TableGrid-812"><a href="#TableGrid-812"><span class="linenos">812</span></a>            <span class="n">row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_first</span><span class="p">)</span>
</span><span id="TableGrid-813"><a href="#TableGrid-813"><span class="linenos">813</span></a>
</span><span id="TableGrid-814"><a href="#TableGrid-814"><span class="linenos">814</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_top_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid-815"><a href="#TableGrid-815"><span class="linenos">815</span></a>        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid-816"><a href="#TableGrid-816"><span class="linenos">816</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="TableGrid-817"><a href="#TableGrid-817"><span class="linenos">817</span></a>            <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span><span class="p">))</span>
</span><span id="TableGrid-818"><a href="#TableGrid-818"><span class="linenos">818</span></a>
</span><span id="TableGrid-819"><a href="#TableGrid-819"><span class="linenos">819</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_row</span><span class="p">)</span>
</span><span id="TableGrid-820"><a href="#TableGrid-820"><span class="linenos">820</span></a>
</span><span id="TableGrid-821"><a href="#TableGrid-821"><span class="linenos">821</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_surrounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="TableGrid-822"><a href="#TableGrid-822"><span class="linenos">822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;point: x, y&quot;&quot;&quot;</span>
</span><span id="TableGrid-823"><a href="#TableGrid-823"><span class="linenos">823</span></a>        <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span> <span class="o">=</span> <span class="n">rect</span>
</span><span id="TableGrid-824"><a href="#TableGrid-824"><span class="linenos">824</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
</span><span id="TableGrid-825"><a href="#TableGrid-825"><span class="linenos">825</span></a>
</span><span id="TableGrid-826"><a href="#TableGrid-826"><span class="linenos">826</span></a>        <span class="n">top</span> <span class="o">=</span> <span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">lt</span><span class="p">,</span> <span class="o">*</span><span class="n">rt</span><span class="p">)</span>
</span><span id="TableGrid-827"><a href="#TableGrid-827"><span class="linenos">827</span></a>        <span class="k">if</span> <span class="n">top</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
</span><span id="TableGrid-828"><a href="#TableGrid-828"><span class="linenos">828</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TableGrid-829"><a href="#TableGrid-829"><span class="linenos">829</span></a>
</span><span id="TableGrid-830"><a href="#TableGrid-830"><span class="linenos">830</span></a>        <span class="n">right</span> <span class="o">=</span> <span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">rt</span><span class="p">,</span> <span class="o">*</span><span class="n">rb</span><span class="p">)</span>
</span><span id="TableGrid-831"><a href="#TableGrid-831"><span class="linenos">831</span></a>        <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
</span><span id="TableGrid-832"><a href="#TableGrid-832"><span class="linenos">832</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TableGrid-833"><a href="#TableGrid-833"><span class="linenos">833</span></a>
</span><span id="TableGrid-834"><a href="#TableGrid-834"><span class="linenos">834</span></a>        <span class="n">bottom</span> <span class="o">=</span> <span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">lb</span><span class="p">,</span> <span class="o">*</span><span class="n">rb</span><span class="p">)</span>
</span><span id="TableGrid-835"><a href="#TableGrid-835"><span class="linenos">835</span></a>        <span class="k">if</span> <span class="n">bottom</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
</span><span id="TableGrid-836"><a href="#TableGrid-836"><span class="linenos">836</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TableGrid-837"><a href="#TableGrid-837"><span class="linenos">837</span></a>
</span><span id="TableGrid-838"><a href="#TableGrid-838"><span class="linenos">838</span></a>        <span class="n">left</span> <span class="o">=</span> <span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">lb</span><span class="p">,</span> <span class="o">*</span><span class="n">lt</span><span class="p">)</span>
</span><span id="TableGrid-839"><a href="#TableGrid-839"><span class="linenos">839</span></a>        <span class="k">if</span> <span class="n">left</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
</span><span id="TableGrid-840"><a href="#TableGrid-840"><span class="linenos">840</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TableGrid-841"><a href="#TableGrid-841"><span class="linenos">841</span></a>
</span><span id="TableGrid-842"><a href="#TableGrid-842"><span class="linenos">842</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TableGrid-843"><a href="#TableGrid-843"><span class="linenos">843</span></a>
</span><span id="TableGrid-844"><a href="#TableGrid-844"><span class="linenos">844</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TableGrid-845"><a href="#TableGrid-845"><span class="linenos">845</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid-846"><a href="#TableGrid-846"><span class="linenos">846</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TableGrid-847"><a href="#TableGrid-847"><span class="linenos">847</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid-848"><a href="#TableGrid-848"><span class="linenos">848</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid-849"><a href="#TableGrid-849"><span class="linenos">849</span></a>                    <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TableGrid-850"><a href="#TableGrid-850"><span class="linenos">850</span></a>                    <span class="k">continue</span>
</span><span id="TableGrid-851"><a href="#TableGrid-851"><span class="linenos">851</span></a>
</span><span id="TableGrid-852"><a href="#TableGrid-852"><span class="linenos">852</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surrounds</span><span class="p">(</span>
</span><span id="TableGrid-853"><a href="#TableGrid-853"><span class="linenos">853</span></a>                    <span class="p">[</span>
</span><span id="TableGrid-854"><a href="#TableGrid-854"><span class="linenos">854</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid-855"><a href="#TableGrid-855"><span class="linenos">855</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid-856"><a href="#TableGrid-856"><span class="linenos">856</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid-857"><a href="#TableGrid-857"><span class="linenos">857</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid-858"><a href="#TableGrid-858"><span class="linenos">858</span></a>                    <span class="p">],</span>
</span><span id="TableGrid-859"><a href="#TableGrid-859"><span class="linenos">859</span></a>                    <span class="n">point</span><span class="p">,</span>
</span><span id="TableGrid-860"><a href="#TableGrid-860"><span class="linenos">860</span></a>                <span class="p">):</span>
</span><span id="TableGrid-861"><a href="#TableGrid-861"><span class="linenos">861</span></a>                    <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="TableGrid-862"><a href="#TableGrid-862"><span class="linenos">862</span></a>
</span><span id="TableGrid-863"><a href="#TableGrid-863"><span class="linenos">863</span></a>        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TableGrid-864"><a href="#TableGrid-864"><span class="linenos">864</span></a>
</span><span id="TableGrid-865"><a href="#TableGrid-865"><span class="linenos">865</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid-866"><a href="#TableGrid-866"><span class="linenos">866</span></a>        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="TableGrid-867"><a href="#TableGrid-867"><span class="linenos">867</span></a>
</span><span id="TableGrid-868"><a href="#TableGrid-868"><span class="linenos">868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="TableGrid-869"><a href="#TableGrid-869"><span class="linenos">869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="TableGrid-870"><a href="#TableGrid-870"><span class="linenos">870</span></a>
</span><span id="TableGrid-871"><a href="#TableGrid-871"><span class="linenos">871</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid-872"><a href="#TableGrid-872"><span class="linenos">872</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid-873"><a href="#TableGrid-873"><span class="linenos">873</span></a>
</span><span id="TableGrid-874"><a href="#TableGrid-874"><span class="linenos">874</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="TableGrid-875"><a href="#TableGrid-875"><span class="linenos">875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid-876"><a href="#TableGrid-876"><span class="linenos">876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid-877"><a href="#TableGrid-877"><span class="linenos">877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid-878"><a href="#TableGrid-878"><span class="linenos">878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid-879"><a href="#TableGrid-879"><span class="linenos">879</span></a>        <span class="p">)</span>
</span><span id="TableGrid-880"><a href="#TableGrid-880"><span class="linenos">880</span></a>
</span><span id="TableGrid-881"><a href="#TableGrid-881"><span class="linenos">881</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="TableGrid-882"><a href="#TableGrid-882"><span class="linenos">882</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="TableGrid-883"><a href="#TableGrid-883"><span class="linenos">883</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid-884"><a href="#TableGrid-884"><span class="linenos">884</span></a>        <span class="n">r0</span><span class="p">,</span> <span class="n">c0</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="TableGrid-885"><a href="#TableGrid-885"><span class="linenos">885</span></a>        <span class="n">r1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="TableGrid-886"><a href="#TableGrid-886"><span class="linenos">886</span></a>
</span><span id="TableGrid-887"><a href="#TableGrid-887"><span class="linenos">887</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span>
</span><span id="TableGrid-888"><a href="#TableGrid-888"><span class="linenos">888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
</span><span id="TableGrid-889"><a href="#TableGrid-889"><span class="linenos">889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span>
</span><span id="TableGrid-890"><a href="#TableGrid-890"><span class="linenos">890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="TableGrid-891"><a href="#TableGrid-891"><span class="linenos">891</span></a>
</span><span id="TableGrid-892"><a href="#TableGrid-892"><span class="linenos">892</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c0</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid-893"><a href="#TableGrid-893"><span class="linenos">893</span></a>            <span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid-894"><a href="#TableGrid-894"><span class="linenos">894</span></a>
</span><span id="TableGrid-895"><a href="#TableGrid-895"><span class="linenos">895</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid-896"><a href="#TableGrid-896"><span class="linenos">896</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid-897"><a href="#TableGrid-897"><span class="linenos">897</span></a>
</span><span id="TableGrid-898"><a href="#TableGrid-898"><span class="linenos">898</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r0</span><span class="p">][</span><span class="n">c0</span><span class="p">]</span>
</span><span id="TableGrid-899"><a href="#TableGrid-899"><span class="linenos">899</span></a>        <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r0</span><span class="p">][</span><span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="TableGrid-900"><a href="#TableGrid-900"><span class="linenos">900</span></a>        <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="TableGrid-901"><a href="#TableGrid-901"><span class="linenos">901</span></a>        <span class="n">lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c0</span><span class="p">]</span>
</span><span id="TableGrid-902"><a href="#TableGrid-902"><span class="linenos">902</span></a>
</span><span id="TableGrid-903"><a href="#TableGrid-903"><span class="linenos">903</span></a>        <span class="k">return</span> <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span>
</span><span id="TableGrid-904"><a href="#TableGrid-904"><span class="linenos">904</span></a>
</span><span id="TableGrid-905"><a href="#TableGrid-905"><span class="linenos">905</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">):</span>
</span><span id="TableGrid-906"><a href="#TableGrid-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid-907"><a href="#TableGrid-907"><span class="linenos">907</span></a><span class="sd">        Draw the detected table points on the image for visual verification</span>
</span><span id="TableGrid-908"><a href="#TableGrid-908"><span class="linenos">908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid-909"><a href="#TableGrid-909"><span class="linenos">909</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">colorsys</span>
</span><span id="TableGrid-910"><a href="#TableGrid-910"><span class="linenos">910</span></a>
</span><span id="TableGrid-911"><a href="#TableGrid-911"><span class="linenos">911</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">clr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
</span><span id="TableGrid-912"><a href="#TableGrid-912"><span class="linenos">912</span></a>            <span class="n">hue</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="n">total_steps</span>  <span class="c1"># Normalized hue between 0 and 1</span>
</span><span id="TableGrid-913"><a href="#TableGrid-913"><span class="linenos">913</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="TableGrid-914"><a href="#TableGrid-914"><span class="linenos">914</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="TableGrid-915"><a href="#TableGrid-915"><span class="linenos">915</span></a>
</span><span id="TableGrid-916"><a href="#TableGrid-916"><span class="linenos">916</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">):</span>
</span><span id="TableGrid-917"><a href="#TableGrid-917"><span class="linenos">917</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
</span><span id="TableGrid-918"><a href="#TableGrid-918"><span class="linenos">918</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">clr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TableGrid-919"><a href="#TableGrid-919"><span class="linenos">919</span></a>
</span><span id="TableGrid-920"><a href="#TableGrid-920"><span class="linenos">920</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="TableGrid-921"><a href="#TableGrid-921"><span class="linenos">921</span></a>
</span><span id="TableGrid-922"><a href="#TableGrid-922"><span class="linenos">922</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="TableGrid-923"><a href="#TableGrid-923"><span class="linenos">923</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
</span><span id="TableGrid-924"><a href="#TableGrid-924"><span class="linenos">924</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="TableGrid-925"><a href="#TableGrid-925"><span class="linenos">925</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">vertical_rule_crop</span><span class="p">(</span><span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid-926"><a href="#TableGrid-926"><span class="linenos">926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="TableGrid-927"><a href="#TableGrid-927"><span class="linenos">927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="TableGrid-928"><a href="#TableGrid-928"><span class="linenos">928</span></a>
</span><span id="TableGrid-929"><a href="#TableGrid-929"><span class="linenos">929</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid-930"><a href="#TableGrid-930"><span class="linenos">930</span></a>                <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid-931"><a href="#TableGrid-931"><span class="linenos">931</span></a>
</span><span id="TableGrid-932"><a href="#TableGrid-932"><span class="linenos">932</span></a>            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="TableGrid-933"><a href="#TableGrid-933"><span class="linenos">933</span></a>            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="TableGrid-934"><a href="#TableGrid-934"><span class="linenos">934</span></a>
</span><span id="TableGrid-935"><a href="#TableGrid-935"><span class="linenos">935</span></a>            <span class="n">left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="TableGrid-936"><a href="#TableGrid-936"><span class="linenos">936</span></a>            <span class="n">right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="TableGrid-937"><a href="#TableGrid-937"><span class="linenos">937</span></a>
</span><span id="TableGrid-938"><a href="#TableGrid-938"><span class="linenos">938</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">[</span>
</span><span id="TableGrid-939"><a href="#TableGrid-939"><span class="linenos">939</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">margin_y</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">margin_y</span><span class="p">,</span>
</span><span id="TableGrid-940"><a href="#TableGrid-940"><span class="linenos">940</span></a>                <span class="n">left</span> <span class="o">-</span> <span class="n">margin_x</span> <span class="p">:</span> <span class="n">right</span> <span class="o">+</span> <span class="n">margin_x</span><span class="p">,</span>
</span><span id="TableGrid-941"><a href="#TableGrid-941"><span class="linenos">941</span></a>            <span class="p">]</span>
</span><span id="TableGrid-942"><a href="#TableGrid-942"><span class="linenos">942</span></a>
</span><span id="TableGrid-943"><a href="#TableGrid-943"><span class="linenos">943</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid-944"><a href="#TableGrid-944"><span class="linenos">944</span></a>
</span><span id="TableGrid-945"><a href="#TableGrid-945"><span class="linenos">945</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TableGrid-946"><a href="#TableGrid-946"><span class="linenos">946</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="TableGrid-947"><a href="#TableGrid-947"><span class="linenos">947</span></a>            <span class="n">crop</span> <span class="o">=</span> <span class="n">vertical_rule_crop</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="TableGrid-948"><a href="#TableGrid-948"><span class="linenos">948</span></a>            <span class="n">text_over_score</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">text_presence_score</span><span class="p">(</span><span class="n">crop</span><span class="p">)</span>
</span><span id="TableGrid-949"><a href="#TableGrid-949"><span class="linenos">949</span></a>            <span class="n">text_over</span> <span class="o">=</span> <span class="n">text_over_score</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.10</span>
</span><span id="TableGrid-950"><a href="#TableGrid-950"><span class="linenos">950</span></a>
</span><span id="TableGrid-951"><a href="#TableGrid-951"><span class="linenos">951</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">text_over</span><span class="p">:</span>
</span><span id="TableGrid-952"><a href="#TableGrid-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid-953"><a href="#TableGrid-953"><span class="linenos">953</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="TableGrid-954"><a href="#TableGrid-954"><span class="linenos">954</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">col</span>
</span><span id="TableGrid-955"><a href="#TableGrid-955"><span class="linenos">955</span></a>
</span><span id="TableGrid-956"><a href="#TableGrid-956"><span class="linenos">956</span></a>        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid-957"><a href="#TableGrid-957"><span class="linenos">957</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="TableGrid-958"><a href="#TableGrid-958"><span class="linenos">958</span></a>
</span><span id="TableGrid-959"><a href="#TableGrid-959"><span class="linenos">959</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>A data class that allows segmenting the image into cells</p>
</div>


                            <div id="TableGrid.__init__" class="classattr">
                                        <input id="TableGrid.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TableGrid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">right_offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="TableGrid.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.__init__-732"><a href="#TableGrid.__init__-732"><span class="linenos">732</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]],</span> <span class="n">right_offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TableGrid.__init__-733"><a href="#TableGrid.__init__-733"><span class="linenos">733</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid.__init__-734"><a href="#TableGrid.__init__-734"><span class="linenos">734</span></a><span class="sd">        Args:</span>
</span><span id="TableGrid.__init__-735"><a href="#TableGrid.__init__-735"><span class="linenos">735</span></a><span class="sd">            points: a 2D list of intersections between hor. and vert. rules</span>
</span><span id="TableGrid.__init__-736"><a href="#TableGrid.__init__-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid.__init__-737"><a href="#TableGrid.__init__-737"><span class="linenos">737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="TableGrid.__init__-738"><a href="#TableGrid.__init__-738"><span class="linenos">738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="o">=</span> <span class="n">right_offset</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>points:</strong>  a 2D list of intersections between hor. and vert. rules</li>
</ul>
</div>


                            </div>
                            <div id="TableGrid.points" class="classattr">
                                        <input id="TableGrid.points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">points</span><span class="annotation">: list[list[typing.Tuple[int, int]]]</span>

                <label class="view-source-button" for="TableGrid.points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.points-740"><a href="#TableGrid.points-740"><span class="linenos">740</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid.points-741"><a href="#TableGrid.points-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]]:</span>
</span><span id="TableGrid.points-742"><a href="#TableGrid.points-742"><span class="linenos">742</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.row" class="classattr">
                                        <input id="TableGrid.row-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">row</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableGrid.row-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.row"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.row-744"><a href="#TableGrid.row-744"><span class="linenos">744</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid.row-745"><a href="#TableGrid.row-745"><span class="linenos">745</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span>
</span><span id="TableGrid.row-746"><a href="#TableGrid.row-746"><span class="linenos">746</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.cols" class="classattr">
                                        <input id="TableGrid.cols-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">cols</span><span class="annotation">: int</span>

                <label class="view-source-button" for="TableGrid.cols-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.cols"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.cols-748"><a href="#TableGrid.cols-748"><span class="linenos">748</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid.cols-749"><a href="#TableGrid.cols-749"><span class="linenos">749</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableGrid.cols-750"><a href="#TableGrid.cols-750"><span class="linenos">750</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid.cols-751"><a href="#TableGrid.cols-751"><span class="linenos">751</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="TableGrid.cols-752"><a href="#TableGrid.cols-752"><span class="linenos">752</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TableGrid.cols-753"><a href="#TableGrid.cols-753"><span class="linenos">753</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.rows" class="classattr">
                                        <input id="TableGrid.rows-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">rows</span><span class="annotation">: int</span>

                <label class="view-source-button" for="TableGrid.rows-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.rows"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.rows-755"><a href="#TableGrid.rows-755"><span class="linenos">755</span></a>    <span class="nd">@property</span>
</span><span id="TableGrid.rows-756"><a href="#TableGrid.rows-756"><span class="linenos">756</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableGrid.rows-757"><a href="#TableGrid.rows-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.from_split" class="classattr">
                                        <input id="TableGrid.from_split-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_split</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">split_grids</span><span class="p">:</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="n"><a href="#TableGrid">TableGrid</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">offsets</span><span class="p">:</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#TableGrid">TableGrid</a></span>:</span></span>

                <label class="view-source-button" for="TableGrid.from_split-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.from_split"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.from_split-759"><a href="#TableGrid.from_split-759"><span class="linenos">759</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TableGrid.from_split-760"><a href="#TableGrid.from_split-760"><span class="linenos">760</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_split</span><span class="p">(</span>
</span><span id="TableGrid.from_split-761"><a href="#TableGrid.from_split-761"><span class="linenos">761</span></a>        <span class="n">split_grids</span><span class="p">:</span> <span class="n">Split</span><span class="p">[</span><span class="s2">&quot;TableGrid&quot;</span><span class="p">],</span> <span class="n">offsets</span><span class="p">:</span> <span class="n">Split</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span>
</span><span id="TableGrid.from_split-762"><a href="#TableGrid.from_split-762"><span class="linenos">762</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="TableGrid.from_split-763"><a href="#TableGrid.from_split-763"><span class="linenos">763</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid.from_split-764"><a href="#TableGrid.from_split-764"><span class="linenos">764</span></a><span class="sd">        Convert two ``TableGrid`` objects into one, that is able to segment the original (non-cropped) image</span>
</span><span id="TableGrid.from_split-765"><a href="#TableGrid.from_split-765"><span class="linenos">765</span></a>
</span><span id="TableGrid.from_split-766"><a href="#TableGrid.from_split-766"><span class="linenos">766</span></a><span class="sd">        Args:</span>
</span><span id="TableGrid.from_split-767"><a href="#TableGrid.from_split-767"><span class="linenos">767</span></a><span class="sd">            split_grids (Split[TableGrid]): a Split of TableGrid objects of the left and right part of the table</span>
</span><span id="TableGrid.from_split-768"><a href="#TableGrid.from_split-768"><span class="linenos">768</span></a><span class="sd">            offsets (Split[tuple[int, int]]): a Split of the offsets in the image where the crop happened</span>
</span><span id="TableGrid.from_split-769"><a href="#TableGrid.from_split-769"><span class="linenos">769</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid.from_split-770"><a href="#TableGrid.from_split-770"><span class="linenos">770</span></a>
</span><span id="TableGrid.from_split-771"><a href="#TableGrid.from_split-771"><span class="linenos">771</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">offset_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="TableGrid.from_split-772"><a href="#TableGrid.from_split-772"><span class="linenos">772</span></a>            <span class="k">return</span> <span class="p">[</span>
</span><span id="TableGrid.from_split-773"><a href="#TableGrid.from_split-773"><span class="linenos">773</span></a>                <span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">points</span>
</span><span id="TableGrid.from_split-774"><a href="#TableGrid.from_split-774"><span class="linenos">774</span></a>            <span class="p">]</span>
</span><span id="TableGrid.from_split-775"><a href="#TableGrid.from_split-775"><span class="linenos">775</span></a>
</span><span id="TableGrid.from_split-776"><a href="#TableGrid.from_split-776"><span class="linenos">776</span></a>        <span class="n">split_points</span> <span class="o">=</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="TableGrid.from_split-777"><a href="#TableGrid.from_split-777"><span class="linenos">777</span></a>            <span class="k">lambda</span> <span class="n">grid</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="n">offset_points</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span> <span class="n">offsets</span>
</span><span id="TableGrid.from_split-778"><a href="#TableGrid.from_split-778"><span class="linenos">778</span></a>        <span class="p">)</span>
</span><span id="TableGrid.from_split-779"><a href="#TableGrid.from_split-779"><span class="linenos">779</span></a>
</span><span id="TableGrid.from_split-780"><a href="#TableGrid.from_split-780"><span class="linenos">780</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid.from_split-781"><a href="#TableGrid.from_split-781"><span class="linenos">781</span></a>
</span><span id="TableGrid.from_split-782"><a href="#TableGrid.from_split-782"><span class="linenos">782</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">split_grids</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
</span><span id="TableGrid.from_split-783"><a href="#TableGrid.from_split-783"><span class="linenos">783</span></a>
</span><span id="TableGrid.from_split-784"><a href="#TableGrid.from_split-784"><span class="linenos">784</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid.from_split-785"><a href="#TableGrid.from_split-785"><span class="linenos">785</span></a>            <span class="n">row_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid.from_split-786"><a href="#TableGrid.from_split-786"><span class="linenos">786</span></a>
</span><span id="TableGrid.from_split-787"><a href="#TableGrid.from_split-787"><span class="linenos">787</span></a>            <span class="n">row_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_points</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
</span><span id="TableGrid.from_split-788"><a href="#TableGrid.from_split-788"><span class="linenos">788</span></a>            <span class="n">row_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_points</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
</span><span id="TableGrid.from_split-789"><a href="#TableGrid.from_split-789"><span class="linenos">789</span></a>
</span><span id="TableGrid.from_split-790"><a href="#TableGrid.from_split-790"><span class="linenos">790</span></a>            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_points</span><span class="p">)</span>
</span><span id="TableGrid.from_split-791"><a href="#TableGrid.from_split-791"><span class="linenos">791</span></a>
</span><span id="TableGrid.from_split-792"><a href="#TableGrid.from_split-792"><span class="linenos">792</span></a>        <span class="n">table_grid</span> <span class="o">=</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">split_grids</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
</span><span id="TableGrid.from_split-793"><a href="#TableGrid.from_split-793"><span class="linenos">793</span></a>
</span><span id="TableGrid.from_split-794"><a href="#TableGrid.from_split-794"><span class="linenos">794</span></a>        <span class="k">return</span> <span class="n">table_grid</span>
</span></pre></div>


            <div class="docstring"><p>Convert two <code><a href="#TableGrid">TableGrid</a></code> objects into one, that is able to segment the original (non-cropped) image</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>split_grids (Split[TableGrid]):</strong>  a Split of TableGrid objects of the left and right part of the table</li>
<li><strong>offsets (Split[tuple[int, int]]):</strong>  a Split of the offsets in the image where the crop happened</li>
</ul>
</div>


                            </div>
                            <div id="TableGrid.save" class="classattr">
                                        <input id="TableGrid.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TableGrid.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.save-796"><a href="#TableGrid.save-796"><span class="linenos">796</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="TableGrid.save-797"><a href="#TableGrid.save-797"><span class="linenos">797</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TableGrid.save-798"><a href="#TableGrid.save-798"><span class="linenos">798</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="s2">&quot;right_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.from_saved" class="classattr">
                                        <input id="TableGrid.from_saved-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_saved</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">) -> <span class="n"><a href="#TableGrid">TableGrid</a></span>:</span></span>

                <label class="view-source-button" for="TableGrid.from_saved-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.from_saved"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.from_saved-800"><a href="#TableGrid.from_saved-800"><span class="linenos">800</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TableGrid.from_saved-801"><a href="#TableGrid.from_saved-801"><span class="linenos">801</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_saved</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableGrid&quot;</span><span class="p">:</span>
</span><span id="TableGrid.from_saved-802"><a href="#TableGrid.from_saved-802"><span class="linenos">802</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TableGrid.from_saved-803"><a href="#TableGrid.from_saved-803"><span class="linenos">803</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TableGrid.from_saved-804"><a href="#TableGrid.from_saved-804"><span class="linenos">804</span></a>            <span class="n">right_offset</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;right_offset&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TableGrid.from_saved-805"><a href="#TableGrid.from_saved-805"><span class="linenos">805</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="p">[[(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pointes</span><span class="p">]</span> <span class="k">for</span> <span class="n">pointes</span> <span class="ow">in</span> <span class="n">points</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]]</span>
</span><span id="TableGrid.from_saved-806"><a href="#TableGrid.from_saved-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="n">TableGrid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">right_offset</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.add_left_col" class="classattr">
                                        <input id="TableGrid.add_left_col-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_left_col</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">width</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TableGrid.add_left_col-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.add_left_col"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.add_left_col-808"><a href="#TableGrid.add_left_col-808"><span class="linenos">808</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_left_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid.add_left_col-809"><a href="#TableGrid.add_left_col-809"><span class="linenos">809</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">:</span>
</span><span id="TableGrid.add_left_col-810"><a href="#TableGrid.add_left_col-810"><span class="linenos">810</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TableGrid.add_left_col-811"><a href="#TableGrid.add_left_col-811"><span class="linenos">811</span></a>            <span class="n">new_first</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TableGrid.add_left_col-812"><a href="#TableGrid.add_left_col-812"><span class="linenos">812</span></a>            <span class="n">row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_first</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.add_top_row" class="classattr">
                                        <input id="TableGrid.add_top_row-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_top_row</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">height</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TableGrid.add_top_row-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.add_top_row"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.add_top_row-814"><a href="#TableGrid.add_top_row-814"><span class="linenos">814</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_top_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid.add_top_row-815"><a href="#TableGrid.add_top_row-815"><span class="linenos">815</span></a>        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid.add_top_row-816"><a href="#TableGrid.add_top_row-816"><span class="linenos">816</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="TableGrid.add_top_row-817"><a href="#TableGrid.add_top_row-817"><span class="linenos">817</span></a>            <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span><span class="p">))</span>
</span><span id="TableGrid.add_top_row-818"><a href="#TableGrid.add_top_row-818"><span class="linenos">818</span></a>
</span><span id="TableGrid.add_top_row-819"><a href="#TableGrid.add_top_row-819"><span class="linenos">819</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_row</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TableGrid.cell" class="classattr">
                                        <input id="TableGrid.cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableGrid.cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.cell-844"><a href="#TableGrid.cell-844"><span class="linenos">844</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TableGrid.cell-845"><a href="#TableGrid.cell-845"><span class="linenos">845</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid.cell-846"><a href="#TableGrid.cell-846"><span class="linenos">846</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TableGrid.cell-847"><a href="#TableGrid.cell-847"><span class="linenos">847</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="TableGrid.cell-848"><a href="#TableGrid.cell-848"><span class="linenos">848</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid.cell-849"><a href="#TableGrid.cell-849"><span class="linenos">849</span></a>                    <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="TableGrid.cell-850"><a href="#TableGrid.cell-850"><span class="linenos">850</span></a>                    <span class="k">continue</span>
</span><span id="TableGrid.cell-851"><a href="#TableGrid.cell-851"><span class="linenos">851</span></a>
</span><span id="TableGrid.cell-852"><a href="#TableGrid.cell-852"><span class="linenos">852</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surrounds</span><span class="p">(</span>
</span><span id="TableGrid.cell-853"><a href="#TableGrid.cell-853"><span class="linenos">853</span></a>                    <span class="p">[</span>
</span><span id="TableGrid.cell-854"><a href="#TableGrid.cell-854"><span class="linenos">854</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid.cell-855"><a href="#TableGrid.cell-855"><span class="linenos">855</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid.cell-856"><a href="#TableGrid.cell-856"><span class="linenos">856</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid.cell-857"><a href="#TableGrid.cell-857"><span class="linenos">857</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid.cell-858"><a href="#TableGrid.cell-858"><span class="linenos">858</span></a>                    <span class="p">],</span>
</span><span id="TableGrid.cell-859"><a href="#TableGrid.cell-859"><span class="linenos">859</span></a>                    <span class="n">point</span><span class="p">,</span>
</span><span id="TableGrid.cell-860"><a href="#TableGrid.cell-860"><span class="linenos">860</span></a>                <span class="p">):</span>
</span><span id="TableGrid.cell-861"><a href="#TableGrid.cell-861"><span class="linenos">861</span></a>                    <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="TableGrid.cell-862"><a href="#TableGrid.cell-862"><span class="linenos">862</span></a>
</span><span id="TableGrid.cell-863"><a href="#TableGrid.cell-863"><span class="linenos">863</span></a>        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the coordinate (row, col) of the cell that contains the given position</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>point (tuple[float, float]):</strong>  a location in the input image</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[int, int]: the cell index (row, col) that contains the given point</p>
</blockquote>
</div>


                            </div>
                            <div id="TableGrid.cell_polygon" class="classattr">
                                        <input id="TableGrid.cell_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_polygon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableGrid.cell_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.cell_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.cell_polygon-865"><a href="#TableGrid.cell_polygon-865"><span class="linenos">865</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid.cell_polygon-866"><a href="#TableGrid.cell_polygon-866"><span class="linenos">866</span></a>        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="TableGrid.cell_polygon-867"><a href="#TableGrid.cell_polygon-867"><span class="linenos">867</span></a>
</span><span id="TableGrid.cell_polygon-868"><a href="#TableGrid.cell_polygon-868"><span class="linenos">868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="TableGrid.cell_polygon-869"><a href="#TableGrid.cell_polygon-869"><span class="linenos">869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="TableGrid.cell_polygon-870"><a href="#TableGrid.cell_polygon-870"><span class="linenos">870</span></a>
</span><span id="TableGrid.cell_polygon-871"><a href="#TableGrid.cell_polygon-871"><span class="linenos">871</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid.cell_polygon-872"><a href="#TableGrid.cell_polygon-872"><span class="linenos">872</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid.cell_polygon-873"><a href="#TableGrid.cell_polygon-873"><span class="linenos">873</span></a>
</span><span id="TableGrid.cell_polygon-874"><a href="#TableGrid.cell_polygon-874"><span class="linenos">874</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="TableGrid.cell_polygon-875"><a href="#TableGrid.cell_polygon-875"><span class="linenos">875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid.cell_polygon-876"><a href="#TableGrid.cell_polygon-876"><span class="linenos">876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid.cell_polygon-877"><a href="#TableGrid.cell_polygon-877"><span class="linenos">877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="TableGrid.cell_polygon-878"><a href="#TableGrid.cell_polygon-878"><span class="linenos">878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">],</span>
</span><span id="TableGrid.cell_polygon-879"><a href="#TableGrid.cell_polygon-879"><span class="linenos">879</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>returns the polygon (used in e.g. opencv) that enscribes the cell at the given cell position</p>
</div>


                            </div>
                            <div id="TableGrid.region" class="classattr">
                                        <input id="TableGrid.region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">region</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableGrid.region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.region-881"><a href="#TableGrid.region-881"><span class="linenos">881</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="TableGrid.region-882"><a href="#TableGrid.region-882"><span class="linenos">882</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="TableGrid.region-883"><a href="#TableGrid.region-883"><span class="linenos">883</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableGrid.region-884"><a href="#TableGrid.region-884"><span class="linenos">884</span></a>        <span class="n">r0</span><span class="p">,</span> <span class="n">c0</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="TableGrid.region-885"><a href="#TableGrid.region-885"><span class="linenos">885</span></a>        <span class="n">r1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="TableGrid.region-886"><a href="#TableGrid.region-886"><span class="linenos">886</span></a>
</span><span id="TableGrid.region-887"><a href="#TableGrid.region-887"><span class="linenos">887</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span>
</span><span id="TableGrid.region-888"><a href="#TableGrid.region-888"><span class="linenos">888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
</span><span id="TableGrid.region-889"><a href="#TableGrid.region-889"><span class="linenos">889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span>
</span><span id="TableGrid.region-890"><a href="#TableGrid.region-890"><span class="linenos">890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
</span><span id="TableGrid.region-891"><a href="#TableGrid.region-891"><span class="linenos">891</span></a>
</span><span id="TableGrid.region-892"><a href="#TableGrid.region-892"><span class="linenos">892</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c0</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid.region-893"><a href="#TableGrid.region-893"><span class="linenos">893</span></a>            <span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid.region-894"><a href="#TableGrid.region-894"><span class="linenos">894</span></a>
</span><span id="TableGrid.region-895"><a href="#TableGrid.region-895"><span class="linenos">895</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid.region-896"><a href="#TableGrid.region-896"><span class="linenos">896</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid.region-897"><a href="#TableGrid.region-897"><span class="linenos">897</span></a>
</span><span id="TableGrid.region-898"><a href="#TableGrid.region-898"><span class="linenos">898</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r0</span><span class="p">][</span><span class="n">c0</span><span class="p">]</span>
</span><span id="TableGrid.region-899"><a href="#TableGrid.region-899"><span class="linenos">899</span></a>        <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r0</span><span class="p">][</span><span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="TableGrid.region-900"><a href="#TableGrid.region-900"><span class="linenos">900</span></a>        <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="TableGrid.region-901"><a href="#TableGrid.region-901"><span class="linenos">901</span></a>        <span class="n">lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">r1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">c0</span><span class="p">]</span>
</span><span id="TableGrid.region-902"><a href="#TableGrid.region-902"><span class="linenos">902</span></a>
</span><span id="TableGrid.region-903"><a href="#TableGrid.region-903"><span class="linenos">903</span></a>        <span class="k">return</span> <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span>
</span></pre></div>


            <div class="docstring"><p>Get the bounding box for the rectangular region that goes from start to end</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>4 points: lt, rt, rb, lb, in format (x, y)</p>
</blockquote>
</div>


                            </div>
                            <div id="TableGrid.visualize_points" class="classattr">
                                        <input id="TableGrid.visualize_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TableGrid.visualize_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.visualize_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.visualize_points-905"><a href="#TableGrid.visualize_points-905"><span class="linenos">905</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">):</span>
</span><span id="TableGrid.visualize_points-906"><a href="#TableGrid.visualize_points-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableGrid.visualize_points-907"><a href="#TableGrid.visualize_points-907"><span class="linenos">907</span></a><span class="sd">        Draw the detected table points on the image for visual verification</span>
</span><span id="TableGrid.visualize_points-908"><a href="#TableGrid.visualize_points-908"><span class="linenos">908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableGrid.visualize_points-909"><a href="#TableGrid.visualize_points-909"><span class="linenos">909</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">colorsys</span>
</span><span id="TableGrid.visualize_points-910"><a href="#TableGrid.visualize_points-910"><span class="linenos">910</span></a>
</span><span id="TableGrid.visualize_points-911"><a href="#TableGrid.visualize_points-911"><span class="linenos">911</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">clr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
</span><span id="TableGrid.visualize_points-912"><a href="#TableGrid.visualize_points-912"><span class="linenos">912</span></a>            <span class="n">hue</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="n">total_steps</span>  <span class="c1"># Normalized hue between 0 and 1</span>
</span><span id="TableGrid.visualize_points-913"><a href="#TableGrid.visualize_points-913"><span class="linenos">913</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="TableGrid.visualize_points-914"><a href="#TableGrid.visualize_points-914"><span class="linenos">914</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="TableGrid.visualize_points-915"><a href="#TableGrid.visualize_points-915"><span class="linenos">915</span></a>
</span><span id="TableGrid.visualize_points-916"><a href="#TableGrid.visualize_points-916"><span class="linenos">916</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">):</span>
</span><span id="TableGrid.visualize_points-917"><a href="#TableGrid.visualize_points-917"><span class="linenos">917</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
</span><span id="TableGrid.visualize_points-918"><a href="#TableGrid.visualize_points-918"><span class="linenos">918</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">clr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TableGrid.visualize_points-919"><a href="#TableGrid.visualize_points-919"><span class="linenos">919</span></a>
</span><span id="TableGrid.visualize_points-920"><a href="#TableGrid.visualize_points-920"><span class="linenos">920</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Draw the detected table points on the image for visual verification</p>
</div>


                            </div>
                            <div id="TableGrid.text_regions" class="classattr">
                                        <input id="TableGrid.text_regions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">text_regions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">row</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="TableGrid.text_regions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableGrid.text_regions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableGrid.text_regions-922"><a href="#TableGrid.text_regions-922"><span class="linenos">922</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="TableGrid.text_regions-923"><a href="#TableGrid.text_regions-923"><span class="linenos">923</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
</span><span id="TableGrid.text_regions-924"><a href="#TableGrid.text_regions-924"><span class="linenos">924</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="TableGrid.text_regions-925"><a href="#TableGrid.text_regions-925"><span class="linenos">925</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">vertical_rule_crop</span><span class="p">(</span><span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableGrid.text_regions-926"><a href="#TableGrid.text_regions-926"><span class="linenos">926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="TableGrid.text_regions-927"><a href="#TableGrid.text_regions-927"><span class="linenos">927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="TableGrid.text_regions-928"><a href="#TableGrid.text_regions-928"><span class="linenos">928</span></a>
</span><span id="TableGrid.text_regions-929"><a href="#TableGrid.text_regions-929"><span class="linenos">929</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_offset</span><span class="p">:</span>
</span><span id="TableGrid.text_regions-930"><a href="#TableGrid.text_regions-930"><span class="linenos">930</span></a>                <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TableGrid.text_regions-931"><a href="#TableGrid.text_regions-931"><span class="linenos">931</span></a>
</span><span id="TableGrid.text_regions-932"><a href="#TableGrid.text_regions-932"><span class="linenos">932</span></a>            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="TableGrid.text_regions-933"><a href="#TableGrid.text_regions-933"><span class="linenos">933</span></a>            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="TableGrid.text_regions-934"><a href="#TableGrid.text_regions-934"><span class="linenos">934</span></a>
</span><span id="TableGrid.text_regions-935"><a href="#TableGrid.text_regions-935"><span class="linenos">935</span></a>            <span class="n">left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="TableGrid.text_regions-936"><a href="#TableGrid.text_regions-936"><span class="linenos">936</span></a>            <span class="n">right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="TableGrid.text_regions-937"><a href="#TableGrid.text_regions-937"><span class="linenos">937</span></a>
</span><span id="TableGrid.text_regions-938"><a href="#TableGrid.text_regions-938"><span class="linenos">938</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">[</span>
</span><span id="TableGrid.text_regions-939"><a href="#TableGrid.text_regions-939"><span class="linenos">939</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">margin_y</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">margin_y</span><span class="p">,</span>
</span><span id="TableGrid.text_regions-940"><a href="#TableGrid.text_regions-940"><span class="linenos">940</span></a>                <span class="n">left</span> <span class="o">-</span> <span class="n">margin_x</span> <span class="p">:</span> <span class="n">right</span> <span class="o">+</span> <span class="n">margin_x</span><span class="p">,</span>
</span><span id="TableGrid.text_regions-941"><a href="#TableGrid.text_regions-941"><span class="linenos">941</span></a>            <span class="p">]</span>
</span><span id="TableGrid.text_regions-942"><a href="#TableGrid.text_regions-942"><span class="linenos">942</span></a>
</span><span id="TableGrid.text_regions-943"><a href="#TableGrid.text_regions-943"><span class="linenos">943</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableGrid.text_regions-944"><a href="#TableGrid.text_regions-944"><span class="linenos">944</span></a>
</span><span id="TableGrid.text_regions-945"><a href="#TableGrid.text_regions-945"><span class="linenos">945</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TableGrid.text_regions-946"><a href="#TableGrid.text_regions-946"><span class="linenos">946</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="TableGrid.text_regions-947"><a href="#TableGrid.text_regions-947"><span class="linenos">947</span></a>            <span class="n">crop</span> <span class="o">=</span> <span class="n">vertical_rule_crop</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="TableGrid.text_regions-948"><a href="#TableGrid.text_regions-948"><span class="linenos">948</span></a>            <span class="n">text_over_score</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">text_presence_score</span><span class="p">(</span><span class="n">crop</span><span class="p">)</span>
</span><span id="TableGrid.text_regions-949"><a href="#TableGrid.text_regions-949"><span class="linenos">949</span></a>            <span class="n">text_over</span> <span class="o">=</span> <span class="n">text_over_score</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.10</span>
</span><span id="TableGrid.text_regions-950"><a href="#TableGrid.text_regions-950"><span class="linenos">950</span></a>
</span><span id="TableGrid.text_regions-951"><a href="#TableGrid.text_regions-951"><span class="linenos">951</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">text_over</span><span class="p">:</span>
</span><span id="TableGrid.text_regions-952"><a href="#TableGrid.text_regions-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid.text_regions-953"><a href="#TableGrid.text_regions-953"><span class="linenos">953</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="TableGrid.text_regions-954"><a href="#TableGrid.text_regions-954"><span class="linenos">954</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">col</span>
</span><span id="TableGrid.text_regions-955"><a href="#TableGrid.text_regions-955"><span class="linenos">955</span></a>
</span><span id="TableGrid.text_regions-956"><a href="#TableGrid.text_regions-956"><span class="linenos">956</span></a>        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableGrid.text_regions-957"><a href="#TableGrid.text_regions-957"><span class="linenos">957</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="TableGrid.text_regions-958"><a href="#TableGrid.text_regions-958"><span class="linenos">958</span></a>
</span><span id="TableGrid.text_regions-959"><a href="#TableGrid.text_regions-959"><span class="linenos">959</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Split the row into regions of continuous text</p>

<p>Returns
    list[tuple[int, int]]: a list of spans (start col, end col)</p>
</div>


                            </div>
                </section>
                <section id="HeaderAligner">
                            <input id="HeaderAligner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HeaderAligner</span>:

                <label class="view-source-button" for="HeaderAligner-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner-23"><a href="#HeaderAligner-23"><span class="linenos"> 23</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HeaderAligner</span><span class="p">:</span>
</span><span id="HeaderAligner-24"><a href="#HeaderAligner-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-25"><a href="#HeaderAligner-25"><span class="linenos"> 25</span></a><span class="sd">    Aligns table header templates to subject images using feature-based registration.</span>
</span><span id="HeaderAligner-26"><a href="#HeaderAligner-26"><span class="linenos"> 26</span></a>
</span><span id="HeaderAligner-27"><a href="#HeaderAligner-27"><span class="linenos"> 27</span></a><span class="sd">    This class uses ORB (Oriented FAST and Rotated BRIEF) feature detection and</span>
</span><span id="HeaderAligner-28"><a href="#HeaderAligner-28"><span class="linenos"> 28</span></a><span class="sd">    matching to compute a homography transformation that maps points from a header</span>
</span><span id="HeaderAligner-29"><a href="#HeaderAligner-29"><span class="linenos"> 29</span></a><span class="sd">    template image to their corresponding locations in full table images.</span>
</span><span id="HeaderAligner-30"><a href="#HeaderAligner-30"><span class="linenos"> 30</span></a>
</span><span id="HeaderAligner-31"><a href="#HeaderAligner-31"><span class="linenos"> 31</span></a><span class="sd">    ## How it Works</span>
</span><span id="HeaderAligner-32"><a href="#HeaderAligner-32"><span class="linenos"> 32</span></a>
</span><span id="HeaderAligner-33"><a href="#HeaderAligner-33"><span class="linenos"> 33</span></a><span class="sd">    1. **Feature Detection**: Extracts ORB keypoints from both template and subject</span>
</span><span id="HeaderAligner-34"><a href="#HeaderAligner-34"><span class="linenos"> 34</span></a><span class="sd">    2. **Feature Matching**: Finds correspondences using Hamming distance</span>
</span><span id="HeaderAligner-35"><a href="#HeaderAligner-35"><span class="linenos"> 35</span></a><span class="sd">    3. **Filtering**: Keeps top matches and prunes based on spatial consistency</span>
</span><span id="HeaderAligner-36"><a href="#HeaderAligner-36"><span class="linenos"> 36</span></a><span class="sd">    4. **Homography Estimation**: Computes perspective transform using RANSAC</span>
</span><span id="HeaderAligner-37"><a href="#HeaderAligner-37"><span class="linenos"> 37</span></a>
</span><span id="HeaderAligner-38"><a href="#HeaderAligner-38"><span class="linenos"> 38</span></a><span class="sd">    The computed homography can then transform any point from template space to</span>
</span><span id="HeaderAligner-39"><a href="#HeaderAligner-39"><span class="linenos"> 39</span></a><span class="sd">    image space, allowing you to locate table structures based on your annotation.</span>
</span><span id="HeaderAligner-40"><a href="#HeaderAligner-40"><span class="linenos"> 40</span></a>
</span><span id="HeaderAligner-41"><a href="#HeaderAligner-41"><span class="linenos"> 41</span></a><span class="sd">    ## Preprocessing Options</span>
</span><span id="HeaderAligner-42"><a href="#HeaderAligner-42"><span class="linenos"> 42</span></a>
</span><span id="HeaderAligner-43"><a href="#HeaderAligner-43"><span class="linenos"> 43</span></a><span class="sd">    - Set `k` parameter to apply Sauvola thresholding before feature detection.</span>
</span><span id="HeaderAligner-44"><a href="#HeaderAligner-44"><span class="linenos"> 44</span></a><span class="sd">      This can improve matching on documents with variable lighting.</span>
</span><span id="HeaderAligner-45"><a href="#HeaderAligner-45"><span class="linenos"> 45</span></a><span class="sd">    - Set `k=None` to use raw images (just extract blue channel for BGR images)</span>
</span><span id="HeaderAligner-46"><a href="#HeaderAligner-46"><span class="linenos"> 46</span></a>
</span><span id="HeaderAligner-47"><a href="#HeaderAligner-47"><span class="linenos"> 47</span></a><span class="sd">    ## Tuning Guidelines</span>
</span><span id="HeaderAligner-48"><a href="#HeaderAligner-48"><span class="linenos"> 48</span></a>
</span><span id="HeaderAligner-49"><a href="#HeaderAligner-49"><span class="linenos"> 49</span></a><span class="sd">    - **max_features**: Increase if matching fails on complex templates</span>
</span><span id="HeaderAligner-50"><a href="#HeaderAligner-50"><span class="linenos"> 50</span></a><span class="sd">    - **match_fraction**: Decrease if you get many incorrect matches</span>
</span><span id="HeaderAligner-51"><a href="#HeaderAligner-51"><span class="linenos"> 51</span></a><span class="sd">    - **max_dist**: Increase for documents with more warping/distortion</span>
</span><span id="HeaderAligner-52"><a href="#HeaderAligner-52"><span class="linenos"> 52</span></a><span class="sd">    - **scale**: Decrease (&lt;1.0) to speed up on high-resolution images</span>
</span><span id="HeaderAligner-53"><a href="#HeaderAligner-53"><span class="linenos"> 53</span></a>
</span><span id="HeaderAligner-54"><a href="#HeaderAligner-54"><span class="linenos"> 54</span></a><span class="sd">    Args:</span>
</span><span id="HeaderAligner-55"><a href="#HeaderAligner-55"><span class="linenos"> 55</span></a><span class="sd">        template (MatLike | PathLike[str] | str | None): Header template image or path.</span>
</span><span id="HeaderAligner-56"><a href="#HeaderAligner-56"><span class="linenos"> 56</span></a><span class="sd">            This should contain a clear, representative view of the table header.</span>
</span><span id="HeaderAligner-57"><a href="#HeaderAligner-57"><span class="linenos"> 57</span></a><span class="sd">        max_features (int): Maximum ORB features to detect. More features = slower</span>
</span><span id="HeaderAligner-58"><a href="#HeaderAligner-58"><span class="linenos"> 58</span></a><span class="sd">            but potentially more robust matching.</span>
</span><span id="HeaderAligner-59"><a href="#HeaderAligner-59"><span class="linenos"> 59</span></a><span class="sd">        patch_size (int): ORB patch size for feature extraction.</span>
</span><span id="HeaderAligner-60"><a href="#HeaderAligner-60"><span class="linenos"> 60</span></a><span class="sd">        match_fraction (float): Fraction [0, 1] of matches to keep after sorting by</span>
</span><span id="HeaderAligner-61"><a href="#HeaderAligner-61"><span class="linenos"> 61</span></a><span class="sd">            quality. Higher = more matches but potentially more outliers.</span>
</span><span id="HeaderAligner-62"><a href="#HeaderAligner-62"><span class="linenos"> 62</span></a><span class="sd">        scale (float): Image downscaling factor (0, 1] for processing speed.</span>
</span><span id="HeaderAligner-63"><a href="#HeaderAligner-63"><span class="linenos"> 63</span></a><span class="sd">        max_dist (float): Maximum allowed distance (relative to image size) between</span>
</span><span id="HeaderAligner-64"><a href="#HeaderAligner-64"><span class="linenos"> 64</span></a><span class="sd">            matched keypoints. Filters out spatially inconsistent matches.</span>
</span><span id="HeaderAligner-65"><a href="#HeaderAligner-65"><span class="linenos"> 65</span></a><span class="sd">        k (float | None): Sauvola threshold parameter for preprocessing. If None,</span>
</span><span id="HeaderAligner-66"><a href="#HeaderAligner-66"><span class="linenos"> 66</span></a><span class="sd">            no thresholding is applied. Typical range: 0.03-0.15.</span>
</span><span id="HeaderAligner-67"><a href="#HeaderAligner-67"><span class="linenos"> 67</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HeaderAligner-68"><a href="#HeaderAligner-68"><span class="linenos"> 68</span></a>
</span><span id="HeaderAligner-69"><a href="#HeaderAligner-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HeaderAligner-70"><a href="#HeaderAligner-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HeaderAligner-71"><a href="#HeaderAligner-71"><span class="linenos"> 71</span></a>        <span class="n">template</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HeaderAligner-72"><a href="#HeaderAligner-72"><span class="linenos"> 72</span></a>        <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25_000</span><span class="p">,</span>
</span><span id="HeaderAligner-73"><a href="#HeaderAligner-73"><span class="linenos"> 73</span></a>        <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
</span><span id="HeaderAligner-74"><a href="#HeaderAligner-74"><span class="linenos"> 74</span></a>        <span class="n">match_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="HeaderAligner-75"><a href="#HeaderAligner-75"><span class="linenos"> 75</span></a>        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="HeaderAligner-76"><a href="#HeaderAligner-76"><span class="linenos"> 76</span></a>        <span class="n">max_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span>
</span><span id="HeaderAligner-77"><a href="#HeaderAligner-77"><span class="linenos"> 77</span></a>        <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="HeaderAligner-78"><a href="#HeaderAligner-78"><span class="linenos"> 78</span></a>    <span class="p">):</span>
</span><span id="HeaderAligner-79"><a href="#HeaderAligner-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-80"><a href="#HeaderAligner-80"><span class="linenos"> 80</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner-81"><a href="#HeaderAligner-81"><span class="linenos"> 81</span></a><span class="sd">            template (MatLike | str): (path of) template image, with the table template clearly visible</span>
</span><span id="HeaderAligner-82"><a href="#HeaderAligner-82"><span class="linenos"> 82</span></a><span class="sd">            max_features (int): maximal number of features that will be extracted by ORB</span>
</span><span id="HeaderAligner-83"><a href="#HeaderAligner-83"><span class="linenos"> 83</span></a><span class="sd">            patch_size (int): for ORB feature extractor</span>
</span><span id="HeaderAligner-84"><a href="#HeaderAligner-84"><span class="linenos"> 84</span></a><span class="sd">            match_fraction (float): best fraction of matches that are kept</span>
</span><span id="HeaderAligner-85"><a href="#HeaderAligner-85"><span class="linenos"> 85</span></a><span class="sd">            scale (float): image scale factor to do calculations on (useful for increasing calculation speed mostly)</span>
</span><span id="HeaderAligner-86"><a href="#HeaderAligner-86"><span class="linenos"> 86</span></a><span class="sd">            max_dist (float): maximum distance (relative to image size) of matched features.</span>
</span><span id="HeaderAligner-87"><a href="#HeaderAligner-87"><span class="linenos"> 87</span></a><span class="sd">                Increase this value if the warping between image and template needs to be more agressive</span>
</span><span id="HeaderAligner-88"><a href="#HeaderAligner-88"><span class="linenos"> 88</span></a><span class="sd">            k (float | None): sauvola thresholding threshold value. If None, no sauvola thresholding is done</span>
</span><span id="HeaderAligner-89"><a href="#HeaderAligner-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner-90"><a href="#HeaderAligner-90"><span class="linenos"> 90</span></a>
</span><span id="HeaderAligner-91"><a href="#HeaderAligner-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="n">PathLike</span><span class="p">:</span>
</span><span id="HeaderAligner-92"><a href="#HeaderAligner-92"><span class="linenos"> 92</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fspath</span><span class="p">(</span><span class="n">template</span><span class="p">))</span>
</span><span id="HeaderAligner-93"><a href="#HeaderAligner-93"><span class="linenos"> 93</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HeaderAligner-94"><a href="#HeaderAligner-94"><span class="linenos"> 94</span></a>
</span><span id="HeaderAligner-95"><a href="#HeaderAligner-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="HeaderAligner-96"><a href="#HeaderAligner-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="HeaderAligner-97"><a href="#HeaderAligner-97"><span class="linenos"> 97</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="HeaderAligner-98"><a href="#HeaderAligner-98"><span class="linenos"> 98</span></a>                <span class="s2">&quot;Scaling up the image for header alignment is useless. Use 0 &lt; scale &lt;= 1.0&quot;</span>
</span><span id="HeaderAligner-99"><a href="#HeaderAligner-99"><span class="linenos"> 99</span></a>            <span class="p">)</span>
</span><span id="HeaderAligner-100"><a href="#HeaderAligner-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HeaderAligner-101"><a href="#HeaderAligner-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;Use 0 &lt; scale &lt;= 1.0&quot;</span><span class="p">)</span>
</span><span id="HeaderAligner-102"><a href="#HeaderAligner-102"><span class="linenos">102</span></a>
</span><span id="HeaderAligner-103"><a href="#HeaderAligner-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="HeaderAligner-104"><a href="#HeaderAligner-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_img</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">template</span><span class="p">))</span>
</span><span id="HeaderAligner-105"><a href="#HeaderAligner-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template_orig</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">MatLike</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderAligner-106"><a href="#HeaderAligner-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_template</span><span class="p">()</span>
</span><span id="HeaderAligner-107"><a href="#HeaderAligner-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_features</span> <span class="o">=</span> <span class="n">max_features</span>
</span><span id="HeaderAligner-108"><a href="#HeaderAligner-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_size</span> <span class="o">=</span> <span class="n">patch_size</span>
</span><span id="HeaderAligner-109"><a href="#HeaderAligner-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_match_fraction</span> <span class="o">=</span> <span class="n">match_fraction</span>
</span><span id="HeaderAligner-110"><a href="#HeaderAligner-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">max_dist</span>
</span><span id="HeaderAligner-111"><a href="#HeaderAligner-111"><span class="linenos">111</span></a>
</span><span id="HeaderAligner-112"><a href="#HeaderAligner-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_scale_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="HeaderAligner-113"><a href="#HeaderAligner-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="HeaderAligner-114"><a href="#HeaderAligner-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="n">img</span>
</span><span id="HeaderAligner-115"><a href="#HeaderAligner-115"><span class="linenos">115</span></a>
</span><span id="HeaderAligner-116"><a href="#HeaderAligner-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="HeaderAligner-117"><a href="#HeaderAligner-117"><span class="linenos">117</span></a>
</span><span id="HeaderAligner-118"><a href="#HeaderAligner-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_unscale_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="HeaderAligner-119"><a href="#HeaderAligner-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="HeaderAligner-120"><a href="#HeaderAligner-120"><span class="linenos">120</span></a>            <span class="k">return</span> <span class="n">img</span>
</span><span id="HeaderAligner-121"><a href="#HeaderAligner-121"><span class="linenos">121</span></a>
</span><span id="HeaderAligner-122"><a href="#HeaderAligner-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">)</span>
</span><span id="HeaderAligner-123"><a href="#HeaderAligner-123"><span class="linenos">123</span></a>
</span><span id="HeaderAligner-124"><a href="#HeaderAligner-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_unscale_homography</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HeaderAligner-125"><a href="#HeaderAligner-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="HeaderAligner-126"><a href="#HeaderAligner-126"><span class="linenos">126</span></a>            <span class="k">return</span> <span class="n">h</span>
</span><span id="HeaderAligner-127"><a href="#HeaderAligner-127"><span class="linenos">127</span></a>
</span><span id="HeaderAligner-128"><a href="#HeaderAligner-128"><span class="linenos">128</span></a>        <span class="n">scale_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="HeaderAligner-129"><a href="#HeaderAligner-129"><span class="linenos">129</span></a>        <span class="c1"># inv_scale_matrix = np.linalg.inv(scale_matrix)</span>
</span><span id="HeaderAligner-130"><a href="#HeaderAligner-130"><span class="linenos">130</span></a>        <span class="n">inv_scale_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="HeaderAligner-131"><a href="#HeaderAligner-131"><span class="linenos">131</span></a>        <span class="c1"># return inv_scale_matrix @ h @ scale_matrix</span>
</span><span id="HeaderAligner-132"><a href="#HeaderAligner-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="n">inv_scale_matrix</span> <span class="o">@</span> <span class="n">h</span> <span class="o">@</span> <span class="n">scale_matrix</span>
</span><span id="HeaderAligner-133"><a href="#HeaderAligner-133"><span class="linenos">133</span></a>
</span><span id="HeaderAligner-134"><a href="#HeaderAligner-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="HeaderAligner-135"><a href="#HeaderAligner-135"><span class="linenos">135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HeaderAligner-136"><a href="#HeaderAligner-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The template image that subject images are aligned to&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-137"><a href="#HeaderAligner-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span>
</span><span id="HeaderAligner-138"><a href="#HeaderAligner-138"><span class="linenos">138</span></a>
</span><span id="HeaderAligner-139"><a href="#HeaderAligner-139"><span class="linenos">139</span></a>    <span class="nd">@template</span><span class="o">.</span><span class="n">setter</span>
</span><span id="HeaderAligner-140"><a href="#HeaderAligner-140"><span class="linenos">140</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="HeaderAligner-141"><a href="#HeaderAligner-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the template image as a path or an image&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-142"><a href="#HeaderAligner-142"><span class="linenos">142</span></a>
</span><span id="HeaderAligner-143"><a href="#HeaderAligner-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HeaderAligner-144"><a href="#HeaderAligner-144"><span class="linenos">144</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="HeaderAligner-145"><a href="#HeaderAligner-145"><span class="linenos">145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HeaderAligner-146"><a href="#HeaderAligner-146"><span class="linenos">146</span></a>
</span><span id="HeaderAligner-147"><a href="#HeaderAligner-147"><span class="linenos">147</span></a>        <span class="c1"># TODO: check if the image has the right properties (dimensions etc.)</span>
</span><span id="HeaderAligner-148"><a href="#HeaderAligner-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="HeaderAligner-149"><a href="#HeaderAligner-149"><span class="linenos">149</span></a>
</span><span id="HeaderAligner-150"><a href="#HeaderAligner-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_template</span><span class="p">()</span>
</span><span id="HeaderAligner-151"><a href="#HeaderAligner-151"><span class="linenos">151</span></a>
</span><span id="HeaderAligner-152"><a href="#HeaderAligner-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HeaderAligner-153"><a href="#HeaderAligner-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template_orig</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="HeaderAligner-154"><a href="#HeaderAligner-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderAligner-155"><a href="#HeaderAligner-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">sauvola</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span><span class="p">)</span>
</span><span id="HeaderAligner-156"><a href="#HeaderAligner-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">)</span>
</span><span id="HeaderAligner-157"><a href="#HeaderAligner-157"><span class="linenos">157</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HeaderAligner-158"><a href="#HeaderAligner-158"><span class="linenos">158</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">)</span>
</span><span id="HeaderAligner-159"><a href="#HeaderAligner-159"><span class="linenos">159</span></a>
</span><span id="HeaderAligner-160"><a href="#HeaderAligner-160"><span class="linenos">160</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">):</span>
</span><span id="HeaderAligner-161"><a href="#HeaderAligner-161"><span class="linenos">161</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_orig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderAligner-162"><a href="#HeaderAligner-162"><span class="linenos">162</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;process the template first&quot;</span><span class="p">)</span>
</span><span id="HeaderAligner-163"><a href="#HeaderAligner-163"><span class="linenos">163</span></a>
</span><span id="HeaderAligner-164"><a href="#HeaderAligner-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderAligner-165"><a href="#HeaderAligner-165"><span class="linenos">165</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">sauvola</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span><span class="p">)</span>
</span><span id="HeaderAligner-166"><a href="#HeaderAligner-166"><span class="linenos">166</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-167"><a href="#HeaderAligner-167"><span class="linenos">167</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HeaderAligner-168"><a href="#HeaderAligner-168"><span class="linenos">168</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-169"><a href="#HeaderAligner-169"><span class="linenos">169</span></a>
</span><span id="HeaderAligner-170"><a href="#HeaderAligner-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">img</span>
</span><span id="HeaderAligner-171"><a href="#HeaderAligner-171"><span class="linenos">171</span></a>
</span><span id="HeaderAligner-172"><a href="#HeaderAligner-172"><span class="linenos">172</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HeaderAligner-173"><a href="#HeaderAligner-173"><span class="linenos">173</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_transform_of_template_on</span><span class="p">(</span>
</span><span id="HeaderAligner-174"><a href="#HeaderAligner-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span>
</span><span id="HeaderAligner-175"><a href="#HeaderAligner-175"><span class="linenos">175</span></a>    <span class="p">):</span>
</span><span id="HeaderAligner-176"><a href="#HeaderAligner-176"><span class="linenos">176</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_img</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</span><span id="HeaderAligner-177"><a href="#HeaderAligner-177"><span class="linenos">177</span></a>        <span class="c1"># Detect ORB features and compute descriptors.</span>
</span><span id="HeaderAligner-178"><a href="#HeaderAligner-178"><span class="linenos">178</span></a>        <span class="n">orb</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span>
</span><span id="HeaderAligner-179"><a href="#HeaderAligner-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_max_features</span><span class="p">,</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner-180"><a href="#HeaderAligner-180"><span class="linenos">180</span></a>            <span class="n">patchSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_patch_size</span><span class="p">,</span>
</span><span id="HeaderAligner-181"><a href="#HeaderAligner-181"><span class="linenos">181</span></a>        <span class="p">)</span>
</span><span id="HeaderAligner-182"><a href="#HeaderAligner-182"><span class="linenos">182</span></a>        <span class="n">keypoints_im</span><span class="p">,</span> <span class="n">descriptors_im</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="HeaderAligner-183"><a href="#HeaderAligner-183"><span class="linenos">183</span></a>        <span class="n">keypoints_tg</span><span class="p">,</span> <span class="n">descriptors_tg</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="HeaderAligner-184"><a href="#HeaderAligner-184"><span class="linenos">184</span></a>
</span><span id="HeaderAligner-185"><a href="#HeaderAligner-185"><span class="linenos">185</span></a>        <span class="c1"># Match features</span>
</span><span id="HeaderAligner-186"><a href="#HeaderAligner-186"><span class="linenos">186</span></a>        <span class="n">matcher</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HeaderAligner-187"><a href="#HeaderAligner-187"><span class="linenos">187</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">descriptors_im</span><span class="p">,</span> <span class="n">descriptors_tg</span><span class="p">)</span>
</span><span id="HeaderAligner-188"><a href="#HeaderAligner-188"><span class="linenos">188</span></a>
</span><span id="HeaderAligner-189"><a href="#HeaderAligner-189"><span class="linenos">189</span></a>        <span class="c1"># Sort matches by score</span>
</span><span id="HeaderAligner-190"><a href="#HeaderAligner-190"><span class="linenos">190</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
</span><span id="HeaderAligner-191"><a href="#HeaderAligner-191"><span class="linenos">191</span></a>
</span><span id="HeaderAligner-192"><a href="#HeaderAligner-192"><span class="linenos">192</span></a>        <span class="c1"># Remove not so good matches</span>
</span><span id="HeaderAligner-193"><a href="#HeaderAligner-193"><span class="linenos">193</span></a>        <span class="n">numGoodMatches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_fraction</span><span class="p">)</span>
</span><span id="HeaderAligner-194"><a href="#HeaderAligner-194"><span class="linenos">194</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[:</span><span class="n">numGoodMatches</span><span class="p">]</span>
</span><span id="HeaderAligner-195"><a href="#HeaderAligner-195"><span class="linenos">195</span></a>
</span><span id="HeaderAligner-196"><a href="#HeaderAligner-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="HeaderAligner-197"><a href="#HeaderAligner-197"><span class="linenos">197</span></a>            <span class="n">final_img_filtered</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
</span><span id="HeaderAligner-198"><a href="#HeaderAligner-198"><span class="linenos">198</span></a>                <span class="n">im</span><span class="p">,</span>
</span><span id="HeaderAligner-199"><a href="#HeaderAligner-199"><span class="linenos">199</span></a>                <span class="n">keypoints_im</span><span class="p">,</span>
</span><span id="HeaderAligner-200"><a href="#HeaderAligner-200"><span class="linenos">200</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span>
</span><span id="HeaderAligner-201"><a href="#HeaderAligner-201"><span class="linenos">201</span></a>                <span class="n">keypoints_tg</span><span class="p">,</span>
</span><span id="HeaderAligner-202"><a href="#HeaderAligner-202"><span class="linenos">202</span></a>                <span class="n">matches</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span>
</span><span id="HeaderAligner-203"><a href="#HeaderAligner-203"><span class="linenos">203</span></a>                <span class="kc">None</span><span class="p">,</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner-204"><a href="#HeaderAligner-204"><span class="linenos">204</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span><span class="p">,</span>
</span><span id="HeaderAligner-205"><a href="#HeaderAligner-205"><span class="linenos">205</span></a>            <span class="p">)</span>
</span><span id="HeaderAligner-206"><a href="#HeaderAligner-206"><span class="linenos">206</span></a>            <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">final_img_filtered</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;matches&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
</span><span id="HeaderAligner-207"><a href="#HeaderAligner-207"><span class="linenos">207</span></a>
</span><span id="HeaderAligner-208"><a href="#HeaderAligner-208"><span class="linenos">208</span></a>        <span class="c1"># Extract location of good matches</span>
</span><span id="HeaderAligner-209"><a href="#HeaderAligner-209"><span class="linenos">209</span></a>        <span class="n">points1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="HeaderAligner-210"><a href="#HeaderAligner-210"><span class="linenos">210</span></a>        <span class="n">points2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="HeaderAligner-211"><a href="#HeaderAligner-211"><span class="linenos">211</span></a>
</span><span id="HeaderAligner-212"><a href="#HeaderAligner-212"><span class="linenos">212</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
</span><span id="HeaderAligner-213"><a href="#HeaderAligner-213"><span class="linenos">213</span></a>            <span class="n">points1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">keypoints_tg</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span>
</span><span id="HeaderAligner-214"><a href="#HeaderAligner-214"><span class="linenos">214</span></a>            <span class="n">points2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">keypoints_im</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span>
</span><span id="HeaderAligner-215"><a href="#HeaderAligner-215"><span class="linenos">215</span></a>
</span><span id="HeaderAligner-216"><a href="#HeaderAligner-216"><span class="linenos">216</span></a>        <span class="c1"># Prune reference points based upon distance between</span>
</span><span id="HeaderAligner-217"><a href="#HeaderAligner-217"><span class="linenos">217</span></a>        <span class="c1"># key points. This assumes a fairly good alignment to start with</span>
</span><span id="HeaderAligner-218"><a href="#HeaderAligner-218"><span class="linenos">218</span></a>        <span class="c1"># due to the protocol used (location of the sheets)</span>
</span><span id="HeaderAligner-219"><a href="#HeaderAligner-219"><span class="linenos">219</span></a>        <span class="n">p1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">points1</span><span class="p">)</span>
</span><span id="HeaderAligner-220"><a href="#HeaderAligner-220"><span class="linenos">220</span></a>        <span class="n">p2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">points2</span><span class="p">)</span>
</span><span id="HeaderAligner-221"><a href="#HeaderAligner-221"><span class="linenos">221</span></a>        <span class="n">refdist</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span>
</span><span id="HeaderAligner-222"><a href="#HeaderAligner-222"><span class="linenos">222</span></a>
</span><span id="HeaderAligner-223"><a href="#HeaderAligner-223"><span class="linenos">223</span></a>        <span class="n">mask_x</span> <span class="o">=</span> <span class="n">refdist</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">)</span>
</span><span id="HeaderAligner-224"><a href="#HeaderAligner-224"><span class="linenos">224</span></a>        <span class="n">mask_y</span> <span class="o">=</span> <span class="n">refdist</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">)</span>
</span><span id="HeaderAligner-225"><a href="#HeaderAligner-225"><span class="linenos">225</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_x</span> <span class="o">&amp;</span> <span class="n">mask_y</span>
</span><span id="HeaderAligner-226"><a href="#HeaderAligner-226"><span class="linenos">226</span></a>        <span class="n">points1</span> <span class="o">=</span> <span class="n">points1</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
</span><span id="HeaderAligner-227"><a href="#HeaderAligner-227"><span class="linenos">227</span></a>        <span class="n">points2</span> <span class="o">=</span> <span class="n">points2</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
</span><span id="HeaderAligner-228"><a href="#HeaderAligner-228"><span class="linenos">228</span></a>
</span><span id="HeaderAligner-229"><a href="#HeaderAligner-229"><span class="linenos">229</span></a>        <span class="c1"># Find homography</span>
</span><span id="HeaderAligner-230"><a href="#HeaderAligner-230"><span class="linenos">230</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">)</span>
</span><span id="HeaderAligner-231"><a href="#HeaderAligner-231"><span class="linenos">231</span></a>
</span><span id="HeaderAligner-232"><a href="#HeaderAligner-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unscale_homography</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span id="HeaderAligner-233"><a href="#HeaderAligner-233"><span class="linenos">233</span></a>
</span><span id="HeaderAligner-234"><a href="#HeaderAligner-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">view_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
</span><span id="HeaderAligner-235"><a href="#HeaderAligner-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-236"><a href="#HeaderAligner-236"><span class="linenos">236</span></a><span class="sd">        Show the alignment of the template on the given image</span>
</span><span id="HeaderAligner-237"><a href="#HeaderAligner-237"><span class="linenos">237</span></a><span class="sd">        by transforming it using the supplied transformation matrix `h`</span>
</span><span id="HeaderAligner-238"><a href="#HeaderAligner-238"><span class="linenos">238</span></a><span class="sd">        and visualising both on different channels</span>
</span><span id="HeaderAligner-239"><a href="#HeaderAligner-239"><span class="linenos">239</span></a>
</span><span id="HeaderAligner-240"><a href="#HeaderAligner-240"><span class="linenos">240</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner-241"><a href="#HeaderAligner-241"><span class="linenos">241</span></a><span class="sd">            img (MatLike): the image on which the template is transformed</span>
</span><span id="HeaderAligner-242"><a href="#HeaderAligner-242"><span class="linenos">242</span></a><span class="sd">            h (NDArray): the transformation matrix</span>
</span><span id="HeaderAligner-243"><a href="#HeaderAligner-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner-244"><a href="#HeaderAligner-244"><span class="linenos">244</span></a>
</span><span id="HeaderAligner-245"><a href="#HeaderAligner-245"><span class="linenos">245</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">ensure_gray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-246"><a href="#HeaderAligner-246"><span class="linenos">246</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">ensure_gray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unscale_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">))</span>
</span><span id="HeaderAligner-247"><a href="#HeaderAligner-247"><span class="linenos">247</span></a>        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span>
</span><span id="HeaderAligner-248"><a href="#HeaderAligner-248"><span class="linenos">248</span></a>
</span><span id="HeaderAligner-249"><a href="#HeaderAligner-249"><span class="linenos">249</span></a>        <span class="n">header_warped</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
</span><span id="HeaderAligner-250"><a href="#HeaderAligner-250"><span class="linenos">250</span></a>
</span><span id="HeaderAligner-251"><a href="#HeaderAligner-251"><span class="linenos">251</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="HeaderAligner-252"><a href="#HeaderAligner-252"><span class="linenos">252</span></a>
</span><span id="HeaderAligner-253"><a href="#HeaderAligner-253"><span class="linenos">253</span></a>        <span class="n">merged</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">im</span>
</span><span id="HeaderAligner-254"><a href="#HeaderAligner-254"><span class="linenos">254</span></a>        <span class="n">merged</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_warped</span>
</span><span id="HeaderAligner-255"><a href="#HeaderAligner-255"><span class="linenos">255</span></a>
</span><span id="HeaderAligner-256"><a href="#HeaderAligner-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</span><span id="HeaderAligner-257"><a href="#HeaderAligner-257"><span class="linenos">257</span></a>
</span><span id="HeaderAligner-258"><a href="#HeaderAligner-258"><span class="linenos">258</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HeaderAligner-259"><a href="#HeaderAligner-259"><span class="linenos">259</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align</span><span class="p">(</span>
</span><span id="HeaderAligner-260"><a href="#HeaderAligner-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span>
</span><span id="HeaderAligner-261"><a href="#HeaderAligner-261"><span class="linenos">261</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="HeaderAligner-262"><a href="#HeaderAligner-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-263"><a href="#HeaderAligner-263"><span class="linenos">263</span></a><span class="sd">        Calculates a homogeneous transformation matrix that maps pixels of</span>
</span><span id="HeaderAligner-264"><a href="#HeaderAligner-264"><span class="linenos">264</span></a><span class="sd">        the template to the given image</span>
</span><span id="HeaderAligner-265"><a href="#HeaderAligner-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner-266"><a href="#HeaderAligner-266"><span class="linenos">266</span></a>
</span><span id="HeaderAligner-267"><a href="#HeaderAligner-267"><span class="linenos">267</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aligning header with supplied table image&quot;</span><span class="p">)</span>
</span><span id="HeaderAligner-268"><a href="#HeaderAligner-268"><span class="linenos">268</span></a>
</span><span id="HeaderAligner-269"><a href="#HeaderAligner-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HeaderAligner-270"><a href="#HeaderAligner-270"><span class="linenos">270</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-271"><a href="#HeaderAligner-271"><span class="linenos">271</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-272"><a href="#HeaderAligner-272"><span class="linenos">272</span></a>
</span><span id="HeaderAligner-273"><a href="#HeaderAligner-273"><span class="linenos">273</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner-274"><a href="#HeaderAligner-274"><span class="linenos">274</span></a>
</span><span id="HeaderAligner-275"><a href="#HeaderAligner-275"><span class="linenos">275</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_transform_of_template_on</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
</span><span id="HeaderAligner-276"><a href="#HeaderAligner-276"><span class="linenos">276</span></a>
</span><span id="HeaderAligner-277"><a href="#HeaderAligner-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="HeaderAligner-278"><a href="#HeaderAligner-278"><span class="linenos">278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">view_alignment</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="HeaderAligner-279"><a href="#HeaderAligner-279"><span class="linenos">279</span></a>
</span><span id="HeaderAligner-280"><a href="#HeaderAligner-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">h</span>
</span><span id="HeaderAligner-281"><a href="#HeaderAligner-281"><span class="linenos">281</span></a>
</span><span id="HeaderAligner-282"><a href="#HeaderAligner-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">template_to_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderAligner-283"><a href="#HeaderAligner-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner-284"><a href="#HeaderAligner-284"><span class="linenos">284</span></a><span class="sd">        Transform the given point (in template-space) using the transformation h</span>
</span><span id="HeaderAligner-285"><a href="#HeaderAligner-285"><span class="linenos">285</span></a><span class="sd">        (obtained through the `align` method)</span>
</span><span id="HeaderAligner-286"><a href="#HeaderAligner-286"><span class="linenos">286</span></a>
</span><span id="HeaderAligner-287"><a href="#HeaderAligner-287"><span class="linenos">287</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner-288"><a href="#HeaderAligner-288"><span class="linenos">288</span></a><span class="sd">            h (NDArray): transformation matrix of shape (3, 3)</span>
</span><span id="HeaderAligner-289"><a href="#HeaderAligner-289"><span class="linenos">289</span></a><span class="sd">            point (Iterable[int]): the to-be-transformed point, should conform to (x, y)</span>
</span><span id="HeaderAligner-290"><a href="#HeaderAligner-290"><span class="linenos">290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner-291"><a href="#HeaderAligner-291"><span class="linenos">291</span></a>
</span><span id="HeaderAligner-292"><a href="#HeaderAligner-292"><span class="linenos">292</span></a>        <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">]])</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner-293"><a href="#HeaderAligner-293"><span class="linenos">293</span></a>        <span class="n">transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner-294"><a href="#HeaderAligner-294"><span class="linenos">294</span></a>
</span><span id="HeaderAligner-295"><a href="#HeaderAligner-295"><span class="linenos">295</span></a>        <span class="n">transformed</span> <span class="o">/=</span> <span class="n">transformed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="HeaderAligner-296"><a href="#HeaderAligner-296"><span class="linenos">296</span></a>
</span><span id="HeaderAligner-297"><a href="#HeaderAligner-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">transformed</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">transformed</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Aligns table header templates to subject images using feature-based registration.</p>

<p>This class uses ORB (Oriented FAST and Rotated BRIEF) feature detection and
matching to compute a homography transformation that maps points from a header
template image to their corresponding locations in full table images.</p>

<h2 id="how-it-works">How it Works</h2>

<ol>
<li><strong>Feature Detection</strong>: Extracts ORB keypoints from both template and subject</li>
<li><strong>Feature Matching</strong>: Finds correspondences using Hamming distance</li>
<li><strong>Filtering</strong>: Keeps top matches and prunes based on spatial consistency</li>
<li><strong>Homography Estimation</strong>: Computes perspective transform using RANSAC</li>
</ol>

<p>The computed homography can then transform any point from template space to
image space, allowing you to locate table structures based on your annotation.</p>

<h2 id="preprocessing-options">Preprocessing Options</h2>

<ul>
<li>Set <code>k</code> parameter to apply Sauvola thresholding before feature detection.
This can improve matching on documents with variable lighting.</li>
<li>Set <code>k=None</code> to use raw images (just extract blue channel for BGR images)</li>
</ul>

<h2 id="tuning-guidelines">Tuning Guidelines</h2>

<ul>
<li><strong>max_features</strong>: Increase if matching fails on complex templates</li>
<li><strong>match_fraction</strong>: Decrease if you get many incorrect matches</li>
<li><strong>max_dist</strong>: Increase for documents with more warping/distortion</li>
<li><strong>scale</strong>: Decrease (&lt;1.0) to speed up on high-resolution images</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>template (MatLike | PathLike[str] | str | None):</strong>  Header template image or path.
This should contain a clear, representative view of the table header.</li>
<li><strong>max_features (int):</strong>  Maximum ORB features to detect. More features = slower
but potentially more robust matching.</li>
<li><strong>patch_size (int):</strong>  ORB patch size for feature extraction.</li>
<li><strong>match_fraction (float):</strong>  Fraction [0, 1] of matches to keep after sorting by
quality. Higher = more matches but potentially more outliers.</li>
<li><strong>scale (float):</strong>  Image downscaling factor (0, 1] for processing speed.</li>
<li><strong>max_dist (float):</strong>  Maximum allowed distance (relative to image size) between
matched keypoints. Filters out spatially inconsistent matches.</li>
<li><strong>k (float | None):</strong>  Sauvola threshold parameter for preprocessing. If None,
no thresholding is applied. Typical range: 0.03-0.15.</li>
</ul>
</div>


                            <div id="HeaderAligner.__init__" class="classattr">
                                        <input id="HeaderAligner.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HeaderAligner</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">template</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25000</span>,</span><span class="param">	<span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">31</span>,</span><span class="param">	<span class="n">match_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">max_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.05</span></span>)</span>

                <label class="view-source-button" for="HeaderAligner.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner.__init__-69"><a href="#HeaderAligner.__init__-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HeaderAligner.__init__-70"><a href="#HeaderAligner.__init__-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-71"><a href="#HeaderAligner.__init__-71"><span class="linenos"> 71</span></a>        <span class="n">template</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-72"><a href="#HeaderAligner.__init__-72"><span class="linenos"> 72</span></a>        <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25_000</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-73"><a href="#HeaderAligner.__init__-73"><span class="linenos"> 73</span></a>        <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-74"><a href="#HeaderAligner.__init__-74"><span class="linenos"> 74</span></a>        <span class="n">match_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-75"><a href="#HeaderAligner.__init__-75"><span class="linenos"> 75</span></a>        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-76"><a href="#HeaderAligner.__init__-76"><span class="linenos"> 76</span></a>        <span class="n">max_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-77"><a href="#HeaderAligner.__init__-77"><span class="linenos"> 77</span></a>        <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="HeaderAligner.__init__-78"><a href="#HeaderAligner.__init__-78"><span class="linenos"> 78</span></a>    <span class="p">):</span>
</span><span id="HeaderAligner.__init__-79"><a href="#HeaderAligner.__init__-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner.__init__-80"><a href="#HeaderAligner.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner.__init__-81"><a href="#HeaderAligner.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            template (MatLike | str): (path of) template image, with the table template clearly visible</span>
</span><span id="HeaderAligner.__init__-82"><a href="#HeaderAligner.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            max_features (int): maximal number of features that will be extracted by ORB</span>
</span><span id="HeaderAligner.__init__-83"><a href="#HeaderAligner.__init__-83"><span class="linenos"> 83</span></a><span class="sd">            patch_size (int): for ORB feature extractor</span>
</span><span id="HeaderAligner.__init__-84"><a href="#HeaderAligner.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            match_fraction (float): best fraction of matches that are kept</span>
</span><span id="HeaderAligner.__init__-85"><a href="#HeaderAligner.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            scale (float): image scale factor to do calculations on (useful for increasing calculation speed mostly)</span>
</span><span id="HeaderAligner.__init__-86"><a href="#HeaderAligner.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            max_dist (float): maximum distance (relative to image size) of matched features.</span>
</span><span id="HeaderAligner.__init__-87"><a href="#HeaderAligner.__init__-87"><span class="linenos"> 87</span></a><span class="sd">                Increase this value if the warping between image and template needs to be more agressive</span>
</span><span id="HeaderAligner.__init__-88"><a href="#HeaderAligner.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            k (float | None): sauvola thresholding threshold value. If None, no sauvola thresholding is done</span>
</span><span id="HeaderAligner.__init__-89"><a href="#HeaderAligner.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner.__init__-90"><a href="#HeaderAligner.__init__-90"><span class="linenos"> 90</span></a>
</span><span id="HeaderAligner.__init__-91"><a href="#HeaderAligner.__init__-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="n">PathLike</span><span class="p">:</span>
</span><span id="HeaderAligner.__init__-92"><a href="#HeaderAligner.__init__-92"><span class="linenos"> 92</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fspath</span><span class="p">(</span><span class="n">template</span><span class="p">))</span>
</span><span id="HeaderAligner.__init__-93"><a href="#HeaderAligner.__init__-93"><span class="linenos"> 93</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HeaderAligner.__init__-94"><a href="#HeaderAligner.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="HeaderAligner.__init__-95"><a href="#HeaderAligner.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="HeaderAligner.__init__-96"><a href="#HeaderAligner.__init__-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="HeaderAligner.__init__-97"><a href="#HeaderAligner.__init__-97"><span class="linenos"> 97</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="HeaderAligner.__init__-98"><a href="#HeaderAligner.__init__-98"><span class="linenos"> 98</span></a>                <span class="s2">&quot;Scaling up the image for header alignment is useless. Use 0 &lt; scale &lt;= 1.0&quot;</span>
</span><span id="HeaderAligner.__init__-99"><a href="#HeaderAligner.__init__-99"><span class="linenos"> 99</span></a>            <span class="p">)</span>
</span><span id="HeaderAligner.__init__-100"><a href="#HeaderAligner.__init__-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HeaderAligner.__init__-101"><a href="#HeaderAligner.__init__-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;Use 0 &lt; scale &lt;= 1.0&quot;</span><span class="p">)</span>
</span><span id="HeaderAligner.__init__-102"><a href="#HeaderAligner.__init__-102"><span class="linenos">102</span></a>
</span><span id="HeaderAligner.__init__-103"><a href="#HeaderAligner.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="HeaderAligner.__init__-104"><a href="#HeaderAligner.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_img</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">template</span><span class="p">))</span>
</span><span id="HeaderAligner.__init__-105"><a href="#HeaderAligner.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_template_orig</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">MatLike</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderAligner.__init__-106"><a href="#HeaderAligner.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_template</span><span class="p">()</span>
</span><span id="HeaderAligner.__init__-107"><a href="#HeaderAligner.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_features</span> <span class="o">=</span> <span class="n">max_features</span>
</span><span id="HeaderAligner.__init__-108"><a href="#HeaderAligner.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_size</span> <span class="o">=</span> <span class="n">patch_size</span>
</span><span id="HeaderAligner.__init__-109"><a href="#HeaderAligner.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_match_fraction</span> <span class="o">=</span> <span class="n">match_fraction</span>
</span><span id="HeaderAligner.__init__-110"><a href="#HeaderAligner.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">max_dist</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>template (MatLike | str):</strong>  (path of) template image, with the table template clearly visible</li>
<li><strong>max_features (int):</strong>  maximal number of features that will be extracted by ORB</li>
<li><strong>patch_size (int):</strong>  for ORB feature extractor</li>
<li><strong>match_fraction (float):</strong>  best fraction of matches that are kept</li>
<li><strong>scale (float):</strong>  image scale factor to do calculations on (useful for increasing calculation speed mostly)</li>
<li><strong>max_dist (float):</strong>  maximum distance (relative to image size) of matched features.
Increase this value if the warping between image and template needs to be more agressive</li>
<li><strong>k (float | None):</strong>  sauvola thresholding threshold value. If None, no sauvola thresholding is done</li>
</ul>
</div>


                            </div>
                            <div id="HeaderAligner.template" class="classattr">
                                        <input id="HeaderAligner.template-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">template</span>

                <label class="view-source-button" for="HeaderAligner.template-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner.template"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner.template-134"><a href="#HeaderAligner.template-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="HeaderAligner.template-135"><a href="#HeaderAligner.template-135"><span class="linenos">135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HeaderAligner.template-136"><a href="#HeaderAligner.template-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The template image that subject images are aligned to&quot;&quot;&quot;</span>
</span><span id="HeaderAligner.template-137"><a href="#HeaderAligner.template-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span>
</span></pre></div>


            <div class="docstring"><p>The template image that subject images are aligned to</p>
</div>


                            </div>
                            <div id="HeaderAligner.view_alignment" class="classattr">
                                        <input id="HeaderAligner.view_alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">view_alignment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">h</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="o">~</span><span class="n">_ScalarT</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HeaderAligner.view_alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner.view_alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner.view_alignment-234"><a href="#HeaderAligner.view_alignment-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">view_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
</span><span id="HeaderAligner.view_alignment-235"><a href="#HeaderAligner.view_alignment-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner.view_alignment-236"><a href="#HeaderAligner.view_alignment-236"><span class="linenos">236</span></a><span class="sd">        Show the alignment of the template on the given image</span>
</span><span id="HeaderAligner.view_alignment-237"><a href="#HeaderAligner.view_alignment-237"><span class="linenos">237</span></a><span class="sd">        by transforming it using the supplied transformation matrix `h`</span>
</span><span id="HeaderAligner.view_alignment-238"><a href="#HeaderAligner.view_alignment-238"><span class="linenos">238</span></a><span class="sd">        and visualising both on different channels</span>
</span><span id="HeaderAligner.view_alignment-239"><a href="#HeaderAligner.view_alignment-239"><span class="linenos">239</span></a>
</span><span id="HeaderAligner.view_alignment-240"><a href="#HeaderAligner.view_alignment-240"><span class="linenos">240</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner.view_alignment-241"><a href="#HeaderAligner.view_alignment-241"><span class="linenos">241</span></a><span class="sd">            img (MatLike): the image on which the template is transformed</span>
</span><span id="HeaderAligner.view_alignment-242"><a href="#HeaderAligner.view_alignment-242"><span class="linenos">242</span></a><span class="sd">            h (NDArray): the transformation matrix</span>
</span><span id="HeaderAligner.view_alignment-243"><a href="#HeaderAligner.view_alignment-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner.view_alignment-244"><a href="#HeaderAligner.view_alignment-244"><span class="linenos">244</span></a>
</span><span id="HeaderAligner.view_alignment-245"><a href="#HeaderAligner.view_alignment-245"><span class="linenos">245</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">ensure_gray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner.view_alignment-246"><a href="#HeaderAligner.view_alignment-246"><span class="linenos">246</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">ensure_gray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unscale_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">))</span>
</span><span id="HeaderAligner.view_alignment-247"><a href="#HeaderAligner.view_alignment-247"><span class="linenos">247</span></a>        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span>
</span><span id="HeaderAligner.view_alignment-248"><a href="#HeaderAligner.view_alignment-248"><span class="linenos">248</span></a>
</span><span id="HeaderAligner.view_alignment-249"><a href="#HeaderAligner.view_alignment-249"><span class="linenos">249</span></a>        <span class="n">header_warped</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
</span><span id="HeaderAligner.view_alignment-250"><a href="#HeaderAligner.view_alignment-250"><span class="linenos">250</span></a>
</span><span id="HeaderAligner.view_alignment-251"><a href="#HeaderAligner.view_alignment-251"><span class="linenos">251</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="HeaderAligner.view_alignment-252"><a href="#HeaderAligner.view_alignment-252"><span class="linenos">252</span></a>
</span><span id="HeaderAligner.view_alignment-253"><a href="#HeaderAligner.view_alignment-253"><span class="linenos">253</span></a>        <span class="n">merged</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">im</span>
</span><span id="HeaderAligner.view_alignment-254"><a href="#HeaderAligner.view_alignment-254"><span class="linenos">254</span></a>        <span class="n">merged</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_warped</span>
</span><span id="HeaderAligner.view_alignment-255"><a href="#HeaderAligner.view_alignment-255"><span class="linenos">255</span></a>
</span><span id="HeaderAligner.view_alignment-256"><a href="#HeaderAligner.view_alignment-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Show the alignment of the template on the given image
by transforming it using the supplied transformation matrix <code>h</code>
and visualising both on different channels</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>img (MatLike):</strong>  the image on which the template is transformed</li>
<li><strong>h (NDArray):</strong>  the transformation matrix</li>
</ul>
</div>


                            </div>
                            <div id="HeaderAligner.align" class="classattr">
                                        <input id="HeaderAligner.align-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-log_calls">@log_calls(level=logging.DEBUG, include_return=True)</div>

        <span class="def">def</span>
        <span class="name">align</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;taulu&#39;</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="o">~</span><span class="n">_ScalarT</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="HeaderAligner.align-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner.align"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner.align-258"><a href="#HeaderAligner.align-258"><span class="linenos">258</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HeaderAligner.align-259"><a href="#HeaderAligner.align-259"><span class="linenos">259</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align</span><span class="p">(</span>
</span><span id="HeaderAligner.align-260"><a href="#HeaderAligner.align-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span>
</span><span id="HeaderAligner.align-261"><a href="#HeaderAligner.align-261"><span class="linenos">261</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
</span><span id="HeaderAligner.align-262"><a href="#HeaderAligner.align-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner.align-263"><a href="#HeaderAligner.align-263"><span class="linenos">263</span></a><span class="sd">        Calculates a homogeneous transformation matrix that maps pixels of</span>
</span><span id="HeaderAligner.align-264"><a href="#HeaderAligner.align-264"><span class="linenos">264</span></a><span class="sd">        the template to the given image</span>
</span><span id="HeaderAligner.align-265"><a href="#HeaderAligner.align-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner.align-266"><a href="#HeaderAligner.align-266"><span class="linenos">266</span></a>
</span><span id="HeaderAligner.align-267"><a href="#HeaderAligner.align-267"><span class="linenos">267</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aligning header with supplied table image&quot;</span><span class="p">)</span>
</span><span id="HeaderAligner.align-268"><a href="#HeaderAligner.align-268"><span class="linenos">268</span></a>
</span><span id="HeaderAligner.align-269"><a href="#HeaderAligner.align-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HeaderAligner.align-270"><a href="#HeaderAligner.align-270"><span class="linenos">270</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner.align-271"><a href="#HeaderAligner.align-271"><span class="linenos">271</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner.align-272"><a href="#HeaderAligner.align-272"><span class="linenos">272</span></a>
</span><span id="HeaderAligner.align-273"><a href="#HeaderAligner.align-273"><span class="linenos">273</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="HeaderAligner.align-274"><a href="#HeaderAligner.align-274"><span class="linenos">274</span></a>
</span><span id="HeaderAligner.align-275"><a href="#HeaderAligner.align-275"><span class="linenos">275</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_transform_of_template_on</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
</span><span id="HeaderAligner.align-276"><a href="#HeaderAligner.align-276"><span class="linenos">276</span></a>
</span><span id="HeaderAligner.align-277"><a href="#HeaderAligner.align-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">visual</span><span class="p">:</span>
</span><span id="HeaderAligner.align-278"><a href="#HeaderAligner.align-278"><span class="linenos">278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">view_alignment</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="HeaderAligner.align-279"><a href="#HeaderAligner.align-279"><span class="linenos">279</span></a>
</span><span id="HeaderAligner.align-280"><a href="#HeaderAligner.align-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">h</span>
</span></pre></div>


            <div class="docstring"><p>Calculates a homogeneous transformation matrix that maps pixels of
the template to the given image</p>
</div>


                            </div>
                            <div id="HeaderAligner.template_to_img" class="classattr">
                                        <input id="HeaderAligner.template_to_img-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">template_to_img</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">h</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="o">~</span><span class="n">_ScalarT</span><span class="p">]]</span>,</span><span class="param">	<span class="n">point</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HeaderAligner.template_to_img-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderAligner.template_to_img"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderAligner.template_to_img-282"><a href="#HeaderAligner.template_to_img-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">template_to_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderAligner.template_to_img-283"><a href="#HeaderAligner.template_to_img-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderAligner.template_to_img-284"><a href="#HeaderAligner.template_to_img-284"><span class="linenos">284</span></a><span class="sd">        Transform the given point (in template-space) using the transformation h</span>
</span><span id="HeaderAligner.template_to_img-285"><a href="#HeaderAligner.template_to_img-285"><span class="linenos">285</span></a><span class="sd">        (obtained through the `align` method)</span>
</span><span id="HeaderAligner.template_to_img-286"><a href="#HeaderAligner.template_to_img-286"><span class="linenos">286</span></a>
</span><span id="HeaderAligner.template_to_img-287"><a href="#HeaderAligner.template_to_img-287"><span class="linenos">287</span></a><span class="sd">        Args:</span>
</span><span id="HeaderAligner.template_to_img-288"><a href="#HeaderAligner.template_to_img-288"><span class="linenos">288</span></a><span class="sd">            h (NDArray): transformation matrix of shape (3, 3)</span>
</span><span id="HeaderAligner.template_to_img-289"><a href="#HeaderAligner.template_to_img-289"><span class="linenos">289</span></a><span class="sd">            point (Iterable[int]): the to-be-transformed point, should conform to (x, y)</span>
</span><span id="HeaderAligner.template_to_img-290"><a href="#HeaderAligner.template_to_img-290"><span class="linenos">290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderAligner.template_to_img-291"><a href="#HeaderAligner.template_to_img-291"><span class="linenos">291</span></a>
</span><span id="HeaderAligner.template_to_img-292"><a href="#HeaderAligner.template_to_img-292"><span class="linenos">292</span></a>        <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">]])</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner.template_to_img-293"><a href="#HeaderAligner.template_to_img-293"><span class="linenos">293</span></a>        <span class="n">transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderAligner.template_to_img-294"><a href="#HeaderAligner.template_to_img-294"><span class="linenos">294</span></a>
</span><span id="HeaderAligner.template_to_img-295"><a href="#HeaderAligner.template_to_img-295"><span class="linenos">295</span></a>        <span class="n">transformed</span> <span class="o">/=</span> <span class="n">transformed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="HeaderAligner.template_to_img-296"><a href="#HeaderAligner.template_to_img-296"><span class="linenos">296</span></a>
</span><span id="HeaderAligner.template_to_img-297"><a href="#HeaderAligner.template_to_img-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">transformed</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">transformed</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Transform the given point (in template-space) using the transformation h
(obtained through the <code><a href="#HeaderAligner.align">align</a></code> method)</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>h (NDArray):</strong>  transformation matrix of shape (3, 3)</li>
<li><strong>point (Iterable[int]):</strong>  the to-be-transformed point, should conform to (x, y)</li>
</ul>
</div>


                            </div>
                </section>
                <section id="HeaderTemplate">
                            <input id="HeaderTemplate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HeaderTemplate</span><wbr>(<span class="base"><a href="#TableIndexer">taulu.TableIndexer</a></span>):

                <label class="view-source-button" for="HeaderTemplate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate-151"><a href="#HeaderTemplate-151"><span class="linenos">151</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HeaderTemplate</span><span class="p">(</span><span class="n">TableIndexer</span><span class="p">):</span>
</span><span id="HeaderTemplate-152"><a href="#HeaderTemplate-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
</span><span id="HeaderTemplate-153"><a href="#HeaderTemplate-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-154"><a href="#HeaderTemplate-154"><span class="linenos">154</span></a><span class="sd">        A TableTemplate is a collection of rules of a table. This class implements methods</span>
</span><span id="HeaderTemplate-155"><a href="#HeaderTemplate-155"><span class="linenos">155</span></a><span class="sd">        for finding cell positions in a table image, given the template the image adheres to.</span>
</span><span id="HeaderTemplate-156"><a href="#HeaderTemplate-156"><span class="linenos">156</span></a>
</span><span id="HeaderTemplate-157"><a href="#HeaderTemplate-157"><span class="linenos">157</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate-158"><a href="#HeaderTemplate-158"><span class="linenos">158</span></a><span class="sd">            rules: 2D array of lines, where each line is represented as [x0, y0, x1, y1]</span>
</span><span id="HeaderTemplate-159"><a href="#HeaderTemplate-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-160"><a href="#HeaderTemplate-160"><span class="linenos">160</span></a>
</span><span id="HeaderTemplate-161"><a href="#HeaderTemplate-161"><span class="linenos">161</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="HeaderTemplate-162"><a href="#HeaderTemplate-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>
</span><span id="HeaderTemplate-163"><a href="#HeaderTemplate-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="HeaderTemplate-164"><a href="#HeaderTemplate-164"><span class="linenos">164</span></a>            <span class="p">[</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">_is_horizontal</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">_y</span>
</span><span id="HeaderTemplate-165"><a href="#HeaderTemplate-165"><span class="linenos">165</span></a>        <span class="p">)</span>
</span><span id="HeaderTemplate-166"><a href="#HeaderTemplate-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="HeaderTemplate-167"><a href="#HeaderTemplate-167"><span class="linenos">167</span></a>            <span class="p">[</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">_is_vertical</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">_x</span>
</span><span id="HeaderTemplate-168"><a href="#HeaderTemplate-168"><span class="linenos">168</span></a>        <span class="p">)</span>
</span><span id="HeaderTemplate-169"><a href="#HeaderTemplate-169"><span class="linenos">169</span></a>
</span><span id="HeaderTemplate-170"><a href="#HeaderTemplate-170"><span class="linenos">170</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate-171"><a href="#HeaderTemplate-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="HeaderTemplate-172"><a href="#HeaderTemplate-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-173"><a href="#HeaderTemplate-173"><span class="linenos">173</span></a><span class="sd">        Save the HeaderTemplate to the given path, as a json</span>
</span><span id="HeaderTemplate-174"><a href="#HeaderTemplate-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-175"><a href="#HeaderTemplate-175"><span class="linenos">175</span></a>
</span><span id="HeaderTemplate-176"><a href="#HeaderTemplate-176"><span class="linenos">176</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">]}</span>
</span><span id="HeaderTemplate-177"><a href="#HeaderTemplate-177"><span class="linenos">177</span></a>
</span><span id="HeaderTemplate-178"><a href="#HeaderTemplate-178"><span class="linenos">178</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HeaderTemplate-179"><a href="#HeaderTemplate-179"><span class="linenos">179</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="HeaderTemplate-180"><a href="#HeaderTemplate-180"><span class="linenos">180</span></a>
</span><span id="HeaderTemplate-181"><a href="#HeaderTemplate-181"><span class="linenos">181</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate-182"><a href="#HeaderTemplate-182"><span class="linenos">182</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate-183"><a href="#HeaderTemplate-183"><span class="linenos">183</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_saved</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate-184"><a href="#HeaderTemplate-184"><span class="linenos">184</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HeaderTemplate-185"><a href="#HeaderTemplate-185"><span class="linenos">185</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="HeaderTemplate-186"><a href="#HeaderTemplate-186"><span class="linenos">186</span></a>            <span class="n">rules</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate-187"><a href="#HeaderTemplate-187"><span class="linenos">187</span></a>            <span class="n">rules</span> <span class="o">=</span> <span class="p">[[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>
</span><span id="HeaderTemplate-188"><a href="#HeaderTemplate-188"><span class="linenos">188</span></a>
</span><span id="HeaderTemplate-189"><a href="#HeaderTemplate-189"><span class="linenos">189</span></a>            <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</span><span id="HeaderTemplate-190"><a href="#HeaderTemplate-190"><span class="linenos">190</span></a>
</span><span id="HeaderTemplate-191"><a href="#HeaderTemplate-191"><span class="linenos">191</span></a>    <span class="nd">@property</span>
</span><span id="HeaderTemplate-192"><a href="#HeaderTemplate-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate-193"><a href="#HeaderTemplate-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="HeaderTemplate-194"><a href="#HeaderTemplate-194"><span class="linenos">194</span></a>
</span><span id="HeaderTemplate-195"><a href="#HeaderTemplate-195"><span class="linenos">195</span></a>    <span class="nd">@property</span>
</span><span id="HeaderTemplate-196"><a href="#HeaderTemplate-196"><span class="linenos">196</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate-197"><a href="#HeaderTemplate-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="HeaderTemplate-198"><a href="#HeaderTemplate-198"><span class="linenos">198</span></a>
</span><span id="HeaderTemplate-199"><a href="#HeaderTemplate-199"><span class="linenos">199</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate-200"><a href="#HeaderTemplate-200"><span class="linenos">200</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate-201"><a href="#HeaderTemplate-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">annotate_image</span><span class="p">(</span>
</span><span id="HeaderTemplate-202"><a href="#HeaderTemplate-202"><span class="linenos">202</span></a>        <span class="n">template</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="HeaderTemplate-203"><a href="#HeaderTemplate-203"><span class="linenos">203</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate-204"><a href="#HeaderTemplate-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-205"><a href="#HeaderTemplate-205"><span class="linenos">205</span></a><span class="sd">        Utility method that allows users to create a template form a template image.</span>
</span><span id="HeaderTemplate-206"><a href="#HeaderTemplate-206"><span class="linenos">206</span></a>
</span><span id="HeaderTemplate-207"><a href="#HeaderTemplate-207"><span class="linenos">207</span></a><span class="sd">        The user is asked to click to annotate lines (two clicks per line).</span>
</span><span id="HeaderTemplate-208"><a href="#HeaderTemplate-208"><span class="linenos">208</span></a>
</span><span id="HeaderTemplate-209"><a href="#HeaderTemplate-209"><span class="linenos">209</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate-210"><a href="#HeaderTemplate-210"><span class="linenos">210</span></a><span class="sd">            template: the image on which to annotate the header lines</span>
</span><span id="HeaderTemplate-211"><a href="#HeaderTemplate-211"><span class="linenos">211</span></a><span class="sd">            crop (str | None): if str, crop the template image first, then do the annotation.</span>
</span><span id="HeaderTemplate-212"><a href="#HeaderTemplate-212"><span class="linenos">212</span></a><span class="sd">                The cropped image will be stored at the supplied path</span>
</span><span id="HeaderTemplate-213"><a href="#HeaderTemplate-213"><span class="linenos">213</span></a><span class="sd">            margin (int): margin to add around the cropping of the header</span>
</span><span id="HeaderTemplate-214"><a href="#HeaderTemplate-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-215"><a href="#HeaderTemplate-215"><span class="linenos">215</span></a>
</span><span id="HeaderTemplate-216"><a href="#HeaderTemplate-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HeaderTemplate-217"><a href="#HeaderTemplate-217"><span class="linenos">217</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate-218"><a href="#HeaderTemplate-218"><span class="linenos">218</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HeaderTemplate-219"><a href="#HeaderTemplate-219"><span class="linenos">219</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate-220"><a href="#HeaderTemplate-220"><span class="linenos">220</span></a>
</span><span id="HeaderTemplate-221"><a href="#HeaderTemplate-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="n">crop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderTemplate-222"><a href="#HeaderTemplate-222"><span class="linenos">222</span></a>            <span class="n">cropped</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">_crop</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">margin</span><span class="p">)</span>
</span><span id="HeaderTemplate-223"><a href="#HeaderTemplate-223"><span class="linenos">223</span></a>            <span class="n">cv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">crop</span><span class="p">),</span> <span class="n">cropped</span><span class="p">)</span>
</span><span id="HeaderTemplate-224"><a href="#HeaderTemplate-224"><span class="linenos">224</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">cropped</span>
</span><span id="HeaderTemplate-225"><a href="#HeaderTemplate-225"><span class="linenos">225</span></a>
</span><span id="HeaderTemplate-226"><a href="#HeaderTemplate-226"><span class="linenos">226</span></a>        <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-227"><a href="#HeaderTemplate-227"><span class="linenos">227</span></a>        <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HeaderTemplate-228"><a href="#HeaderTemplate-228"><span class="linenos">228</span></a>
</span><span id="HeaderTemplate-229"><a href="#HeaderTemplate-229"><span class="linenos">229</span></a>        <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate-230"><a href="#HeaderTemplate-230"><span class="linenos">230</span></a>
</span><span id="HeaderTemplate-231"><a href="#HeaderTemplate-231"><span class="linenos">231</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_point</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="HeaderTemplate-232"><a href="#HeaderTemplate-232"><span class="linenos">232</span></a>            <span class="k">nonlocal</span> <span class="n">lines</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">anno_template</span>
</span><span id="HeaderTemplate-233"><a href="#HeaderTemplate-233"><span class="linenos">233</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="HeaderTemplate-234"><a href="#HeaderTemplate-234"><span class="linenos">234</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="HeaderTemplate-235"><a href="#HeaderTemplate-235"><span class="linenos">235</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate-236"><a href="#HeaderTemplate-236"><span class="linenos">236</span></a>                <span class="k">if</span> <span class="n">start_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderTemplate-237"><a href="#HeaderTemplate-237"><span class="linenos">237</span></a>                    <span class="n">line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
</span><span id="HeaderTemplate-238"><a href="#HeaderTemplate-238"><span class="linenos">238</span></a>
</span><span id="HeaderTemplate-239"><a href="#HeaderTemplate-239"><span class="linenos">239</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-240"><a href="#HeaderTemplate-240"><span class="linenos">240</span></a>                        <span class="n">anno_template</span><span class="p">,</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-241"><a href="#HeaderTemplate-241"><span class="linenos">241</span></a>                        <span class="p">(</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="HeaderTemplate-242"><a href="#HeaderTemplate-242"><span class="linenos">242</span></a>                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</span><span id="HeaderTemplate-243"><a href="#HeaderTemplate-243"><span class="linenos">243</span></a>                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate-244"><a href="#HeaderTemplate-244"><span class="linenos">244</span></a>                        <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate-245"><a href="#HeaderTemplate-245"><span class="linenos">245</span></a>                        <span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span>
</span><span id="HeaderTemplate-246"><a href="#HeaderTemplate-246"><span class="linenos">246</span></a>                    <span class="p">)</span>
</span><span id="HeaderTemplate-247"><a href="#HeaderTemplate-247"><span class="linenos">247</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">anno_template</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-248"><a href="#HeaderTemplate-248"><span class="linenos">248</span></a>
</span><span id="HeaderTemplate-249"><a href="#HeaderTemplate-249"><span class="linenos">249</span></a>                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="HeaderTemplate-250"><a href="#HeaderTemplate-250"><span class="linenos">250</span></a>                    <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-251"><a href="#HeaderTemplate-251"><span class="linenos">251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="HeaderTemplate-252"><a href="#HeaderTemplate-252"><span class="linenos">252</span></a>                    <span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate-253"><a href="#HeaderTemplate-253"><span class="linenos">253</span></a>            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate-254"><a href="#HeaderTemplate-254"><span class="linenos">254</span></a>                <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-255"><a href="#HeaderTemplate-255"><span class="linenos">255</span></a>
</span><span id="HeaderTemplate-256"><a href="#HeaderTemplate-256"><span class="linenos">256</span></a>                <span class="c1"># remove the last annotation</span>
</span><span id="HeaderTemplate-257"><a href="#HeaderTemplate-257"><span class="linenos">257</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-258"><a href="#HeaderTemplate-258"><span class="linenos">258</span></a>
</span><span id="HeaderTemplate-259"><a href="#HeaderTemplate-259"><span class="linenos">259</span></a>                <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">anno_template</span><span class="p">)</span>
</span><span id="HeaderTemplate-260"><a href="#HeaderTemplate-260"><span class="linenos">260</span></a>
</span><span id="HeaderTemplate-261"><a href="#HeaderTemplate-261"><span class="linenos">261</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="HeaderTemplate-262"><a href="#HeaderTemplate-262"><span class="linenos">262</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="HeaderTemplate-263"><a href="#HeaderTemplate-263"><span class="linenos">263</span></a>                        <span class="n">template</span><span class="p">,</span>
</span><span id="HeaderTemplate-264"><a href="#HeaderTemplate-264"><span class="linenos">264</span></a>                        <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="HeaderTemplate-265"><a href="#HeaderTemplate-265"><span class="linenos">265</span></a>                        <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
</span><span id="HeaderTemplate-266"><a href="#HeaderTemplate-266"><span class="linenos">266</span></a>                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate-267"><a href="#HeaderTemplate-267"><span class="linenos">267</span></a>                        <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate-268"><a href="#HeaderTemplate-268"><span class="linenos">268</span></a>                        <span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span>
</span><span id="HeaderTemplate-269"><a href="#HeaderTemplate-269"><span class="linenos">269</span></a>                    <span class="p">)</span>
</span><span id="HeaderTemplate-270"><a href="#HeaderTemplate-270"><span class="linenos">270</span></a>
</span><span id="HeaderTemplate-271"><a href="#HeaderTemplate-271"><span class="linenos">271</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate-272"><a href="#HeaderTemplate-272"><span class="linenos">272</span></a>
</span><span id="HeaderTemplate-273"><a href="#HeaderTemplate-273"><span class="linenos">273</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">ANNO_HELP</span><span class="p">)</span>
</span><span id="HeaderTemplate-274"><a href="#HeaderTemplate-274"><span class="linenos">274</span></a>
</span><span id="HeaderTemplate-275"><a href="#HeaderTemplate-275"><span class="linenos">275</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">anno_template</span><span class="p">,</span> <span class="n">get_point</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;annotate the header&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate-276"><a href="#HeaderTemplate-276"><span class="linenos">276</span></a>
</span><span id="HeaderTemplate-277"><a href="#HeaderTemplate-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="HeaderTemplate-278"><a href="#HeaderTemplate-278"><span class="linenos">278</span></a>
</span><span id="HeaderTemplate-279"><a href="#HeaderTemplate-279"><span class="linenos">279</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate-280"><a href="#HeaderTemplate-280"><span class="linenos">280</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">include_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HeaderTemplate-281"><a href="#HeaderTemplate-281"><span class="linenos">281</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_crop</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="HeaderTemplate-282"><a href="#HeaderTemplate-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-283"><a href="#HeaderTemplate-283"><span class="linenos">283</span></a><span class="sd">        Crop the image to contain only the annotations, such that it can be used as the header image in the taulu workflow.</span>
</span><span id="HeaderTemplate-284"><a href="#HeaderTemplate-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-285"><a href="#HeaderTemplate-285"><span class="linenos">285</span></a>
</span><span id="HeaderTemplate-286"><a href="#HeaderTemplate-286"><span class="linenos">286</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HeaderTemplate-287"><a href="#HeaderTemplate-287"><span class="linenos">287</span></a>        <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate-288"><a href="#HeaderTemplate-288"><span class="linenos">288</span></a>
</span><span id="HeaderTemplate-289"><a href="#HeaderTemplate-289"><span class="linenos">289</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_point</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="HeaderTemplate-290"><a href="#HeaderTemplate-290"><span class="linenos">290</span></a>            <span class="k">nonlocal</span> <span class="n">points</span><span class="p">,</span> <span class="n">anno_template</span>
</span><span id="HeaderTemplate-291"><a href="#HeaderTemplate-291"><span class="linenos">291</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="HeaderTemplate-292"><a href="#HeaderTemplate-292"><span class="linenos">292</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="HeaderTemplate-293"><a href="#HeaderTemplate-293"><span class="linenos">293</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate-294"><a href="#HeaderTemplate-294"><span class="linenos">294</span></a>                <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="HeaderTemplate-295"><a href="#HeaderTemplate-295"><span class="linenos">295</span></a>
</span><span id="HeaderTemplate-296"><a href="#HeaderTemplate-296"><span class="linenos">296</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-297"><a href="#HeaderTemplate-297"><span class="linenos">297</span></a>                    <span class="n">anno_template</span><span class="p">,</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-298"><a href="#HeaderTemplate-298"><span class="linenos">298</span></a>                    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</span><span id="HeaderTemplate-299"><a href="#HeaderTemplate-299"><span class="linenos">299</span></a>                    <span class="mi">4</span><span class="p">,</span>
</span><span id="HeaderTemplate-300"><a href="#HeaderTemplate-300"><span class="linenos">300</span></a>                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate-301"><a href="#HeaderTemplate-301"><span class="linenos">301</span></a>                    <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate-302"><a href="#HeaderTemplate-302"><span class="linenos">302</span></a>                <span class="p">)</span>
</span><span id="HeaderTemplate-303"><a href="#HeaderTemplate-303"><span class="linenos">303</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">anno_template</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-304"><a href="#HeaderTemplate-304"><span class="linenos">304</span></a>
</span><span id="HeaderTemplate-305"><a href="#HeaderTemplate-305"><span class="linenos">305</span></a>                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="HeaderTemplate-306"><a href="#HeaderTemplate-306"><span class="linenos">306</span></a>            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate-307"><a href="#HeaderTemplate-307"><span class="linenos">307</span></a>                <span class="c1"># remove the last annotation</span>
</span><span id="HeaderTemplate-308"><a href="#HeaderTemplate-308"><span class="linenos">308</span></a>                <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-309"><a href="#HeaderTemplate-309"><span class="linenos">309</span></a>
</span><span id="HeaderTemplate-310"><a href="#HeaderTemplate-310"><span class="linenos">310</span></a>                <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">anno_template</span><span class="p">)</span>
</span><span id="HeaderTemplate-311"><a href="#HeaderTemplate-311"><span class="linenos">311</span></a>
</span><span id="HeaderTemplate-312"><a href="#HeaderTemplate-312"><span class="linenos">312</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
</span><span id="HeaderTemplate-313"><a href="#HeaderTemplate-313"><span class="linenos">313</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="HeaderTemplate-314"><a href="#HeaderTemplate-314"><span class="linenos">314</span></a>                        <span class="n">anno_template</span><span class="p">,</span>
</span><span id="HeaderTemplate-315"><a href="#HeaderTemplate-315"><span class="linenos">315</span></a>                        <span class="n">p</span><span class="p">,</span>
</span><span id="HeaderTemplate-316"><a href="#HeaderTemplate-316"><span class="linenos">316</span></a>                        <span class="mi">4</span><span class="p">,</span>
</span><span id="HeaderTemplate-317"><a href="#HeaderTemplate-317"><span class="linenos">317</span></a>                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate-318"><a href="#HeaderTemplate-318"><span class="linenos">318</span></a>                        <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate-319"><a href="#HeaderTemplate-319"><span class="linenos">319</span></a>                    <span class="p">)</span>
</span><span id="HeaderTemplate-320"><a href="#HeaderTemplate-320"><span class="linenos">320</span></a>
</span><span id="HeaderTemplate-321"><a href="#HeaderTemplate-321"><span class="linenos">321</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">anno_template</span><span class="p">)</span>
</span><span id="HeaderTemplate-322"><a href="#HeaderTemplate-322"><span class="linenos">322</span></a>
</span><span id="HeaderTemplate-323"><a href="#HeaderTemplate-323"><span class="linenos">323</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">CROP_HELP</span><span class="p">)</span>
</span><span id="HeaderTemplate-324"><a href="#HeaderTemplate-324"><span class="linenos">324</span></a>
</span><span id="HeaderTemplate-325"><a href="#HeaderTemplate-325"><span class="linenos">325</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">anno_template</span><span class="p">,</span> <span class="n">get_point</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;crop the header&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate-326"><a href="#HeaderTemplate-326"><span class="linenos">326</span></a>
</span><span id="HeaderTemplate-327"><a href="#HeaderTemplate-327"><span class="linenos">327</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span>
</span><span id="HeaderTemplate-328"><a href="#HeaderTemplate-328"><span class="linenos">328</span></a>            <span class="s2">&quot;you need to annotate the four corners of the table in order to crop it&quot;</span>
</span><span id="HeaderTemplate-329"><a href="#HeaderTemplate-329"><span class="linenos">329</span></a>        <span class="p">)</span>
</span><span id="HeaderTemplate-330"><a href="#HeaderTemplate-330"><span class="linenos">330</span></a>
</span><span id="HeaderTemplate-331"><a href="#HeaderTemplate-331"><span class="linenos">331</span></a>        <span class="c1"># crop the image to contain all of the points (just crop rectangularly, x, y, w, h)</span>
</span><span id="HeaderTemplate-332"><a href="#HeaderTemplate-332"><span class="linenos">332</span></a>        <span class="c1"># Convert points to numpy array</span>
</span><span id="HeaderTemplate-333"><a href="#HeaderTemplate-333"><span class="linenos">333</span></a>        <span class="n">points_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</span><span id="HeaderTemplate-334"><a href="#HeaderTemplate-334"><span class="linenos">334</span></a>
</span><span id="HeaderTemplate-335"><a href="#HeaderTemplate-335"><span class="linenos">335</span></a>        <span class="c1"># Find bounding box</span>
</span><span id="HeaderTemplate-336"><a href="#HeaderTemplate-336"><span class="linenos">336</span></a>        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points_np</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate-337"><a href="#HeaderTemplate-337"><span class="linenos">337</span></a>        <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points_np</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate-338"><a href="#HeaderTemplate-338"><span class="linenos">338</span></a>        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points_np</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate-339"><a href="#HeaderTemplate-339"><span class="linenos">339</span></a>        <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points_np</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate-340"><a href="#HeaderTemplate-340"><span class="linenos">340</span></a>
</span><span id="HeaderTemplate-341"><a href="#HeaderTemplate-341"><span class="linenos">341</span></a>        <span class="c1"># Compute width and height</span>
</span><span id="HeaderTemplate-342"><a href="#HeaderTemplate-342"><span class="linenos">342</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
</span><span id="HeaderTemplate-343"><a href="#HeaderTemplate-343"><span class="linenos">343</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>
</span><span id="HeaderTemplate-344"><a href="#HeaderTemplate-344"><span class="linenos">344</span></a>
</span><span id="HeaderTemplate-345"><a href="#HeaderTemplate-345"><span class="linenos">345</span></a>        <span class="c1"># Ensure integers and within image boundaries</span>
</span><span id="HeaderTemplate-346"><a href="#HeaderTemplate-346"><span class="linenos">346</span></a>        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x_min</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HeaderTemplate-347"><a href="#HeaderTemplate-347"><span class="linenos">347</span></a>        <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y_min</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HeaderTemplate-348"><a href="#HeaderTemplate-348"><span class="linenos">348</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
</span><span id="HeaderTemplate-349"><a href="#HeaderTemplate-349"><span class="linenos">349</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
</span><span id="HeaderTemplate-350"><a href="#HeaderTemplate-350"><span class="linenos">350</span></a>
</span><span id="HeaderTemplate-351"><a href="#HeaderTemplate-351"><span class="linenos">351</span></a>        <span class="c1"># Crop the image</span>
</span><span id="HeaderTemplate-352"><a href="#HeaderTemplate-352"><span class="linenos">352</span></a>        <span class="n">cropped</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span>
</span><span id="HeaderTemplate-353"><a href="#HeaderTemplate-353"><span class="linenos">353</span></a>            <span class="n">y_min</span> <span class="o">-</span> <span class="n">margin</span> <span class="p">:</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span>
</span><span id="HeaderTemplate-354"><a href="#HeaderTemplate-354"><span class="linenos">354</span></a>            <span class="n">x_min</span> <span class="o">-</span> <span class="n">margin</span> <span class="p">:</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span>
</span><span id="HeaderTemplate-355"><a href="#HeaderTemplate-355"><span class="linenos">355</span></a>        <span class="p">]</span>
</span><span id="HeaderTemplate-356"><a href="#HeaderTemplate-356"><span class="linenos">356</span></a>
</span><span id="HeaderTemplate-357"><a href="#HeaderTemplate-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="n">cropped</span>
</span><span id="HeaderTemplate-358"><a href="#HeaderTemplate-358"><span class="linenos">358</span></a>
</span><span id="HeaderTemplate-359"><a href="#HeaderTemplate-359"><span class="linenos">359</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate-360"><a href="#HeaderTemplate-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_vgg_annotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate-361"><a href="#HeaderTemplate-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-362"><a href="#HeaderTemplate-362"><span class="linenos">362</span></a><span class="sd">        Create a TableTemplate from annotations made in [vgg](https://annotate.officialstatistics.org/), using the polylines tool.</span>
</span><span id="HeaderTemplate-363"><a href="#HeaderTemplate-363"><span class="linenos">363</span></a>
</span><span id="HeaderTemplate-364"><a href="#HeaderTemplate-364"><span class="linenos">364</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate-365"><a href="#HeaderTemplate-365"><span class="linenos">365</span></a><span class="sd">            annotation (str): the path of the annotation csv file</span>
</span><span id="HeaderTemplate-366"><a href="#HeaderTemplate-366"><span class="linenos">366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-367"><a href="#HeaderTemplate-367"><span class="linenos">367</span></a>
</span><span id="HeaderTemplate-368"><a href="#HeaderTemplate-368"><span class="linenos">368</span></a>        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HeaderTemplate-369"><a href="#HeaderTemplate-369"><span class="linenos">369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span><span id="HeaderTemplate-370"><a href="#HeaderTemplate-370"><span class="linenos">370</span></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
</span><span id="HeaderTemplate-371"><a href="#HeaderTemplate-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="HeaderTemplate-372"><a href="#HeaderTemplate-372"><span class="linenos">372</span></a>                <span class="n">shape_attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;region_shape_attributes&quot;</span><span class="p">])</span>
</span><span id="HeaderTemplate-373"><a href="#HeaderTemplate-373"><span class="linenos">373</span></a>                <span class="k">if</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;polyline&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate-374"><a href="#HeaderTemplate-374"><span class="linenos">374</span></a>                    <span class="n">x_points</span> <span class="o">=</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;all_points_x&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate-375"><a href="#HeaderTemplate-375"><span class="linenos">375</span></a>                    <span class="n">y_points</span> <span class="o">=</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;all_points_y&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate-376"><a href="#HeaderTemplate-376"><span class="linenos">376</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="HeaderTemplate-377"><a href="#HeaderTemplate-377"><span class="linenos">377</span></a>                        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="HeaderTemplate-378"><a href="#HeaderTemplate-378"><span class="linenos">378</span></a>                            <span class="p">[</span><span class="n">x_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_points</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="HeaderTemplate-379"><a href="#HeaderTemplate-379"><span class="linenos">379</span></a>                        <span class="p">)</span>
</span><span id="HeaderTemplate-380"><a href="#HeaderTemplate-380"><span class="linenos">380</span></a>
</span><span id="HeaderTemplate-381"><a href="#HeaderTemplate-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</span><span id="HeaderTemplate-382"><a href="#HeaderTemplate-382"><span class="linenos">382</span></a>
</span><span id="HeaderTemplate-383"><a href="#HeaderTemplate-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate-384"><a href="#HeaderTemplate-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="HeaderTemplate-385"><a href="#HeaderTemplate-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
</span><span id="HeaderTemplate-386"><a href="#HeaderTemplate-386"><span class="linenos">386</span></a>
</span><span id="HeaderTemplate-387"><a href="#HeaderTemplate-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate-388"><a href="#HeaderTemplate-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)]</span>
</span><span id="HeaderTemplate-389"><a href="#HeaderTemplate-389"><span class="linenos">389</span></a>
</span><span id="HeaderTemplate-390"><a href="#HeaderTemplate-390"><span class="linenos">390</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate-391"><a href="#HeaderTemplate-391"><span class="linenos">391</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">header_factor</span><span class="p">)</span>
</span><span id="HeaderTemplate-392"><a href="#HeaderTemplate-392"><span class="linenos">392</span></a>
</span><span id="HeaderTemplate-393"><a href="#HeaderTemplate-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_heights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_factors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate-394"><a href="#HeaderTemplate-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_factors</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="HeaderTemplate-395"><a href="#HeaderTemplate-395"><span class="linenos">395</span></a>            <span class="n">header_factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">header_factors</span><span class="p">]</span>
</span><span id="HeaderTemplate-396"><a href="#HeaderTemplate-396"><span class="linenos">396</span></a>        <span class="n">header_factors</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">header_factors</span><span class="p">)</span>
</span><span id="HeaderTemplate-397"><a href="#HeaderTemplate-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="HeaderTemplate-398"><a href="#HeaderTemplate-398"><span class="linenos">398</span></a>            <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">header_factors</span>
</span><span id="HeaderTemplate-399"><a href="#HeaderTemplate-399"><span class="linenos">399</span></a>        <span class="p">]</span>
</span><span id="HeaderTemplate-400"><a href="#HeaderTemplate-400"><span class="linenos">400</span></a>
</span><span id="HeaderTemplate-401"><a href="#HeaderTemplate-401"><span class="linenos">401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="HeaderTemplate-402"><a href="#HeaderTemplate-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-403"><a href="#HeaderTemplate-403"><span class="linenos">403</span></a><span class="sd">        Returns the interaction of the index[0]th horizontal rule and the</span>
</span><span id="HeaderTemplate-404"><a href="#HeaderTemplate-404"><span class="linenos">404</span></a><span class="sd">        index[1]th vertical rule</span>
</span><span id="HeaderTemplate-405"><a href="#HeaderTemplate-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-406"><a href="#HeaderTemplate-406"><span class="linenos">406</span></a>
</span><span id="HeaderTemplate-407"><a href="#HeaderTemplate-407"><span class="linenos">407</span></a>        <span class="n">ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="HeaderTemplate-408"><a href="#HeaderTemplate-408"><span class="linenos">408</span></a>        <span class="k">assert</span> <span class="n">ints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-409"><a href="#HeaderTemplate-409"><span class="linenos">409</span></a>        <span class="k">return</span> <span class="n">ints</span>
</span><span id="HeaderTemplate-410"><a href="#HeaderTemplate-410"><span class="linenos">410</span></a>
</span><span id="HeaderTemplate-411"><a href="#HeaderTemplate-411"><span class="linenos">411</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate-412"><a href="#HeaderTemplate-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-413"><a href="#HeaderTemplate-413"><span class="linenos">413</span></a><span class="sd">        Get the cell index (row, col) that corresponds with the point (x, y) in the template image</span>
</span><span id="HeaderTemplate-414"><a href="#HeaderTemplate-414"><span class="linenos">414</span></a>
</span><span id="HeaderTemplate-415"><a href="#HeaderTemplate-415"><span class="linenos">415</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate-416"><a href="#HeaderTemplate-416"><span class="linenos">416</span></a><span class="sd">            point (tuple[float, float]): the coordinates in the template image</span>
</span><span id="HeaderTemplate-417"><a href="#HeaderTemplate-417"><span class="linenos">417</span></a>
</span><span id="HeaderTemplate-418"><a href="#HeaderTemplate-418"><span class="linenos">418</span></a><span class="sd">        Returns:</span>
</span><span id="HeaderTemplate-419"><a href="#HeaderTemplate-419"><span class="linenos">419</span></a><span class="sd">            tuple[int, int]: (row, col)</span>
</span><span id="HeaderTemplate-420"><a href="#HeaderTemplate-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-421"><a href="#HeaderTemplate-421"><span class="linenos">421</span></a>
</span><span id="HeaderTemplate-422"><a href="#HeaderTemplate-422"><span class="linenos">422</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
</span><span id="HeaderTemplate-423"><a href="#HeaderTemplate-423"><span class="linenos">423</span></a>
</span><span id="HeaderTemplate-424"><a href="#HeaderTemplate-424"><span class="linenos">424</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="HeaderTemplate-425"><a href="#HeaderTemplate-425"><span class="linenos">425</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="HeaderTemplate-426"><a href="#HeaderTemplate-426"><span class="linenos">426</span></a>
</span><span id="HeaderTemplate-427"><a href="#HeaderTemplate-427"><span class="linenos">427</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
</span><span id="HeaderTemplate-428"><a href="#HeaderTemplate-428"><span class="linenos">428</span></a>            <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate-429"><a href="#HeaderTemplate-429"><span class="linenos">429</span></a>            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate-430"><a href="#HeaderTemplate-430"><span class="linenos">430</span></a>            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
</span><span id="HeaderTemplate-431"><a href="#HeaderTemplate-431"><span class="linenos">431</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="HeaderTemplate-432"><a href="#HeaderTemplate-432"><span class="linenos">432</span></a>                <span class="k">break</span>
</span><span id="HeaderTemplate-433"><a href="#HeaderTemplate-433"><span class="linenos">433</span></a>
</span><span id="HeaderTemplate-434"><a href="#HeaderTemplate-434"><span class="linenos">434</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="HeaderTemplate-435"><a href="#HeaderTemplate-435"><span class="linenos">435</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="HeaderTemplate-436"><a href="#HeaderTemplate-436"><span class="linenos">436</span></a>            <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="HeaderTemplate-437"><a href="#HeaderTemplate-437"><span class="linenos">437</span></a>            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
</span><span id="HeaderTemplate-438"><a href="#HeaderTemplate-438"><span class="linenos">438</span></a>                <span class="n">col</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="HeaderTemplate-439"><a href="#HeaderTemplate-439"><span class="linenos">439</span></a>                <span class="k">break</span>
</span><span id="HeaderTemplate-440"><a href="#HeaderTemplate-440"><span class="linenos">440</span></a>
</span><span id="HeaderTemplate-441"><a href="#HeaderTemplate-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">col</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="HeaderTemplate-442"><a href="#HeaderTemplate-442"><span class="linenos">442</span></a>            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="HeaderTemplate-443"><a href="#HeaderTemplate-443"><span class="linenos">443</span></a>
</span><span id="HeaderTemplate-444"><a href="#HeaderTemplate-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="HeaderTemplate-445"><a href="#HeaderTemplate-445"><span class="linenos">445</span></a>
</span><span id="HeaderTemplate-446"><a href="#HeaderTemplate-446"><span class="linenos">446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span>
</span><span id="HeaderTemplate-447"><a href="#HeaderTemplate-447"><span class="linenos">447</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="HeaderTemplate-448"><a href="#HeaderTemplate-448"><span class="linenos">448</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="HeaderTemplate-449"><a href="#HeaderTemplate-449"><span class="linenos">449</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-450"><a href="#HeaderTemplate-450"><span class="linenos">450</span></a><span class="sd">        Return points (x,y) that make up a polygon around the requested cell</span>
</span><span id="HeaderTemplate-451"><a href="#HeaderTemplate-451"><span class="linenos">451</span></a><span class="sd">        (top left, top right, bottom right, bottom left)</span>
</span><span id="HeaderTemplate-452"><a href="#HeaderTemplate-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate-453"><a href="#HeaderTemplate-453"><span class="linenos">453</span></a>
</span><span id="HeaderTemplate-454"><a href="#HeaderTemplate-454"><span class="linenos">454</span></a>        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="HeaderTemplate-455"><a href="#HeaderTemplate-455"><span class="linenos">455</span></a>
</span><span id="HeaderTemplate-456"><a href="#HeaderTemplate-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="HeaderTemplate-457"><a href="#HeaderTemplate-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="HeaderTemplate-458"><a href="#HeaderTemplate-458"><span class="linenos">458</span></a>
</span><span id="HeaderTemplate-459"><a href="#HeaderTemplate-459"><span class="linenos">459</span></a>        <span class="n">top_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
</span><span id="HeaderTemplate-460"><a href="#HeaderTemplate-460"><span class="linenos">460</span></a>        <span class="n">bottom_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-461"><a href="#HeaderTemplate-461"><span class="linenos">461</span></a>        <span class="n">left_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="HeaderTemplate-462"><a href="#HeaderTemplate-462"><span class="linenos">462</span></a>        <span class="n">right_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-463"><a href="#HeaderTemplate-463"><span class="linenos">463</span></a>
</span><span id="HeaderTemplate-464"><a href="#HeaderTemplate-464"><span class="linenos">464</span></a>        <span class="c1"># Calculate corner points using intersections</span>
</span><span id="HeaderTemplate-465"><a href="#HeaderTemplate-465"><span class="linenos">465</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-466"><a href="#HeaderTemplate-466"><span class="linenos">466</span></a>        <span class="n">top_right</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-467"><a href="#HeaderTemplate-467"><span class="linenos">467</span></a>        <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-468"><a href="#HeaderTemplate-468"><span class="linenos">468</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-469"><a href="#HeaderTemplate-469"><span class="linenos">469</span></a>
</span><span id="HeaderTemplate-470"><a href="#HeaderTemplate-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="HeaderTemplate-471"><a href="#HeaderTemplate-471"><span class="linenos">471</span></a>            <span class="p">[</span>
</span><span id="HeaderTemplate-472"><a href="#HeaderTemplate-472"><span class="linenos">472</span></a>                <span class="n">point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-473"><a href="#HeaderTemplate-473"><span class="linenos">473</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="p">[</span><span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">]</span>
</span><span id="HeaderTemplate-474"><a href="#HeaderTemplate-474"><span class="linenos">474</span></a>            <span class="p">]</span>
</span><span id="HeaderTemplate-475"><a href="#HeaderTemplate-475"><span class="linenos">475</span></a>        <span class="p">):</span>
</span><span id="HeaderTemplate-476"><a href="#HeaderTemplate-476"><span class="linenos">476</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;the lines around this cell do not intersect&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate-477"><a href="#HeaderTemplate-477"><span class="linenos">477</span></a>
</span><span id="HeaderTemplate-478"><a href="#HeaderTemplate-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">,</span> <span class="n">bottom_left</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate-479"><a href="#HeaderTemplate-479"><span class="linenos">479</span></a>
</span><span id="HeaderTemplate-480"><a href="#HeaderTemplate-480"><span class="linenos">480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="HeaderTemplate-481"><a href="#HeaderTemplate-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="HeaderTemplate-482"><a href="#HeaderTemplate-482"><span class="linenos">482</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="HeaderTemplate-483"><a href="#HeaderTemplate-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate-484"><a href="#HeaderTemplate-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate-485"><a href="#HeaderTemplate-485"><span class="linenos">485</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate-486"><a href="#HeaderTemplate-486"><span class="linenos">486</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate-487"><a href="#HeaderTemplate-487"><span class="linenos">487</span></a>
</span><span id="HeaderTemplate-488"><a href="#HeaderTemplate-488"><span class="linenos">488</span></a>        <span class="c1"># the rules that surround this row</span>
</span><span id="HeaderTemplate-489"><a href="#HeaderTemplate-489"><span class="linenos">489</span></a>        <span class="n">top_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="HeaderTemplate-490"><a href="#HeaderTemplate-490"><span class="linenos">490</span></a>        <span class="n">bottom_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-491"><a href="#HeaderTemplate-491"><span class="linenos">491</span></a>        <span class="n">left_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="HeaderTemplate-492"><a href="#HeaderTemplate-492"><span class="linenos">492</span></a>        <span class="n">right_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate-493"><a href="#HeaderTemplate-493"><span class="linenos">493</span></a>
</span><span id="HeaderTemplate-494"><a href="#HeaderTemplate-494"><span class="linenos">494</span></a>        <span class="c1"># four points that will be the bounding polygon of the result,</span>
</span><span id="HeaderTemplate-495"><a href="#HeaderTemplate-495"><span class="linenos">495</span></a>        <span class="c1"># which needs to be rectified</span>
</span><span id="HeaderTemplate-496"><a href="#HeaderTemplate-496"><span class="linenos">496</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-497"><a href="#HeaderTemplate-497"><span class="linenos">497</span></a>        <span class="n">top_right</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-498"><a href="#HeaderTemplate-498"><span class="linenos">498</span></a>        <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-499"><a href="#HeaderTemplate-499"><span class="linenos">499</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate-500"><a href="#HeaderTemplate-500"><span class="linenos">500</span></a>
</span><span id="HeaderTemplate-501"><a href="#HeaderTemplate-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="HeaderTemplate-502"><a href="#HeaderTemplate-502"><span class="linenos">502</span></a>            <span class="n">top_left</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-503"><a href="#HeaderTemplate-503"><span class="linenos">503</span></a>            <span class="ow">or</span> <span class="n">top_right</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-504"><a href="#HeaderTemplate-504"><span class="linenos">504</span></a>            <span class="ow">or</span> <span class="n">bottom_left</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-505"><a href="#HeaderTemplate-505"><span class="linenos">505</span></a>            <span class="ow">or</span> <span class="n">bottom_right</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate-506"><a href="#HeaderTemplate-506"><span class="linenos">506</span></a>        <span class="p">):</span>
</span><span id="HeaderTemplate-507"><a href="#HeaderTemplate-507"><span class="linenos">507</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;the lines around this row do not intersect properly&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate-508"><a href="#HeaderTemplate-508"><span class="linenos">508</span></a>
</span><span id="HeaderTemplate-509"><a href="#HeaderTemplate-509"><span class="linenos">509</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">to_point</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
</span><span id="HeaderTemplate-510"><a href="#HeaderTemplate-510"><span class="linenos">510</span></a>            <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="HeaderTemplate-511"><a href="#HeaderTemplate-511"><span class="linenos">511</span></a>
</span><span id="HeaderTemplate-512"><a href="#HeaderTemplate-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="HeaderTemplate-513"><a href="#HeaderTemplate-513"><span class="linenos">513</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">top_left</span><span class="p">),</span>
</span><span id="HeaderTemplate-514"><a href="#HeaderTemplate-514"><span class="linenos">514</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">top_right</span><span class="p">),</span>
</span><span id="HeaderTemplate-515"><a href="#HeaderTemplate-515"><span class="linenos">515</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">bottom_right</span><span class="p">),</span>
</span><span id="HeaderTemplate-516"><a href="#HeaderTemplate-516"><span class="linenos">516</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">),</span>
</span><span id="HeaderTemplate-517"><a href="#HeaderTemplate-517"><span class="linenos">517</span></a>        <span class="p">)</span>
</span><span id="HeaderTemplate-518"><a href="#HeaderTemplate-518"><span class="linenos">518</span></a>
</span><span id="HeaderTemplate-519"><a href="#HeaderTemplate-519"><span class="linenos">519</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="HeaderTemplate-520"><a href="#HeaderTemplate-520"><span class="linenos">520</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="HeaderTemplate-521"><a href="#HeaderTemplate-521"><span class="linenos">521</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="HeaderTemplate-522"><a href="#HeaderTemplate-522"><span class="linenos">522</span></a>        <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;text_regions should not be called on a HeaderTemplate&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Subclasses implement methods for going from a pixel in the input image to a table cell index,
and cropping an image to the given table cell index.</p>
</div>


                            <div id="HeaderTemplate.__init__" class="classattr">
                                        <input id="HeaderTemplate.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HeaderTemplate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span></span>)</span>

                <label class="view-source-button" for="HeaderTemplate.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.__init__-152"><a href="#HeaderTemplate.__init__-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
</span><span id="HeaderTemplate.__init__-153"><a href="#HeaderTemplate.__init__-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.__init__-154"><a href="#HeaderTemplate.__init__-154"><span class="linenos">154</span></a><span class="sd">        A TableTemplate is a collection of rules of a table. This class implements methods</span>
</span><span id="HeaderTemplate.__init__-155"><a href="#HeaderTemplate.__init__-155"><span class="linenos">155</span></a><span class="sd">        for finding cell positions in a table image, given the template the image adheres to.</span>
</span><span id="HeaderTemplate.__init__-156"><a href="#HeaderTemplate.__init__-156"><span class="linenos">156</span></a>
</span><span id="HeaderTemplate.__init__-157"><a href="#HeaderTemplate.__init__-157"><span class="linenos">157</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate.__init__-158"><a href="#HeaderTemplate.__init__-158"><span class="linenos">158</span></a><span class="sd">            rules: 2D array of lines, where each line is represented as [x0, y0, x1, y1]</span>
</span><span id="HeaderTemplate.__init__-159"><a href="#HeaderTemplate.__init__-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.__init__-160"><a href="#HeaderTemplate.__init__-160"><span class="linenos">160</span></a>
</span><span id="HeaderTemplate.__init__-161"><a href="#HeaderTemplate.__init__-161"><span class="linenos">161</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="HeaderTemplate.__init__-162"><a href="#HeaderTemplate.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">_Rule</span><span class="p">(</span><span class="o">*</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>
</span><span id="HeaderTemplate.__init__-163"><a href="#HeaderTemplate.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="HeaderTemplate.__init__-164"><a href="#HeaderTemplate.__init__-164"><span class="linenos">164</span></a>            <span class="p">[</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">_is_horizontal</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">_y</span>
</span><span id="HeaderTemplate.__init__-165"><a href="#HeaderTemplate.__init__-165"><span class="linenos">165</span></a>        <span class="p">)</span>
</span><span id="HeaderTemplate.__init__-166"><a href="#HeaderTemplate.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="HeaderTemplate.__init__-167"><a href="#HeaderTemplate.__init__-167"><span class="linenos">167</span></a>            <span class="p">[</span><span class="n">rule</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">_is_vertical</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">_x</span>
</span><span id="HeaderTemplate.__init__-168"><a href="#HeaderTemplate.__init__-168"><span class="linenos">168</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A TableTemplate is a collection of rules of a table. This class implements methods
for finding cell positions in a table image, given the template the image adheres to.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rules:</strong>  2D array of lines, where each line is represented as [x0, y0, x1, y1]</li>
</ul>
</div>


                            </div>
                            <div id="HeaderTemplate.save" class="classattr">
                                        <input id="HeaderTemplate.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-log_calls">@log_calls(level=logging.DEBUG)</div>

        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HeaderTemplate.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.save-170"><a href="#HeaderTemplate.save-170"><span class="linenos">170</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate.save-171"><a href="#HeaderTemplate.save-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="HeaderTemplate.save-172"><a href="#HeaderTemplate.save-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.save-173"><a href="#HeaderTemplate.save-173"><span class="linenos">173</span></a><span class="sd">        Save the HeaderTemplate to the given path, as a json</span>
</span><span id="HeaderTemplate.save-174"><a href="#HeaderTemplate.save-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.save-175"><a href="#HeaderTemplate.save-175"><span class="linenos">175</span></a>
</span><span id="HeaderTemplate.save-176"><a href="#HeaderTemplate.save-176"><span class="linenos">176</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">]}</span>
</span><span id="HeaderTemplate.save-177"><a href="#HeaderTemplate.save-177"><span class="linenos">177</span></a>
</span><span id="HeaderTemplate.save-178"><a href="#HeaderTemplate.save-178"><span class="linenos">178</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HeaderTemplate.save-179"><a href="#HeaderTemplate.save-179"><span class="linenos">179</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save the HeaderTemplate to the given path, as a json</p>
</div>


                            </div>
                            <div id="HeaderTemplate.from_saved" class="classattr">
                                        <input id="HeaderTemplate.from_saved-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>
        <div class="decorator decorator-log_calls">@log_calls(level=logging.DEBUG)</div>

        <span class="def">def</span>
        <span class="name">from_saved</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#HeaderTemplate">HeaderTemplate</a></span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.from_saved-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.from_saved"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.from_saved-181"><a href="#HeaderTemplate.from_saved-181"><span class="linenos">181</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate.from_saved-182"><a href="#HeaderTemplate.from_saved-182"><span class="linenos">182</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate.from_saved-183"><a href="#HeaderTemplate.from_saved-183"><span class="linenos">183</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_saved</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_saved-184"><a href="#HeaderTemplate.from_saved-184"><span class="linenos">184</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_saved-185"><a href="#HeaderTemplate.from_saved-185"><span class="linenos">185</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="HeaderTemplate.from_saved-186"><a href="#HeaderTemplate.from_saved-186"><span class="linenos">186</span></a>            <span class="n">rules</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate.from_saved-187"><a href="#HeaderTemplate.from_saved-187"><span class="linenos">187</span></a>            <span class="n">rules</span> <span class="o">=</span> <span class="p">[[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>
</span><span id="HeaderTemplate.from_saved-188"><a href="#HeaderTemplate.from_saved-188"><span class="linenos">188</span></a>
</span><span id="HeaderTemplate.from_saved-189"><a href="#HeaderTemplate.from_saved-189"><span class="linenos">189</span></a>            <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.cols" class="classattr">
                                        <input id="HeaderTemplate.cols-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">cols</span><span class="annotation">: int</span>

                <label class="view-source-button" for="HeaderTemplate.cols-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cols"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cols-191"><a href="#HeaderTemplate.cols-191"><span class="linenos">191</span></a>    <span class="nd">@property</span>
</span><span id="HeaderTemplate.cols-192"><a href="#HeaderTemplate.cols-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate.cols-193"><a href="#HeaderTemplate.cols-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.rows" class="classattr">
                                        <input id="HeaderTemplate.rows-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">rows</span><span class="annotation">: int</span>

                <label class="view-source-button" for="HeaderTemplate.rows-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.rows"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.rows-195"><a href="#HeaderTemplate.rows-195"><span class="linenos">195</span></a>    <span class="nd">@property</span>
</span><span id="HeaderTemplate.rows-196"><a href="#HeaderTemplate.rows-196"><span class="linenos">196</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate.rows-197"><a href="#HeaderTemplate.rows-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.annotate_image" class="classattr">
                                        <input id="HeaderTemplate.annotate_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>
        <div class="decorator decorator-log_calls">@log_calls(level=logging.DEBUG)</div>

        <span class="def">def</span>
        <span class="name">annotate_image</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">template</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n"><a href="#HeaderTemplate">HeaderTemplate</a></span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.annotate_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.annotate_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.annotate_image-199"><a href="#HeaderTemplate.annotate_image-199"><span class="linenos">199</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate.annotate_image-200"><a href="#HeaderTemplate.annotate_image-200"><span class="linenos">200</span></a>    <span class="nd">@log_calls</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-201"><a href="#HeaderTemplate.annotate_image-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">annotate_image</span><span class="p">(</span>
</span><span id="HeaderTemplate.annotate_image-202"><a href="#HeaderTemplate.annotate_image-202"><span class="linenos">202</span></a>        <span class="n">template</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="HeaderTemplate.annotate_image-203"><a href="#HeaderTemplate.annotate_image-203"><span class="linenos">203</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-204"><a href="#HeaderTemplate.annotate_image-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.annotate_image-205"><a href="#HeaderTemplate.annotate_image-205"><span class="linenos">205</span></a><span class="sd">        Utility method that allows users to create a template form a template image.</span>
</span><span id="HeaderTemplate.annotate_image-206"><a href="#HeaderTemplate.annotate_image-206"><span class="linenos">206</span></a>
</span><span id="HeaderTemplate.annotate_image-207"><a href="#HeaderTemplate.annotate_image-207"><span class="linenos">207</span></a><span class="sd">        The user is asked to click to annotate lines (two clicks per line).</span>
</span><span id="HeaderTemplate.annotate_image-208"><a href="#HeaderTemplate.annotate_image-208"><span class="linenos">208</span></a>
</span><span id="HeaderTemplate.annotate_image-209"><a href="#HeaderTemplate.annotate_image-209"><span class="linenos">209</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate.annotate_image-210"><a href="#HeaderTemplate.annotate_image-210"><span class="linenos">210</span></a><span class="sd">            template: the image on which to annotate the header lines</span>
</span><span id="HeaderTemplate.annotate_image-211"><a href="#HeaderTemplate.annotate_image-211"><span class="linenos">211</span></a><span class="sd">            crop (str | None): if str, crop the template image first, then do the annotation.</span>
</span><span id="HeaderTemplate.annotate_image-212"><a href="#HeaderTemplate.annotate_image-212"><span class="linenos">212</span></a><span class="sd">                The cropped image will be stored at the supplied path</span>
</span><span id="HeaderTemplate.annotate_image-213"><a href="#HeaderTemplate.annotate_image-213"><span class="linenos">213</span></a><span class="sd">            margin (int): margin to add around the cropping of the header</span>
</span><span id="HeaderTemplate.annotate_image-214"><a href="#HeaderTemplate.annotate_image-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.annotate_image-215"><a href="#HeaderTemplate.annotate_image-215"><span class="linenos">215</span></a>
</span><span id="HeaderTemplate.annotate_image-216"><a href="#HeaderTemplate.annotate_image-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-217"><a href="#HeaderTemplate.annotate_image-217"><span class="linenos">217</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-218"><a href="#HeaderTemplate.annotate_image-218"><span class="linenos">218</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HeaderTemplate.annotate_image-219"><a href="#HeaderTemplate.annotate_image-219"><span class="linenos">219</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">MatLike</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-220"><a href="#HeaderTemplate.annotate_image-220"><span class="linenos">220</span></a>
</span><span id="HeaderTemplate.annotate_image-221"><a href="#HeaderTemplate.annotate_image-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="n">crop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-222"><a href="#HeaderTemplate.annotate_image-222"><span class="linenos">222</span></a>            <span class="n">cropped</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">_crop</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">margin</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-223"><a href="#HeaderTemplate.annotate_image-223"><span class="linenos">223</span></a>            <span class="n">cv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">crop</span><span class="p">),</span> <span class="n">cropped</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-224"><a href="#HeaderTemplate.annotate_image-224"><span class="linenos">224</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">cropped</span>
</span><span id="HeaderTemplate.annotate_image-225"><a href="#HeaderTemplate.annotate_image-225"><span class="linenos">225</span></a>
</span><span id="HeaderTemplate.annotate_image-226"><a href="#HeaderTemplate.annotate_image-226"><span class="linenos">226</span></a>        <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.annotate_image-227"><a href="#HeaderTemplate.annotate_image-227"><span class="linenos">227</span></a>        <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HeaderTemplate.annotate_image-228"><a href="#HeaderTemplate.annotate_image-228"><span class="linenos">228</span></a>
</span><span id="HeaderTemplate.annotate_image-229"><a href="#HeaderTemplate.annotate_image-229"><span class="linenos">229</span></a>        <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-230"><a href="#HeaderTemplate.annotate_image-230"><span class="linenos">230</span></a>
</span><span id="HeaderTemplate.annotate_image-231"><a href="#HeaderTemplate.annotate_image-231"><span class="linenos">231</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_point</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="HeaderTemplate.annotate_image-232"><a href="#HeaderTemplate.annotate_image-232"><span class="linenos">232</span></a>            <span class="k">nonlocal</span> <span class="n">lines</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">anno_template</span>
</span><span id="HeaderTemplate.annotate_image-233"><a href="#HeaderTemplate.annotate_image-233"><span class="linenos">233</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="HeaderTemplate.annotate_image-234"><a href="#HeaderTemplate.annotate_image-234"><span class="linenos">234</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="HeaderTemplate.annotate_image-235"><a href="#HeaderTemplate.annotate_image-235"><span class="linenos">235</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-236"><a href="#HeaderTemplate.annotate_image-236"><span class="linenos">236</span></a>                <span class="k">if</span> <span class="n">start_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-237"><a href="#HeaderTemplate.annotate_image-237"><span class="linenos">237</span></a>                    <span class="n">line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
</span><span id="HeaderTemplate.annotate_image-238"><a href="#HeaderTemplate.annotate_image-238"><span class="linenos">238</span></a>
</span><span id="HeaderTemplate.annotate_image-239"><a href="#HeaderTemplate.annotate_image-239"><span class="linenos">239</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate.annotate_image-240"><a href="#HeaderTemplate.annotate_image-240"><span class="linenos">240</span></a>                        <span class="n">anno_template</span><span class="p">,</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate.annotate_image-241"><a href="#HeaderTemplate.annotate_image-241"><span class="linenos">241</span></a>                        <span class="p">(</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="HeaderTemplate.annotate_image-242"><a href="#HeaderTemplate.annotate_image-242"><span class="linenos">242</span></a>                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</span><span id="HeaderTemplate.annotate_image-243"><a href="#HeaderTemplate.annotate_image-243"><span class="linenos">243</span></a>                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate.annotate_image-244"><a href="#HeaderTemplate.annotate_image-244"><span class="linenos">244</span></a>                        <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate.annotate_image-245"><a href="#HeaderTemplate.annotate_image-245"><span class="linenos">245</span></a>                        <span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span>
</span><span id="HeaderTemplate.annotate_image-246"><a href="#HeaderTemplate.annotate_image-246"><span class="linenos">246</span></a>                    <span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-247"><a href="#HeaderTemplate.annotate_image-247"><span class="linenos">247</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">anno_template</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="HeaderTemplate.annotate_image-248"><a href="#HeaderTemplate.annotate_image-248"><span class="linenos">248</span></a>
</span><span id="HeaderTemplate.annotate_image-249"><a href="#HeaderTemplate.annotate_image-249"><span class="linenos">249</span></a>                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-250"><a href="#HeaderTemplate.annotate_image-250"><span class="linenos">250</span></a>                    <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.annotate_image-251"><a href="#HeaderTemplate.annotate_image-251"><span class="linenos">251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-252"><a href="#HeaderTemplate.annotate_image-252"><span class="linenos">252</span></a>                    <span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-253"><a href="#HeaderTemplate.annotate_image-253"><span class="linenos">253</span></a>            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-254"><a href="#HeaderTemplate.annotate_image-254"><span class="linenos">254</span></a>                <span class="n">start_point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.annotate_image-255"><a href="#HeaderTemplate.annotate_image-255"><span class="linenos">255</span></a>
</span><span id="HeaderTemplate.annotate_image-256"><a href="#HeaderTemplate.annotate_image-256"><span class="linenos">256</span></a>                <span class="c1"># remove the last annotation</span>
</span><span id="HeaderTemplate.annotate_image-257"><a href="#HeaderTemplate.annotate_image-257"><span class="linenos">257</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate.annotate_image-258"><a href="#HeaderTemplate.annotate_image-258"><span class="linenos">258</span></a>
</span><span id="HeaderTemplate.annotate_image-259"><a href="#HeaderTemplate.annotate_image-259"><span class="linenos">259</span></a>                <span class="n">anno_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">anno_template</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-260"><a href="#HeaderTemplate.annotate_image-260"><span class="linenos">260</span></a>
</span><span id="HeaderTemplate.annotate_image-261"><a href="#HeaderTemplate.annotate_image-261"><span class="linenos">261</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="HeaderTemplate.annotate_image-262"><a href="#HeaderTemplate.annotate_image-262"><span class="linenos">262</span></a>                    <span class="n">cv</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="HeaderTemplate.annotate_image-263"><a href="#HeaderTemplate.annotate_image-263"><span class="linenos">263</span></a>                        <span class="n">template</span><span class="p">,</span>
</span><span id="HeaderTemplate.annotate_image-264"><a href="#HeaderTemplate.annotate_image-264"><span class="linenos">264</span></a>                        <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="HeaderTemplate.annotate_image-265"><a href="#HeaderTemplate.annotate_image-265"><span class="linenos">265</span></a>                        <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
</span><span id="HeaderTemplate.annotate_image-266"><a href="#HeaderTemplate.annotate_image-266"><span class="linenos">266</span></a>                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HeaderTemplate.annotate_image-267"><a href="#HeaderTemplate.annotate_image-267"><span class="linenos">267</span></a>                        <span class="mi">2</span><span class="p">,</span>
</span><span id="HeaderTemplate.annotate_image-268"><a href="#HeaderTemplate.annotate_image-268"><span class="linenos">268</span></a>                        <span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span>
</span><span id="HeaderTemplate.annotate_image-269"><a href="#HeaderTemplate.annotate_image-269"><span class="linenos">269</span></a>                    <span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-270"><a href="#HeaderTemplate.annotate_image-270"><span class="linenos">270</span></a>
</span><span id="HeaderTemplate.annotate_image-271"><a href="#HeaderTemplate.annotate_image-271"><span class="linenos">271</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-272"><a href="#HeaderTemplate.annotate_image-272"><span class="linenos">272</span></a>
</span><span id="HeaderTemplate.annotate_image-273"><a href="#HeaderTemplate.annotate_image-273"><span class="linenos">273</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">ANNO_HELP</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-274"><a href="#HeaderTemplate.annotate_image-274"><span class="linenos">274</span></a>
</span><span id="HeaderTemplate.annotate_image-275"><a href="#HeaderTemplate.annotate_image-275"><span class="linenos">275</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">anno_template</span><span class="p">,</span> <span class="n">get_point</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;annotate the header&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate.annotate_image-276"><a href="#HeaderTemplate.annotate_image-276"><span class="linenos">276</span></a>
</span><span id="HeaderTemplate.annotate_image-277"><a href="#HeaderTemplate.annotate_image-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Utility method that allows users to create a template form a template image.</p>

<p>The user is asked to click to annotate lines (two clicks per line).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>template:</strong>  the image on which to annotate the header lines</li>
<li><strong>crop (str | None):</strong>  if str, crop the template image first, then do the annotation.
The cropped image will be stored at the supplied path</li>
<li><strong>margin (int):</strong>  margin to add around the cropping of the header</li>
</ul>
</div>


                            </div>
                            <div id="HeaderTemplate.from_vgg_annotation" class="classattr">
                                        <input id="HeaderTemplate.from_vgg_annotation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_vgg_annotation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">annotation</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#HeaderTemplate">HeaderTemplate</a></span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.from_vgg_annotation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.from_vgg_annotation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.from_vgg_annotation-359"><a href="#HeaderTemplate.from_vgg_annotation-359"><span class="linenos">359</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HeaderTemplate.from_vgg_annotation-360"><a href="#HeaderTemplate.from_vgg_annotation-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_vgg_annotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HeaderTemplate&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-361"><a href="#HeaderTemplate.from_vgg_annotation-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.from_vgg_annotation-362"><a href="#HeaderTemplate.from_vgg_annotation-362"><span class="linenos">362</span></a><span class="sd">        Create a TableTemplate from annotations made in [vgg](https://annotate.officialstatistics.org/), using the polylines tool.</span>
</span><span id="HeaderTemplate.from_vgg_annotation-363"><a href="#HeaderTemplate.from_vgg_annotation-363"><span class="linenos">363</span></a>
</span><span id="HeaderTemplate.from_vgg_annotation-364"><a href="#HeaderTemplate.from_vgg_annotation-364"><span class="linenos">364</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-365"><a href="#HeaderTemplate.from_vgg_annotation-365"><span class="linenos">365</span></a><span class="sd">            annotation (str): the path of the annotation csv file</span>
</span><span id="HeaderTemplate.from_vgg_annotation-366"><a href="#HeaderTemplate.from_vgg_annotation-366"><span class="linenos">366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.from_vgg_annotation-367"><a href="#HeaderTemplate.from_vgg_annotation-367"><span class="linenos">367</span></a>
</span><span id="HeaderTemplate.from_vgg_annotation-368"><a href="#HeaderTemplate.from_vgg_annotation-368"><span class="linenos">368</span></a>        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HeaderTemplate.from_vgg_annotation-369"><a href="#HeaderTemplate.from_vgg_annotation-369"><span class="linenos">369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-370"><a href="#HeaderTemplate.from_vgg_annotation-370"><span class="linenos">370</span></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
</span><span id="HeaderTemplate.from_vgg_annotation-371"><a href="#HeaderTemplate.from_vgg_annotation-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-372"><a href="#HeaderTemplate.from_vgg_annotation-372"><span class="linenos">372</span></a>                <span class="n">shape_attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;region_shape_attributes&quot;</span><span class="p">])</span>
</span><span id="HeaderTemplate.from_vgg_annotation-373"><a href="#HeaderTemplate.from_vgg_annotation-373"><span class="linenos">373</span></a>                <span class="k">if</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;polyline&quot;</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-374"><a href="#HeaderTemplate.from_vgg_annotation-374"><span class="linenos">374</span></a>                    <span class="n">x_points</span> <span class="o">=</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;all_points_x&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate.from_vgg_annotation-375"><a href="#HeaderTemplate.from_vgg_annotation-375"><span class="linenos">375</span></a>                    <span class="n">y_points</span> <span class="o">=</span> <span class="n">shape_attributes</span><span class="p">[</span><span class="s2">&quot;all_points_y&quot;</span><span class="p">]</span>
</span><span id="HeaderTemplate.from_vgg_annotation-376"><a href="#HeaderTemplate.from_vgg_annotation-376"><span class="linenos">376</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="HeaderTemplate.from_vgg_annotation-377"><a href="#HeaderTemplate.from_vgg_annotation-377"><span class="linenos">377</span></a>                        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="HeaderTemplate.from_vgg_annotation-378"><a href="#HeaderTemplate.from_vgg_annotation-378"><span class="linenos">378</span></a>                            <span class="p">[</span><span class="n">x_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_points</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="HeaderTemplate.from_vgg_annotation-379"><a href="#HeaderTemplate.from_vgg_annotation-379"><span class="linenos">379</span></a>                        <span class="p">)</span>
</span><span id="HeaderTemplate.from_vgg_annotation-380"><a href="#HeaderTemplate.from_vgg_annotation-380"><span class="linenos">380</span></a>
</span><span id="HeaderTemplate.from_vgg_annotation-381"><a href="#HeaderTemplate.from_vgg_annotation-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">HeaderTemplate</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a TableTemplate from annotations made in <a href="https://annotate.officialstatistics.org/">vgg</a>, using the polylines tool.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>annotation (str):</strong>  the path of the annotation csv file</li>
</ul>
</div>


                            </div>
                            <div id="HeaderTemplate.cell_width" class="classattr">
                                        <input id="HeaderTemplate.cell_width-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_width</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell_width-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell_width"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell_width-383"><a href="#HeaderTemplate.cell_width-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate.cell_width-384"><a href="#HeaderTemplate.cell_width-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_width-385"><a href="#HeaderTemplate.cell_width-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.cell_widths" class="classattr">
                                        <input id="HeaderTemplate.cell_widths-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_widths</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell_widths-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell_widths"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell_widths-387"><a href="#HeaderTemplate.cell_widths-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate.cell_widths-388"><a href="#HeaderTemplate.cell_widths-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)]</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.cell_height" class="classattr">
                                        <input id="HeaderTemplate.cell_height-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_height</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">header_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell_height-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell_height"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell_height-390"><a href="#HeaderTemplate.cell_height-390"><span class="linenos">390</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="HeaderTemplate.cell_height-391"><a href="#HeaderTemplate.cell_height-391"><span class="linenos">391</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">header_factor</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.cell_heights" class="classattr">
                                        <input id="HeaderTemplate.cell_heights-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_heights</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">header_factors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell_heights-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell_heights"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell_heights-393"><a href="#HeaderTemplate.cell_heights-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_heights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_factors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate.cell_heights-394"><a href="#HeaderTemplate.cell_heights-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_factors</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="HeaderTemplate.cell_heights-395"><a href="#HeaderTemplate.cell_heights-395"><span class="linenos">395</span></a>            <span class="n">header_factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">header_factors</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_heights-396"><a href="#HeaderTemplate.cell_heights-396"><span class="linenos">396</span></a>        <span class="n">header_factors</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">header_factors</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_heights-397"><a href="#HeaderTemplate.cell_heights-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="HeaderTemplate.cell_heights-398"><a href="#HeaderTemplate.cell_heights-398"><span class="linenos">398</span></a>            <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">header_factors</span>
</span><span id="HeaderTemplate.cell_heights-399"><a href="#HeaderTemplate.cell_heights-399"><span class="linenos">399</span></a>        <span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="HeaderTemplate.intersection" class="classattr">
                                        <input id="HeaderTemplate.intersection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersection</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">index</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.intersection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.intersection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.intersection-401"><a href="#HeaderTemplate.intersection-401"><span class="linenos">401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="HeaderTemplate.intersection-402"><a href="#HeaderTemplate.intersection-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.intersection-403"><a href="#HeaderTemplate.intersection-403"><span class="linenos">403</span></a><span class="sd">        Returns the interaction of the index[0]th horizontal rule and the</span>
</span><span id="HeaderTemplate.intersection-404"><a href="#HeaderTemplate.intersection-404"><span class="linenos">404</span></a><span class="sd">        index[1]th vertical rule</span>
</span><span id="HeaderTemplate.intersection-405"><a href="#HeaderTemplate.intersection-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.intersection-406"><a href="#HeaderTemplate.intersection-406"><span class="linenos">406</span></a>
</span><span id="HeaderTemplate.intersection-407"><a href="#HeaderTemplate.intersection-407"><span class="linenos">407</span></a>        <span class="n">ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="HeaderTemplate.intersection-408"><a href="#HeaderTemplate.intersection-408"><span class="linenos">408</span></a>        <span class="k">assert</span> <span class="n">ints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.intersection-409"><a href="#HeaderTemplate.intersection-409"><span class="linenos">409</span></a>        <span class="k">return</span> <span class="n">ints</span>
</span></pre></div>


            <div class="docstring"><p>Returns the interaction of the index[0]th horizontal rule and the
index[1]th vertical rule</p>
</div>


                            </div>
                            <div id="HeaderTemplate.cell" class="classattr">
                                        <input id="HeaderTemplate.cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell-411"><a href="#HeaderTemplate.cell-411"><span class="linenos">411</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="HeaderTemplate.cell-412"><a href="#HeaderTemplate.cell-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.cell-413"><a href="#HeaderTemplate.cell-413"><span class="linenos">413</span></a><span class="sd">        Get the cell index (row, col) that corresponds with the point (x, y) in the template image</span>
</span><span id="HeaderTemplate.cell-414"><a href="#HeaderTemplate.cell-414"><span class="linenos">414</span></a>
</span><span id="HeaderTemplate.cell-415"><a href="#HeaderTemplate.cell-415"><span class="linenos">415</span></a><span class="sd">        Args:</span>
</span><span id="HeaderTemplate.cell-416"><a href="#HeaderTemplate.cell-416"><span class="linenos">416</span></a><span class="sd">            point (tuple[float, float]): the coordinates in the template image</span>
</span><span id="HeaderTemplate.cell-417"><a href="#HeaderTemplate.cell-417"><span class="linenos">417</span></a>
</span><span id="HeaderTemplate.cell-418"><a href="#HeaderTemplate.cell-418"><span class="linenos">418</span></a><span class="sd">        Returns:</span>
</span><span id="HeaderTemplate.cell-419"><a href="#HeaderTemplate.cell-419"><span class="linenos">419</span></a><span class="sd">            tuple[int, int]: (row, col)</span>
</span><span id="HeaderTemplate.cell-420"><a href="#HeaderTemplate.cell-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.cell-421"><a href="#HeaderTemplate.cell-421"><span class="linenos">421</span></a>
</span><span id="HeaderTemplate.cell-422"><a href="#HeaderTemplate.cell-422"><span class="linenos">422</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
</span><span id="HeaderTemplate.cell-423"><a href="#HeaderTemplate.cell-423"><span class="linenos">423</span></a>
</span><span id="HeaderTemplate.cell-424"><a href="#HeaderTemplate.cell-424"><span class="linenos">424</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="HeaderTemplate.cell-425"><a href="#HeaderTemplate.cell-425"><span class="linenos">425</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="HeaderTemplate.cell-426"><a href="#HeaderTemplate.cell-426"><span class="linenos">426</span></a>
</span><span id="HeaderTemplate.cell-427"><a href="#HeaderTemplate.cell-427"><span class="linenos">427</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
</span><span id="HeaderTemplate.cell-428"><a href="#HeaderTemplate.cell-428"><span class="linenos">428</span></a>            <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell-429"><a href="#HeaderTemplate.cell-429"><span class="linenos">429</span></a>            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_y_at_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell-430"><a href="#HeaderTemplate.cell-430"><span class="linenos">430</span></a>            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
</span><span id="HeaderTemplate.cell-431"><a href="#HeaderTemplate.cell-431"><span class="linenos">431</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="HeaderTemplate.cell-432"><a href="#HeaderTemplate.cell-432"><span class="linenos">432</span></a>                <span class="k">break</span>
</span><span id="HeaderTemplate.cell-433"><a href="#HeaderTemplate.cell-433"><span class="linenos">433</span></a>
</span><span id="HeaderTemplate.cell-434"><a href="#HeaderTemplate.cell-434"><span class="linenos">434</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="HeaderTemplate.cell-435"><a href="#HeaderTemplate.cell-435"><span class="linenos">435</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell-436"><a href="#HeaderTemplate.cell-436"><span class="linenos">436</span></a>            <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_x_at_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell-437"><a href="#HeaderTemplate.cell-437"><span class="linenos">437</span></a>            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
</span><span id="HeaderTemplate.cell-438"><a href="#HeaderTemplate.cell-438"><span class="linenos">438</span></a>                <span class="n">col</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="HeaderTemplate.cell-439"><a href="#HeaderTemplate.cell-439"><span class="linenos">439</span></a>                <span class="k">break</span>
</span><span id="HeaderTemplate.cell-440"><a href="#HeaderTemplate.cell-440"><span class="linenos">440</span></a>
</span><span id="HeaderTemplate.cell-441"><a href="#HeaderTemplate.cell-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">col</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="HeaderTemplate.cell-442"><a href="#HeaderTemplate.cell-442"><span class="linenos">442</span></a>            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell-443"><a href="#HeaderTemplate.cell-443"><span class="linenos">443</span></a>
</span><span id="HeaderTemplate.cell-444"><a href="#HeaderTemplate.cell-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the cell index (row, col) that corresponds with the point (x, y) in the template image</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>point (tuple[float, float]):</strong>  the coordinates in the template image</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[int, int]: (row, col)</p>
</blockquote>
</div>


                            </div>
                            <div id="HeaderTemplate.cell_polygon" class="classattr">
                                        <input id="HeaderTemplate.cell_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cell_polygon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.cell_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.cell_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.cell_polygon-446"><a href="#HeaderTemplate.cell_polygon-446"><span class="linenos">446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span>
</span><span id="HeaderTemplate.cell_polygon-447"><a href="#HeaderTemplate.cell_polygon-447"><span class="linenos">447</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-448"><a href="#HeaderTemplate.cell_polygon-448"><span class="linenos">448</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="HeaderTemplate.cell_polygon-449"><a href="#HeaderTemplate.cell_polygon-449"><span class="linenos">449</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.cell_polygon-450"><a href="#HeaderTemplate.cell_polygon-450"><span class="linenos">450</span></a><span class="sd">        Return points (x,y) that make up a polygon around the requested cell</span>
</span><span id="HeaderTemplate.cell_polygon-451"><a href="#HeaderTemplate.cell_polygon-451"><span class="linenos">451</span></a><span class="sd">        (top left, top right, bottom right, bottom left)</span>
</span><span id="HeaderTemplate.cell_polygon-452"><a href="#HeaderTemplate.cell_polygon-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeaderTemplate.cell_polygon-453"><a href="#HeaderTemplate.cell_polygon-453"><span class="linenos">453</span></a>
</span><span id="HeaderTemplate.cell_polygon-454"><a href="#HeaderTemplate.cell_polygon-454"><span class="linenos">454</span></a>        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="HeaderTemplate.cell_polygon-455"><a href="#HeaderTemplate.cell_polygon-455"><span class="linenos">455</span></a>
</span><span id="HeaderTemplate.cell_polygon-456"><a href="#HeaderTemplate.cell_polygon-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-457"><a href="#HeaderTemplate.cell_polygon-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-458"><a href="#HeaderTemplate.cell_polygon-458"><span class="linenos">458</span></a>
</span><span id="HeaderTemplate.cell_polygon-459"><a href="#HeaderTemplate.cell_polygon-459"><span class="linenos">459</span></a>        <span class="n">top_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-460"><a href="#HeaderTemplate.cell_polygon-460"><span class="linenos">460</span></a>        <span class="n">bottom_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-461"><a href="#HeaderTemplate.cell_polygon-461"><span class="linenos">461</span></a>        <span class="n">left_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-462"><a href="#HeaderTemplate.cell_polygon-462"><span class="linenos">462</span></a>        <span class="n">right_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-463"><a href="#HeaderTemplate.cell_polygon-463"><span class="linenos">463</span></a>
</span><span id="HeaderTemplate.cell_polygon-464"><a href="#HeaderTemplate.cell_polygon-464"><span class="linenos">464</span></a>        <span class="c1"># Calculate corner points using intersections</span>
</span><span id="HeaderTemplate.cell_polygon-465"><a href="#HeaderTemplate.cell_polygon-465"><span class="linenos">465</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-466"><a href="#HeaderTemplate.cell_polygon-466"><span class="linenos">466</span></a>        <span class="n">top_right</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-467"><a href="#HeaderTemplate.cell_polygon-467"><span class="linenos">467</span></a>        <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-468"><a href="#HeaderTemplate.cell_polygon-468"><span class="linenos">468</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-469"><a href="#HeaderTemplate.cell_polygon-469"><span class="linenos">469</span></a>
</span><span id="HeaderTemplate.cell_polygon-470"><a href="#HeaderTemplate.cell_polygon-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="HeaderTemplate.cell_polygon-471"><a href="#HeaderTemplate.cell_polygon-471"><span class="linenos">471</span></a>            <span class="p">[</span>
</span><span id="HeaderTemplate.cell_polygon-472"><a href="#HeaderTemplate.cell_polygon-472"><span class="linenos">472</span></a>                <span class="n">point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.cell_polygon-473"><a href="#HeaderTemplate.cell_polygon-473"><span class="linenos">473</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="p">[</span><span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-474"><a href="#HeaderTemplate.cell_polygon-474"><span class="linenos">474</span></a>            <span class="p">]</span>
</span><span id="HeaderTemplate.cell_polygon-475"><a href="#HeaderTemplate.cell_polygon-475"><span class="linenos">475</span></a>        <span class="p">):</span>
</span><span id="HeaderTemplate.cell_polygon-476"><a href="#HeaderTemplate.cell_polygon-476"><span class="linenos">476</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;the lines around this cell do not intersect&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate.cell_polygon-477"><a href="#HeaderTemplate.cell_polygon-477"><span class="linenos">477</span></a>
</span><span id="HeaderTemplate.cell_polygon-478"><a href="#HeaderTemplate.cell_polygon-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">,</span> <span class="n">bottom_left</span>  <span class="c1"># type:ignore</span>
</span></pre></div>


            <div class="docstring"><p>Return points (x,y) that make up a polygon around the requested cell
(top left, top right, bottom right, bottom left)</p>
</div>


                            </div>
                            <div id="HeaderTemplate.region" class="classattr">
                                        <input id="HeaderTemplate.region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">region</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.region-480"><a href="#HeaderTemplate.region-480"><span class="linenos">480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="HeaderTemplate.region-481"><a href="#HeaderTemplate.region-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="HeaderTemplate.region-482"><a href="#HeaderTemplate.region-482"><span class="linenos">482</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="HeaderTemplate.region-483"><a href="#HeaderTemplate.region-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate.region-484"><a href="#HeaderTemplate.region-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_row_idx</span><span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="HeaderTemplate.region-485"><a href="#HeaderTemplate.region-485"><span class="linenos">485</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate.region-486"><a href="#HeaderTemplate.region-486"><span class="linenos">486</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_col_idx</span><span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="HeaderTemplate.region-487"><a href="#HeaderTemplate.region-487"><span class="linenos">487</span></a>
</span><span id="HeaderTemplate.region-488"><a href="#HeaderTemplate.region-488"><span class="linenos">488</span></a>        <span class="c1"># the rules that surround this row</span>
</span><span id="HeaderTemplate.region-489"><a href="#HeaderTemplate.region-489"><span class="linenos">489</span></a>        <span class="n">top_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="HeaderTemplate.region-490"><a href="#HeaderTemplate.region-490"><span class="linenos">490</span></a>        <span class="n">bottom_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_rules</span><span class="p">[</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate.region-491"><a href="#HeaderTemplate.region-491"><span class="linenos">491</span></a>        <span class="n">left_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="HeaderTemplate.region-492"><a href="#HeaderTemplate.region-492"><span class="linenos">492</span></a>        <span class="n">right_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_rules</span><span class="p">[</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="HeaderTemplate.region-493"><a href="#HeaderTemplate.region-493"><span class="linenos">493</span></a>
</span><span id="HeaderTemplate.region-494"><a href="#HeaderTemplate.region-494"><span class="linenos">494</span></a>        <span class="c1"># four points that will be the bounding polygon of the result,</span>
</span><span id="HeaderTemplate.region-495"><a href="#HeaderTemplate.region-495"><span class="linenos">495</span></a>        <span class="c1"># which needs to be rectified</span>
</span><span id="HeaderTemplate.region-496"><a href="#HeaderTemplate.region-496"><span class="linenos">496</span></a>        <span class="n">top_left</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.region-497"><a href="#HeaderTemplate.region-497"><span class="linenos">497</span></a>        <span class="n">top_right</span> <span class="o">=</span> <span class="n">top_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.region-498"><a href="#HeaderTemplate.region-498"><span class="linenos">498</span></a>        <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">left_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.region-499"><a href="#HeaderTemplate.region-499"><span class="linenos">499</span></a>        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">bottom_rule</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_rule</span><span class="p">)</span>
</span><span id="HeaderTemplate.region-500"><a href="#HeaderTemplate.region-500"><span class="linenos">500</span></a>
</span><span id="HeaderTemplate.region-501"><a href="#HeaderTemplate.region-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="HeaderTemplate.region-502"><a href="#HeaderTemplate.region-502"><span class="linenos">502</span></a>            <span class="n">top_left</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.region-503"><a href="#HeaderTemplate.region-503"><span class="linenos">503</span></a>            <span class="ow">or</span> <span class="n">top_right</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.region-504"><a href="#HeaderTemplate.region-504"><span class="linenos">504</span></a>            <span class="ow">or</span> <span class="n">bottom_left</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.region-505"><a href="#HeaderTemplate.region-505"><span class="linenos">505</span></a>            <span class="ow">or</span> <span class="n">bottom_right</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="HeaderTemplate.region-506"><a href="#HeaderTemplate.region-506"><span class="linenos">506</span></a>        <span class="p">):</span>
</span><span id="HeaderTemplate.region-507"><a href="#HeaderTemplate.region-507"><span class="linenos">507</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;the lines around this row do not intersect properly&quot;</span><span class="p">)</span>
</span><span id="HeaderTemplate.region-508"><a href="#HeaderTemplate.region-508"><span class="linenos">508</span></a>
</span><span id="HeaderTemplate.region-509"><a href="#HeaderTemplate.region-509"><span class="linenos">509</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">to_point</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
</span><span id="HeaderTemplate.region-510"><a href="#HeaderTemplate.region-510"><span class="linenos">510</span></a>            <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="HeaderTemplate.region-511"><a href="#HeaderTemplate.region-511"><span class="linenos">511</span></a>
</span><span id="HeaderTemplate.region-512"><a href="#HeaderTemplate.region-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="HeaderTemplate.region-513"><a href="#HeaderTemplate.region-513"><span class="linenos">513</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">top_left</span><span class="p">),</span>
</span><span id="HeaderTemplate.region-514"><a href="#HeaderTemplate.region-514"><span class="linenos">514</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">top_right</span><span class="p">),</span>
</span><span id="HeaderTemplate.region-515"><a href="#HeaderTemplate.region-515"><span class="linenos">515</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">bottom_right</span><span class="p">),</span>
</span><span id="HeaderTemplate.region-516"><a href="#HeaderTemplate.region-516"><span class="linenos">516</span></a>            <span class="n">to_point</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">),</span>
</span><span id="HeaderTemplate.region-517"><a href="#HeaderTemplate.region-517"><span class="linenos">517</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the bounding box for the rectangular region that goes from start to end</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>4 points: lt, rt, rb, lb, in format (x, y)</p>
</blockquote>
</div>


                            </div>
                            <div id="HeaderTemplate.text_regions" class="classattr">
                                        <input id="HeaderTemplate.text_regions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">text_regions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">row</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="HeaderTemplate.text_regions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeaderTemplate.text_regions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeaderTemplate.text_regions-519"><a href="#HeaderTemplate.text_regions-519"><span class="linenos">519</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="HeaderTemplate.text_regions-520"><a href="#HeaderTemplate.text_regions-520"><span class="linenos">520</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="HeaderTemplate.text_regions-521"><a href="#HeaderTemplate.text_regions-521"><span class="linenos">521</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="HeaderTemplate.text_regions-522"><a href="#HeaderTemplate.text_regions-522"><span class="linenos">522</span></a>        <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;text_regions should not be called on a HeaderTemplate&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Split the row into regions of continuous text</p>

<p>Returns
    list[tuple[int, int]]: a list of spans (start col, end col)</p>
</div>


                            </div>
                </section>
                <section id="TableIndexer">
                            <input id="TableIndexer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TableIndexer</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="TableIndexer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer-72"><a href="#TableIndexer-72"><span class="linenos"> 72</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TableIndexer</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="TableIndexer-73"><a href="#TableIndexer-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer-74"><a href="#TableIndexer-74"><span class="linenos"> 74</span></a><span class="sd">    Subclasses implement methods for going from a pixel in the input image to a table cell index,</span>
</span><span id="TableIndexer-75"><a href="#TableIndexer-75"><span class="linenos"> 75</span></a><span class="sd">    and cropping an image to the given table cell index.</span>
</span><span id="TableIndexer-76"><a href="#TableIndexer-76"><span class="linenos"> 76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TableIndexer-77"><a href="#TableIndexer-77"><span class="linenos"> 77</span></a>
</span><span id="TableIndexer-78"><a href="#TableIndexer-78"><span class="linenos"> 78</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TableIndexer-79"><a href="#TableIndexer-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_col_offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TableIndexer-80"><a href="#TableIndexer-80"><span class="linenos"> 80</span></a>
</span><span id="TableIndexer-81"><a href="#TableIndexer-81"><span class="linenos"> 81</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer-82"><a href="#TableIndexer-82"><span class="linenos"> 82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">col_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer-83"><a href="#TableIndexer-83"><span class="linenos"> 83</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_offset</span>
</span><span id="TableIndexer-84"><a href="#TableIndexer-84"><span class="linenos"> 84</span></a>
</span><span id="TableIndexer-85"><a href="#TableIndexer-85"><span class="linenos"> 85</span></a>    <span class="nd">@col_offset</span><span class="o">.</span><span class="n">setter</span>
</span><span id="TableIndexer-86"><a href="#TableIndexer-86"><span class="linenos"> 86</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">col_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableIndexer-87"><a href="#TableIndexer-87"><span class="linenos"> 87</span></a>        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span>
</span><span id="TableIndexer-88"><a href="#TableIndexer-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_col_offset</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="TableIndexer-89"><a href="#TableIndexer-89"><span class="linenos"> 89</span></a>
</span><span id="TableIndexer-90"><a href="#TableIndexer-90"><span class="linenos"> 90</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer-91"><a href="#TableIndexer-91"><span class="linenos"> 91</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-92"><a href="#TableIndexer-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer-93"><a href="#TableIndexer-93"><span class="linenos"> 93</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-94"><a href="#TableIndexer-94"><span class="linenos"> 94</span></a>
</span><span id="TableIndexer-95"><a href="#TableIndexer-95"><span class="linenos"> 95</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer-96"><a href="#TableIndexer-96"><span class="linenos"> 96</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-97"><a href="#TableIndexer-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer-98"><a href="#TableIndexer-98"><span class="linenos"> 98</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-99"><a href="#TableIndexer-99"><span class="linenos"> 99</span></a>
</span><span id="TableIndexer-100"><a href="#TableIndexer-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cells</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="TableIndexer-101"><a href="#TableIndexer-101"><span class="linenos">101</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
</span><span id="TableIndexer-102"><a href="#TableIndexer-102"><span class="linenos">102</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="TableIndexer-103"><a href="#TableIndexer-103"><span class="linenos">103</span></a>                <span class="k">yield</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="TableIndexer-104"><a href="#TableIndexer-104"><span class="linenos">104</span></a>
</span><span id="TableIndexer-105"><a href="#TableIndexer-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_row_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableIndexer-106"><a href="#TableIndexer-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer-107"><a href="#TableIndexer-107"><span class="linenos">107</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;row number needs to be positive or zero&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-108"><a href="#TableIndexer-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
</span><span id="TableIndexer-109"><a href="#TableIndexer-109"><span class="linenos">109</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;row number too high: </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-110"><a href="#TableIndexer-110"><span class="linenos">110</span></a>
</span><span id="TableIndexer-111"><a href="#TableIndexer-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_col_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TableIndexer-112"><a href="#TableIndexer-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer-113"><a href="#TableIndexer-113"><span class="linenos">113</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;col number needs to be positive or zero&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-114"><a href="#TableIndexer-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span>
</span><span id="TableIndexer-115"><a href="#TableIndexer-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;col number too high: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-116"><a href="#TableIndexer-116"><span class="linenos">116</span></a>
</span><span id="TableIndexer-117"><a href="#TableIndexer-117"><span class="linenos">117</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-118"><a href="#TableIndexer-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TableIndexer-119"><a href="#TableIndexer-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer-120"><a href="#TableIndexer-120"><span class="linenos">120</span></a><span class="sd">        Returns the coordinate (row, col) of the cell that contains the given position</span>
</span><span id="TableIndexer-121"><a href="#TableIndexer-121"><span class="linenos">121</span></a>
</span><span id="TableIndexer-122"><a href="#TableIndexer-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="TableIndexer-123"><a href="#TableIndexer-123"><span class="linenos">123</span></a><span class="sd">            point (tuple[float, float]): a location in the input image</span>
</span><span id="TableIndexer-124"><a href="#TableIndexer-124"><span class="linenos">124</span></a>
</span><span id="TableIndexer-125"><a href="#TableIndexer-125"><span class="linenos">125</span></a><span class="sd">        Returns:</span>
</span><span id="TableIndexer-126"><a href="#TableIndexer-126"><span class="linenos">126</span></a><span class="sd">            tuple[int, int]: the cell index (row, col) that contains the given point</span>
</span><span id="TableIndexer-127"><a href="#TableIndexer-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer-128"><a href="#TableIndexer-128"><span class="linenos">128</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-129"><a href="#TableIndexer-129"><span class="linenos">129</span></a>
</span><span id="TableIndexer-130"><a href="#TableIndexer-130"><span class="linenos">130</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-131"><a href="#TableIndexer-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span>
</span><span id="TableIndexer-132"><a href="#TableIndexer-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="TableIndexer-133"><a href="#TableIndexer-133"><span class="linenos">133</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="TableIndexer-134"><a href="#TableIndexer-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the polygon (used in e.g. opencv) that enscribes the cell at the given cell position&quot;&quot;&quot;</span>
</span><span id="TableIndexer-135"><a href="#TableIndexer-135"><span class="linenos">135</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-136"><a href="#TableIndexer-136"><span class="linenos">136</span></a>
</span><span id="TableIndexer-137"><a href="#TableIndexer-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_highlight_cell</span><span class="p">(</span>
</span><span id="TableIndexer-138"><a href="#TableIndexer-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer-139"><a href="#TableIndexer-139"><span class="linenos">139</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer-140"><a href="#TableIndexer-140"><span class="linenos">140</span></a>        <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer-141"><a href="#TableIndexer-141"><span class="linenos">141</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="TableIndexer-142"><a href="#TableIndexer-142"><span class="linenos">142</span></a>        <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="TableIndexer-143"><a href="#TableIndexer-143"><span class="linenos">143</span></a>    <span class="p">):</span>
</span><span id="TableIndexer-144"><a href="#TableIndexer-144"><span class="linenos">144</span></a>        <span class="n">polygon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_polygon</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</span><span id="TableIndexer-145"><a href="#TableIndexer-145"><span class="linenos">145</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="p">))</span>  <span class="c1"># type:ignore</span>
</span><span id="TableIndexer-146"><a href="#TableIndexer-146"><span class="linenos">146</span></a>        <span class="n">cv</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">[</span><span class="n">points</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">)</span>  <span class="c1"># type:ignore</span>
</span><span id="TableIndexer-147"><a href="#TableIndexer-147"><span class="linenos">147</span></a>        <span class="n">cv</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
</span><span id="TableIndexer-148"><a href="#TableIndexer-148"><span class="linenos">148</span></a>            <span class="n">image</span><span class="p">,</span>
</span><span id="TableIndexer-149"><a href="#TableIndexer-149"><span class="linenos">149</span></a>            <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">),</span>
</span><span id="TableIndexer-150"><a href="#TableIndexer-150"><span class="linenos">150</span></a>            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)),</span>
</span><span id="TableIndexer-151"><a href="#TableIndexer-151"><span class="linenos">151</span></a>            <span class="n">cv</span><span class="o">.</span><span class="n">FONT_HERSHEY_PLAIN</span><span class="p">,</span>
</span><span id="TableIndexer-152"><a href="#TableIndexer-152"><span class="linenos">152</span></a>            <span class="mf">2.0</span><span class="p">,</span>
</span><span id="TableIndexer-153"><a href="#TableIndexer-153"><span class="linenos">153</span></a>            <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="TableIndexer-154"><a href="#TableIndexer-154"><span class="linenos">154</span></a>            <span class="mi">2</span><span class="p">,</span>
</span><span id="TableIndexer-155"><a href="#TableIndexer-155"><span class="linenos">155</span></a>        <span class="p">)</span>
</span><span id="TableIndexer-156"><a href="#TableIndexer-156"><span class="linenos">156</span></a>
</span><span id="TableIndexer-157"><a href="#TableIndexer-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">highlight_all_cells</span><span class="p">(</span>
</span><span id="TableIndexer-158"><a href="#TableIndexer-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer-159"><a href="#TableIndexer-159"><span class="linenos">159</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer-160"><a href="#TableIndexer-160"><span class="linenos">160</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="TableIndexer-161"><a href="#TableIndexer-161"><span class="linenos">161</span></a>        <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TableIndexer-162"><a href="#TableIndexer-162"><span class="linenos">162</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer-163"><a href="#TableIndexer-163"><span class="linenos">163</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer-164"><a href="#TableIndexer-164"><span class="linenos">164</span></a>
</span><span id="TableIndexer-165"><a href="#TableIndexer-165"><span class="linenos">165</span></a>        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">():</span>
</span><span id="TableIndexer-166"><a href="#TableIndexer-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</span><span id="TableIndexer-167"><a href="#TableIndexer-167"><span class="linenos">167</span></a>
</span><span id="TableIndexer-168"><a href="#TableIndexer-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">img</span>
</span><span id="TableIndexer-169"><a href="#TableIndexer-169"><span class="linenos">169</span></a>
</span><span id="TableIndexer-170"><a href="#TableIndexer-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_one_cell</span><span class="p">(</span>
</span><span id="TableIndexer-171"><a href="#TableIndexer-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer-172"><a href="#TableIndexer-172"><span class="linenos">172</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer-173"><a href="#TableIndexer-173"><span class="linenos">173</span></a>        <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span><span class="p">,</span>
</span><span id="TableIndexer-174"><a href="#TableIndexer-174"><span class="linenos">174</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="TableIndexer-175"><a href="#TableIndexer-175"><span class="linenos">175</span></a>        <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="TableIndexer-176"><a href="#TableIndexer-176"><span class="linenos">176</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableIndexer-177"><a href="#TableIndexer-177"><span class="linenos">177</span></a>        <span class="n">clicked</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TableIndexer-178"><a href="#TableIndexer-178"><span class="linenos">178</span></a>
</span><span id="TableIndexer-179"><a href="#TableIndexer-179"><span class="linenos">179</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">click_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="TableIndexer-180"><a href="#TableIndexer-180"><span class="linenos">180</span></a>            <span class="k">nonlocal</span> <span class="n">clicked</span>
</span><span id="TableIndexer-181"><a href="#TableIndexer-181"><span class="linenos">181</span></a>
</span><span id="TableIndexer-182"><a href="#TableIndexer-182"><span class="linenos">182</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer-183"><a href="#TableIndexer-183"><span class="linenos">183</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="TableIndexer-184"><a href="#TableIndexer-184"><span class="linenos">184</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="TableIndexer-185"><a href="#TableIndexer-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="TableIndexer-186"><a href="#TableIndexer-186"><span class="linenos">186</span></a>                <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="TableIndexer-187"><a href="#TableIndexer-187"><span class="linenos">187</span></a>                <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer-188"><a href="#TableIndexer-188"><span class="linenos">188</span></a>                    <span class="n">clicked</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="TableIndexer-189"><a href="#TableIndexer-189"><span class="linenos">189</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TableIndexer-190"><a href="#TableIndexer-190"><span class="linenos">190</span></a>                    <span class="k">return</span>
</span><span id="TableIndexer-191"><a href="#TableIndexer-191"><span class="linenos">191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</span><span id="TableIndexer-192"><a href="#TableIndexer-192"><span class="linenos">192</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="TableIndexer-193"><a href="#TableIndexer-193"><span class="linenos">193</span></a>
</span><span id="TableIndexer-194"><a href="#TableIndexer-194"><span class="linenos">194</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">click_event</span><span class="o">=</span><span class="n">click_event</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;select one cell&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
</span><span id="TableIndexer-195"><a href="#TableIndexer-195"><span class="linenos">195</span></a>
</span><span id="TableIndexer-196"><a href="#TableIndexer-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">clicked</span>
</span><span id="TableIndexer-197"><a href="#TableIndexer-197"><span class="linenos">197</span></a>
</span><span id="TableIndexer-198"><a href="#TableIndexer-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show_cells</span><span class="p">(</span>
</span><span id="TableIndexer-199"><a href="#TableIndexer-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span>
</span><span id="TableIndexer-200"><a href="#TableIndexer-200"><span class="linenos">200</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="TableIndexer-201"><a href="#TableIndexer-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="TableIndexer-202"><a href="#TableIndexer-202"><span class="linenos">202</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="TableIndexer-203"><a href="#TableIndexer-203"><span class="linenos">203</span></a>
</span><span id="TableIndexer-204"><a href="#TableIndexer-204"><span class="linenos">204</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer-205"><a href="#TableIndexer-205"><span class="linenos">205</span></a>
</span><span id="TableIndexer-206"><a href="#TableIndexer-206"><span class="linenos">206</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableIndexer-207"><a href="#TableIndexer-207"><span class="linenos">207</span></a>
</span><span id="TableIndexer-208"><a href="#TableIndexer-208"><span class="linenos">208</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">click_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="TableIndexer-209"><a href="#TableIndexer-209"><span class="linenos">209</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="TableIndexer-210"><a href="#TableIndexer-210"><span class="linenos">210</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="TableIndexer-211"><a href="#TableIndexer-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="TableIndexer-212"><a href="#TableIndexer-212"><span class="linenos">212</span></a>                <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="TableIndexer-213"><a href="#TableIndexer-213"><span class="linenos">213</span></a>                <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer-214"><a href="#TableIndexer-214"><span class="linenos">214</span></a>                    <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</span><span id="TableIndexer-215"><a href="#TableIndexer-215"><span class="linenos">215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TableIndexer-216"><a href="#TableIndexer-216"><span class="linenos">216</span></a>                    <span class="k">return</span>
</span><span id="TableIndexer-217"><a href="#TableIndexer-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="TableIndexer-218"><a href="#TableIndexer-218"><span class="linenos">218</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="TableIndexer-219"><a href="#TableIndexer-219"><span class="linenos">219</span></a>
</span><span id="TableIndexer-220"><a href="#TableIndexer-220"><span class="linenos">220</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
</span><span id="TableIndexer-221"><a href="#TableIndexer-221"><span class="linenos">221</span></a>            <span class="n">img</span><span class="p">,</span>
</span><span id="TableIndexer-222"><a href="#TableIndexer-222"><span class="linenos">222</span></a>            <span class="n">click_event</span><span class="o">=</span><span class="n">click_event</span><span class="p">,</span>
</span><span id="TableIndexer-223"><a href="#TableIndexer-223"><span class="linenos">223</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;click to highlight cells&quot;</span><span class="p">,</span>
</span><span id="TableIndexer-224"><a href="#TableIndexer-224"><span class="linenos">224</span></a>            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
</span><span id="TableIndexer-225"><a href="#TableIndexer-225"><span class="linenos">225</span></a>        <span class="p">)</span>
</span><span id="TableIndexer-226"><a href="#TableIndexer-226"><span class="linenos">226</span></a>
</span><span id="TableIndexer-227"><a href="#TableIndexer-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="n">cells</span>
</span><span id="TableIndexer-228"><a href="#TableIndexer-228"><span class="linenos">228</span></a>
</span><span id="TableIndexer-229"><a href="#TableIndexer-229"><span class="linenos">229</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-230"><a href="#TableIndexer-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="TableIndexer-231"><a href="#TableIndexer-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer-232"><a href="#TableIndexer-232"><span class="linenos">232</span></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer-233"><a href="#TableIndexer-233"><span class="linenos">233</span></a>        <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer-234"><a href="#TableIndexer-234"><span class="linenos">234</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableIndexer-235"><a href="#TableIndexer-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer-236"><a href="#TableIndexer-236"><span class="linenos">236</span></a><span class="sd">        Get the bounding box for the rectangular region that goes from start to end</span>
</span><span id="TableIndexer-237"><a href="#TableIndexer-237"><span class="linenos">237</span></a>
</span><span id="TableIndexer-238"><a href="#TableIndexer-238"><span class="linenos">238</span></a><span class="sd">        Returns:</span>
</span><span id="TableIndexer-239"><a href="#TableIndexer-239"><span class="linenos">239</span></a><span class="sd">            4 points: lt, rt, rb, lb, in format (x, y)</span>
</span><span id="TableIndexer-240"><a href="#TableIndexer-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer-241"><a href="#TableIndexer-241"><span class="linenos">241</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-242"><a href="#TableIndexer-242"><span class="linenos">242</span></a>
</span><span id="TableIndexer-243"><a href="#TableIndexer-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_region</span><span class="p">(</span>
</span><span id="TableIndexer-244"><a href="#TableIndexer-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer-245"><a href="#TableIndexer-245"><span class="linenos">245</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer-246"><a href="#TableIndexer-246"><span class="linenos">246</span></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer-247"><a href="#TableIndexer-247"><span class="linenos">247</span></a>        <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer-248"><a href="#TableIndexer-248"><span class="linenos">248</span></a>        <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="TableIndexer-249"><a href="#TableIndexer-249"><span class="linenos">249</span></a>        <span class="n">margin_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-250"><a href="#TableIndexer-250"><span class="linenos">250</span></a>        <span class="n">margin_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-251"><a href="#TableIndexer-251"><span class="linenos">251</span></a>        <span class="n">margin_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-252"><a href="#TableIndexer-252"><span class="linenos">252</span></a>        <span class="n">margin_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-253"><a href="#TableIndexer-253"><span class="linenos">253</span></a>        <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-254"><a href="#TableIndexer-254"><span class="linenos">254</span></a>        <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer-255"><a href="#TableIndexer-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer-256"><a href="#TableIndexer-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Crop the input image to a rectangular region with the start and end cells as extremes&quot;&quot;&quot;</span>
</span><span id="TableIndexer-257"><a href="#TableIndexer-257"><span class="linenos">257</span></a>
</span><span id="TableIndexer-258"><a href="#TableIndexer-258"><span class="linenos">258</span></a>        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="TableIndexer-259"><a href="#TableIndexer-259"><span class="linenos">259</span></a>
</span><span id="TableIndexer-260"><a href="#TableIndexer-260"><span class="linenos">260</span></a>        <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span> <span class="o">=</span> <span class="n">_apply_margin</span><span class="p">(</span>
</span><span id="TableIndexer-261"><a href="#TableIndexer-261"><span class="linenos">261</span></a>            <span class="o">*</span><span class="n">region</span><span class="p">,</span>
</span><span id="TableIndexer-262"><a href="#TableIndexer-262"><span class="linenos">262</span></a>            <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span>
</span><span id="TableIndexer-263"><a href="#TableIndexer-263"><span class="linenos">263</span></a>            <span class="n">margin_top</span><span class="o">=</span><span class="n">margin_top</span><span class="p">,</span>
</span><span id="TableIndexer-264"><a href="#TableIndexer-264"><span class="linenos">264</span></a>            <span class="n">margin_bottom</span><span class="o">=</span><span class="n">margin_bottom</span><span class="p">,</span>
</span><span id="TableIndexer-265"><a href="#TableIndexer-265"><span class="linenos">265</span></a>            <span class="n">margin_left</span><span class="o">=</span><span class="n">margin_left</span><span class="p">,</span>
</span><span id="TableIndexer-266"><a href="#TableIndexer-266"><span class="linenos">266</span></a>            <span class="n">margin_right</span><span class="o">=</span><span class="n">margin_right</span><span class="p">,</span>
</span><span id="TableIndexer-267"><a href="#TableIndexer-267"><span class="linenos">267</span></a>            <span class="n">margin_y</span><span class="o">=</span><span class="n">margin_y</span><span class="p">,</span>
</span><span id="TableIndexer-268"><a href="#TableIndexer-268"><span class="linenos">268</span></a>            <span class="n">margin_x</span><span class="o">=</span><span class="n">margin_x</span><span class="p">,</span>
</span><span id="TableIndexer-269"><a href="#TableIndexer-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="TableIndexer-270"><a href="#TableIndexer-270"><span class="linenos">270</span></a>
</span><span id="TableIndexer-271"><a href="#TableIndexer-271"><span class="linenos">271</span></a>        <span class="c1"># apply margins according to priority:</span>
</span><span id="TableIndexer-272"><a href="#TableIndexer-272"><span class="linenos">272</span></a>        <span class="c1"># margin_top &gt; margin_y &gt; margin (etc.)</span>
</span><span id="TableIndexer-273"><a href="#TableIndexer-273"><span class="linenos">273</span></a>
</span><span id="TableIndexer-274"><a href="#TableIndexer-274"><span class="linenos">274</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="TableIndexer-275"><a href="#TableIndexer-275"><span class="linenos">275</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">rb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="TableIndexer-276"><a href="#TableIndexer-276"><span class="linenos">276</span></a>
</span><span id="TableIndexer-277"><a href="#TableIndexer-277"><span class="linenos">277</span></a>        <span class="c1"># crop by doing a perspective transform to the desired quad</span>
</span><span id="TableIndexer-278"><a href="#TableIndexer-278"><span class="linenos">278</span></a>        <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-279"><a href="#TableIndexer-279"><span class="linenos">279</span></a>        <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="TableIndexer-280"><a href="#TableIndexer-280"><span class="linenos">280</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">)</span>
</span><span id="TableIndexer-281"><a href="#TableIndexer-281"><span class="linenos">281</span></a>        <span class="n">warped</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>  <span class="c1"># type:ignore</span>
</span><span id="TableIndexer-282"><a href="#TableIndexer-282"><span class="linenos">282</span></a>
</span><span id="TableIndexer-283"><a href="#TableIndexer-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="n">warped</span>
</span><span id="TableIndexer-284"><a href="#TableIndexer-284"><span class="linenos">284</span></a>
</span><span id="TableIndexer-285"><a href="#TableIndexer-285"><span class="linenos">285</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer-286"><a href="#TableIndexer-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="TableIndexer-287"><a href="#TableIndexer-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TableIndexer-288"><a href="#TableIndexer-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="TableIndexer-289"><a href="#TableIndexer-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer-290"><a href="#TableIndexer-290"><span class="linenos">290</span></a><span class="sd">        Split the row into regions of continuous text</span>
</span><span id="TableIndexer-291"><a href="#TableIndexer-291"><span class="linenos">291</span></a>
</span><span id="TableIndexer-292"><a href="#TableIndexer-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="TableIndexer-293"><a href="#TableIndexer-293"><span class="linenos">293</span></a><span class="sd">            list[tuple[int, int]]: a list of spans (start col, end col)</span>
</span><span id="TableIndexer-294"><a href="#TableIndexer-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer-295"><a href="#TableIndexer-295"><span class="linenos">295</span></a>
</span><span id="TableIndexer-296"><a href="#TableIndexer-296"><span class="linenos">296</span></a>        <span class="k">pass</span>
</span><span id="TableIndexer-297"><a href="#TableIndexer-297"><span class="linenos">297</span></a>
</span><span id="TableIndexer-298"><a href="#TableIndexer-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer-299"><a href="#TableIndexer-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_region</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">margin</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Subclasses implement methods for going from a pixel in the input image to a table cell index,
and cropping an image to the given table cell index.</p>
</div>


                            <div id="TableIndexer.col_offset" class="classattr">
                                        <input id="TableIndexer.col_offset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">col_offset</span><span class="annotation">: int</span>

                <label class="view-source-button" for="TableIndexer.col_offset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.col_offset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.col_offset-81"><a href="#TableIndexer.col_offset-81"><span class="linenos">81</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer.col_offset-82"><a href="#TableIndexer.col_offset-82"><span class="linenos">82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">col_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer.col_offset-83"><a href="#TableIndexer.col_offset-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_offset</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.cols" class="classattr">
                                        <input id="TableIndexer.cols-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">cols</span><span class="annotation">: int</span>

                <label class="view-source-button" for="TableIndexer.cols-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.cols"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.cols-90"><a href="#TableIndexer.cols-90"><span class="linenos">90</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer.cols-91"><a href="#TableIndexer.cols-91"><span class="linenos">91</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.cols-92"><a href="#TableIndexer.cols-92"><span class="linenos">92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer.cols-93"><a href="#TableIndexer.cols-93"><span class="linenos">93</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.rows" class="classattr">
                                        <input id="TableIndexer.rows-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">rows</span><span class="annotation">: int</span>

                <label class="view-source-button" for="TableIndexer.rows-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.rows"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.rows-95"><a href="#TableIndexer.rows-95"><span class="linenos">95</span></a>    <span class="nd">@property</span>
</span><span id="TableIndexer.rows-96"><a href="#TableIndexer.rows-96"><span class="linenos">96</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.rows-97"><a href="#TableIndexer.rows-97"><span class="linenos">97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="TableIndexer.rows-98"><a href="#TableIndexer.rows-98"><span class="linenos">98</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.cells" class="classattr">
                                        <input id="TableIndexer.cells-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cells</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Generator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.cells-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.cells"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.cells-100"><a href="#TableIndexer.cells-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cells</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="TableIndexer.cells-101"><a href="#TableIndexer.cells-101"><span class="linenos">101</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
</span><span id="TableIndexer.cells-102"><a href="#TableIndexer.cells-102"><span class="linenos">102</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
</span><span id="TableIndexer.cells-103"><a href="#TableIndexer.cells-103"><span class="linenos">103</span></a>                <span class="k">yield</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.cell" class="classattr">
                                        <input id="TableIndexer.cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">cell</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.cell-117"><a href="#TableIndexer.cell-117"><span class="linenos">117</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.cell-118"><a href="#TableIndexer.cell-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TableIndexer.cell-119"><a href="#TableIndexer.cell-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer.cell-120"><a href="#TableIndexer.cell-120"><span class="linenos">120</span></a><span class="sd">        Returns the coordinate (row, col) of the cell that contains the given position</span>
</span><span id="TableIndexer.cell-121"><a href="#TableIndexer.cell-121"><span class="linenos">121</span></a>
</span><span id="TableIndexer.cell-122"><a href="#TableIndexer.cell-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="TableIndexer.cell-123"><a href="#TableIndexer.cell-123"><span class="linenos">123</span></a><span class="sd">            point (tuple[float, float]): a location in the input image</span>
</span><span id="TableIndexer.cell-124"><a href="#TableIndexer.cell-124"><span class="linenos">124</span></a>
</span><span id="TableIndexer.cell-125"><a href="#TableIndexer.cell-125"><span class="linenos">125</span></a><span class="sd">        Returns:</span>
</span><span id="TableIndexer.cell-126"><a href="#TableIndexer.cell-126"><span class="linenos">126</span></a><span class="sd">            tuple[int, int]: the cell index (row, col) that contains the given point</span>
</span><span id="TableIndexer.cell-127"><a href="#TableIndexer.cell-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer.cell-128"><a href="#TableIndexer.cell-128"><span class="linenos">128</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Returns the coordinate (row, col) of the cell that contains the given position</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>point (tuple[float, float]):</strong>  a location in the input image</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[int, int]: the cell index (row, col) that contains the given point</p>
</blockquote>
</div>


                            </div>
                            <div id="TableIndexer.cell_polygon" class="classattr">
                                        <input id="TableIndexer.cell_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">cell_polygon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.cell_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.cell_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.cell_polygon-130"><a href="#TableIndexer.cell_polygon-130"><span class="linenos">130</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.cell_polygon-131"><a href="#TableIndexer.cell_polygon-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cell_polygon</span><span class="p">(</span>
</span><span id="TableIndexer.cell_polygon-132"><a href="#TableIndexer.cell_polygon-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="TableIndexer.cell_polygon-133"><a href="#TableIndexer.cell_polygon-133"><span class="linenos">133</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="TableIndexer.cell_polygon-134"><a href="#TableIndexer.cell_polygon-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the polygon (used in e.g. opencv) that enscribes the cell at the given cell position&quot;&quot;&quot;</span>
</span><span id="TableIndexer.cell_polygon-135"><a href="#TableIndexer.cell_polygon-135"><span class="linenos">135</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>returns the polygon (used in e.g. opencv) that enscribes the cell at the given cell position</p>
</div>


                            </div>
                            <div id="TableIndexer.highlight_all_cells" class="classattr">
                                        <input id="TableIndexer.highlight_all_cells-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highlight_all_cells</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>,</span><span class="param">	<span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.highlight_all_cells-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.highlight_all_cells"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.highlight_all_cells-157"><a href="#TableIndexer.highlight_all_cells-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">highlight_all_cells</span><span class="p">(</span>
</span><span id="TableIndexer.highlight_all_cells-158"><a href="#TableIndexer.highlight_all_cells-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer.highlight_all_cells-159"><a href="#TableIndexer.highlight_all_cells-159"><span class="linenos">159</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer.highlight_all_cells-160"><a href="#TableIndexer.highlight_all_cells-160"><span class="linenos">160</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
</span><span id="TableIndexer.highlight_all_cells-161"><a href="#TableIndexer.highlight_all_cells-161"><span class="linenos">161</span></a>        <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TableIndexer.highlight_all_cells-162"><a href="#TableIndexer.highlight_all_cells-162"><span class="linenos">162</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer.highlight_all_cells-163"><a href="#TableIndexer.highlight_all_cells-163"><span class="linenos">163</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer.highlight_all_cells-164"><a href="#TableIndexer.highlight_all_cells-164"><span class="linenos">164</span></a>
</span><span id="TableIndexer.highlight_all_cells-165"><a href="#TableIndexer.highlight_all_cells-165"><span class="linenos">165</span></a>        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">():</span>
</span><span id="TableIndexer.highlight_all_cells-166"><a href="#TableIndexer.highlight_all_cells-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</span><span id="TableIndexer.highlight_all_cells-167"><a href="#TableIndexer.highlight_all_cells-167"><span class="linenos">167</span></a>
</span><span id="TableIndexer.highlight_all_cells-168"><a href="#TableIndexer.highlight_all_cells-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">img</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.select_one_cell" class="classattr">
                                        <input id="TableIndexer.select_one_cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_one_cell</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;taulu&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>,</span><span class="param">	<span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.select_one_cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.select_one_cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.select_one_cell-170"><a href="#TableIndexer.select_one_cell-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_one_cell</span><span class="p">(</span>
</span><span id="TableIndexer.select_one_cell-171"><a href="#TableIndexer.select_one_cell-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer.select_one_cell-172"><a href="#TableIndexer.select_one_cell-172"><span class="linenos">172</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer.select_one_cell-173"><a href="#TableIndexer.select_one_cell-173"><span class="linenos">173</span></a>        <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span><span class="p">,</span>
</span><span id="TableIndexer.select_one_cell-174"><a href="#TableIndexer.select_one_cell-174"><span class="linenos">174</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="TableIndexer.select_one_cell-175"><a href="#TableIndexer.select_one_cell-175"><span class="linenos">175</span></a>        <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="TableIndexer.select_one_cell-176"><a href="#TableIndexer.select_one_cell-176"><span class="linenos">176</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TableIndexer.select_one_cell-177"><a href="#TableIndexer.select_one_cell-177"><span class="linenos">177</span></a>        <span class="n">clicked</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TableIndexer.select_one_cell-178"><a href="#TableIndexer.select_one_cell-178"><span class="linenos">178</span></a>
</span><span id="TableIndexer.select_one_cell-179"><a href="#TableIndexer.select_one_cell-179"><span class="linenos">179</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">click_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="TableIndexer.select_one_cell-180"><a href="#TableIndexer.select_one_cell-180"><span class="linenos">180</span></a>            <span class="k">nonlocal</span> <span class="n">clicked</span>
</span><span id="TableIndexer.select_one_cell-181"><a href="#TableIndexer.select_one_cell-181"><span class="linenos">181</span></a>
</span><span id="TableIndexer.select_one_cell-182"><a href="#TableIndexer.select_one_cell-182"><span class="linenos">182</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer.select_one_cell-183"><a href="#TableIndexer.select_one_cell-183"><span class="linenos">183</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="TableIndexer.select_one_cell-184"><a href="#TableIndexer.select_one_cell-184"><span class="linenos">184</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="TableIndexer.select_one_cell-185"><a href="#TableIndexer.select_one_cell-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="TableIndexer.select_one_cell-186"><a href="#TableIndexer.select_one_cell-186"><span class="linenos">186</span></a>                <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="TableIndexer.select_one_cell-187"><a href="#TableIndexer.select_one_cell-187"><span class="linenos">187</span></a>                <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer.select_one_cell-188"><a href="#TableIndexer.select_one_cell-188"><span class="linenos">188</span></a>                    <span class="n">clicked</span> <span class="o">=</span> <span class="n">cell</span>
</span><span id="TableIndexer.select_one_cell-189"><a href="#TableIndexer.select_one_cell-189"><span class="linenos">189</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TableIndexer.select_one_cell-190"><a href="#TableIndexer.select_one_cell-190"><span class="linenos">190</span></a>                    <span class="k">return</span>
</span><span id="TableIndexer.select_one_cell-191"><a href="#TableIndexer.select_one_cell-191"><span class="linenos">191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</span><span id="TableIndexer.select_one_cell-192"><a href="#TableIndexer.select_one_cell-192"><span class="linenos">192</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="TableIndexer.select_one_cell-193"><a href="#TableIndexer.select_one_cell-193"><span class="linenos">193</span></a>
</span><span id="TableIndexer.select_one_cell-194"><a href="#TableIndexer.select_one_cell-194"><span class="linenos">194</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">click_event</span><span class="o">=</span><span class="n">click_event</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;select one cell&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
</span><span id="TableIndexer.select_one_cell-195"><a href="#TableIndexer.select_one_cell-195"><span class="linenos">195</span></a>
</span><span id="TableIndexer.select_one_cell-196"><a href="#TableIndexer.select_one_cell-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">clicked</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.show_cells" class="classattr">
                                        <input id="TableIndexer.show_cells-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_cells</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;taulu&#39;</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.show_cells-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.show_cells"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.show_cells-198"><a href="#TableIndexer.show_cells-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show_cells</span><span class="p">(</span>
</span><span id="TableIndexer.show_cells-199"><a href="#TableIndexer.show_cells-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">WINDOW</span>
</span><span id="TableIndexer.show_cells-200"><a href="#TableIndexer.show_cells-200"><span class="linenos">200</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="TableIndexer.show_cells-201"><a href="#TableIndexer.show_cells-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="TableIndexer.show_cells-202"><a href="#TableIndexer.show_cells-202"><span class="linenos">202</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="TableIndexer.show_cells-203"><a href="#TableIndexer.show_cells-203"><span class="linenos">203</span></a>
</span><span id="TableIndexer.show_cells-204"><a href="#TableIndexer.show_cells-204"><span class="linenos">204</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="TableIndexer.show_cells-205"><a href="#TableIndexer.show_cells-205"><span class="linenos">205</span></a>
</span><span id="TableIndexer.show_cells-206"><a href="#TableIndexer.show_cells-206"><span class="linenos">206</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TableIndexer.show_cells-207"><a href="#TableIndexer.show_cells-207"><span class="linenos">207</span></a>
</span><span id="TableIndexer.show_cells-208"><a href="#TableIndexer.show_cells-208"><span class="linenos">208</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">click_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="TableIndexer.show_cells-209"><a href="#TableIndexer.show_cells-209"><span class="linenos">209</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="TableIndexer.show_cells-210"><a href="#TableIndexer.show_cells-210"><span class="linenos">210</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="TableIndexer.show_cells-211"><a href="#TableIndexer.show_cells-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span><span id="TableIndexer.show_cells-212"><a href="#TableIndexer.show_cells-212"><span class="linenos">212</span></a>                <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="TableIndexer.show_cells-213"><a href="#TableIndexer.show_cells-213"><span class="linenos">213</span></a>                <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TableIndexer.show_cells-214"><a href="#TableIndexer.show_cells-214"><span class="linenos">214</span></a>                    <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</span><span id="TableIndexer.show_cells-215"><a href="#TableIndexer.show_cells-215"><span class="linenos">215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TableIndexer.show_cells-216"><a href="#TableIndexer.show_cells-216"><span class="linenos">216</span></a>                    <span class="k">return</span>
</span><span id="TableIndexer.show_cells-217"><a href="#TableIndexer.show_cells-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="TableIndexer.show_cells-218"><a href="#TableIndexer.show_cells-218"><span class="linenos">218</span></a>                <span class="n">cv</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="TableIndexer.show_cells-219"><a href="#TableIndexer.show_cells-219"><span class="linenos">219</span></a>
</span><span id="TableIndexer.show_cells-220"><a href="#TableIndexer.show_cells-220"><span class="linenos">220</span></a>        <span class="n">imu</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
</span><span id="TableIndexer.show_cells-221"><a href="#TableIndexer.show_cells-221"><span class="linenos">221</span></a>            <span class="n">img</span><span class="p">,</span>
</span><span id="TableIndexer.show_cells-222"><a href="#TableIndexer.show_cells-222"><span class="linenos">222</span></a>            <span class="n">click_event</span><span class="o">=</span><span class="n">click_event</span><span class="p">,</span>
</span><span id="TableIndexer.show_cells-223"><a href="#TableIndexer.show_cells-223"><span class="linenos">223</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;click to highlight cells&quot;</span><span class="p">,</span>
</span><span id="TableIndexer.show_cells-224"><a href="#TableIndexer.show_cells-224"><span class="linenos">224</span></a>            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
</span><span id="TableIndexer.show_cells-225"><a href="#TableIndexer.show_cells-225"><span class="linenos">225</span></a>        <span class="p">)</span>
</span><span id="TableIndexer.show_cells-226"><a href="#TableIndexer.show_cells-226"><span class="linenos">226</span></a>
</span><span id="TableIndexer.show_cells-227"><a href="#TableIndexer.show_cells-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="n">cells</span>
</span></pre></div>


    

                            </div>
                            <div id="TableIndexer.region" class="classattr">
                                        <input id="TableIndexer.region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">region</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.region-229"><a href="#TableIndexer.region-229"><span class="linenos">229</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.region-230"><a href="#TableIndexer.region-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">region</span><span class="p">(</span>
</span><span id="TableIndexer.region-231"><a href="#TableIndexer.region-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer.region-232"><a href="#TableIndexer.region-232"><span class="linenos">232</span></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer.region-233"><a href="#TableIndexer.region-233"><span class="linenos">233</span></a>        <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer.region-234"><a href="#TableIndexer.region-234"><span class="linenos">234</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
</span><span id="TableIndexer.region-235"><a href="#TableIndexer.region-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer.region-236"><a href="#TableIndexer.region-236"><span class="linenos">236</span></a><span class="sd">        Get the bounding box for the rectangular region that goes from start to end</span>
</span><span id="TableIndexer.region-237"><a href="#TableIndexer.region-237"><span class="linenos">237</span></a>
</span><span id="TableIndexer.region-238"><a href="#TableIndexer.region-238"><span class="linenos">238</span></a><span class="sd">        Returns:</span>
</span><span id="TableIndexer.region-239"><a href="#TableIndexer.region-239"><span class="linenos">239</span></a><span class="sd">            4 points: lt, rt, rb, lb, in format (x, y)</span>
</span><span id="TableIndexer.region-240"><a href="#TableIndexer.region-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer.region-241"><a href="#TableIndexer.region-241"><span class="linenos">241</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Get the bounding box for the rectangular region that goes from start to end</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>4 points: lt, rt, rb, lb, in format (x, y)</p>
</blockquote>
</div>


                            </div>
                            <div id="TableIndexer.crop_region" class="classattr">
                                        <input id="TableIndexer.crop_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crop_region</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">margin_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.crop_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.crop_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.crop_region-243"><a href="#TableIndexer.crop_region-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_region</span><span class="p">(</span>
</span><span id="TableIndexer.crop_region-244"><a href="#TableIndexer.crop_region-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-245"><a href="#TableIndexer.crop_region-245"><span class="linenos">245</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-246"><a href="#TableIndexer.crop_region-246"><span class="linenos">246</span></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer.crop_region-247"><a href="#TableIndexer.crop_region-247"><span class="linenos">247</span></a>        <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="TableIndexer.crop_region-248"><a href="#TableIndexer.crop_region-248"><span class="linenos">248</span></a>        <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-249"><a href="#TableIndexer.crop_region-249"><span class="linenos">249</span></a>        <span class="n">margin_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-250"><a href="#TableIndexer.crop_region-250"><span class="linenos">250</span></a>        <span class="n">margin_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-251"><a href="#TableIndexer.crop_region-251"><span class="linenos">251</span></a>        <span class="n">margin_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-252"><a href="#TableIndexer.crop_region-252"><span class="linenos">252</span></a>        <span class="n">margin_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-253"><a href="#TableIndexer.crop_region-253"><span class="linenos">253</span></a>        <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-254"><a href="#TableIndexer.crop_region-254"><span class="linenos">254</span></a>        <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-255"><a href="#TableIndexer.crop_region-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer.crop_region-256"><a href="#TableIndexer.crop_region-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Crop the input image to a rectangular region with the start and end cells as extremes&quot;&quot;&quot;</span>
</span><span id="TableIndexer.crop_region-257"><a href="#TableIndexer.crop_region-257"><span class="linenos">257</span></a>
</span><span id="TableIndexer.crop_region-258"><a href="#TableIndexer.crop_region-258"><span class="linenos">258</span></a>        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="TableIndexer.crop_region-259"><a href="#TableIndexer.crop_region-259"><span class="linenos">259</span></a>
</span><span id="TableIndexer.crop_region-260"><a href="#TableIndexer.crop_region-260"><span class="linenos">260</span></a>        <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span> <span class="o">=</span> <span class="n">_apply_margin</span><span class="p">(</span>
</span><span id="TableIndexer.crop_region-261"><a href="#TableIndexer.crop_region-261"><span class="linenos">261</span></a>            <span class="o">*</span><span class="n">region</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-262"><a href="#TableIndexer.crop_region-262"><span class="linenos">262</span></a>            <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-263"><a href="#TableIndexer.crop_region-263"><span class="linenos">263</span></a>            <span class="n">margin_top</span><span class="o">=</span><span class="n">margin_top</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-264"><a href="#TableIndexer.crop_region-264"><span class="linenos">264</span></a>            <span class="n">margin_bottom</span><span class="o">=</span><span class="n">margin_bottom</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-265"><a href="#TableIndexer.crop_region-265"><span class="linenos">265</span></a>            <span class="n">margin_left</span><span class="o">=</span><span class="n">margin_left</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-266"><a href="#TableIndexer.crop_region-266"><span class="linenos">266</span></a>            <span class="n">margin_right</span><span class="o">=</span><span class="n">margin_right</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-267"><a href="#TableIndexer.crop_region-267"><span class="linenos">267</span></a>            <span class="n">margin_y</span><span class="o">=</span><span class="n">margin_y</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-268"><a href="#TableIndexer.crop_region-268"><span class="linenos">268</span></a>            <span class="n">margin_x</span><span class="o">=</span><span class="n">margin_x</span><span class="p">,</span>
</span><span id="TableIndexer.crop_region-269"><a href="#TableIndexer.crop_region-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="TableIndexer.crop_region-270"><a href="#TableIndexer.crop_region-270"><span class="linenos">270</span></a>
</span><span id="TableIndexer.crop_region-271"><a href="#TableIndexer.crop_region-271"><span class="linenos">271</span></a>        <span class="c1"># apply margins according to priority:</span>
</span><span id="TableIndexer.crop_region-272"><a href="#TableIndexer.crop_region-272"><span class="linenos">272</span></a>        <span class="c1"># margin_top &gt; margin_y &gt; margin (etc.)</span>
</span><span id="TableIndexer.crop_region-273"><a href="#TableIndexer.crop_region-273"><span class="linenos">273</span></a>
</span><span id="TableIndexer.crop_region-274"><a href="#TableIndexer.crop_region-274"><span class="linenos">274</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="TableIndexer.crop_region-275"><a href="#TableIndexer.crop_region-275"><span class="linenos">275</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">rb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="TableIndexer.crop_region-276"><a href="#TableIndexer.crop_region-276"><span class="linenos">276</span></a>
</span><span id="TableIndexer.crop_region-277"><a href="#TableIndexer.crop_region-277"><span class="linenos">277</span></a>        <span class="c1"># crop by doing a perspective transform to the desired quad</span>
</span><span id="TableIndexer.crop_region-278"><a href="#TableIndexer.crop_region-278"><span class="linenos">278</span></a>        <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">lb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="TableIndexer.crop_region-279"><a href="#TableIndexer.crop_region-279"><span class="linenos">279</span></a>        <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="TableIndexer.crop_region-280"><a href="#TableIndexer.crop_region-280"><span class="linenos">280</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">)</span>
</span><span id="TableIndexer.crop_region-281"><a href="#TableIndexer.crop_region-281"><span class="linenos">281</span></a>        <span class="n">warped</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>  <span class="c1"># type:ignore</span>
</span><span id="TableIndexer.crop_region-282"><a href="#TableIndexer.crop_region-282"><span class="linenos">282</span></a>
</span><span id="TableIndexer.crop_region-283"><a href="#TableIndexer.crop_region-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="n">warped</span>
</span></pre></div>


            <div class="docstring"><p>Crop the input image to a rectangular region with the start and end cells as extremes</p>
</div>


                            </div>
                            <div id="TableIndexer.text_regions" class="classattr">
                                        <input id="TableIndexer.text_regions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">text_regions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">row</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.text_regions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.text_regions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.text_regions-285"><a href="#TableIndexer.text_regions-285"><span class="linenos">285</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="TableIndexer.text_regions-286"><a href="#TableIndexer.text_regions-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_regions</span><span class="p">(</span>
</span><span id="TableIndexer.text_regions-287"><a href="#TableIndexer.text_regions-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">MatLike</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">margin_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">margin_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TableIndexer.text_regions-288"><a href="#TableIndexer.text_regions-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
</span><span id="TableIndexer.text_regions-289"><a href="#TableIndexer.text_regions-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TableIndexer.text_regions-290"><a href="#TableIndexer.text_regions-290"><span class="linenos">290</span></a><span class="sd">        Split the row into regions of continuous text</span>
</span><span id="TableIndexer.text_regions-291"><a href="#TableIndexer.text_regions-291"><span class="linenos">291</span></a>
</span><span id="TableIndexer.text_regions-292"><a href="#TableIndexer.text_regions-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="TableIndexer.text_regions-293"><a href="#TableIndexer.text_regions-293"><span class="linenos">293</span></a><span class="sd">            list[tuple[int, int]]: a list of spans (start col, end col)</span>
</span><span id="TableIndexer.text_regions-294"><a href="#TableIndexer.text_regions-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TableIndexer.text_regions-295"><a href="#TableIndexer.text_regions-295"><span class="linenos">295</span></a>
</span><span id="TableIndexer.text_regions-296"><a href="#TableIndexer.text_regions-296"><span class="linenos">296</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Split the row into regions of continuous text</p>

<p>Returns
    list[tuple[int, int]]: a list of spans (start col, end col)</p>
</div>


                            </div>
                            <div id="TableIndexer.crop_cell" class="classattr">
                                        <input id="TableIndexer.crop_cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crop_cell</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span>,</span><span class="param">	<span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TableIndexer.crop_cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TableIndexer.crop_cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TableIndexer.crop_cell-298"><a href="#TableIndexer.crop_cell-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatLike</span><span class="p">:</span>
</span><span id="TableIndexer.crop_cell-299"><a href="#TableIndexer.crop_cell-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_region</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">margin</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Split">
                            <input id="Split-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Split</span><wbr>(<span class="base">typing.Generic[~T]</span>):

                <label class="view-source-button" for="Split-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split-15"><a href="#Split-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Split</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="Split-16"><a href="#Split-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Split-17"><a href="#Split-17"><span class="linenos"> 17</span></a><span class="sd">    Container for paired left/right data with convenient manipulation methods.</span>
</span><span id="Split-18"><a href="#Split-18"><span class="linenos"> 18</span></a>
</span><span id="Split-19"><a href="#Split-19"><span class="linenos"> 19</span></a><span class="sd">    The Split class is designed for working with table images that span two pages</span>
</span><span id="Split-20"><a href="#Split-20"><span class="linenos"> 20</span></a><span class="sd">    or have distinct left and right sections. It allows you to:</span>
</span><span id="Split-21"><a href="#Split-21"><span class="linenos"> 21</span></a><span class="sd">    - Store related data for both sides</span>
</span><span id="Split-22"><a href="#Split-22"><span class="linenos"> 22</span></a><span class="sd">    - Apply functions to both sides simultaneously</span>
</span><span id="Split-23"><a href="#Split-23"><span class="linenos"> 23</span></a><span class="sd">    - Access attributes/methods of contained objects transparently</span>
</span><span id="Split-24"><a href="#Split-24"><span class="linenos"> 24</span></a>
</span><span id="Split-25"><a href="#Split-25"><span class="linenos"> 25</span></a><span class="sd">    Examples:</span>
</span><span id="Split-26"><a href="#Split-26"><span class="linenos"> 26</span></a><span class="sd">        &gt;&gt;&gt; # Create a split with different parameters for each side</span>
</span><span id="Split-27"><a href="#Split-27"><span class="linenos"> 27</span></a><span class="sd">        &gt;&gt;&gt; thresholds = Split(0.25, 0.30)</span>
</span><span id="Split-28"><a href="#Split-28"><span class="linenos"> 28</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Split-29"><a href="#Split-29"><span class="linenos"> 29</span></a><span class="sd">        &gt;&gt;&gt; # Apply a function to both sides</span>
</span><span id="Split-30"><a href="#Split-30"><span class="linenos"> 30</span></a><span class="sd">        &gt;&gt;&gt; images = Split(left_img, right_img)</span>
</span><span id="Split-31"><a href="#Split-31"><span class="linenos"> 31</span></a><span class="sd">        &gt;&gt;&gt; processed = images.apply(lambda img: cv2.blur(img, (5, 5)))</span>
</span><span id="Split-32"><a href="#Split-32"><span class="linenos"> 32</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Split-33"><a href="#Split-33"><span class="linenos"> 33</span></a><span class="sd">        &gt;&gt;&gt; # Use with different parameters per side</span>
</span><span id="Split-34"><a href="#Split-34"><span class="linenos"> 34</span></a><span class="sd">        &gt;&gt;&gt; results = images.apply(</span>
</span><span id="Split-35"><a href="#Split-35"><span class="linenos"> 35</span></a><span class="sd">        ...     lambda img, k: sauvola_threshold(img, k),</span>
</span><span id="Split-36"><a href="#Split-36"><span class="linenos"> 36</span></a><span class="sd">        ...     k=thresholds  # k.left used for left img, k.right for right</span>
</span><span id="Split-37"><a href="#Split-37"><span class="linenos"> 37</span></a><span class="sd">        ... )</span>
</span><span id="Split-38"><a href="#Split-38"><span class="linenos"> 38</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Split-39"><a href="#Split-39"><span class="linenos"> 39</span></a><span class="sd">        &gt;&gt;&gt; # Access methods of contained objects directly</span>
</span><span id="Split-40"><a href="#Split-40"><span class="linenos"> 40</span></a><span class="sd">        &gt;&gt;&gt; templates = Split(template_left, template_right)</span>
</span><span id="Split-41"><a href="#Split-41"><span class="linenos"> 41</span></a><span class="sd">        &gt;&gt;&gt; widths = templates.cell_widths(0)  # Calls on both templates</span>
</span><span id="Split-42"><a href="#Split-42"><span class="linenos"> 42</span></a>
</span><span id="Split-43"><a href="#Split-43"><span class="linenos"> 43</span></a><span class="sd">    Type Parameters:</span>
</span><span id="Split-44"><a href="#Split-44"><span class="linenos"> 44</span></a><span class="sd">        T: The type of objects stored in left and right</span>
</span><span id="Split-45"><a href="#Split-45"><span class="linenos"> 45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Split-46"><a href="#Split-46"><span class="linenos"> 46</span></a>
</span><span id="Split-47"><a href="#Split-47"><span class="linenos"> 47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Split-48"><a href="#Split-48"><span class="linenos"> 48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Split-49"><a href="#Split-49"><span class="linenos"> 49</span></a><span class="sd">        Initialize a Split container.</span>
</span><span id="Split-50"><a href="#Split-50"><span class="linenos"> 50</span></a>
</span><span id="Split-51"><a href="#Split-51"><span class="linenos"> 51</span></a><span class="sd">        Args:</span>
</span><span id="Split-52"><a href="#Split-52"><span class="linenos"> 52</span></a><span class="sd">            left: Data for the left side</span>
</span><span id="Split-53"><a href="#Split-53"><span class="linenos"> 53</span></a><span class="sd">            right: Data for the right side</span>
</span><span id="Split-54"><a href="#Split-54"><span class="linenos"> 54</span></a>
</span><span id="Split-55"><a href="#Split-55"><span class="linenos"> 55</span></a><span class="sd">        Note:</span>
</span><span id="Split-56"><a href="#Split-56"><span class="linenos"> 56</span></a><span class="sd">            Both can initially be None. Use the `append` method or set</span>
</span><span id="Split-57"><a href="#Split-57"><span class="linenos"> 57</span></a><span class="sd">            properties directly to populate.</span>
</span><span id="Split-58"><a href="#Split-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Split-59"><a href="#Split-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">left</span>
</span><span id="Split-60"><a href="#Split-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">right</span>
</span><span id="Split-61"><a href="#Split-61"><span class="linenos"> 61</span></a>
</span><span id="Split-62"><a href="#Split-62"><span class="linenos"> 62</span></a>    <span class="nd">@property</span>
</span><span id="Split-63"><a href="#Split-63"><span class="linenos"> 63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Split-64"><a href="#Split-64"><span class="linenos"> 64</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-65"><a href="#Split-65"><span class="linenos"> 65</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span>
</span><span id="Split-66"><a href="#Split-66"><span class="linenos"> 66</span></a>
</span><span id="Split-67"><a href="#Split-67"><span class="linenos"> 67</span></a>    <span class="nd">@left</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Split-68"><a href="#Split-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span>
</span><span id="Split-69"><a href="#Split-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Split-70"><a href="#Split-70"><span class="linenos"> 70</span></a>
</span><span id="Split-71"><a href="#Split-71"><span class="linenos"> 71</span></a>    <span class="nd">@property</span>
</span><span id="Split-72"><a href="#Split-72"><span class="linenos"> 72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Split-73"><a href="#Split-73"><span class="linenos"> 73</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-74"><a href="#Split-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span>
</span><span id="Split-75"><a href="#Split-75"><span class="linenos"> 75</span></a>
</span><span id="Split-76"><a href="#Split-76"><span class="linenos"> 76</span></a>    <span class="nd">@right</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Split-77"><a href="#Split-77"><span class="linenos"> 77</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span>
</span><span id="Split-78"><a href="#Split-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Split-79"><a href="#Split-79"><span class="linenos"> 79</span></a>
</span><span id="Split-80"><a href="#Split-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span>
</span><span id="Split-81"><a href="#Split-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Split-82"><a href="#Split-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Split-83"><a href="#Split-83"><span class="linenos"> 83</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Split-84"><a href="#Split-84"><span class="linenos"> 84</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Split-85"><a href="#Split-85"><span class="linenos"> 85</span></a>
</span><span id="Split-86"><a href="#Split-86"><span class="linenos"> 86</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Split-87"><a href="#Split-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;left: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_left</span><span class="si">}</span><span class="s2">, right: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_right</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Split-88"><a href="#Split-88"><span class="linenos"> 88</span></a>
</span><span id="Split-89"><a href="#Split-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Split-90"><a href="#Split-90"><span class="linenos"> 90</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-91"><a href="#Split-91"><span class="linenos"> 91</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-92"><a href="#Split-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span><span class="p">))</span>
</span><span id="Split-93"><a href="#Split-93"><span class="linenos"> 93</span></a>
</span><span id="Split-94"><a href="#Split-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Split-95"><a href="#Split-95"><span class="linenos"> 95</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-96"><a href="#Split-96"><span class="linenos"> 96</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split-97"><a href="#Split-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Split-98"><a href="#Split-98"><span class="linenos"> 98</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span>
</span><span id="Split-99"><a href="#Split-99"><span class="linenos"> 99</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Split-100"><a href="#Split-100"><span class="linenos">100</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span>
</span><span id="Split-101"><a href="#Split-101"><span class="linenos">101</span></a>
</span><span id="Split-102"><a href="#Split-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span>
</span><span id="Split-103"><a href="#Split-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Split-104"><a href="#Split-104"><span class="linenos">104</span></a>        <span class="n">funcs</span><span class="p">:</span> <span class="s2">&quot;Split[Callable[[T, *Any], V]] | Callable[[T, *Any], V]&quot;</span><span class="p">,</span>
</span><span id="Split-105"><a href="#Split-105"><span class="linenos">105</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Split-106"><a href="#Split-106"><span class="linenos">106</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Split-107"><a href="#Split-107"><span class="linenos">107</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Split[V]&quot;</span><span class="p">:</span>
</span><span id="Split-108"><a href="#Split-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Split-109"><a href="#Split-109"><span class="linenos">109</span></a>            <span class="n">funcs</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">funcs</span><span class="p">)</span>
</span><span id="Split-110"><a href="#Split-110"><span class="linenos">110</span></a>
</span><span id="Split-111"><a href="#Split-111"><span class="linenos">111</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
</span><span id="Split-112"><a href="#Split-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Split-113"><a href="#Split-113"><span class="linenos">113</span></a>                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split-114"><a href="#Split-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="n">arg</span>
</span><span id="Split-115"><a href="#Split-115"><span class="linenos">115</span></a>
</span><span id="Split-116"><a href="#Split-116"><span class="linenos">116</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="n">side</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Split-117"><a href="#Split-117"><span class="linenos">117</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split-118"><a href="#Split-118"><span class="linenos">118</span></a>            <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split-119"><a href="#Split-119"><span class="linenos">119</span></a>
</span><span id="Split-120"><a href="#Split-120"><span class="linenos">120</span></a>            <span class="n">side_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
</span><span id="Split-121"><a href="#Split-121"><span class="linenos">121</span></a>            <span class="n">side_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Split-122"><a href="#Split-122"><span class="linenos">122</span></a>
</span><span id="Split-123"><a href="#Split-123"><span class="linenos">123</span></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">side_args</span><span class="p">,</span> <span class="o">**</span><span class="n">side_kwargs</span><span class="p">)</span>
</span><span id="Split-124"><a href="#Split-124"><span class="linenos">124</span></a>
</span><span id="Split-125"><a href="#Split-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">Split</span><span class="p">(</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">),</span> <span class="n">call</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">))</span>
</span><span id="Split-126"><a href="#Split-126"><span class="linenos">126</span></a>
</span><span id="Split-127"><a href="#Split-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Split-128"><a href="#Split-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Split-129"><a href="#Split-129"><span class="linenos">129</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
</span><span id="Split-130"><a href="#Split-130"><span class="linenos">130</span></a>
</span><span id="Split-131"><a href="#Split-131"><span class="linenos">131</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Split-132"><a href="#Split-132"><span class="linenos">132</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="Split-133"><a href="#Split-133"><span class="linenos">133</span></a>                <span class="n">Split</span><span class="p">(</span>
</span><span id="Split-134"><a href="#Split-134"><span class="linenos">134</span></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">),</span>
</span><span id="Split-135"><a href="#Split-135"><span class="linenos">135</span></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">),</span>
</span><span id="Split-136"><a href="#Split-136"><span class="linenos">136</span></a>                <span class="p">),</span>
</span><span id="Split-137"><a href="#Split-137"><span class="linenos">137</span></a>                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Split-138"><a href="#Split-138"><span class="linenos">138</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Split-139"><a href="#Split-139"><span class="linenos">139</span></a>            <span class="p">)</span>
</span><span id="Split-140"><a href="#Split-140"><span class="linenos">140</span></a>
</span><span id="Split-141"><a href="#Split-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>Container for paired left/right data with convenient manipulation methods.</p>

<p>The Split class is designed for working with table images that span two pages
or have distinct left and right sections. It allows you to:</p>

<ul>
<li>Store related data for both sides</li>
<li>Apply functions to both sides simultaneously</li>
<li>Access attributes/methods of contained objects transparently</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a split with different parameters for each side</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Apply a function to both sides</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">images</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">left_img</span><span class="p">,</span> <span class="n">right_img</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use with different parameters per side</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<span class="gp">... </span>    <span class="k">lambda</span> <span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">sauvola_threshold</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">k</span><span class="o">=</span><span class="n">thresholds</span>  <span class="c1"># k.left used for left img, k.right for right</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Access methods of contained objects directly</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">templates</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">template_left</span><span class="p">,</span> <span class="n">template_right</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">widths</span> <span class="o">=</span> <span class="n">templates</span><span class="o">.</span><span class="n">cell_widths</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Calls on both templates</span>
</code></pre>
  </div>
</blockquote>

<h6 id="type-parameters">Type Parameters:</h6>

<blockquote>
  <p>T: The type of objects stored in left and right</p>
</blockquote>
</div>


                            <div id="Split.__init__" class="classattr">
                                        <input id="Split.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Split</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">left</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">right</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Split.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split.__init__-47"><a href="#Split.__init__-47"><span class="linenos">47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Split.__init__-48"><a href="#Split.__init__-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Split.__init__-49"><a href="#Split.__init__-49"><span class="linenos">49</span></a><span class="sd">        Initialize a Split container.</span>
</span><span id="Split.__init__-50"><a href="#Split.__init__-50"><span class="linenos">50</span></a>
</span><span id="Split.__init__-51"><a href="#Split.__init__-51"><span class="linenos">51</span></a><span class="sd">        Args:</span>
</span><span id="Split.__init__-52"><a href="#Split.__init__-52"><span class="linenos">52</span></a><span class="sd">            left: Data for the left side</span>
</span><span id="Split.__init__-53"><a href="#Split.__init__-53"><span class="linenos">53</span></a><span class="sd">            right: Data for the right side</span>
</span><span id="Split.__init__-54"><a href="#Split.__init__-54"><span class="linenos">54</span></a>
</span><span id="Split.__init__-55"><a href="#Split.__init__-55"><span class="linenos">55</span></a><span class="sd">        Note:</span>
</span><span id="Split.__init__-56"><a href="#Split.__init__-56"><span class="linenos">56</span></a><span class="sd">            Both can initially be None. Use the `append` method or set</span>
</span><span id="Split.__init__-57"><a href="#Split.__init__-57"><span class="linenos">57</span></a><span class="sd">            properties directly to populate.</span>
</span><span id="Split.__init__-58"><a href="#Split.__init__-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Split.__init__-59"><a href="#Split.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">left</span>
</span><span id="Split.__init__-60"><a href="#Split.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">right</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a Split container.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>left:</strong>  Data for the left side</li>
<li><strong>right:</strong>  Data for the right side</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Both can initially be None. Use the <code><a href="#Split.append">append</a></code> method or set
  properties directly to populate.</p>
</blockquote>
</div>


                            </div>
                            <div id="Split.left" class="classattr">
                                        <input id="Split.left-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">left</span><span class="annotation">: ~T</span>

                <label class="view-source-button" for="Split.left-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split.left"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split.left-62"><a href="#Split.left-62"><span class="linenos">62</span></a>    <span class="nd">@property</span>
</span><span id="Split.left-63"><a href="#Split.left-63"><span class="linenos">63</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Split.left-64"><a href="#Split.left-64"><span class="linenos">64</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split.left-65"><a href="#Split.left-65"><span class="linenos">65</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span>
</span></pre></div>


    

                            </div>
                            <div id="Split.right" class="classattr">
                                        <input id="Split.right-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">right</span><span class="annotation">: ~T</span>

                <label class="view-source-button" for="Split.right-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split.right"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split.right-71"><a href="#Split.right-71"><span class="linenos">71</span></a>    <span class="nd">@property</span>
</span><span id="Split.right-72"><a href="#Split.right-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Split.right-73"><a href="#Split.right-73"><span class="linenos">73</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Split.right-74"><a href="#Split.right-74"><span class="linenos">74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span>
</span></pre></div>


    

                            </div>
                            <div id="Split.append" class="classattr">
                                        <input id="Split.append-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">append</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="o">~</span><span class="n">T</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Split.append-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split.append"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split.append-80"><a href="#Split.append-80"><span class="linenos">80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span>
</span><span id="Split.append-81"><a href="#Split.append-81"><span class="linenos">81</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Split.append-82"><a href="#Split.append-82"><span class="linenos">82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Split.append-83"><a href="#Split.append-83"><span class="linenos">83</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Split.append-84"><a href="#Split.append-84"><span class="linenos">84</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">value</span>
</span></pre></div>


    

                            </div>
                            <div id="Split.apply" class="classattr">
                                        <input id="Split.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">funcs</span><span class="p">:</span> <span class="s1">&#39;Split[Callable[[T, *Any], V]] | Callable[[T, *Any], V]&#39;</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="o">~</span><span class="n">V</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Split.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Split.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Split.apply-102"><a href="#Split.apply-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span>
</span><span id="Split.apply-103"><a href="#Split.apply-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Split.apply-104"><a href="#Split.apply-104"><span class="linenos">104</span></a>        <span class="n">funcs</span><span class="p">:</span> <span class="s2">&quot;Split[Callable[[T, *Any], V]] | Callable[[T, *Any], V]&quot;</span><span class="p">,</span>
</span><span id="Split.apply-105"><a href="#Split.apply-105"><span class="linenos">105</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Split.apply-106"><a href="#Split.apply-106"><span class="linenos">106</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Split.apply-107"><a href="#Split.apply-107"><span class="linenos">107</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Split[V]&quot;</span><span class="p">:</span>
</span><span id="Split.apply-108"><a href="#Split.apply-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Split.apply-109"><a href="#Split.apply-109"><span class="linenos">109</span></a>            <span class="n">funcs</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">funcs</span><span class="p">)</span>
</span><span id="Split.apply-110"><a href="#Split.apply-110"><span class="linenos">110</span></a>
</span><span id="Split.apply-111"><a href="#Split.apply-111"><span class="linenos">111</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
</span><span id="Split.apply-112"><a href="#Split.apply-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Split.apply-113"><a href="#Split.apply-113"><span class="linenos">113</span></a>                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split.apply-114"><a href="#Split.apply-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="n">arg</span>
</span><span id="Split.apply-115"><a href="#Split.apply-115"><span class="linenos">115</span></a>
</span><span id="Split.apply-116"><a href="#Split.apply-116"><span class="linenos">116</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="n">side</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Split.apply-117"><a href="#Split.apply-117"><span class="linenos">117</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split.apply-118"><a href="#Split.apply-118"><span class="linenos">118</span></a>            <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Split.apply-119"><a href="#Split.apply-119"><span class="linenos">119</span></a>
</span><span id="Split.apply-120"><a href="#Split.apply-120"><span class="linenos">120</span></a>            <span class="n">side_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
</span><span id="Split.apply-121"><a href="#Split.apply-121"><span class="linenos">121</span></a>            <span class="n">side_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">get_arg</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Split.apply-122"><a href="#Split.apply-122"><span class="linenos">122</span></a>
</span><span id="Split.apply-123"><a href="#Split.apply-123"><span class="linenos">123</span></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">side_args</span><span class="p">,</span> <span class="o">**</span><span class="n">side_kwargs</span><span class="p">)</span>
</span><span id="Split.apply-124"><a href="#Split.apply-124"><span class="linenos">124</span></a>
</span><span id="Split.apply-125"><a href="#Split.apply-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">Split</span><span class="p">(</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">),</span> <span class="n">call</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Taulu">
                            <input id="Taulu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Taulu</span>:

                <label class="view-source-button" for="Taulu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Taulu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Taulu-36"><a href="#Taulu-36"><span class="linenos"> 36</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Taulu</span><span class="p">:</span>
</span><span id="Taulu-37"><a href="#Taulu-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu-38"><a href="#Taulu-38"><span class="linenos"> 38</span></a><span class="sd">    High-level API for table segmentation from images.</span>
</span><span id="Taulu-39"><a href="#Taulu-39"><span class="linenos"> 39</span></a>
</span><span id="Taulu-40"><a href="#Taulu-40"><span class="linenos"> 40</span></a><span class="sd">    Taulu provides a simplified interface that orchestrates header alignment,</span>
</span><span id="Taulu-41"><a href="#Taulu-41"><span class="linenos"> 41</span></a><span class="sd">    grid detection, and table segmentation into a single workflow. It&#39;s designed</span>
</span><span id="Taulu-42"><a href="#Taulu-42"><span class="linenos"> 42</span></a><span class="sd">    to hide complexity while still allowing fine-tuned control through parameters.</span>
</span><span id="Taulu-43"><a href="#Taulu-43"><span class="linenos"> 43</span></a>
</span><span id="Taulu-44"><a href="#Taulu-44"><span class="linenos"> 44</span></a><span class="sd">    ## Workflow Overview</span>
</span><span id="Taulu-45"><a href="#Taulu-45"><span class="linenos"> 45</span></a>
</span><span id="Taulu-46"><a href="#Taulu-46"><span class="linenos"> 46</span></a><span class="sd">    1. **Header Template Creation**: Use `Taulu.annotate()` to create annotated</span>
</span><span id="Taulu-47"><a href="#Taulu-47"><span class="linenos"> 47</span></a><span class="sd">       header images that define your table structure</span>
</span><span id="Taulu-48"><a href="#Taulu-48"><span class="linenos"> 48</span></a><span class="sd">    2. **Initialization**: Create a Taulu instance with your header(s) and parameters</span>
</span><span id="Taulu-49"><a href="#Taulu-49"><span class="linenos"> 49</span></a><span class="sd">    3. **Segmentation**: Call `segment_table()` on your table images to get a</span>
</span><span id="Taulu-50"><a href="#Taulu-50"><span class="linenos"> 50</span></a><span class="sd">       `TableGrid` object containing all detected cell boundaries</span>
</span><span id="Taulu-51"><a href="#Taulu-51"><span class="linenos"> 51</span></a>
</span><span id="Taulu-52"><a href="#Taulu-52"><span class="linenos"> 52</span></a><span class="sd">    ## Single vs Split Tables</span>
</span><span id="Taulu-53"><a href="#Taulu-53"><span class="linenos"> 53</span></a>
</span><span id="Taulu-54"><a href="#Taulu-54"><span class="linenos"> 54</span></a><span class="sd">    Taulu supports two modes:</span>
</span><span id="Taulu-55"><a href="#Taulu-55"><span class="linenos"> 55</span></a>
</span><span id="Taulu-56"><a href="#Taulu-56"><span class="linenos"> 56</span></a><span class="sd">    - **Single header**: For tables that fit on one page or have consistent structure</span>
</span><span id="Taulu-57"><a href="#Taulu-57"><span class="linenos"> 57</span></a><span class="sd">    - **Split header**: For tables that span two pages (left/right) with potentially</span>
</span><span id="Taulu-58"><a href="#Taulu-58"><span class="linenos"> 58</span></a><span class="sd">      different parameters for each side</span>
</span><span id="Taulu-59"><a href="#Taulu-59"><span class="linenos"> 59</span></a>
</span><span id="Taulu-60"><a href="#Taulu-60"><span class="linenos"> 60</span></a><span class="sd">    Use `Split[T]` objects to provide different parameters for left and right sides.</span>
</span><span id="Taulu-61"><a href="#Taulu-61"><span class="linenos"> 61</span></a>
</span><span id="Taulu-62"><a href="#Taulu-62"><span class="linenos"> 62</span></a><span class="sd">    ## Parameter Tuning Strategy</span>
</span><span id="Taulu-63"><a href="#Taulu-63"><span class="linenos"> 63</span></a>
</span><span id="Taulu-64"><a href="#Taulu-64"><span class="linenos"> 64</span></a><span class="sd">    If segmentation fails or is inaccurate:</span>
</span><span id="Taulu-65"><a href="#Taulu-65"><span class="linenos"> 65</span></a>
</span><span id="Taulu-66"><a href="#Taulu-66"><span class="linenos"> 66</span></a><span class="sd">    1. **Visual debugging**: Set `debug_view=True` in `segment_table()` to see</span>
</span><span id="Taulu-67"><a href="#Taulu-67"><span class="linenos"> 67</span></a><span class="sd">       intermediate results</span>
</span><span id="Taulu-68"><a href="#Taulu-68"><span class="linenos"> 68</span></a><span class="sd">    2. **Adjust thresholding**: Modify `sauvola_k` to change binarization sensitivity</span>
</span><span id="Taulu-69"><a href="#Taulu-69"><span class="linenos"> 69</span></a><span class="sd">       - Increase to remove more noise (more aggressive)</span>
</span><span id="Taulu-70"><a href="#Taulu-70"><span class="linenos"> 70</span></a><span class="sd">       - Decrease to preserve faint lines</span>
</span><span id="Taulu-71"><a href="#Taulu-71"><span class="linenos"> 71</span></a><span class="sd">    3. **Tune cross-kernel**: Adjust `cross_width`, `cross_height`, `kernel_size`</span>
</span><span id="Taulu-72"><a href="#Taulu-72"><span class="linenos"> 72</span></a><span class="sd">       to match your rule thickness after morphology</span>
</span><span id="Taulu-73"><a href="#Taulu-73"><span class="linenos"> 73</span></a><span class="sd">    4. **Morphology**: Increase `morph_size` to connect broken lines, but be aware</span>
</span><span id="Taulu-74"><a href="#Taulu-74"><span class="linenos"> 74</span></a><span class="sd">       this also thickens lines (requiring larger cross_width)</span>
</span><span id="Taulu-75"><a href="#Taulu-75"><span class="linenos"> 75</span></a><span class="sd">    5. **Search parameters**: Increase `search_region` for warped documents,</span>
</span><span id="Taulu-76"><a href="#Taulu-76"><span class="linenos"> 76</span></a><span class="sd">       adjust `distance_penalty` to control how strictly positions are enforced</span>
</span><span id="Taulu-77"><a href="#Taulu-77"><span class="linenos"> 77</span></a><span class="sd">    6. **Growth parameters**: Lower `grow_threshold` if the algorithm stops too early,</span>
</span><span id="Taulu-78"><a href="#Taulu-78"><span class="linenos"> 78</span></a><span class="sd">       increase `look_distance` for better extrapolation</span>
</span><span id="Taulu-79"><a href="#Taulu-79"><span class="linenos"> 79</span></a>
</span><span id="Taulu-80"><a href="#Taulu-80"><span class="linenos"> 80</span></a><span class="sd">    Examples:</span>
</span><span id="Taulu-81"><a href="#Taulu-81"><span class="linenos"> 81</span></a><span class="sd">        Basic usage with a single header:</span>
</span><span id="Taulu-82"><a href="#Taulu-82"><span class="linenos"> 82</span></a>
</span><span id="Taulu-83"><a href="#Taulu-83"><span class="linenos"> 83</span></a><span class="sd">        &gt;&gt;&gt; from taulu import Taulu</span>
</span><span id="Taulu-84"><a href="#Taulu-84"><span class="linenos"> 84</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-85"><a href="#Taulu-85"><span class="linenos"> 85</span></a><span class="sd">        &gt;&gt;&gt; # First, create annotated header (one-time setup)</span>
</span><span id="Taulu-86"><a href="#Taulu-86"><span class="linenos"> 86</span></a><span class="sd">        &gt;&gt;&gt; Taulu.annotate(&quot;table_image.png&quot;, &quot;header.png&quot;)</span>
</span><span id="Taulu-87"><a href="#Taulu-87"><span class="linenos"> 87</span></a><span class="sd">        &gt;&gt;&gt; # This creates header.png and header.json</span>
</span><span id="Taulu-88"><a href="#Taulu-88"><span class="linenos"> 88</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-89"><a href="#Taulu-89"><span class="linenos"> 89</span></a><span class="sd">        &gt;&gt;&gt; # Initialize Taulu with the header</span>
</span><span id="Taulu-90"><a href="#Taulu-90"><span class="linenos"> 90</span></a><span class="sd">        &gt;&gt;&gt; taulu = Taulu(</span>
</span><span id="Taulu-91"><a href="#Taulu-91"><span class="linenos"> 91</span></a><span class="sd">        ...     header_image_path=&quot;header.png&quot;,</span>
</span><span id="Taulu-92"><a href="#Taulu-92"><span class="linenos"> 92</span></a><span class="sd">        ...     cell_height_factor=0.8,  # Rows are 80% of header height</span>
</span><span id="Taulu-93"><a href="#Taulu-93"><span class="linenos"> 93</span></a><span class="sd">        ...     sauvola_k=0.25,</span>
</span><span id="Taulu-94"><a href="#Taulu-94"><span class="linenos"> 94</span></a><span class="sd">        ...     search_region=60,</span>
</span><span id="Taulu-95"><a href="#Taulu-95"><span class="linenos"> 95</span></a><span class="sd">        ...     cross_width=10</span>
</span><span id="Taulu-96"><a href="#Taulu-96"><span class="linenos"> 96</span></a><span class="sd">        ... )</span>
</span><span id="Taulu-97"><a href="#Taulu-97"><span class="linenos"> 97</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-98"><a href="#Taulu-98"><span class="linenos"> 98</span></a><span class="sd">        &gt;&gt;&gt; # Segment a table image</span>
</span><span id="Taulu-99"><a href="#Taulu-99"><span class="linenos"> 99</span></a><span class="sd">        &gt;&gt;&gt; grid = taulu.segment_table(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu-100"><a href="#Taulu-100"><span class="linenos">100</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-101"><a href="#Taulu-101"><span class="linenos">101</span></a><span class="sd">        &gt;&gt;&gt; # Use the grid to extract cells</span>
</span><span id="Taulu-102"><a href="#Taulu-102"><span class="linenos">102</span></a><span class="sd">        &gt;&gt;&gt; import cv2</span>
</span><span id="Taulu-103"><a href="#Taulu-103"><span class="linenos">103</span></a><span class="sd">        &gt;&gt;&gt; img = cv2.imread(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu-104"><a href="#Taulu-104"><span class="linenos">104</span></a><span class="sd">        &gt;&gt;&gt; cell_image = grid.crop_cell(img, (0, 0))  # First cell</span>
</span><span id="Taulu-105"><a href="#Taulu-105"><span class="linenos">105</span></a>
</span><span id="Taulu-106"><a href="#Taulu-106"><span class="linenos">106</span></a><span class="sd">        Using split headers for two-page tables:</span>
</span><span id="Taulu-107"><a href="#Taulu-107"><span class="linenos">107</span></a>
</span><span id="Taulu-108"><a href="#Taulu-108"><span class="linenos">108</span></a><span class="sd">        &gt;&gt;&gt; from taulu import Taulu, Split</span>
</span><span id="Taulu-109"><a href="#Taulu-109"><span class="linenos">109</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-110"><a href="#Taulu-110"><span class="linenos">110</span></a><span class="sd">        &gt;&gt;&gt; # Annotate both headers</span>
</span><span id="Taulu-111"><a href="#Taulu-111"><span class="linenos">111</span></a><span class="sd">        &gt;&gt;&gt; Taulu.annotate(&quot;scan_01.png&quot;, &quot;header_left.png&quot;)</span>
</span><span id="Taulu-112"><a href="#Taulu-112"><span class="linenos">112</span></a><span class="sd">        &gt;&gt;&gt; Taulu.annotate(&quot;scan_01.png&quot;, &quot;header_right.png&quot;)</span>
</span><span id="Taulu-113"><a href="#Taulu-113"><span class="linenos">113</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-114"><a href="#Taulu-114"><span class="linenos">114</span></a><span class="sd">        &gt;&gt;&gt; # Use different parameters for each side</span>
</span><span id="Taulu-115"><a href="#Taulu-115"><span class="linenos">115</span></a><span class="sd">        &gt;&gt;&gt; taulu = Taulu(</span>
</span><span id="Taulu-116"><a href="#Taulu-116"><span class="linenos">116</span></a><span class="sd">        ...     header_image_path=Split(&quot;header_left.png&quot;, &quot;header_right.png&quot;),</span>
</span><span id="Taulu-117"><a href="#Taulu-117"><span class="linenos">117</span></a><span class="sd">        ...     cell_height_factor=Split([0.8, 0.9], [0.75]),  # Different row heights</span>
</span><span id="Taulu-118"><a href="#Taulu-118"><span class="linenos">118</span></a><span class="sd">        ...     sauvola_k=Split(0.25, 0.30),  # Different thresholds</span>
</span><span id="Taulu-119"><a href="#Taulu-119"><span class="linenos">119</span></a><span class="sd">        ...     cross_width=10  # Same for both sides</span>
</span><span id="Taulu-120"><a href="#Taulu-120"><span class="linenos">120</span></a><span class="sd">        ... )</span>
</span><span id="Taulu-121"><a href="#Taulu-121"><span class="linenos">121</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-122"><a href="#Taulu-122"><span class="linenos">122</span></a><span class="sd">        &gt;&gt;&gt; # Segment returns a unified grid</span>
</span><span id="Taulu-123"><a href="#Taulu-123"><span class="linenos">123</span></a><span class="sd">        &gt;&gt;&gt; grid = taulu.segment_table(&quot;scan_01.png&quot;)</span>
</span><span id="Taulu-124"><a href="#Taulu-124"><span class="linenos">124</span></a>
</span><span id="Taulu-125"><a href="#Taulu-125"><span class="linenos">125</span></a><span class="sd">        Debug visualization to tune parameters:</span>
</span><span id="Taulu-126"><a href="#Taulu-126"><span class="linenos">126</span></a>
</span><span id="Taulu-127"><a href="#Taulu-127"><span class="linenos">127</span></a><span class="sd">        &gt;&gt;&gt; taulu = Taulu(&quot;header.png&quot;, sauvola_k=0.15)</span>
</span><span id="Taulu-128"><a href="#Taulu-128"><span class="linenos">128</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-129"><a href="#Taulu-129"><span class="linenos">129</span></a><span class="sd">        &gt;&gt;&gt; # Opens windows showing each processing step</span>
</span><span id="Taulu-130"><a href="#Taulu-130"><span class="linenos">130</span></a><span class="sd">        &gt;&gt;&gt; # Press &#39;n&#39; to advance, &#39;q&#39; to quit</span>
</span><span id="Taulu-131"><a href="#Taulu-131"><span class="linenos">131</span></a><span class="sd">        &gt;&gt;&gt; grid = taulu.segment_table(&quot;table.png&quot;, debug_view=True)</span>
</span><span id="Taulu-132"><a href="#Taulu-132"><span class="linenos">132</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Taulu-133"><a href="#Taulu-133"><span class="linenos">133</span></a><span class="sd">        &gt;&gt;&gt; # Adjust parameters based on what you see:</span>
</span><span id="Taulu-134"><a href="#Taulu-134"><span class="linenos">134</span></a><span class="sd">        &gt;&gt;&gt; # - If binarization is too noisy: increase sauvola_k</span>
</span><span id="Taulu-135"><a href="#Taulu-135"><span class="linenos">135</span></a><span class="sd">        &gt;&gt;&gt; # - If lines are broken after morphology: increase morph_size</span>
</span><span id="Taulu-136"><a href="#Taulu-136"><span class="linenos">136</span></a><span class="sd">        &gt;&gt;&gt; # - If filtered image has &quot;undefined&quot; corners: adjust cross_width to match line thickness (after morphology)</span>
</span><span id="Taulu-137"><a href="#Taulu-137"><span class="linenos">137</span></a><span class="sd">        &gt;&gt;&gt; # - If corners are missed during search: decrease grow_threshold or increase search_region</span>
</span><span id="Taulu-138"><a href="#Taulu-138"><span class="linenos">138</span></a>
</span><span id="Taulu-139"><a href="#Taulu-139"><span class="linenos">139</span></a>
</span><span id="Taulu-140"><a href="#Taulu-140"><span class="linenos">140</span></a><span class="sd">    Attributes:</span>
</span><span id="Taulu-141"><a href="#Taulu-141"><span class="linenos">141</span></a><span class="sd">        _header (MatLike | Split[MatLike]): Loaded header image(s)</span>
</span><span id="Taulu-142"><a href="#Taulu-142"><span class="linenos">142</span></a><span class="sd">        _aligner (HeaderAligner | Split[HeaderAligner]): Header alignment engine(s)</span>
</span><span id="Taulu-143"><a href="#Taulu-143"><span class="linenos">143</span></a><span class="sd">        _template (HeaderTemplate | Split[HeaderTemplate]): Parsed header structure(s)</span>
</span><span id="Taulu-144"><a href="#Taulu-144"><span class="linenos">144</span></a><span class="sd">        _grid_detector (GridDetector | Split[GridDetector]): Grid detection engine(s)</span>
</span><span id="Taulu-145"><a href="#Taulu-145"><span class="linenos">145</span></a><span class="sd">        _cell_heights (list[int] | Split[list[int]]): Computed cell heights in pixels</span>
</span><span id="Taulu-146"><a href="#Taulu-146"><span class="linenos">146</span></a>
</span><span id="Taulu-147"><a href="#Taulu-147"><span class="linenos">147</span></a><span class="sd">    Raises:</span>
</span><span id="Taulu-148"><a href="#Taulu-148"><span class="linenos">148</span></a><span class="sd">        TauluException: If header files don&#39;t exist, annotation is missing, or</span>
</span><span id="Taulu-149"><a href="#Taulu-149"><span class="linenos">149</span></a><span class="sd">            Split parameters are used incorrectly with single headers</span>
</span><span id="Taulu-150"><a href="#Taulu-150"><span class="linenos">150</span></a>
</span><span id="Taulu-151"><a href="#Taulu-151"><span class="linenos">151</span></a><span class="sd">    See Also:</span>
</span><span id="Taulu-152"><a href="#Taulu-152"><span class="linenos">152</span></a><span class="sd">        - `TableGrid`: The result object with methods for accessing cells</span>
</span><span id="Taulu-153"><a href="#Taulu-153"><span class="linenos">153</span></a><span class="sd">        - `Split`: Container for paired left/right parameters</span>
</span><span id="Taulu-154"><a href="#Taulu-154"><span class="linenos">154</span></a><span class="sd">        - `GridDetector`: Lower-level grid detection (for advanced usage)</span>
</span><span id="Taulu-155"><a href="#Taulu-155"><span class="linenos">155</span></a><span class="sd">        - `HeaderAligner`: Lower-level header alignment (for advanced usage)</span>
</span><span id="Taulu-156"><a href="#Taulu-156"><span class="linenos">156</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Taulu-157"><a href="#Taulu-157"><span class="linenos">157</span></a>
</span><span id="Taulu-158"><a href="#Taulu-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Taulu-159"><a href="#Taulu-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Taulu-160"><a href="#Taulu-160"><span class="linenos">160</span></a>        <span class="n">header_image_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="Taulu-161"><a href="#Taulu-161"><span class="linenos">161</span></a>        <span class="n">cell_height_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
</span><span id="Taulu-162"><a href="#Taulu-162"><span class="linenos">162</span></a>        <span class="n">header_anno_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="Taulu-163"><a href="#Taulu-163"><span class="linenos">163</span></a>        <span class="o">|</span> <span class="nb">str</span>
</span><span id="Taulu-164"><a href="#Taulu-164"><span class="linenos">164</span></a>        <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="Taulu-165"><a href="#Taulu-165"><span class="linenos">165</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Taulu-166"><a href="#Taulu-166"><span class="linenos">166</span></a>        <span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="Taulu-167"><a href="#Taulu-167"><span class="linenos">167</span></a>        <span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
</span><span id="Taulu-168"><a href="#Taulu-168"><span class="linenos">168</span></a>        <span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="Taulu-169"><a href="#Taulu-169"><span class="linenos">169</span></a>        <span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Taulu-170"><a href="#Taulu-170"><span class="linenos">170</span></a>        <span class="n">morph_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Taulu-171"><a href="#Taulu-171"><span class="linenos">171</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span><span class="p">,</span>
</span><span id="Taulu-172"><a href="#Taulu-172"><span class="linenos">172</span></a>        <span class="n">processing_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Taulu-173"><a href="#Taulu-173"><span class="linenos">173</span></a>        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Taulu-174"><a href="#Taulu-174"><span class="linenos">174</span></a>        <span class="n">look_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="Taulu-175"><a href="#Taulu-175"><span class="linenos">175</span></a>        <span class="n">grow_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="Taulu-176"><a href="#Taulu-176"><span class="linenos">176</span></a>        <span class="n">smooth_grid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Taulu-177"><a href="#Taulu-177"><span class="linenos">177</span></a>    <span class="p">):</span>
</span><span id="Taulu-178"><a href="#Taulu-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu-179"><a href="#Taulu-179"><span class="linenos">179</span></a><span class="sd">        Args:</span>
</span><span id="Taulu-180"><a href="#Taulu-180"><span class="linenos">180</span></a><span class="sd">            header_image_path:</span>
</span><span id="Taulu-181"><a href="#Taulu-181"><span class="linenos">181</span></a><span class="sd">                Path to the header template image(s). The header should be a cropped</span>
</span><span id="Taulu-182"><a href="#Taulu-182"><span class="linenos">182</span></a><span class="sd">                image showing a clear view of the table&#39;s first row. An annotation</span>
</span><span id="Taulu-183"><a href="#Taulu-183"><span class="linenos">183</span></a><span class="sd">                file (.json) must exist alongside the image, created via `Taulu.annotate()`.</span>
</span><span id="Taulu-184"><a href="#Taulu-184"><span class="linenos">184</span></a><span class="sd">                For split tables, provide a `Split` containing left and right header paths.</span>
</span><span id="Taulu-185"><a href="#Taulu-185"><span class="linenos">185</span></a>
</span><span id="Taulu-186"><a href="#Taulu-186"><span class="linenos">186</span></a><span class="sd">            cell_height_factor:</span>
</span><span id="Taulu-187"><a href="#Taulu-187"><span class="linenos">187</span></a><span class="sd">                Height of data rows relative to header height. For example, if your</span>
</span><span id="Taulu-188"><a href="#Taulu-188"><span class="linenos">188</span></a><span class="sd">                header is 100px tall and data rows are 80px tall, use 0.8.</span>
</span><span id="Taulu-189"><a href="#Taulu-189"><span class="linenos">189</span></a>
</span><span id="Taulu-190"><a href="#Taulu-190"><span class="linenos">190</span></a><span class="sd">                - **float**: All rows have the same height</span>
</span><span id="Taulu-191"><a href="#Taulu-191"><span class="linenos">191</span></a><span class="sd">                - **list[float]**: Different heights for different rows. The last value</span>
</span><span id="Taulu-192"><a href="#Taulu-192"><span class="linenos">192</span></a><span class="sd">                  is repeated for any additional rows beyond the list length. Useful when</span>
</span><span id="Taulu-193"><a href="#Taulu-193"><span class="linenos">193</span></a><span class="sd">                  the first data row is taller than subsequent rows.</span>
</span><span id="Taulu-194"><a href="#Taulu-194"><span class="linenos">194</span></a><span class="sd">                - **Split**: Different height factors for left and right sides</span>
</span><span id="Taulu-195"><a href="#Taulu-195"><span class="linenos">195</span></a>
</span><span id="Taulu-196"><a href="#Taulu-196"><span class="linenos">196</span></a><span class="sd">                Default: [1.0]</span>
</span><span id="Taulu-197"><a href="#Taulu-197"><span class="linenos">197</span></a>
</span><span id="Taulu-198"><a href="#Taulu-198"><span class="linenos">198</span></a><span class="sd">            header_anno_path (PathLike[str] | str | Split[PathLike[str] | str] | None):</span>
</span><span id="Taulu-199"><a href="#Taulu-199"><span class="linenos">199</span></a><span class="sd">                Optional explicit path to header annotation JSON file(s). If None,</span>
</span><span id="Taulu-200"><a href="#Taulu-200"><span class="linenos">200</span></a><span class="sd">                looks for a .json file with the same name as `header_image_path`.</span>
</span><span id="Taulu-201"><a href="#Taulu-201"><span class="linenos">201</span></a><span class="sd">                Default: None</span>
</span><span id="Taulu-202"><a href="#Taulu-202"><span class="linenos">202</span></a>
</span><span id="Taulu-203"><a href="#Taulu-203"><span class="linenos">203</span></a><span class="sd">            sauvola_k (float | Split[float]):</span>
</span><span id="Taulu-204"><a href="#Taulu-204"><span class="linenos">204</span></a><span class="sd">                Threshold sensitivity for Sauvola adaptive binarization (0.0-1.0).</span>
</span><span id="Taulu-205"><a href="#Taulu-205"><span class="linenos">205</span></a><span class="sd">                Controls how aggressively the algorithm converts the image to binary.</span>
</span><span id="Taulu-206"><a href="#Taulu-206"><span class="linenos">206</span></a>
</span><span id="Taulu-207"><a href="#Taulu-207"><span class="linenos">207</span></a><span class="sd">                - **Lower values** (0.04-0.15): Preserve faint lines, more noise</span>
</span><span id="Taulu-208"><a href="#Taulu-208"><span class="linenos">208</span></a><span class="sd">                - **Higher values** (0.20-0.35): Remove noise, may lose faint lines</span>
</span><span id="Taulu-209"><a href="#Taulu-209"><span class="linenos">209</span></a>
</span><span id="Taulu-210"><a href="#Taulu-210"><span class="linenos">210</span></a><span class="sd">                Start with 0.25 and adjust based on your image quality.</span>
</span><span id="Taulu-211"><a href="#Taulu-211"><span class="linenos">211</span></a><span class="sd">                Default: 0.25</span>
</span><span id="Taulu-212"><a href="#Taulu-212"><span class="linenos">212</span></a>
</span><span id="Taulu-213"><a href="#Taulu-213"><span class="linenos">213</span></a><span class="sd">            search_region (int | Split[int]):</span>
</span><span id="Taulu-214"><a href="#Taulu-214"><span class="linenos">214</span></a><span class="sd">                Size in pixels of the square region to search for the next corner point.</span>
</span><span id="Taulu-215"><a href="#Taulu-215"><span class="linenos">215</span></a><span class="sd">                The algorithm estimates where a corner should be, then searches within</span>
</span><span id="Taulu-216"><a href="#Taulu-216"><span class="linenos">216</span></a><span class="sd">                this region for the best match.</span>
</span><span id="Taulu-217"><a href="#Taulu-217"><span class="linenos">217</span></a>
</span><span id="Taulu-218"><a href="#Taulu-218"><span class="linenos">218</span></a><span class="sd">                - **Smaller values** (20-40): Faster, requires well-aligned tables</span>
</span><span id="Taulu-219"><a href="#Taulu-219"><span class="linenos">219</span></a><span class="sd">                - **Larger values** (60-100): More robust to warping and distortion</span>
</span><span id="Taulu-220"><a href="#Taulu-220"><span class="linenos">220</span></a>
</span><span id="Taulu-221"><a href="#Taulu-221"><span class="linenos">221</span></a><span class="sd">                Default: 60</span>
</span><span id="Taulu-222"><a href="#Taulu-222"><span class="linenos">222</span></a>
</span><span id="Taulu-223"><a href="#Taulu-223"><span class="linenos">223</span></a><span class="sd">            distance_penalty (float | Split[float]):</span>
</span><span id="Taulu-224"><a href="#Taulu-224"><span class="linenos">224</span></a><span class="sd">                Weight factor [0, 1] for penalizing corners far from expected position.</span>
</span><span id="Taulu-225"><a href="#Taulu-225"><span class="linenos">225</span></a><span class="sd">                Uses Gaussian weighting within the search region.</span>
</span><span id="Taulu-226"><a href="#Taulu-226"><span class="linenos">226</span></a>
</span><span id="Taulu-227"><a href="#Taulu-227"><span class="linenos">227</span></a><span class="sd">                - **0.0**: No penalty, any position in search region is equally valid</span>
</span><span id="Taulu-228"><a href="#Taulu-228"><span class="linenos">228</span></a><span class="sd">                - **0.5**: Moderate preference for positions near the expected location</span>
</span><span id="Taulu-229"><a href="#Taulu-229"><span class="linenos">229</span></a><span class="sd">                - **1.0**: Strong preference, only accepts positions very close to expected</span>
</span><span id="Taulu-230"><a href="#Taulu-230"><span class="linenos">230</span></a>
</span><span id="Taulu-231"><a href="#Taulu-231"><span class="linenos">231</span></a><span class="sd">                Default: 0.4</span>
</span><span id="Taulu-232"><a href="#Taulu-232"><span class="linenos">232</span></a>
</span><span id="Taulu-233"><a href="#Taulu-233"><span class="linenos">233</span></a><span class="sd">            cross_width (int | Split[int]):</span>
</span><span id="Taulu-234"><a href="#Taulu-234"><span class="linenos">234</span></a><span class="sd">                Width in pixels of the cross-shaped kernel used to detect intersections.</span>
</span><span id="Taulu-235"><a href="#Taulu-235"><span class="linenos">235</span></a><span class="sd">                Should approximately match the thickness of your table rules AFTER</span>
</span><span id="Taulu-236"><a href="#Taulu-236"><span class="linenos">236</span></a><span class="sd">                morphological dilation.</span>
</span><span id="Taulu-237"><a href="#Taulu-237"><span class="linenos">237</span></a>
</span><span id="Taulu-238"><a href="#Taulu-238"><span class="linenos">238</span></a><span class="sd">                **Tuning**: Look at the dilated image in debug_view. The cross_width</span>
</span><span id="Taulu-239"><a href="#Taulu-239"><span class="linenos">239</span></a><span class="sd">                should match the thickness of the black lines you see.</span>
</span><span id="Taulu-240"><a href="#Taulu-240"><span class="linenos">240</span></a><span class="sd">                Default: 10</span>
</span><span id="Taulu-241"><a href="#Taulu-241"><span class="linenos">241</span></a>
</span><span id="Taulu-242"><a href="#Taulu-242"><span class="linenos">242</span></a><span class="sd">            morph_size (int | Split[int]):</span>
</span><span id="Taulu-243"><a href="#Taulu-243"><span class="linenos">243</span></a><span class="sd">                Size of morphological structuring element for dilation. Controls how</span>
</span><span id="Taulu-244"><a href="#Taulu-244"><span class="linenos">244</span></a><span class="sd">                much gap-bridging occurs to connect broken line segments.</span>
</span><span id="Taulu-245"><a href="#Taulu-245"><span class="linenos">245</span></a>
</span><span id="Taulu-246"><a href="#Taulu-246"><span class="linenos">246</span></a><span class="sd">                - **Smaller values** (2-4): Minimal connection, preserves thin lines</span>
</span><span id="Taulu-247"><a href="#Taulu-247"><span class="linenos">247</span></a><span class="sd">                - **Larger values** (6-10): Connects larger gaps, but thickens lines</span>
</span><span id="Taulu-248"><a href="#Taulu-248"><span class="linenos">248</span></a>
</span><span id="Taulu-249"><a href="#Taulu-249"><span class="linenos">249</span></a><span class="sd">                Note: Increasing this requires increasing `cross_width` proportionally.</span>
</span><span id="Taulu-250"><a href="#Taulu-250"><span class="linenos">250</span></a><span class="sd">                Default: 4</span>
</span><span id="Taulu-251"><a href="#Taulu-251"><span class="linenos">251</span></a>
</span><span id="Taulu-252"><a href="#Taulu-252"><span class="linenos">252</span></a><span class="sd">            kernel_size (int | Split[int]):</span>
</span><span id="Taulu-253"><a href="#Taulu-253"><span class="linenos">253</span></a><span class="sd">                Size of the cross-shaped kernel (must be odd). Larger kernels are more</span>
</span><span id="Taulu-254"><a href="#Taulu-254"><span class="linenos">254</span></a><span class="sd">                selective, reducing false positives but potentially missing valid corners.</span>
</span><span id="Taulu-255"><a href="#Taulu-255"><span class="linenos">255</span></a>
</span><span id="Taulu-256"><a href="#Taulu-256"><span class="linenos">256</span></a><span class="sd">                - **Smaller values** (21-31): More sensitive, finds more candidates</span>
</span><span id="Taulu-257"><a href="#Taulu-257"><span class="linenos">257</span></a><span class="sd">                - **Larger values** (41-61): More selective, fewer false positives</span>
</span><span id="Taulu-258"><a href="#Taulu-258"><span class="linenos">258</span></a>
</span><span id="Taulu-259"><a href="#Taulu-259"><span class="linenos">259</span></a><span class="sd">                Default: 41</span>
</span><span id="Taulu-260"><a href="#Taulu-260"><span class="linenos">260</span></a>
</span><span id="Taulu-261"><a href="#Taulu-261"><span class="linenos">261</span></a><span class="sd">            processing_scale (float | Split[float]):</span>
</span><span id="Taulu-262"><a href="#Taulu-262"><span class="linenos">262</span></a><span class="sd">                Image downscaling factor (0, 1] for processing speed. Processing is done</span>
</span><span id="Taulu-263"><a href="#Taulu-263"><span class="linenos">263</span></a><span class="sd">                on scaled images, then results are scaled back to original size.</span>
</span><span id="Taulu-264"><a href="#Taulu-264"><span class="linenos">264</span></a>
</span><span id="Taulu-265"><a href="#Taulu-265"><span class="linenos">265</span></a><span class="sd">                - **1.0**: Full resolution (slowest, most accurate)</span>
</span><span id="Taulu-266"><a href="#Taulu-266"><span class="linenos">266</span></a><span class="sd">                - **0.5-0.75**: Good balance for high-res scans (2x-4x speedup)</span>
</span><span id="Taulu-267"><a href="#Taulu-267"><span class="linenos">267</span></a><span class="sd">                - **0.25-0.5**: Fast processing for very large images</span>
</span><span id="Taulu-268"><a href="#Taulu-268"><span class="linenos">268</span></a>
</span><span id="Taulu-269"><a href="#Taulu-269"><span class="linenos">269</span></a><span class="sd">                Default: 1.0</span>
</span><span id="Taulu-270"><a href="#Taulu-270"><span class="linenos">270</span></a>
</span><span id="Taulu-271"><a href="#Taulu-271"><span class="linenos">271</span></a><span class="sd">            min_rows (int | Split[int]):</span>
</span><span id="Taulu-272"><a href="#Taulu-272"><span class="linenos">272</span></a><span class="sd">                Minimum number of rows required before the algorithm considers the</span>
</span><span id="Taulu-273"><a href="#Taulu-273"><span class="linenos">273</span></a><span class="sd">                table complete. Prevents stopping too early on tables with initial</span>
</span><span id="Taulu-274"><a href="#Taulu-274"><span class="linenos">274</span></a><span class="sd">                low-confidence detections.</span>
</span><span id="Taulu-275"><a href="#Taulu-275"><span class="linenos">275</span></a><span class="sd">                Default: 5</span>
</span><span id="Taulu-276"><a href="#Taulu-276"><span class="linenos">276</span></a>
</span><span id="Taulu-277"><a href="#Taulu-277"><span class="linenos">277</span></a><span class="sd">            look_distance (int | Split[int]):</span>
</span><span id="Taulu-278"><a href="#Taulu-278"><span class="linenos">278</span></a><span class="sd">                Number of adjacent rows/columns to examine when extrapolating missing</span>
</span><span id="Taulu-279"><a href="#Taulu-279"><span class="linenos">279</span></a><span class="sd">                corners using polynomial regression. Higher values provide more context</span>
</span><span id="Taulu-280"><a href="#Taulu-280"><span class="linenos">280</span></a><span class="sd">                but may smooth over legitimate variations.</span>
</span><span id="Taulu-281"><a href="#Taulu-281"><span class="linenos">281</span></a>
</span><span id="Taulu-282"><a href="#Taulu-282"><span class="linenos">282</span></a><span class="sd">                - **2-3**: Good for consistent grids</span>
</span><span id="Taulu-283"><a href="#Taulu-283"><span class="linenos">283</span></a><span class="sd">                - **4-6**: Better for grids with some irregularity</span>
</span><span id="Taulu-284"><a href="#Taulu-284"><span class="linenos">284</span></a>
</span><span id="Taulu-285"><a href="#Taulu-285"><span class="linenos">285</span></a><span class="sd">                Default: 3</span>
</span><span id="Taulu-286"><a href="#Taulu-286"><span class="linenos">286</span></a>
</span><span id="Taulu-287"><a href="#Taulu-287"><span class="linenos">287</span></a><span class="sd">            grow_threshold (float | Split[float]):</span>
</span><span id="Taulu-288"><a href="#Taulu-288"><span class="linenos">288</span></a><span class="sd">                Initial minimum confidence [0, 1] required to accept a detected corner</span>
</span><span id="Taulu-289"><a href="#Taulu-289"><span class="linenos">289</span></a><span class="sd">                during the growing phase. The algorithm may adaptively lower this</span>
</span><span id="Taulu-290"><a href="#Taulu-290"><span class="linenos">290</span></a><span class="sd">                threshold if growth stalls.</span>
</span><span id="Taulu-291"><a href="#Taulu-291"><span class="linenos">291</span></a>
</span><span id="Taulu-292"><a href="#Taulu-292"><span class="linenos">292</span></a><span class="sd">                - **Higher values** (0.5-0.8): Stricter, fewer errors but may miss valid corners</span>
</span><span id="Taulu-293"><a href="#Taulu-293"><span class="linenos">293</span></a><span class="sd">                - **Lower values** (0.2-0.4): More permissive, finds more corners but more errors</span>
</span><span id="Taulu-294"><a href="#Taulu-294"><span class="linenos">294</span></a>
</span><span id="Taulu-295"><a href="#Taulu-295"><span class="linenos">295</span></a><span class="sd">                Default: 0.3</span>
</span><span id="Taulu-296"><a href="#Taulu-296"><span class="linenos">296</span></a>
</span><span id="Taulu-297"><a href="#Taulu-297"><span class="linenos">297</span></a><span class="sd">            smooth_grid (bool | Split[bool]):</span>
</span><span id="Taulu-298"><a href="#Taulu-298"><span class="linenos">298</span></a><span class="sd">                Whether or not to apply local smoothing logic to the grid after point detection.</span>
</span><span id="Taulu-299"><a href="#Taulu-299"><span class="linenos">299</span></a><span class="sd">                This may clean up rugged parts of the grid but could also lead to small inaccuracies</span>
</span><span id="Taulu-300"><a href="#Taulu-300"><span class="linenos">300</span></a><span class="sd">                if the grid is actually locally _not smooth_.</span>
</span><span id="Taulu-301"><a href="#Taulu-301"><span class="linenos">301</span></a>
</span><span id="Taulu-302"><a href="#Taulu-302"><span class="linenos">302</span></a><span class="sd">                Default: False</span>
</span><span id="Taulu-303"><a href="#Taulu-303"><span class="linenos">303</span></a>
</span><span id="Taulu-304"><a href="#Taulu-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu-305"><a href="#Taulu-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span> <span class="o">=</span> <span class="n">processing_scale</span>
</span><span id="Taulu-306"><a href="#Taulu-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_height_factor</span> <span class="o">=</span> <span class="n">cell_height_factor</span>
</span><span id="Taulu-307"><a href="#Taulu-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_smooth</span> <span class="o">=</span> <span class="n">smooth_grid</span>
</span><span id="Taulu-308"><a href="#Taulu-308"><span class="linenos">308</span></a>
</span><span id="Taulu-309"><a href="#Taulu-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">,</span> <span class="n">Split</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_anno_path</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu-310"><a href="#Taulu-310"><span class="linenos">310</span></a>            <span class="n">header</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="o">.</span><span class="n">left</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
</span><span id="Taulu-311"><a href="#Taulu-311"><span class="linenos">311</span></a>
</span><span id="Taulu-312"><a href="#Taulu-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu-313"><a href="#Taulu-313"><span class="linenos">313</span></a>                <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Taulu-314"><a href="#Taulu-314"><span class="linenos">314</span></a>            <span class="p">):</span>
</span><span id="Taulu-315"><a href="#Taulu-315"><span class="linenos">315</span></a>                <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu-316"><a href="#Taulu-316"><span class="linenos">316</span></a>                    <span class="s2">&quot;The header images you provided do not exist (or they aren&#39;t .png files)&quot;</span>
</span><span id="Taulu-317"><a href="#Taulu-317"><span class="linenos">317</span></a>                <span class="p">)</span>
</span><span id="Taulu-318"><a href="#Taulu-318"><span class="linenos">318</span></a>
</span><span id="Taulu-319"><a href="#Taulu-319"><span class="linenos">319</span></a>            <span class="k">if</span> <span class="n">header_anno_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Taulu-320"><a href="#Taulu-320"><span class="linenos">320</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu-321"><a href="#Taulu-321"><span class="linenos">321</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu-322"><a href="#Taulu-322"><span class="linenos">322</span></a>                <span class="p">):</span>
</span><span id="Taulu-323"><a href="#Taulu-323"><span class="linenos">323</span></a>                    <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu-324"><a href="#Taulu-324"><span class="linenos">324</span></a>                        <span class="s2">&quot;You need to annotate the headers of your table first</span><span class="se">\n\n</span><span class="s2">see the Taulu.annotate method&quot;</span>
</span><span id="Taulu-325"><a href="#Taulu-325"><span class="linenos">325</span></a>                    <span class="p">)</span>
</span><span id="Taulu-326"><a href="#Taulu-326"><span class="linenos">326</span></a>
</span><span id="Taulu-327"><a href="#Taulu-327"><span class="linenos">327</span></a>                <span class="n">template_left</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu-328"><a href="#Taulu-328"><span class="linenos">328</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu-329"><a href="#Taulu-329"><span class="linenos">329</span></a>                <span class="p">)</span>
</span><span id="Taulu-330"><a href="#Taulu-330"><span class="linenos">330</span></a>                <span class="n">template_right</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu-331"><a href="#Taulu-331"><span class="linenos">331</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu-332"><a href="#Taulu-332"><span class="linenos">332</span></a>                <span class="p">)</span>
</span><span id="Taulu-333"><a href="#Taulu-333"><span class="linenos">333</span></a>
</span><span id="Taulu-334"><a href="#Taulu-334"><span class="linenos">334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu-335"><a href="#Taulu-335"><span class="linenos">335</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu-336"><a href="#Taulu-336"><span class="linenos">336</span></a>                    <span class="n">header_anno_path</span><span class="o">.</span><span class="n">right</span>
</span><span id="Taulu-337"><a href="#Taulu-337"><span class="linenos">337</span></a>                <span class="p">):</span>
</span><span id="Taulu-338"><a href="#Taulu-338"><span class="linenos">338</span></a>                    <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu-339"><a href="#Taulu-339"><span class="linenos">339</span></a>                        <span class="s2">&quot;The header annotation files you provided do not exist (or they aren&#39;t .json files)&quot;</span>
</span><span id="Taulu-340"><a href="#Taulu-340"><span class="linenos">340</span></a>                    <span class="p">)</span>
</span><span id="Taulu-341"><a href="#Taulu-341"><span class="linenos">341</span></a>
</span><span id="Taulu-342"><a href="#Taulu-342"><span class="linenos">342</span></a>                <span class="n">template_left</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
</span><span id="Taulu-343"><a href="#Taulu-343"><span class="linenos">343</span></a>                <span class="n">template_right</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
</span><span id="Taulu-344"><a href="#Taulu-344"><span class="linenos">344</span></a>
</span><span id="Taulu-345"><a href="#Taulu-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu-346"><a href="#Taulu-346"><span class="linenos">346</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="p">)),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
</span><span id="Taulu-347"><a href="#Taulu-347"><span class="linenos">347</span></a>            <span class="p">)</span>
</span><span id="Taulu-348"><a href="#Taulu-348"><span class="linenos">348</span></a>
</span><span id="Taulu-349"><a href="#Taulu-349"><span class="linenos">349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu-350"><a href="#Taulu-350"><span class="linenos">350</span></a>                <span class="n">HeaderAligner</span><span class="p">(</span>
</span><span id="Taulu-351"><a href="#Taulu-351"><span class="linenos">351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="Taulu-352"><a href="#Taulu-352"><span class="linenos">352</span></a>                <span class="p">),</span>
</span><span id="Taulu-353"><a href="#Taulu-353"><span class="linenos">353</span></a>                <span class="n">HeaderAligner</span><span class="p">(</span>
</span><span id="Taulu-354"><a href="#Taulu-354"><span class="linenos">354</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Taulu-355"><a href="#Taulu-355"><span class="linenos">355</span></a>                <span class="p">),</span>
</span><span id="Taulu-356"><a href="#Taulu-356"><span class="linenos">356</span></a>            <span class="p">)</span>
</span><span id="Taulu-357"><a href="#Taulu-357"><span class="linenos">357</span></a>
</span><span id="Taulu-358"><a href="#Taulu-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">template_left</span><span class="p">,</span> <span class="n">template_right</span><span class="p">)</span>
</span><span id="Taulu-359"><a href="#Taulu-359"><span class="linenos">359</span></a>
</span><span id="Taulu-360"><a href="#Taulu-360"><span class="linenos">360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu-361"><a href="#Taulu-361"><span class="linenos">361</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span><span class="n">get_param</span><span class="p">(</span><span class="n">cell_height_factor</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">)),</span>
</span><span id="Taulu-362"><a href="#Taulu-362"><span class="linenos">362</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span>
</span><span id="Taulu-363"><a href="#Taulu-363"><span class="linenos">363</span></a>                    <span class="n">get_param</span><span class="p">(</span><span class="n">cell_height_factor</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Taulu-364"><a href="#Taulu-364"><span class="linenos">364</span></a>                <span class="p">),</span>
</span><span id="Taulu-365"><a href="#Taulu-365"><span class="linenos">365</span></a>            <span class="p">)</span>
</span><span id="Taulu-366"><a href="#Taulu-366"><span class="linenos">366</span></a>
</span><span id="Taulu-367"><a href="#Taulu-367"><span class="linenos">367</span></a>            <span class="c1"># Create GridDetector for left and right with potentially different parameters</span>
</span><span id="Taulu-368"><a href="#Taulu-368"><span class="linenos">368</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu-369"><a href="#Taulu-369"><span class="linenos">369</span></a>                <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu-370"><a href="#Taulu-370"><span class="linenos">370</span></a>                    <span class="n">kernel_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-371"><a href="#Taulu-371"><span class="linenos">371</span></a>                    <span class="n">cross_width</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">cross_width</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-372"><a href="#Taulu-372"><span class="linenos">372</span></a>                    <span class="n">morph_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">morph_size</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-373"><a href="#Taulu-373"><span class="linenos">373</span></a>                    <span class="n">search_region</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">search_region</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-374"><a href="#Taulu-374"><span class="linenos">374</span></a>                    <span class="n">sauvola_k</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">sauvola_k</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-375"><a href="#Taulu-375"><span class="linenos">375</span></a>                    <span class="n">distance_penalty</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">distance_penalty</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-376"><a href="#Taulu-376"><span class="linenos">376</span></a>                    <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-377"><a href="#Taulu-377"><span class="linenos">377</span></a>                    <span class="n">min_rows</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">min_rows</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-378"><a href="#Taulu-378"><span class="linenos">378</span></a>                    <span class="n">look_distance</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">look_distance</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-379"><a href="#Taulu-379"><span class="linenos">379</span></a>                    <span class="n">grow_threshold</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">grow_threshold</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu-380"><a href="#Taulu-380"><span class="linenos">380</span></a>                <span class="p">),</span>
</span><span id="Taulu-381"><a href="#Taulu-381"><span class="linenos">381</span></a>                <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu-382"><a href="#Taulu-382"><span class="linenos">382</span></a>                    <span class="n">kernel_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-383"><a href="#Taulu-383"><span class="linenos">383</span></a>                    <span class="n">cross_width</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">cross_width</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-384"><a href="#Taulu-384"><span class="linenos">384</span></a>                    <span class="n">morph_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">morph_size</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-385"><a href="#Taulu-385"><span class="linenos">385</span></a>                    <span class="n">search_region</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">search_region</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-386"><a href="#Taulu-386"><span class="linenos">386</span></a>                    <span class="n">sauvola_k</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">sauvola_k</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-387"><a href="#Taulu-387"><span class="linenos">387</span></a>                    <span class="n">distance_penalty</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">distance_penalty</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-388"><a href="#Taulu-388"><span class="linenos">388</span></a>                    <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-389"><a href="#Taulu-389"><span class="linenos">389</span></a>                    <span class="n">min_rows</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">min_rows</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-390"><a href="#Taulu-390"><span class="linenos">390</span></a>                    <span class="n">look_distance</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">look_distance</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-391"><a href="#Taulu-391"><span class="linenos">391</span></a>                    <span class="n">grow_threshold</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">grow_threshold</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu-392"><a href="#Taulu-392"><span class="linenos">392</span></a>                <span class="p">),</span>
</span><span id="Taulu-393"><a href="#Taulu-393"><span class="linenos">393</span></a>            <span class="p">)</span>
</span><span id="Taulu-394"><a href="#Taulu-394"><span class="linenos">394</span></a>
</span><span id="Taulu-395"><a href="#Taulu-395"><span class="linenos">395</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu-396"><a href="#Taulu-396"><span class="linenos">396</span></a>            <span class="n">header_image_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">)</span>
</span><span id="Taulu-397"><a href="#Taulu-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">))</span>
</span><span id="Taulu-398"><a href="#Taulu-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span> <span class="o">=</span> <span class="n">HeaderAligner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">)</span>
</span><span id="Taulu-399"><a href="#Taulu-399"><span class="linenos">399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu-400"><a href="#Taulu-400"><span class="linenos">400</span></a>                <span class="n">header_image_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu-401"><a href="#Taulu-401"><span class="linenos">401</span></a>            <span class="p">)</span>
</span><span id="Taulu-402"><a href="#Taulu-402"><span class="linenos">402</span></a>
</span><span id="Taulu-403"><a href="#Taulu-403"><span class="linenos">403</span></a>            <span class="c1"># For single header, parameters should not be Split objects</span>
</span><span id="Taulu-404"><a href="#Taulu-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="Taulu-405"><a href="#Taulu-405"><span class="linenos">405</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Split</span><span class="p">)</span>
</span><span id="Taulu-406"><a href="#Taulu-406"><span class="linenos">406</span></a>                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Taulu-407"><a href="#Taulu-407"><span class="linenos">407</span></a>                    <span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="Taulu-408"><a href="#Taulu-408"><span class="linenos">408</span></a>                    <span class="n">search_region</span><span class="p">,</span>
</span><span id="Taulu-409"><a href="#Taulu-409"><span class="linenos">409</span></a>                    <span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="Taulu-410"><a href="#Taulu-410"><span class="linenos">410</span></a>                    <span class="n">cross_width</span><span class="p">,</span>
</span><span id="Taulu-411"><a href="#Taulu-411"><span class="linenos">411</span></a>                    <span class="n">morph_size</span><span class="p">,</span>
</span><span id="Taulu-412"><a href="#Taulu-412"><span class="linenos">412</span></a>                    <span class="n">kernel_size</span><span class="p">,</span>
</span><span id="Taulu-413"><a href="#Taulu-413"><span class="linenos">413</span></a>                    <span class="n">processing_scale</span><span class="p">,</span>
</span><span id="Taulu-414"><a href="#Taulu-414"><span class="linenos">414</span></a>                    <span class="n">min_rows</span><span class="p">,</span>
</span><span id="Taulu-415"><a href="#Taulu-415"><span class="linenos">415</span></a>                    <span class="n">look_distance</span><span class="p">,</span>
</span><span id="Taulu-416"><a href="#Taulu-416"><span class="linenos">416</span></a>                    <span class="n">grow_threshold</span><span class="p">,</span>
</span><span id="Taulu-417"><a href="#Taulu-417"><span class="linenos">417</span></a>                    <span class="n">cell_height_factor</span><span class="p">,</span>
</span><span id="Taulu-418"><a href="#Taulu-418"><span class="linenos">418</span></a>                <span class="p">]</span>
</span><span id="Taulu-419"><a href="#Taulu-419"><span class="linenos">419</span></a>            <span class="p">):</span>
</span><span id="Taulu-420"><a href="#Taulu-420"><span class="linenos">420</span></a>                <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu-421"><a href="#Taulu-421"><span class="linenos">421</span></a>                    <span class="s2">&quot;Split parameters can only be used with split headers (tuple header_path)&quot;</span>
</span><span id="Taulu-422"><a href="#Taulu-422"><span class="linenos">422</span></a>                <span class="p">)</span>
</span><span id="Taulu-423"><a href="#Taulu-423"><span class="linenos">423</span></a>
</span><span id="Taulu-424"><a href="#Taulu-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_height_factor</span><span class="p">)</span>
</span><span id="Taulu-425"><a href="#Taulu-425"><span class="linenos">425</span></a>
</span><span id="Taulu-426"><a href="#Taulu-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span> <span class="o">=</span> <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu-427"><a href="#Taulu-427"><span class="linenos">427</span></a>                <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
</span><span id="Taulu-428"><a href="#Taulu-428"><span class="linenos">428</span></a>                <span class="n">cross_width</span><span class="o">=</span><span class="n">cross_width</span><span class="p">,</span>
</span><span id="Taulu-429"><a href="#Taulu-429"><span class="linenos">429</span></a>                <span class="n">morph_size</span><span class="o">=</span><span class="n">morph_size</span><span class="p">,</span>
</span><span id="Taulu-430"><a href="#Taulu-430"><span class="linenos">430</span></a>                <span class="n">search_region</span><span class="o">=</span><span class="n">search_region</span><span class="p">,</span>
</span><span id="Taulu-431"><a href="#Taulu-431"><span class="linenos">431</span></a>                <span class="n">sauvola_k</span><span class="o">=</span><span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="Taulu-432"><a href="#Taulu-432"><span class="linenos">432</span></a>                <span class="n">distance_penalty</span><span class="o">=</span><span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="Taulu-433"><a href="#Taulu-433"><span class="linenos">433</span></a>                <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span>
</span><span id="Taulu-434"><a href="#Taulu-434"><span class="linenos">434</span></a>                <span class="n">min_rows</span><span class="o">=</span><span class="n">min_rows</span><span class="p">,</span>
</span><span id="Taulu-435"><a href="#Taulu-435"><span class="linenos">435</span></a>                <span class="n">look_distance</span><span class="o">=</span><span class="n">look_distance</span><span class="p">,</span>
</span><span id="Taulu-436"><a href="#Taulu-436"><span class="linenos">436</span></a>                <span class="n">grow_threshold</span><span class="o">=</span><span class="n">grow_threshold</span><span class="p">,</span>
</span><span id="Taulu-437"><a href="#Taulu-437"><span class="linenos">437</span></a>            <span class="p">)</span>
</span><span id="Taulu-438"><a href="#Taulu-438"><span class="linenos">438</span></a>
</span><span id="Taulu-439"><a href="#Taulu-439"><span class="linenos">439</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Taulu-440"><a href="#Taulu-440"><span class="linenos">440</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">annotate</span><span class="p">(</span><span class="n">image_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Taulu-441"><a href="#Taulu-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu-442"><a href="#Taulu-442"><span class="linenos">442</span></a><span class="sd">        Interactive tool to create header annotations for table segmentation.</span>
</span><span id="Taulu-443"><a href="#Taulu-443"><span class="linenos">443</span></a>
</span><span id="Taulu-444"><a href="#Taulu-444"><span class="linenos">444</span></a><span class="sd">        This method guides you through a two-step annotation process:</span>
</span><span id="Taulu-445"><a href="#Taulu-445"><span class="linenos">445</span></a>
</span><span id="Taulu-446"><a href="#Taulu-446"><span class="linenos">446</span></a><span class="sd">        1. **Crop the header**: Click four corners to define the header region</span>
</span><span id="Taulu-447"><a href="#Taulu-447"><span class="linenos">447</span></a><span class="sd">        2. **Annotate lines**: Click pairs of points to define each vertical and</span>
</span><span id="Taulu-448"><a href="#Taulu-448"><span class="linenos">448</span></a><span class="sd">           horizontal line in the header</span>
</span><span id="Taulu-449"><a href="#Taulu-449"><span class="linenos">449</span></a>
</span><span id="Taulu-450"><a href="#Taulu-450"><span class="linenos">450</span></a><span class="sd">        The annotations are saved as:</span>
</span><span id="Taulu-451"><a href="#Taulu-451"><span class="linenos">451</span></a><span class="sd">        - A cropped header image (.png) at `output_path`</span>
</span><span id="Taulu-452"><a href="#Taulu-452"><span class="linenos">452</span></a><span class="sd">        - A JSON file (.json) containing line coordinates</span>
</span><span id="Taulu-453"><a href="#Taulu-453"><span class="linenos">453</span></a>
</span><span id="Taulu-454"><a href="#Taulu-454"><span class="linenos">454</span></a><span class="sd">        ## Annotation Guidelines</span>
</span><span id="Taulu-455"><a href="#Taulu-455"><span class="linenos">455</span></a>
</span><span id="Taulu-456"><a href="#Taulu-456"><span class="linenos">456</span></a><span class="sd">        **Which lines to annotate:**</span>
</span><span id="Taulu-457"><a href="#Taulu-457"><span class="linenos">457</span></a><span class="sd">        - All vertical lines that extend into the table body (column separators)</span>
</span><span id="Taulu-458"><a href="#Taulu-458"><span class="linenos">458</span></a><span class="sd">        - The top horizontal line of the header</span>
</span><span id="Taulu-459"><a href="#Taulu-459"><span class="linenos">459</span></a><span class="sd">        - The bottom horizontal line of the header (top of data rows)</span>
</span><span id="Taulu-460"><a href="#Taulu-460"><span class="linenos">460</span></a>
</span><span id="Taulu-461"><a href="#Taulu-461"><span class="linenos">461</span></a><span class="sd">        **Order doesn&#39;t matter** - annotate lines in any order that&#39;s convenient.</span>
</span><span id="Taulu-462"><a href="#Taulu-462"><span class="linenos">462</span></a>
</span><span id="Taulu-463"><a href="#Taulu-463"><span class="linenos">463</span></a><span class="sd">        **To annotate a line:**</span>
</span><span id="Taulu-464"><a href="#Taulu-464"><span class="linenos">464</span></a><span class="sd">        1. Click once at one endpoint</span>
</span><span id="Taulu-465"><a href="#Taulu-465"><span class="linenos">465</span></a><span class="sd">        2. Click again at the other endpoint</span>
</span><span id="Taulu-466"><a href="#Taulu-466"><span class="linenos">466</span></a><span class="sd">        3. A green line appears showing your annotation</span>
</span><span id="Taulu-467"><a href="#Taulu-467"><span class="linenos">467</span></a>
</span><span id="Taulu-468"><a href="#Taulu-468"><span class="linenos">468</span></a><span class="sd">        **To undo:**</span>
</span><span id="Taulu-469"><a href="#Taulu-469"><span class="linenos">469</span></a><span class="sd">        - Right-click anywhere to remove the last line you drew</span>
</span><span id="Taulu-470"><a href="#Taulu-470"><span class="linenos">470</span></a>
</span><span id="Taulu-471"><a href="#Taulu-471"><span class="linenos">471</span></a><span class="sd">        **When finished:**</span>
</span><span id="Taulu-472"><a href="#Taulu-472"><span class="linenos">472</span></a><span class="sd">        - Press &#39;n&#39; to save and exit</span>
</span><span id="Taulu-473"><a href="#Taulu-473"><span class="linenos">473</span></a><span class="sd">        - Press &#39;q&#39; to quit without saving</span>
</span><span id="Taulu-474"><a href="#Taulu-474"><span class="linenos">474</span></a>
</span><span id="Taulu-475"><a href="#Taulu-475"><span class="linenos">475</span></a><span class="sd">        Args:</span>
</span><span id="Taulu-476"><a href="#Taulu-476"><span class="linenos">476</span></a><span class="sd">            image_path (PathLike[str] | str): Path to a table image containing</span>
</span><span id="Taulu-477"><a href="#Taulu-477"><span class="linenos">477</span></a><span class="sd">                a clear view of the header. This can be a full table image.</span>
</span><span id="Taulu-478"><a href="#Taulu-478"><span class="linenos">478</span></a><span class="sd">            output_path (PathLike[str] | str): Where to save the cropped header</span>
</span><span id="Taulu-479"><a href="#Taulu-479"><span class="linenos">479</span></a><span class="sd">                image. The annotation JSON will be saved with the same name but</span>
</span><span id="Taulu-480"><a href="#Taulu-480"><span class="linenos">480</span></a><span class="sd">                .json extension.</span>
</span><span id="Taulu-481"><a href="#Taulu-481"><span class="linenos">481</span></a>
</span><span id="Taulu-482"><a href="#Taulu-482"><span class="linenos">482</span></a><span class="sd">        Raises:</span>
</span><span id="Taulu-483"><a href="#Taulu-483"><span class="linenos">483</span></a><span class="sd">            TauluException: If image_path doesn&#39;t exist or output_path is a directory</span>
</span><span id="Taulu-484"><a href="#Taulu-484"><span class="linenos">484</span></a>
</span><span id="Taulu-485"><a href="#Taulu-485"><span class="linenos">485</span></a><span class="sd">        Examples:</span>
</span><span id="Taulu-486"><a href="#Taulu-486"><span class="linenos">486</span></a><span class="sd">            Annotate a single header:</span>
</span><span id="Taulu-487"><a href="#Taulu-487"><span class="linenos">487</span></a>
</span><span id="Taulu-488"><a href="#Taulu-488"><span class="linenos">488</span></a><span class="sd">            &gt;&gt;&gt; from taulu import Taulu</span>
</span><span id="Taulu-489"><a href="#Taulu-489"><span class="linenos">489</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header.png&quot;)</span>
</span><span id="Taulu-490"><a href="#Taulu-490"><span class="linenos">490</span></a><span class="sd">            # Interactive window opens</span>
</span><span id="Taulu-491"><a href="#Taulu-491"><span class="linenos">491</span></a><span class="sd">            # After annotation: creates header.png and header.json</span>
</span><span id="Taulu-492"><a href="#Taulu-492"><span class="linenos">492</span></a>
</span><span id="Taulu-493"><a href="#Taulu-493"><span class="linenos">493</span></a><span class="sd">            Annotate left and right headers for a split table:</span>
</span><span id="Taulu-494"><a href="#Taulu-494"><span class="linenos">494</span></a>
</span><span id="Taulu-495"><a href="#Taulu-495"><span class="linenos">495</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header_left.png&quot;)</span>
</span><span id="Taulu-496"><a href="#Taulu-496"><span class="linenos">496</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header_right.png&quot;)</span>
</span><span id="Taulu-497"><a href="#Taulu-497"><span class="linenos">497</span></a><span class="sd">            # Creates header_left.{png,json} and header_right.{png,json}</span>
</span><span id="Taulu-498"><a href="#Taulu-498"><span class="linenos">498</span></a>
</span><span id="Taulu-499"><a href="#Taulu-499"><span class="linenos">499</span></a><span class="sd">        Notes:</span>
</span><span id="Taulu-500"><a href="#Taulu-500"><span class="linenos">500</span></a><span class="sd">            - The header image doesn&#39;t need to be perfectly cropped initially -</span>
</span><span id="Taulu-501"><a href="#Taulu-501"><span class="linenos">501</span></a><span class="sd">              the tool will help you crop it precisely</span>
</span><span id="Taulu-502"><a href="#Taulu-502"><span class="linenos">502</span></a><span class="sd">            - Annotation accuracy is important: misaligned lines will cause</span>
</span><span id="Taulu-503"><a href="#Taulu-503"><span class="linenos">503</span></a><span class="sd">              segmentation errors</span>
</span><span id="Taulu-504"><a href="#Taulu-504"><span class="linenos">504</span></a><span class="sd">            - You can re-run this method to update annotations if needed</span>
</span><span id="Taulu-505"><a href="#Taulu-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu-506"><a href="#Taulu-506"><span class="linenos">506</span></a>
</span><span id="Taulu-507"><a href="#Taulu-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
</span><span id="Taulu-508"><a href="#Taulu-508"><span class="linenos">508</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image path </span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
</span><span id="Taulu-509"><a href="#Taulu-509"><span class="linenos">509</span></a>
</span><span id="Taulu-510"><a href="#Taulu-510"><span class="linenos">510</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
</span><span id="Taulu-511"><a href="#Taulu-511"><span class="linenos">511</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;Output path should be a file&quot;</span><span class="p">)</span>
</span><span id="Taulu-512"><a href="#Taulu-512"><span class="linenos">512</span></a>
</span><span id="Taulu-513"><a href="#Taulu-513"><span class="linenos">513</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</span><span id="Taulu-514"><a href="#Taulu-514"><span class="linenos">514</span></a>
</span><span id="Taulu-515"><a href="#Taulu-515"><span class="linenos">515</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">annotate_image</span><span class="p">(</span>
</span><span id="Taulu-516"><a href="#Taulu-516"><span class="linenos">516</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span> <span class="n">crop</span><span class="o">=</span><span class="n">output_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Taulu-517"><a href="#Taulu-517"><span class="linenos">517</span></a>        <span class="p">)</span>
</span><span id="Taulu-518"><a href="#Taulu-518"><span class="linenos">518</span></a>
</span><span id="Taulu-519"><a href="#Taulu-519"><span class="linenos">519</span></a>        <span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">))</span>
</span><span id="Taulu-520"><a href="#Taulu-520"><span class="linenos">520</span></a>
</span><span id="Taulu-521"><a href="#Taulu-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">segment_table</span><span class="p">(</span>
</span><span id="Taulu-522"><a href="#Taulu-522"><span class="linenos">522</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Taulu-523"><a href="#Taulu-523"><span class="linenos">523</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Taulu-524"><a href="#Taulu-524"><span class="linenos">524</span></a>        <span class="n">filtered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Taulu-525"><a href="#Taulu-525"><span class="linenos">525</span></a>        <span class="n">debug_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Taulu-526"><a href="#Taulu-526"><span class="linenos">526</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TableGrid</span><span class="p">:</span>
</span><span id="Taulu-527"><a href="#Taulu-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu-528"><a href="#Taulu-528"><span class="linenos">528</span></a><span class="sd">        Segment a table image into a grid of cells.</span>
</span><span id="Taulu-529"><a href="#Taulu-529"><span class="linenos">529</span></a>
</span><span id="Taulu-530"><a href="#Taulu-530"><span class="linenos">530</span></a><span class="sd">        This is the main entry point for the taulu package. It orchestrates:</span>
</span><span id="Taulu-531"><a href="#Taulu-531"><span class="linenos">531</span></a>
</span><span id="Taulu-532"><a href="#Taulu-532"><span class="linenos">532</span></a><span class="sd">        1. **Header alignment**: Locates the table by matching the header template</span>
</span><span id="Taulu-533"><a href="#Taulu-533"><span class="linenos">533</span></a><span class="sd">           to the image using feature-based registration (ORB features + homography)</span>
</span><span id="Taulu-534"><a href="#Taulu-534"><span class="linenos">534</span></a><span class="sd">        2. **Grid detection**: Applies morphological filtering and cross-correlation</span>
</span><span id="Taulu-535"><a href="#Taulu-535"><span class="linenos">535</span></a><span class="sd">           to find corner intersections</span>
</span><span id="Taulu-536"><a href="#Taulu-536"><span class="linenos">536</span></a><span class="sd">        3. **Grid growing**: Iteratively detects corners row-by-row and column-by-column,</span>
</span><span id="Taulu-537"><a href="#Taulu-537"><span class="linenos">537</span></a><span class="sd">           starting from the aligned header position</span>
</span><span id="Taulu-538"><a href="#Taulu-538"><span class="linenos">538</span></a><span class="sd">        4. **Extrapolation**: Fills in any missing corners using polynomial regression</span>
</span><span id="Taulu-539"><a href="#Taulu-539"><span class="linenos">539</span></a><span class="sd">           based on neighboring detected points</span>
</span><span id="Taulu-540"><a href="#Taulu-540"><span class="linenos">540</span></a><span class="sd">        5. **Smoothing**: Refines corner positions for consistency</span>
</span><span id="Taulu-541"><a href="#Taulu-541"><span class="linenos">541</span></a>
</span><span id="Taulu-542"><a href="#Taulu-542"><span class="linenos">542</span></a><span class="sd">        ## Performance Notes</span>
</span><span id="Taulu-543"><a href="#Taulu-543"><span class="linenos">543</span></a>
</span><span id="Taulu-544"><a href="#Taulu-544"><span class="linenos">544</span></a><span class="sd">        Processing time depends on:</span>
</span><span id="Taulu-545"><a href="#Taulu-545"><span class="linenos">545</span></a><span class="sd">        - Image resolution (use `processing_scale &lt; 1.0` for large images)</span>
</span><span id="Taulu-546"><a href="#Taulu-546"><span class="linenos">546</span></a><span class="sd">        - Table complexity (more rows/columns = longer processing)</span>
</span><span id="Taulu-547"><a href="#Taulu-547"><span class="linenos">547</span></a><span class="sd">        - Parameter settings</span>
</span><span id="Taulu-548"><a href="#Taulu-548"><span class="linenos">548</span></a>
</span><span id="Taulu-549"><a href="#Taulu-549"><span class="linenos">549</span></a><span class="sd">        ## Troubleshooting</span>
</span><span id="Taulu-550"><a href="#Taulu-550"><span class="linenos">550</span></a>
</span><span id="Taulu-551"><a href="#Taulu-551"><span class="linenos">551</span></a><span class="sd">        **If segmentation fails (returns incomplete grid):**</span>
</span><span id="Taulu-552"><a href="#Taulu-552"><span class="linenos">552</span></a><span class="sd">        1. Enable `debug_view=True` to see where it stops</span>
</span><span id="Taulu-553"><a href="#Taulu-553"><span class="linenos">553</span></a><span class="sd">        2. Check if header alignment is correct (first debug image)</span>
</span><span id="Taulu-554"><a href="#Taulu-554"><span class="linenos">554</span></a><span class="sd">        3. Verify cross-correlation shows bright spots at corners</span>
</span><span id="Taulu-555"><a href="#Taulu-555"><span class="linenos">555</span></a><span class="sd">        4. Adjust `grow_threshold` (lower if stopping too early)</span>
</span><span id="Taulu-556"><a href="#Taulu-556"><span class="linenos">556</span></a><span class="sd">        5. Increase `search_region` if corners are far from expected positions</span>
</span><span id="Taulu-557"><a href="#Taulu-557"><span class="linenos">557</span></a>
</span><span id="Taulu-558"><a href="#Taulu-558"><span class="linenos">558</span></a><span class="sd">        **If segmentation is inaccurate (corners in wrong positions):**</span>
</span><span id="Taulu-559"><a href="#Taulu-559"><span class="linenos">559</span></a><span class="sd">        1. Check binarization quality (adjust `sauvola_k`)</span>
</span><span id="Taulu-560"><a href="#Taulu-560"><span class="linenos">560</span></a><span class="sd">        2. Verify cross-kernel size matches line thickness (adjust `cross_width`)</span>
</span><span id="Taulu-561"><a href="#Taulu-561"><span class="linenos">561</span></a><span class="sd">        3. Ensure morphology isn&#39;t over-connecting (reduce `morph_size`)</span>
</span><span id="Taulu-562"><a href="#Taulu-562"><span class="linenos">562</span></a><span class="sd">        4. Increase `distance_penalty` to enforce expected positions more strictly</span>
</span><span id="Taulu-563"><a href="#Taulu-563"><span class="linenos">563</span></a>
</span><span id="Taulu-564"><a href="#Taulu-564"><span class="linenos">564</span></a><span class="sd">        Args:</span>
</span><span id="Taulu-565"><a href="#Taulu-565"><span class="linenos">565</span></a><span class="sd">            image (MatLike | PathLike[str] | str): Table image to segment.</span>
</span><span id="Taulu-566"><a href="#Taulu-566"><span class="linenos">566</span></a><span class="sd">                Can be a file path or a numpy array (BGR or grayscale).</span>
</span><span id="Taulu-567"><a href="#Taulu-567"><span class="linenos">567</span></a>
</span><span id="Taulu-568"><a href="#Taulu-568"><span class="linenos">568</span></a><span class="sd">            filtered (MatLike | PathLike[str] | str | None): Optional pre-filtered</span>
</span><span id="Taulu-569"><a href="#Taulu-569"><span class="linenos">569</span></a><span class="sd">                binary image to use instead of computing it internally.</span>
</span><span id="Taulu-570"><a href="#Taulu-570"><span class="linenos">570</span></a><span class="sd">                Must be the same size as `image`. If provided, parameters related</span>
</span><span id="Taulu-571"><a href="#Taulu-571"><span class="linenos">571</span></a><span class="sd">                to filtering (e.g. `sauvola_k`, `morph_size`) are ignored.</span>
</span><span id="Taulu-572"><a href="#Taulu-572"><span class="linenos">572</span></a>
</span><span id="Taulu-573"><a href="#Taulu-573"><span class="linenos">573</span></a><span class="sd">                **GPU acceleration**: Use trained CNN model for corner detection:</span>
</span><span id="Taulu-574"><a href="#Taulu-574"><span class="linenos">574</span></a>
</span><span id="Taulu-575"><a href="#Taulu-575"><span class="linenos">575</span></a><span class="sd">                &gt;&gt;&gt; from taulu.gpu import DeepConvNet, apply_kernel_to_image_tiled</span>
</span><span id="Taulu-576"><a href="#Taulu-576"><span class="linenos">576</span></a><span class="sd">                &gt;&gt;&gt; model = DeepConvNet.load(&quot;model.pth&quot;)</span>
</span><span id="Taulu-577"><a href="#Taulu-577"><span class="linenos">577</span></a><span class="sd">                &gt;&gt;&gt; filtered = apply_kernel_to_image_tiled(model, image)</span>
</span><span id="Taulu-578"><a href="#Taulu-578"><span class="linenos">578</span></a><span class="sd">                &gt;&gt;&gt; grid = taulu.segment_table(image, filtered=filtered)</span>
</span><span id="Taulu-579"><a href="#Taulu-579"><span class="linenos">579</span></a>
</span><span id="Taulu-580"><a href="#Taulu-580"><span class="linenos">580</span></a><span class="sd">                Default: None</span>
</span><span id="Taulu-581"><a href="#Taulu-581"><span class="linenos">581</span></a>
</span><span id="Taulu-582"><a href="#Taulu-582"><span class="linenos">582</span></a><span class="sd">            debug_view (bool): If True, opens OpenCV windows showing intermediate</span>
</span><span id="Taulu-583"><a href="#Taulu-583"><span class="linenos">583</span></a><span class="sd">                processing steps:</span>
</span><span id="Taulu-584"><a href="#Taulu-584"><span class="linenos">584</span></a><span class="sd">                - Header alignment overlay</span>
</span><span id="Taulu-585"><a href="#Taulu-585"><span class="linenos">585</span></a><span class="sd">                - Binarized image</span>
</span><span id="Taulu-586"><a href="#Taulu-586"><span class="linenos">586</span></a><span class="sd">                - After morphological operations</span>
</span><span id="Taulu-587"><a href="#Taulu-587"><span class="linenos">587</span></a><span class="sd">                - Cross-correlation result</span>
</span><span id="Taulu-588"><a href="#Taulu-588"><span class="linenos">588</span></a><span class="sd">                - Growing progress (corner-by-corner)</span>
</span><span id="Taulu-589"><a href="#Taulu-589"><span class="linenos">589</span></a>
</span><span id="Taulu-590"><a href="#Taulu-590"><span class="linenos">590</span></a><span class="sd">                **Controls:**</span>
</span><span id="Taulu-591"><a href="#Taulu-591"><span class="linenos">591</span></a><span class="sd">                - Press &#39;n&#39; to advance to next step</span>
</span><span id="Taulu-592"><a href="#Taulu-592"><span class="linenos">592</span></a><span class="sd">                - Press &#39;q&#39; to quit immediately</span>
</span><span id="Taulu-593"><a href="#Taulu-593"><span class="linenos">593</span></a>
</span><span id="Taulu-594"><a href="#Taulu-594"><span class="linenos">594</span></a><span class="sd">                Useful for parameter tuning and understanding failures.</span>
</span><span id="Taulu-595"><a href="#Taulu-595"><span class="linenos">595</span></a><span class="sd">                Default: False</span>
</span><span id="Taulu-596"><a href="#Taulu-596"><span class="linenos">596</span></a>
</span><span id="Taulu-597"><a href="#Taulu-597"><span class="linenos">597</span></a><span class="sd">        Returns:</span>
</span><span id="Taulu-598"><a href="#Taulu-598"><span class="linenos">598</span></a><span class="sd">            TableGrid: A grid structure containing detected corner positions with</span>
</span><span id="Taulu-599"><a href="#Taulu-599"><span class="linenos">599</span></a><span class="sd">                methods for:</span>
</span><span id="Taulu-600"><a href="#Taulu-600"><span class="linenos">600</span></a>
</span><span id="Taulu-601"><a href="#Taulu-601"><span class="linenos">601</span></a><span class="sd">                **Position queries:**</span>
</span><span id="Taulu-602"><a href="#Taulu-602"><span class="linenos">602</span></a><span class="sd">                - `cell(point)`: Get (row, col) at pixel coordinates (x, y)</span>
</span><span id="Taulu-603"><a href="#Taulu-603"><span class="linenos">603</span></a><span class="sd">                - `cell_polygon(cell)`: Get 4 corners of a cell as (lt, rt, rb, lb)</span>
</span><span id="Taulu-604"><a href="#Taulu-604"><span class="linenos">604</span></a><span class="sd">                - `region(start, end)`: Get bounding box for a cell range</span>
</span><span id="Taulu-605"><a href="#Taulu-605"><span class="linenos">605</span></a>
</span><span id="Taulu-606"><a href="#Taulu-606"><span class="linenos">606</span></a><span class="sd">                **Image extraction:**</span>
</span><span id="Taulu-607"><a href="#Taulu-607"><span class="linenos">607</span></a><span class="sd">                - `crop_cell(img, cell, margin=0)`: Extract single cell with optional margin</span>
</span><span id="Taulu-608"><a href="#Taulu-608"><span class="linenos">608</span></a><span class="sd">                - `crop_region(img, start, end, margin=0)`: Extract rectangular region</span>
</span><span id="Taulu-609"><a href="#Taulu-609"><span class="linenos">609</span></a>
</span><span id="Taulu-610"><a href="#Taulu-610"><span class="linenos">610</span></a><span class="sd">                **Visualization:**</span>
</span><span id="Taulu-611"><a href="#Taulu-611"><span class="linenos">611</span></a><span class="sd">                - `show_cells(img)`: Interactive cell viewer (click to highlight)</span>
</span><span id="Taulu-612"><a href="#Taulu-612"><span class="linenos">612</span></a><span class="sd">                - `highlight_all_cells(img)`: Draw all cell boundaries</span>
</span><span id="Taulu-613"><a href="#Taulu-613"><span class="linenos">613</span></a><span class="sd">                - `visualize_points(img)`: Show detected corner points</span>
</span><span id="Taulu-614"><a href="#Taulu-614"><span class="linenos">614</span></a>
</span><span id="Taulu-615"><a href="#Taulu-615"><span class="linenos">615</span></a><span class="sd">                **Analysis:**</span>
</span><span id="Taulu-616"><a href="#Taulu-616"><span class="linenos">616</span></a><span class="sd">                - `text_regions(img, row)`: Find continuous text regions in a row</span>
</span><span id="Taulu-617"><a href="#Taulu-617"><span class="linenos">617</span></a><span class="sd">                - `cells()`: Generator yielding all (row, col) indices</span>
</span><span id="Taulu-618"><a href="#Taulu-618"><span class="linenos">618</span></a>
</span><span id="Taulu-619"><a href="#Taulu-619"><span class="linenos">619</span></a><span class="sd">                **Persistence:**</span>
</span><span id="Taulu-620"><a href="#Taulu-620"><span class="linenos">620</span></a><span class="sd">                - `save(path)`: Save grid to JSON file</span>
</span><span id="Taulu-621"><a href="#Taulu-621"><span class="linenos">621</span></a><span class="sd">                - `TableGrid.from_saved(path)`: Load grid from JSON</span>
</span><span id="Taulu-622"><a href="#Taulu-622"><span class="linenos">622</span></a>
</span><span id="Taulu-623"><a href="#Taulu-623"><span class="linenos">623</span></a><span class="sd">                **Properties:**</span>
</span><span id="Taulu-624"><a href="#Taulu-624"><span class="linenos">624</span></a><span class="sd">                - `rows`: Number of data rows (header not included)</span>
</span><span id="Taulu-625"><a href="#Taulu-625"><span class="linenos">625</span></a><span class="sd">                - `cols`: Number of columns</span>
</span><span id="Taulu-626"><a href="#Taulu-626"><span class="linenos">626</span></a><span class="sd">                - `points`: Raw list of detected corner coordinates</span>
</span><span id="Taulu-627"><a href="#Taulu-627"><span class="linenos">627</span></a>
</span><span id="Taulu-628"><a href="#Taulu-628"><span class="linenos">628</span></a><span class="sd">        Raises:</span>
</span><span id="Taulu-629"><a href="#Taulu-629"><span class="linenos">629</span></a><span class="sd">            TauluException: If image cannot be loaded, header alignment fails,</span>
</span><span id="Taulu-630"><a href="#Taulu-630"><span class="linenos">630</span></a><span class="sd">                or grid detection produces no results</span>
</span><span id="Taulu-631"><a href="#Taulu-631"><span class="linenos">631</span></a>
</span><span id="Taulu-632"><a href="#Taulu-632"><span class="linenos">632</span></a><span class="sd">        Examples:</span>
</span><span id="Taulu-633"><a href="#Taulu-633"><span class="linenos">633</span></a><span class="sd">            Basic segmentation:</span>
</span><span id="Taulu-634"><a href="#Taulu-634"><span class="linenos">634</span></a>
</span><span id="Taulu-635"><a href="#Taulu-635"><span class="linenos">635</span></a><span class="sd">            &gt;&gt;&gt; from taulu import Taulu</span>
</span><span id="Taulu-636"><a href="#Taulu-636"><span class="linenos">636</span></a><span class="sd">            &gt;&gt;&gt; import cv2</span>
</span><span id="Taulu-637"><a href="#Taulu-637"><span class="linenos">637</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu-638"><a href="#Taulu-638"><span class="linenos">638</span></a><span class="sd">            &gt;&gt;&gt; taulu = Taulu(&quot;header.png&quot;)</span>
</span><span id="Taulu-639"><a href="#Taulu-639"><span class="linenos">639</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu-640"><a href="#Taulu-640"><span class="linenos">640</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu-641"><a href="#Taulu-641"><span class="linenos">641</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Detected {grid.rows} rows and {grid.cols} columns&quot;)</span>
</span><span id="Taulu-642"><a href="#Taulu-642"><span class="linenos">642</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu-643"><a href="#Taulu-643"><span class="linenos">643</span></a><span class="sd">            &gt;&gt;&gt; # Extract first cell</span>
</span><span id="Taulu-644"><a href="#Taulu-644"><span class="linenos">644</span></a><span class="sd">            &gt;&gt;&gt; img = cv2.imread(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu-645"><a href="#Taulu-645"><span class="linenos">645</span></a><span class="sd">            &gt;&gt;&gt; cell_img = grid.crop_cell(img, (0, 0))</span>
</span><span id="Taulu-646"><a href="#Taulu-646"><span class="linenos">646</span></a><span class="sd">            &gt;&gt;&gt; cv2.imwrite(&quot;cell_0_0.png&quot;, cell_img)</span>
</span><span id="Taulu-647"><a href="#Taulu-647"><span class="linenos">647</span></a>
</span><span id="Taulu-648"><a href="#Taulu-648"><span class="linenos">648</span></a><span class="sd">            Debug mode for parameter tuning:</span>
</span><span id="Taulu-649"><a href="#Taulu-649"><span class="linenos">649</span></a>
</span><span id="Taulu-650"><a href="#Taulu-650"><span class="linenos">650</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table_page_01.png&quot;, debug_view=True)</span>
</span><span id="Taulu-651"><a href="#Taulu-651"><span class="linenos">651</span></a><span class="sd">            # Windows open showing each step</span>
</span><span id="Taulu-652"><a href="#Taulu-652"><span class="linenos">652</span></a><span class="sd">            # Adjust parameters based on what you see</span>
</span><span id="Taulu-653"><a href="#Taulu-653"><span class="linenos">653</span></a>
</span><span id="Taulu-654"><a href="#Taulu-654"><span class="linenos">654</span></a><span class="sd">            Process multiple images with the same header:</span>
</span><span id="Taulu-655"><a href="#Taulu-655"><span class="linenos">655</span></a>
</span><span id="Taulu-656"><a href="#Taulu-656"><span class="linenos">656</span></a><span class="sd">            &gt;&gt;&gt; taulu = Taulu(&quot;header.png&quot;, sauvola_k=0.25)</span>
</span><span id="Taulu-657"><a href="#Taulu-657"><span class="linenos">657</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu-658"><a href="#Taulu-658"><span class="linenos">658</span></a><span class="sd">            &gt;&gt;&gt; for i in range(1, 11):</span>
</span><span id="Taulu-659"><a href="#Taulu-659"><span class="linenos">659</span></a><span class="sd">            ...     img_path = f&quot;table_page_{i:02d}.png&quot;</span>
</span><span id="Taulu-660"><a href="#Taulu-660"><span class="linenos">660</span></a><span class="sd">            ...     grid = taulu.segment_table(img_path)</span>
</span><span id="Taulu-661"><a href="#Taulu-661"><span class="linenos">661</span></a><span class="sd">            ...     grid.save(f&quot;grid_{i:02d}.json&quot;)</span>
</span><span id="Taulu-662"><a href="#Taulu-662"><span class="linenos">662</span></a><span class="sd">            ...     print(f&quot;Page {i}: {grid.rows} rows detected&quot;)</span>
</span><span id="Taulu-663"><a href="#Taulu-663"><span class="linenos">663</span></a>
</span><span id="Taulu-664"><a href="#Taulu-664"><span class="linenos">664</span></a><span class="sd">            Extract all cells from a table:</span>
</span><span id="Taulu-665"><a href="#Taulu-665"><span class="linenos">665</span></a>
</span><span id="Taulu-666"><a href="#Taulu-666"><span class="linenos">666</span></a><span class="sd">            &gt;&gt;&gt; img = cv2.imread(&quot;table.png&quot;)</span>
</span><span id="Taulu-667"><a href="#Taulu-667"><span class="linenos">667</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table.png&quot;)</span>
</span><span id="Taulu-668"><a href="#Taulu-668"><span class="linenos">668</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu-669"><a href="#Taulu-669"><span class="linenos">669</span></a><span class="sd">            &gt;&gt;&gt; for row, col in grid.cells():</span>
</span><span id="Taulu-670"><a href="#Taulu-670"><span class="linenos">670</span></a><span class="sd">            ...     cell_img = grid.crop_cell(img, (row, col), margin=5)</span>
</span><span id="Taulu-671"><a href="#Taulu-671"><span class="linenos">671</span></a><span class="sd">            ...     cv2.imwrite(f&quot;cell_{row}_{col}.png&quot;, cell_img)</span>
</span><span id="Taulu-672"><a href="#Taulu-672"><span class="linenos">672</span></a>
</span><span id="Taulu-673"><a href="#Taulu-673"><span class="linenos">673</span></a><span class="sd">            Find text regions for OCR:</span>
</span><span id="Taulu-674"><a href="#Taulu-674"><span class="linenos">674</span></a>
</span><span id="Taulu-675"><a href="#Taulu-675"><span class="linenos">675</span></a><span class="sd">            &gt;&gt;&gt; for row in range(grid.rows):</span>
</span><span id="Taulu-676"><a href="#Taulu-676"><span class="linenos">676</span></a><span class="sd">            ...     text_regions = grid.text_regions(img, row)</span>
</span><span id="Taulu-677"><a href="#Taulu-677"><span class="linenos">677</span></a><span class="sd">            ...     for start_cell, end_cell in text_regions:</span>
</span><span id="Taulu-678"><a href="#Taulu-678"><span class="linenos">678</span></a><span class="sd">            ...         # Extract region spanning multiple cells</span>
</span><span id="Taulu-679"><a href="#Taulu-679"><span class="linenos">679</span></a><span class="sd">            ...         region_img = grid.crop_region(img, start_cell, end_cell)</span>
</span><span id="Taulu-680"><a href="#Taulu-680"><span class="linenos">680</span></a><span class="sd">            ...         # Run OCR on region_img...</span>
</span><span id="Taulu-681"><a href="#Taulu-681"><span class="linenos">681</span></a>
</span><span id="Taulu-682"><a href="#Taulu-682"><span class="linenos">682</span></a><span class="sd">        See Also:</span>
</span><span id="Taulu-683"><a href="#Taulu-683"><span class="linenos">683</span></a><span class="sd">            - `TableGrid`: Complete documentation of the returned object</span>
</span><span id="Taulu-684"><a href="#Taulu-684"><span class="linenos">684</span></a><span class="sd">            - `GridDetector.find_table_points()`: Lower-level grid detection</span>
</span><span id="Taulu-685"><a href="#Taulu-685"><span class="linenos">685</span></a><span class="sd">            - `HeaderAligner.align()`: Lower-level header alignment</span>
</span><span id="Taulu-686"><a href="#Taulu-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu-687"><a href="#Taulu-687"><span class="linenos">687</span></a>
</span><span id="Taulu-688"><a href="#Taulu-688"><span class="linenos">688</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">MatLike</span><span class="p">):</span>
</span><span id="Taulu-689"><a href="#Taulu-689"><span class="linenos">689</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="Taulu-690"><a href="#Taulu-690"><span class="linenos">690</span></a>
</span><span id="Taulu-691"><a href="#Taulu-691"><span class="linenos">691</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
</span><span id="Taulu-692"><a href="#Taulu-692"><span class="linenos">692</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">visual</span><span class="o">=</span><span class="n">debug_view</span><span class="p">)</span>
</span><span id="Taulu-693"><a href="#Taulu-693"><span class="linenos">693</span></a>        <span class="n">align_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">now</span>
</span><span id="Taulu-694"><a href="#Taulu-694"><span class="linenos">694</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Header alignment took </span><span class="si">{</span><span class="n">align_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="Taulu-695"><a href="#Taulu-695"><span class="linenos">695</span></a>
</span><span id="Taulu-696"><a href="#Taulu-696"><span class="linenos">696</span></a>        <span class="c1"># find the starting point for the table grid algorithm</span>
</span><span id="Taulu-697"><a href="#Taulu-697"><span class="linenos">697</span></a>        <span class="n">left_top_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">intersection</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Taulu-698"><a href="#Taulu-698"><span class="linenos">698</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu-699"><a href="#Taulu-699"><span class="linenos">699</span></a>            <span class="n">left_top_template</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu-700"><a href="#Taulu-700"><span class="linenos">700</span></a>                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
</span><span id="Taulu-701"><a href="#Taulu-701"><span class="linenos">701</span></a>                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
</span><span id="Taulu-702"><a href="#Taulu-702"><span class="linenos">702</span></a>            <span class="p">)</span>
</span><span id="Taulu-703"><a href="#Taulu-703"><span class="linenos">703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu-704"><a href="#Taulu-704"><span class="linenos">704</span></a>            <span class="n">left_top_template</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Taulu-705"><a href="#Taulu-705"><span class="linenos">705</span></a>
</span><span id="Taulu-706"><a href="#Taulu-706"><span class="linenos">706</span></a>        <span class="n">left_top_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span><span class="o">.</span><span class="n">template_to_img</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">left_top_template</span><span class="p">)</span>
</span><span id="Taulu-707"><a href="#Taulu-707"><span class="linenos">707</span></a>
</span><span id="Taulu-708"><a href="#Taulu-708"><span class="linenos">708</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
</span><span id="Taulu-709"><a href="#Taulu-709"><span class="linenos">709</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span><span class="o">.</span><span class="n">find_table_points</span><span class="p">(</span>
</span><span id="Taulu-710"><a href="#Taulu-710"><span class="linenos">710</span></a>            <span class="n">image</span><span class="p">,</span>
</span><span id="Taulu-711"><a href="#Taulu-711"><span class="linenos">711</span></a>            <span class="n">left_top_table</span><span class="p">,</span>
</span><span id="Taulu-712"><a href="#Taulu-712"><span class="linenos">712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">cell_widths</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span><span id="Taulu-713"><a href="#Taulu-713"><span class="linenos">713</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span><span class="p">,</span>
</span><span id="Taulu-714"><a href="#Taulu-714"><span class="linenos">714</span></a>            <span class="n">visual</span><span class="o">=</span><span class="n">debug_view</span><span class="p">,</span>
</span><span id="Taulu-715"><a href="#Taulu-715"><span class="linenos">715</span></a>            <span class="n">filtered</span><span class="o">=</span><span class="n">filtered</span><span class="p">,</span>
</span><span id="Taulu-716"><a href="#Taulu-716"><span class="linenos">716</span></a>            <span class="n">smooth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_smooth</span>
</span><span id="Taulu-717"><a href="#Taulu-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="Taulu-718"><a href="#Taulu-718"><span class="linenos">718</span></a>        <span class="n">grid_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">now</span>
</span><span id="Taulu-719"><a href="#Taulu-719"><span class="linenos">719</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grid detection took </span><span class="si">{</span><span class="n">grid_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="Taulu-720"><a href="#Taulu-720"><span class="linenos">720</span></a>
</span><span id="Taulu-721"><a href="#Taulu-721"><span class="linenos">721</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu-722"><a href="#Taulu-722"><span class="linenos">722</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">TableGrid</span><span class="o">.</span><span class="n">from_split</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Taulu-723"><a href="#Taulu-723"><span class="linenos">723</span></a>
</span><span id="Taulu-724"><a href="#Taulu-724"><span class="linenos">724</span></a>        <span class="k">return</span> <span class="n">table</span>
</span></pre></div>


            <div class="docstring"><p>High-level API for table segmentation from images.</p>

<p>Taulu provides a simplified interface that orchestrates header alignment,
grid detection, and table segmentation into a single workflow. It's designed
to hide complexity while still allowing fine-tuned control through parameters.</p>

<h2 id="workflow-overview">Workflow Overview</h2>

<ol>
<li><strong>Header Template Creation</strong>: Use <code><a href="#Taulu.annotate">Taulu.annotate()</a></code> to create annotated
header images that define your table structure</li>
<li><strong>Initialization</strong>: Create a Taulu instance with your header(s) and parameters</li>
<li><strong>Segmentation</strong>: Call <code><a href="#Taulu.segment_table">segment_table()</a></code> on your table images to get a
<code><a href="#TableGrid">TableGrid</a></code> object containing all detected cell boundaries</li>
</ol>

<h2 id="single-vs-split-tables">Single vs Split Tables</h2>

<p>Taulu supports two modes:</p>

<ul>
<li><strong>Single header</strong>: For tables that fit on one page or have consistent structure</li>
<li><strong>Split header</strong>: For tables that span two pages (left/right) with potentially
different parameters for each side</li>
</ul>

<p>Use <code>Split[T]</code> objects to provide different parameters for left and right sides.</p>

<h2 id="parameter-tuning-strategy">Parameter Tuning Strategy</h2>

<p>If segmentation fails or is inaccurate:</p>

<ol>
<li><strong>Visual debugging</strong>: Set <code>debug_view=True</code> in <code><a href="#Taulu.segment_table">segment_table()</a></code> to see
intermediate results</li>
<li><strong>Adjust thresholding</strong>: Modify <code>sauvola_k</code> to change binarization sensitivity
<ul>
<li>Increase to remove more noise (more aggressive)</li>
<li>Decrease to preserve faint lines</li>
</ul></li>
<li><strong>Tune cross-kernel</strong>: Adjust <code>cross_width</code>, <code>cross_height</code>, <code>kernel_size</code>
to match your rule thickness after morphology</li>
<li><strong>Morphology</strong>: Increase <code>morph_size</code> to connect broken lines, but be aware
this also thickens lines (requiring larger cross_width)</li>
<li><strong>Search parameters</strong>: Increase <code>search_region</code> for warped documents,
adjust <code>distance_penalty</code> to control how strictly positions are enforced</li>
<li><strong>Growth parameters</strong>: Lower <code>grow_threshold</code> if the algorithm stops too early,
increase <code>look_distance</code> for better extrapolation</li>
</ol>

<h6 id="examples">Examples:</h6>

<blockquote>
  <p>Basic usage with a single header:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># First, create annotated header (one-time setup)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;table_image.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This creates header.png and header.json</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize Taulu with the header</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">header_image_path</span><span class="o">=</span><span class="s2">&quot;header.png&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">cell_height_factor</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Rows are 80% of header height</span>
<span class="gp">... </span>    <span class="n">sauvola_k</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">search_region</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">cross_width</span><span class="o">=</span><span class="mi">10</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Segment a table image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;table_page_01.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use the grid to extract cells</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;table_page_01.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell_image</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">crop_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># First cell</span>
</code></pre>
  </div>
  
  <p>Using split headers for two-page tables:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span><span class="p">,</span> <span class="n">Split</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Annotate both headers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;scan_01.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header_left.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;scan_01.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use different parameters for each side</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">header_image_path</span><span class="o">=</span><span class="n">Split</span><span class="p">(</span><span class="s2">&quot;header_left.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right.png&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">cell_height_factor</span><span class="o">=</span><span class="n">Split</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">]),</span>  <span class="c1"># Different row heights</span>
<span class="gp">... </span>    <span class="n">sauvola_k</span><span class="o">=</span><span class="n">Split</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>  <span class="c1"># Different thresholds</span>
<span class="gp">... </span>    <span class="n">cross_width</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Same for both sides</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Segment returns a unified grid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;scan_01.png&quot;</span><span class="p">)</span>
</code></pre>
  </div>
  
  <p>Debug visualization to tune parameters:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">(</span><span class="s2">&quot;header.png&quot;</span><span class="p">,</span> <span class="n">sauvola_k</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Opens windows showing each processing step</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Press &#39;n&#39; to advance, &#39;q&#39; to quit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;table.png&quot;</span><span class="p">,</span> <span class="n">debug_view</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Adjust parameters based on what you see:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># - If binarization is too noisy: increase sauvola_k</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># - If lines are broken after morphology: increase morph_size</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># - If filtered image has &quot;undefined&quot; corners: adjust cross_width to match line thickness (after morphology)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># - If corners are missed during search: decrease grow_threshold or increase search_region</span>
</code></pre>
  </div>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>_header (MatLike | Split[MatLike]):</strong>  Loaded header image(s)</li>
<li><strong>_aligner (HeaderAligner | Split[HeaderAligner]):</strong>  Header alignment engine(s)</li>
<li><strong>_template (HeaderTemplate | Split[HeaderTemplate]):</strong>  Parsed header structure(s)</li>
<li><strong>_grid_detector (GridDetector | Split[GridDetector]):</strong>  Grid detection engine(s)</li>
<li><strong>_cell_heights (list[int] | Split[list[int]]):</strong>  Computed cell heights in pixels</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>TauluException:</strong>  If header files don't exist, annotation is missing, or
Split parameters are used incorrectly with single headers</li>
</ul>

<h6 id="see-also">See Also:</h6>

<blockquote>
  <ul>
  <li><code><a href="#TableGrid">TableGrid</a></code>: The result object with methods for accessing cells</li>
  <li><code><a href="#Split">Split</a></code>: Container for paired left/right parameters</li>
  <li><code><a href="#GridDetector">GridDetector</a></code>: Lower-level grid detection (for advanced usage)</li>
  <li><code><a href="#HeaderAligner">HeaderAligner</a></code>: Lower-level header alignment (for advanced usage)</li>
  </ul>
</blockquote>
</div>


                            <div id="Taulu.__init__" class="classattr">
                                        <input id="Taulu.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Taulu</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">header_image_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">cell_height_factor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>,</span><span class="param">	<span class="n">header_anno_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sauvola_k</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.25</span>,</span><span class="param">	<span class="n">search_region</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">60</span>,</span><span class="param">	<span class="n">distance_penalty</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.4</span>,</span><span class="param">	<span class="n">cross_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">morph_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">kernel_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">41</span>,</span><span class="param">	<span class="n">processing_scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">min_rows</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">look_distance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">grow_threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n"><a href="#Split">Split</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">smooth_grid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Taulu.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Taulu.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Taulu.__init__-158"><a href="#Taulu.__init__-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Taulu.__init__-159"><a href="#Taulu.__init__-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Taulu.__init__-160"><a href="#Taulu.__init__-160"><span class="linenos">160</span></a>        <span class="n">header_image_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="Taulu.__init__-161"><a href="#Taulu.__init__-161"><span class="linenos">161</span></a>        <span class="n">cell_height_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
</span><span id="Taulu.__init__-162"><a href="#Taulu.__init__-162"><span class="linenos">162</span></a>        <span class="n">header_anno_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="Taulu.__init__-163"><a href="#Taulu.__init__-163"><span class="linenos">163</span></a>        <span class="o">|</span> <span class="nb">str</span>
</span><span id="Taulu.__init__-164"><a href="#Taulu.__init__-164"><span class="linenos">164</span></a>        <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="Taulu.__init__-165"><a href="#Taulu.__init__-165"><span class="linenos">165</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Taulu.__init__-166"><a href="#Taulu.__init__-166"><span class="linenos">166</span></a>        <span class="n">sauvola_k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="Taulu.__init__-167"><a href="#Taulu.__init__-167"><span class="linenos">167</span></a>        <span class="n">search_region</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
</span><span id="Taulu.__init__-168"><a href="#Taulu.__init__-168"><span class="linenos">168</span></a>        <span class="n">distance_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="Taulu.__init__-169"><a href="#Taulu.__init__-169"><span class="linenos">169</span></a>        <span class="n">cross_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Taulu.__init__-170"><a href="#Taulu.__init__-170"><span class="linenos">170</span></a>        <span class="n">morph_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Taulu.__init__-171"><a href="#Taulu.__init__-171"><span class="linenos">171</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span><span class="p">,</span>
</span><span id="Taulu.__init__-172"><a href="#Taulu.__init__-172"><span class="linenos">172</span></a>        <span class="n">processing_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Taulu.__init__-173"><a href="#Taulu.__init__-173"><span class="linenos">173</span></a>        <span class="n">min_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Taulu.__init__-174"><a href="#Taulu.__init__-174"><span class="linenos">174</span></a>        <span class="n">look_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="Taulu.__init__-175"><a href="#Taulu.__init__-175"><span class="linenos">175</span></a>        <span class="n">grow_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Split</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="Taulu.__init__-176"><a href="#Taulu.__init__-176"><span class="linenos">176</span></a>        <span class="n">smooth_grid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Taulu.__init__-177"><a href="#Taulu.__init__-177"><span class="linenos">177</span></a>    <span class="p">):</span>
</span><span id="Taulu.__init__-178"><a href="#Taulu.__init__-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu.__init__-179"><a href="#Taulu.__init__-179"><span class="linenos">179</span></a><span class="sd">        Args:</span>
</span><span id="Taulu.__init__-180"><a href="#Taulu.__init__-180"><span class="linenos">180</span></a><span class="sd">            header_image_path:</span>
</span><span id="Taulu.__init__-181"><a href="#Taulu.__init__-181"><span class="linenos">181</span></a><span class="sd">                Path to the header template image(s). The header should be a cropped</span>
</span><span id="Taulu.__init__-182"><a href="#Taulu.__init__-182"><span class="linenos">182</span></a><span class="sd">                image showing a clear view of the table&#39;s first row. An annotation</span>
</span><span id="Taulu.__init__-183"><a href="#Taulu.__init__-183"><span class="linenos">183</span></a><span class="sd">                file (.json) must exist alongside the image, created via `Taulu.annotate()`.</span>
</span><span id="Taulu.__init__-184"><a href="#Taulu.__init__-184"><span class="linenos">184</span></a><span class="sd">                For split tables, provide a `Split` containing left and right header paths.</span>
</span><span id="Taulu.__init__-185"><a href="#Taulu.__init__-185"><span class="linenos">185</span></a>
</span><span id="Taulu.__init__-186"><a href="#Taulu.__init__-186"><span class="linenos">186</span></a><span class="sd">            cell_height_factor:</span>
</span><span id="Taulu.__init__-187"><a href="#Taulu.__init__-187"><span class="linenos">187</span></a><span class="sd">                Height of data rows relative to header height. For example, if your</span>
</span><span id="Taulu.__init__-188"><a href="#Taulu.__init__-188"><span class="linenos">188</span></a><span class="sd">                header is 100px tall and data rows are 80px tall, use 0.8.</span>
</span><span id="Taulu.__init__-189"><a href="#Taulu.__init__-189"><span class="linenos">189</span></a>
</span><span id="Taulu.__init__-190"><a href="#Taulu.__init__-190"><span class="linenos">190</span></a><span class="sd">                - **float**: All rows have the same height</span>
</span><span id="Taulu.__init__-191"><a href="#Taulu.__init__-191"><span class="linenos">191</span></a><span class="sd">                - **list[float]**: Different heights for different rows. The last value</span>
</span><span id="Taulu.__init__-192"><a href="#Taulu.__init__-192"><span class="linenos">192</span></a><span class="sd">                  is repeated for any additional rows beyond the list length. Useful when</span>
</span><span id="Taulu.__init__-193"><a href="#Taulu.__init__-193"><span class="linenos">193</span></a><span class="sd">                  the first data row is taller than subsequent rows.</span>
</span><span id="Taulu.__init__-194"><a href="#Taulu.__init__-194"><span class="linenos">194</span></a><span class="sd">                - **Split**: Different height factors for left and right sides</span>
</span><span id="Taulu.__init__-195"><a href="#Taulu.__init__-195"><span class="linenos">195</span></a>
</span><span id="Taulu.__init__-196"><a href="#Taulu.__init__-196"><span class="linenos">196</span></a><span class="sd">                Default: [1.0]</span>
</span><span id="Taulu.__init__-197"><a href="#Taulu.__init__-197"><span class="linenos">197</span></a>
</span><span id="Taulu.__init__-198"><a href="#Taulu.__init__-198"><span class="linenos">198</span></a><span class="sd">            header_anno_path (PathLike[str] | str | Split[PathLike[str] | str] | None):</span>
</span><span id="Taulu.__init__-199"><a href="#Taulu.__init__-199"><span class="linenos">199</span></a><span class="sd">                Optional explicit path to header annotation JSON file(s). If None,</span>
</span><span id="Taulu.__init__-200"><a href="#Taulu.__init__-200"><span class="linenos">200</span></a><span class="sd">                looks for a .json file with the same name as `header_image_path`.</span>
</span><span id="Taulu.__init__-201"><a href="#Taulu.__init__-201"><span class="linenos">201</span></a><span class="sd">                Default: None</span>
</span><span id="Taulu.__init__-202"><a href="#Taulu.__init__-202"><span class="linenos">202</span></a>
</span><span id="Taulu.__init__-203"><a href="#Taulu.__init__-203"><span class="linenos">203</span></a><span class="sd">            sauvola_k (float | Split[float]):</span>
</span><span id="Taulu.__init__-204"><a href="#Taulu.__init__-204"><span class="linenos">204</span></a><span class="sd">                Threshold sensitivity for Sauvola adaptive binarization (0.0-1.0).</span>
</span><span id="Taulu.__init__-205"><a href="#Taulu.__init__-205"><span class="linenos">205</span></a><span class="sd">                Controls how aggressively the algorithm converts the image to binary.</span>
</span><span id="Taulu.__init__-206"><a href="#Taulu.__init__-206"><span class="linenos">206</span></a>
</span><span id="Taulu.__init__-207"><a href="#Taulu.__init__-207"><span class="linenos">207</span></a><span class="sd">                - **Lower values** (0.04-0.15): Preserve faint lines, more noise</span>
</span><span id="Taulu.__init__-208"><a href="#Taulu.__init__-208"><span class="linenos">208</span></a><span class="sd">                - **Higher values** (0.20-0.35): Remove noise, may lose faint lines</span>
</span><span id="Taulu.__init__-209"><a href="#Taulu.__init__-209"><span class="linenos">209</span></a>
</span><span id="Taulu.__init__-210"><a href="#Taulu.__init__-210"><span class="linenos">210</span></a><span class="sd">                Start with 0.25 and adjust based on your image quality.</span>
</span><span id="Taulu.__init__-211"><a href="#Taulu.__init__-211"><span class="linenos">211</span></a><span class="sd">                Default: 0.25</span>
</span><span id="Taulu.__init__-212"><a href="#Taulu.__init__-212"><span class="linenos">212</span></a>
</span><span id="Taulu.__init__-213"><a href="#Taulu.__init__-213"><span class="linenos">213</span></a><span class="sd">            search_region (int | Split[int]):</span>
</span><span id="Taulu.__init__-214"><a href="#Taulu.__init__-214"><span class="linenos">214</span></a><span class="sd">                Size in pixels of the square region to search for the next corner point.</span>
</span><span id="Taulu.__init__-215"><a href="#Taulu.__init__-215"><span class="linenos">215</span></a><span class="sd">                The algorithm estimates where a corner should be, then searches within</span>
</span><span id="Taulu.__init__-216"><a href="#Taulu.__init__-216"><span class="linenos">216</span></a><span class="sd">                this region for the best match.</span>
</span><span id="Taulu.__init__-217"><a href="#Taulu.__init__-217"><span class="linenos">217</span></a>
</span><span id="Taulu.__init__-218"><a href="#Taulu.__init__-218"><span class="linenos">218</span></a><span class="sd">                - **Smaller values** (20-40): Faster, requires well-aligned tables</span>
</span><span id="Taulu.__init__-219"><a href="#Taulu.__init__-219"><span class="linenos">219</span></a><span class="sd">                - **Larger values** (60-100): More robust to warping and distortion</span>
</span><span id="Taulu.__init__-220"><a href="#Taulu.__init__-220"><span class="linenos">220</span></a>
</span><span id="Taulu.__init__-221"><a href="#Taulu.__init__-221"><span class="linenos">221</span></a><span class="sd">                Default: 60</span>
</span><span id="Taulu.__init__-222"><a href="#Taulu.__init__-222"><span class="linenos">222</span></a>
</span><span id="Taulu.__init__-223"><a href="#Taulu.__init__-223"><span class="linenos">223</span></a><span class="sd">            distance_penalty (float | Split[float]):</span>
</span><span id="Taulu.__init__-224"><a href="#Taulu.__init__-224"><span class="linenos">224</span></a><span class="sd">                Weight factor [0, 1] for penalizing corners far from expected position.</span>
</span><span id="Taulu.__init__-225"><a href="#Taulu.__init__-225"><span class="linenos">225</span></a><span class="sd">                Uses Gaussian weighting within the search region.</span>
</span><span id="Taulu.__init__-226"><a href="#Taulu.__init__-226"><span class="linenos">226</span></a>
</span><span id="Taulu.__init__-227"><a href="#Taulu.__init__-227"><span class="linenos">227</span></a><span class="sd">                - **0.0**: No penalty, any position in search region is equally valid</span>
</span><span id="Taulu.__init__-228"><a href="#Taulu.__init__-228"><span class="linenos">228</span></a><span class="sd">                - **0.5**: Moderate preference for positions near the expected location</span>
</span><span id="Taulu.__init__-229"><a href="#Taulu.__init__-229"><span class="linenos">229</span></a><span class="sd">                - **1.0**: Strong preference, only accepts positions very close to expected</span>
</span><span id="Taulu.__init__-230"><a href="#Taulu.__init__-230"><span class="linenos">230</span></a>
</span><span id="Taulu.__init__-231"><a href="#Taulu.__init__-231"><span class="linenos">231</span></a><span class="sd">                Default: 0.4</span>
</span><span id="Taulu.__init__-232"><a href="#Taulu.__init__-232"><span class="linenos">232</span></a>
</span><span id="Taulu.__init__-233"><a href="#Taulu.__init__-233"><span class="linenos">233</span></a><span class="sd">            cross_width (int | Split[int]):</span>
</span><span id="Taulu.__init__-234"><a href="#Taulu.__init__-234"><span class="linenos">234</span></a><span class="sd">                Width in pixels of the cross-shaped kernel used to detect intersections.</span>
</span><span id="Taulu.__init__-235"><a href="#Taulu.__init__-235"><span class="linenos">235</span></a><span class="sd">                Should approximately match the thickness of your table rules AFTER</span>
</span><span id="Taulu.__init__-236"><a href="#Taulu.__init__-236"><span class="linenos">236</span></a><span class="sd">                morphological dilation.</span>
</span><span id="Taulu.__init__-237"><a href="#Taulu.__init__-237"><span class="linenos">237</span></a>
</span><span id="Taulu.__init__-238"><a href="#Taulu.__init__-238"><span class="linenos">238</span></a><span class="sd">                **Tuning**: Look at the dilated image in debug_view. The cross_width</span>
</span><span id="Taulu.__init__-239"><a href="#Taulu.__init__-239"><span class="linenos">239</span></a><span class="sd">                should match the thickness of the black lines you see.</span>
</span><span id="Taulu.__init__-240"><a href="#Taulu.__init__-240"><span class="linenos">240</span></a><span class="sd">                Default: 10</span>
</span><span id="Taulu.__init__-241"><a href="#Taulu.__init__-241"><span class="linenos">241</span></a>
</span><span id="Taulu.__init__-242"><a href="#Taulu.__init__-242"><span class="linenos">242</span></a><span class="sd">            morph_size (int | Split[int]):</span>
</span><span id="Taulu.__init__-243"><a href="#Taulu.__init__-243"><span class="linenos">243</span></a><span class="sd">                Size of morphological structuring element for dilation. Controls how</span>
</span><span id="Taulu.__init__-244"><a href="#Taulu.__init__-244"><span class="linenos">244</span></a><span class="sd">                much gap-bridging occurs to connect broken line segments.</span>
</span><span id="Taulu.__init__-245"><a href="#Taulu.__init__-245"><span class="linenos">245</span></a>
</span><span id="Taulu.__init__-246"><a href="#Taulu.__init__-246"><span class="linenos">246</span></a><span class="sd">                - **Smaller values** (2-4): Minimal connection, preserves thin lines</span>
</span><span id="Taulu.__init__-247"><a href="#Taulu.__init__-247"><span class="linenos">247</span></a><span class="sd">                - **Larger values** (6-10): Connects larger gaps, but thickens lines</span>
</span><span id="Taulu.__init__-248"><a href="#Taulu.__init__-248"><span class="linenos">248</span></a>
</span><span id="Taulu.__init__-249"><a href="#Taulu.__init__-249"><span class="linenos">249</span></a><span class="sd">                Note: Increasing this requires increasing `cross_width` proportionally.</span>
</span><span id="Taulu.__init__-250"><a href="#Taulu.__init__-250"><span class="linenos">250</span></a><span class="sd">                Default: 4</span>
</span><span id="Taulu.__init__-251"><a href="#Taulu.__init__-251"><span class="linenos">251</span></a>
</span><span id="Taulu.__init__-252"><a href="#Taulu.__init__-252"><span class="linenos">252</span></a><span class="sd">            kernel_size (int | Split[int]):</span>
</span><span id="Taulu.__init__-253"><a href="#Taulu.__init__-253"><span class="linenos">253</span></a><span class="sd">                Size of the cross-shaped kernel (must be odd). Larger kernels are more</span>
</span><span id="Taulu.__init__-254"><a href="#Taulu.__init__-254"><span class="linenos">254</span></a><span class="sd">                selective, reducing false positives but potentially missing valid corners.</span>
</span><span id="Taulu.__init__-255"><a href="#Taulu.__init__-255"><span class="linenos">255</span></a>
</span><span id="Taulu.__init__-256"><a href="#Taulu.__init__-256"><span class="linenos">256</span></a><span class="sd">                - **Smaller values** (21-31): More sensitive, finds more candidates</span>
</span><span id="Taulu.__init__-257"><a href="#Taulu.__init__-257"><span class="linenos">257</span></a><span class="sd">                - **Larger values** (41-61): More selective, fewer false positives</span>
</span><span id="Taulu.__init__-258"><a href="#Taulu.__init__-258"><span class="linenos">258</span></a>
</span><span id="Taulu.__init__-259"><a href="#Taulu.__init__-259"><span class="linenos">259</span></a><span class="sd">                Default: 41</span>
</span><span id="Taulu.__init__-260"><a href="#Taulu.__init__-260"><span class="linenos">260</span></a>
</span><span id="Taulu.__init__-261"><a href="#Taulu.__init__-261"><span class="linenos">261</span></a><span class="sd">            processing_scale (float | Split[float]):</span>
</span><span id="Taulu.__init__-262"><a href="#Taulu.__init__-262"><span class="linenos">262</span></a><span class="sd">                Image downscaling factor (0, 1] for processing speed. Processing is done</span>
</span><span id="Taulu.__init__-263"><a href="#Taulu.__init__-263"><span class="linenos">263</span></a><span class="sd">                on scaled images, then results are scaled back to original size.</span>
</span><span id="Taulu.__init__-264"><a href="#Taulu.__init__-264"><span class="linenos">264</span></a>
</span><span id="Taulu.__init__-265"><a href="#Taulu.__init__-265"><span class="linenos">265</span></a><span class="sd">                - **1.0**: Full resolution (slowest, most accurate)</span>
</span><span id="Taulu.__init__-266"><a href="#Taulu.__init__-266"><span class="linenos">266</span></a><span class="sd">                - **0.5-0.75**: Good balance for high-res scans (2x-4x speedup)</span>
</span><span id="Taulu.__init__-267"><a href="#Taulu.__init__-267"><span class="linenos">267</span></a><span class="sd">                - **0.25-0.5**: Fast processing for very large images</span>
</span><span id="Taulu.__init__-268"><a href="#Taulu.__init__-268"><span class="linenos">268</span></a>
</span><span id="Taulu.__init__-269"><a href="#Taulu.__init__-269"><span class="linenos">269</span></a><span class="sd">                Default: 1.0</span>
</span><span id="Taulu.__init__-270"><a href="#Taulu.__init__-270"><span class="linenos">270</span></a>
</span><span id="Taulu.__init__-271"><a href="#Taulu.__init__-271"><span class="linenos">271</span></a><span class="sd">            min_rows (int | Split[int]):</span>
</span><span id="Taulu.__init__-272"><a href="#Taulu.__init__-272"><span class="linenos">272</span></a><span class="sd">                Minimum number of rows required before the algorithm considers the</span>
</span><span id="Taulu.__init__-273"><a href="#Taulu.__init__-273"><span class="linenos">273</span></a><span class="sd">                table complete. Prevents stopping too early on tables with initial</span>
</span><span id="Taulu.__init__-274"><a href="#Taulu.__init__-274"><span class="linenos">274</span></a><span class="sd">                low-confidence detections.</span>
</span><span id="Taulu.__init__-275"><a href="#Taulu.__init__-275"><span class="linenos">275</span></a><span class="sd">                Default: 5</span>
</span><span id="Taulu.__init__-276"><a href="#Taulu.__init__-276"><span class="linenos">276</span></a>
</span><span id="Taulu.__init__-277"><a href="#Taulu.__init__-277"><span class="linenos">277</span></a><span class="sd">            look_distance (int | Split[int]):</span>
</span><span id="Taulu.__init__-278"><a href="#Taulu.__init__-278"><span class="linenos">278</span></a><span class="sd">                Number of adjacent rows/columns to examine when extrapolating missing</span>
</span><span id="Taulu.__init__-279"><a href="#Taulu.__init__-279"><span class="linenos">279</span></a><span class="sd">                corners using polynomial regression. Higher values provide more context</span>
</span><span id="Taulu.__init__-280"><a href="#Taulu.__init__-280"><span class="linenos">280</span></a><span class="sd">                but may smooth over legitimate variations.</span>
</span><span id="Taulu.__init__-281"><a href="#Taulu.__init__-281"><span class="linenos">281</span></a>
</span><span id="Taulu.__init__-282"><a href="#Taulu.__init__-282"><span class="linenos">282</span></a><span class="sd">                - **2-3**: Good for consistent grids</span>
</span><span id="Taulu.__init__-283"><a href="#Taulu.__init__-283"><span class="linenos">283</span></a><span class="sd">                - **4-6**: Better for grids with some irregularity</span>
</span><span id="Taulu.__init__-284"><a href="#Taulu.__init__-284"><span class="linenos">284</span></a>
</span><span id="Taulu.__init__-285"><a href="#Taulu.__init__-285"><span class="linenos">285</span></a><span class="sd">                Default: 3</span>
</span><span id="Taulu.__init__-286"><a href="#Taulu.__init__-286"><span class="linenos">286</span></a>
</span><span id="Taulu.__init__-287"><a href="#Taulu.__init__-287"><span class="linenos">287</span></a><span class="sd">            grow_threshold (float | Split[float]):</span>
</span><span id="Taulu.__init__-288"><a href="#Taulu.__init__-288"><span class="linenos">288</span></a><span class="sd">                Initial minimum confidence [0, 1] required to accept a detected corner</span>
</span><span id="Taulu.__init__-289"><a href="#Taulu.__init__-289"><span class="linenos">289</span></a><span class="sd">                during the growing phase. The algorithm may adaptively lower this</span>
</span><span id="Taulu.__init__-290"><a href="#Taulu.__init__-290"><span class="linenos">290</span></a><span class="sd">                threshold if growth stalls.</span>
</span><span id="Taulu.__init__-291"><a href="#Taulu.__init__-291"><span class="linenos">291</span></a>
</span><span id="Taulu.__init__-292"><a href="#Taulu.__init__-292"><span class="linenos">292</span></a><span class="sd">                - **Higher values** (0.5-0.8): Stricter, fewer errors but may miss valid corners</span>
</span><span id="Taulu.__init__-293"><a href="#Taulu.__init__-293"><span class="linenos">293</span></a><span class="sd">                - **Lower values** (0.2-0.4): More permissive, finds more corners but more errors</span>
</span><span id="Taulu.__init__-294"><a href="#Taulu.__init__-294"><span class="linenos">294</span></a>
</span><span id="Taulu.__init__-295"><a href="#Taulu.__init__-295"><span class="linenos">295</span></a><span class="sd">                Default: 0.3</span>
</span><span id="Taulu.__init__-296"><a href="#Taulu.__init__-296"><span class="linenos">296</span></a>
</span><span id="Taulu.__init__-297"><a href="#Taulu.__init__-297"><span class="linenos">297</span></a><span class="sd">            smooth_grid (bool | Split[bool]):</span>
</span><span id="Taulu.__init__-298"><a href="#Taulu.__init__-298"><span class="linenos">298</span></a><span class="sd">                Whether or not to apply local smoothing logic to the grid after point detection.</span>
</span><span id="Taulu.__init__-299"><a href="#Taulu.__init__-299"><span class="linenos">299</span></a><span class="sd">                This may clean up rugged parts of the grid but could also lead to small inaccuracies</span>
</span><span id="Taulu.__init__-300"><a href="#Taulu.__init__-300"><span class="linenos">300</span></a><span class="sd">                if the grid is actually locally _not smooth_.</span>
</span><span id="Taulu.__init__-301"><a href="#Taulu.__init__-301"><span class="linenos">301</span></a>
</span><span id="Taulu.__init__-302"><a href="#Taulu.__init__-302"><span class="linenos">302</span></a><span class="sd">                Default: False</span>
</span><span id="Taulu.__init__-303"><a href="#Taulu.__init__-303"><span class="linenos">303</span></a>
</span><span id="Taulu.__init__-304"><a href="#Taulu.__init__-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu.__init__-305"><a href="#Taulu.__init__-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span> <span class="o">=</span> <span class="n">processing_scale</span>
</span><span id="Taulu.__init__-306"><a href="#Taulu.__init__-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_height_factor</span> <span class="o">=</span> <span class="n">cell_height_factor</span>
</span><span id="Taulu.__init__-307"><a href="#Taulu.__init__-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_smooth</span> <span class="o">=</span> <span class="n">smooth_grid</span>
</span><span id="Taulu.__init__-308"><a href="#Taulu.__init__-308"><span class="linenos">308</span></a>
</span><span id="Taulu.__init__-309"><a href="#Taulu.__init__-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">,</span> <span class="n">Split</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_anno_path</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu.__init__-310"><a href="#Taulu.__init__-310"><span class="linenos">310</span></a>            <span class="n">header</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="o">.</span><span class="n">left</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
</span><span id="Taulu.__init__-311"><a href="#Taulu.__init__-311"><span class="linenos">311</span></a>
</span><span id="Taulu.__init__-312"><a href="#Taulu.__init__-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu.__init__-313"><a href="#Taulu.__init__-313"><span class="linenos">313</span></a>                <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-314"><a href="#Taulu.__init__-314"><span class="linenos">314</span></a>            <span class="p">):</span>
</span><span id="Taulu.__init__-315"><a href="#Taulu.__init__-315"><span class="linenos">315</span></a>                <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu.__init__-316"><a href="#Taulu.__init__-316"><span class="linenos">316</span></a>                    <span class="s2">&quot;The header images you provided do not exist (or they aren&#39;t .png files)&quot;</span>
</span><span id="Taulu.__init__-317"><a href="#Taulu.__init__-317"><span class="linenos">317</span></a>                <span class="p">)</span>
</span><span id="Taulu.__init__-318"><a href="#Taulu.__init__-318"><span class="linenos">318</span></a>
</span><span id="Taulu.__init__-319"><a href="#Taulu.__init__-319"><span class="linenos">319</span></a>            <span class="k">if</span> <span class="n">header_anno_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Taulu.__init__-320"><a href="#Taulu.__init__-320"><span class="linenos">320</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu.__init__-321"><a href="#Taulu.__init__-321"><span class="linenos">321</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-322"><a href="#Taulu.__init__-322"><span class="linenos">322</span></a>                <span class="p">):</span>
</span><span id="Taulu.__init__-323"><a href="#Taulu.__init__-323"><span class="linenos">323</span></a>                    <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu.__init__-324"><a href="#Taulu.__init__-324"><span class="linenos">324</span></a>                        <span class="s2">&quot;You need to annotate the headers of your table first</span><span class="se">\n\n</span><span class="s2">see the Taulu.annotate method&quot;</span>
</span><span id="Taulu.__init__-325"><a href="#Taulu.__init__-325"><span class="linenos">325</span></a>                    <span class="p">)</span>
</span><span id="Taulu.__init__-326"><a href="#Taulu.__init__-326"><span class="linenos">326</span></a>
</span><span id="Taulu.__init__-327"><a href="#Taulu.__init__-327"><span class="linenos">327</span></a>                <span class="n">template_left</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu.__init__-328"><a href="#Taulu.__init__-328"><span class="linenos">328</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-329"><a href="#Taulu.__init__-329"><span class="linenos">329</span></a>                <span class="p">)</span>
</span><span id="Taulu.__init__-330"><a href="#Taulu.__init__-330"><span class="linenos">330</span></a>                <span class="n">template_right</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu.__init__-331"><a href="#Taulu.__init__-331"><span class="linenos">331</span></a>                    <span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-332"><a href="#Taulu.__init__-332"><span class="linenos">332</span></a>                <span class="p">)</span>
</span><span id="Taulu.__init__-333"><a href="#Taulu.__init__-333"><span class="linenos">333</span></a>
</span><span id="Taulu.__init__-334"><a href="#Taulu.__init__-334"><span class="linenos">334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu.__init__-335"><a href="#Taulu.__init__-335"><span class="linenos">335</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
</span><span id="Taulu.__init__-336"><a href="#Taulu.__init__-336"><span class="linenos">336</span></a>                    <span class="n">header_anno_path</span><span class="o">.</span><span class="n">right</span>
</span><span id="Taulu.__init__-337"><a href="#Taulu.__init__-337"><span class="linenos">337</span></a>                <span class="p">):</span>
</span><span id="Taulu.__init__-338"><a href="#Taulu.__init__-338"><span class="linenos">338</span></a>                    <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu.__init__-339"><a href="#Taulu.__init__-339"><span class="linenos">339</span></a>                        <span class="s2">&quot;The header annotation files you provided do not exist (or they aren&#39;t .json files)&quot;</span>
</span><span id="Taulu.__init__-340"><a href="#Taulu.__init__-340"><span class="linenos">340</span></a>                    <span class="p">)</span>
</span><span id="Taulu.__init__-341"><a href="#Taulu.__init__-341"><span class="linenos">341</span></a>
</span><span id="Taulu.__init__-342"><a href="#Taulu.__init__-342"><span class="linenos">342</span></a>                <span class="n">template_left</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
</span><span id="Taulu.__init__-343"><a href="#Taulu.__init__-343"><span class="linenos">343</span></a>                <span class="n">template_right</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span><span class="n">header_anno_path</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
</span><span id="Taulu.__init__-344"><a href="#Taulu.__init__-344"><span class="linenos">344</span></a>
</span><span id="Taulu.__init__-345"><a href="#Taulu.__init__-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu.__init__-346"><a href="#Taulu.__init__-346"><span class="linenos">346</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">left</span><span class="p">)),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
</span><span id="Taulu.__init__-347"><a href="#Taulu.__init__-347"><span class="linenos">347</span></a>            <span class="p">)</span>
</span><span id="Taulu.__init__-348"><a href="#Taulu.__init__-348"><span class="linenos">348</span></a>
</span><span id="Taulu.__init__-349"><a href="#Taulu.__init__-349"><span class="linenos">349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu.__init__-350"><a href="#Taulu.__init__-350"><span class="linenos">350</span></a>                <span class="n">HeaderAligner</span><span class="p">(</span>
</span><span id="Taulu.__init__-351"><a href="#Taulu.__init__-351"><span class="linenos">351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-352"><a href="#Taulu.__init__-352"><span class="linenos">352</span></a>                <span class="p">),</span>
</span><span id="Taulu.__init__-353"><a href="#Taulu.__init__-353"><span class="linenos">353</span></a>                <span class="n">HeaderAligner</span><span class="p">(</span>
</span><span id="Taulu.__init__-354"><a href="#Taulu.__init__-354"><span class="linenos">354</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-355"><a href="#Taulu.__init__-355"><span class="linenos">355</span></a>                <span class="p">),</span>
</span><span id="Taulu.__init__-356"><a href="#Taulu.__init__-356"><span class="linenos">356</span></a>            <span class="p">)</span>
</span><span id="Taulu.__init__-357"><a href="#Taulu.__init__-357"><span class="linenos">357</span></a>
</span><span id="Taulu.__init__-358"><a href="#Taulu.__init__-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">template_left</span><span class="p">,</span> <span class="n">template_right</span><span class="p">)</span>
</span><span id="Taulu.__init__-359"><a href="#Taulu.__init__-359"><span class="linenos">359</span></a>
</span><span id="Taulu.__init__-360"><a href="#Taulu.__init__-360"><span class="linenos">360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu.__init__-361"><a href="#Taulu.__init__-361"><span class="linenos">361</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span><span class="n">get_param</span><span class="p">(</span><span class="n">cell_height_factor</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">)),</span>
</span><span id="Taulu.__init__-362"><a href="#Taulu.__init__-362"><span class="linenos">362</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span>
</span><span id="Taulu.__init__-363"><a href="#Taulu.__init__-363"><span class="linenos">363</span></a>                    <span class="n">get_param</span><span class="p">(</span><span class="n">cell_height_factor</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-364"><a href="#Taulu.__init__-364"><span class="linenos">364</span></a>                <span class="p">),</span>
</span><span id="Taulu.__init__-365"><a href="#Taulu.__init__-365"><span class="linenos">365</span></a>            <span class="p">)</span>
</span><span id="Taulu.__init__-366"><a href="#Taulu.__init__-366"><span class="linenos">366</span></a>
</span><span id="Taulu.__init__-367"><a href="#Taulu.__init__-367"><span class="linenos">367</span></a>            <span class="c1"># Create GridDetector for left and right with potentially different parameters</span>
</span><span id="Taulu.__init__-368"><a href="#Taulu.__init__-368"><span class="linenos">368</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu.__init__-369"><a href="#Taulu.__init__-369"><span class="linenos">369</span></a>                <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu.__init__-370"><a href="#Taulu.__init__-370"><span class="linenos">370</span></a>                    <span class="n">kernel_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-371"><a href="#Taulu.__init__-371"><span class="linenos">371</span></a>                    <span class="n">cross_width</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">cross_width</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-372"><a href="#Taulu.__init__-372"><span class="linenos">372</span></a>                    <span class="n">morph_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">morph_size</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-373"><a href="#Taulu.__init__-373"><span class="linenos">373</span></a>                    <span class="n">search_region</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">search_region</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-374"><a href="#Taulu.__init__-374"><span class="linenos">374</span></a>                    <span class="n">sauvola_k</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">sauvola_k</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-375"><a href="#Taulu.__init__-375"><span class="linenos">375</span></a>                    <span class="n">distance_penalty</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">distance_penalty</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-376"><a href="#Taulu.__init__-376"><span class="linenos">376</span></a>                    <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-377"><a href="#Taulu.__init__-377"><span class="linenos">377</span></a>                    <span class="n">min_rows</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">min_rows</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-378"><a href="#Taulu.__init__-378"><span class="linenos">378</span></a>                    <span class="n">look_distance</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">look_distance</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-379"><a href="#Taulu.__init__-379"><span class="linenos">379</span></a>                    <span class="n">grow_threshold</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">grow_threshold</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-380"><a href="#Taulu.__init__-380"><span class="linenos">380</span></a>                <span class="p">),</span>
</span><span id="Taulu.__init__-381"><a href="#Taulu.__init__-381"><span class="linenos">381</span></a>                <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu.__init__-382"><a href="#Taulu.__init__-382"><span class="linenos">382</span></a>                    <span class="n">kernel_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-383"><a href="#Taulu.__init__-383"><span class="linenos">383</span></a>                    <span class="n">cross_width</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">cross_width</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-384"><a href="#Taulu.__init__-384"><span class="linenos">384</span></a>                    <span class="n">morph_size</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">morph_size</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-385"><a href="#Taulu.__init__-385"><span class="linenos">385</span></a>                    <span class="n">search_region</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">search_region</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-386"><a href="#Taulu.__init__-386"><span class="linenos">386</span></a>                    <span class="n">sauvola_k</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">sauvola_k</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-387"><a href="#Taulu.__init__-387"><span class="linenos">387</span></a>                    <span class="n">distance_penalty</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">distance_penalty</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-388"><a href="#Taulu.__init__-388"><span class="linenos">388</span></a>                    <span class="n">scale</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-389"><a href="#Taulu.__init__-389"><span class="linenos">389</span></a>                    <span class="n">min_rows</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">min_rows</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-390"><a href="#Taulu.__init__-390"><span class="linenos">390</span></a>                    <span class="n">look_distance</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">look_distance</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-391"><a href="#Taulu.__init__-391"><span class="linenos">391</span></a>                    <span class="n">grow_threshold</span><span class="o">=</span><span class="n">get_param</span><span class="p">(</span><span class="n">grow_threshold</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">),</span>
</span><span id="Taulu.__init__-392"><a href="#Taulu.__init__-392"><span class="linenos">392</span></a>                <span class="p">),</span>
</span><span id="Taulu.__init__-393"><a href="#Taulu.__init__-393"><span class="linenos">393</span></a>            <span class="p">)</span>
</span><span id="Taulu.__init__-394"><a href="#Taulu.__init__-394"><span class="linenos">394</span></a>
</span><span id="Taulu.__init__-395"><a href="#Taulu.__init__-395"><span class="linenos">395</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu.__init__-396"><a href="#Taulu.__init__-396"><span class="linenos">396</span></a>            <span class="n">header_image_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">)</span>
</span><span id="Taulu.__init__-397"><a href="#Taulu.__init__-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">header_image_path</span><span class="p">))</span>
</span><span id="Taulu.__init__-398"><a href="#Taulu.__init__-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span> <span class="o">=</span> <span class="n">HeaderAligner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">)</span>
</span><span id="Taulu.__init__-399"><a href="#Taulu.__init__-399"><span class="linenos">399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">from_saved</span><span class="p">(</span>
</span><span id="Taulu.__init__-400"><a href="#Taulu.__init__-400"><span class="linenos">400</span></a>                <span class="n">header_image_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="Taulu.__init__-401"><a href="#Taulu.__init__-401"><span class="linenos">401</span></a>            <span class="p">)</span>
</span><span id="Taulu.__init__-402"><a href="#Taulu.__init__-402"><span class="linenos">402</span></a>
</span><span id="Taulu.__init__-403"><a href="#Taulu.__init__-403"><span class="linenos">403</span></a>            <span class="c1"># For single header, parameters should not be Split objects</span>
</span><span id="Taulu.__init__-404"><a href="#Taulu.__init__-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="Taulu.__init__-405"><a href="#Taulu.__init__-405"><span class="linenos">405</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Split</span><span class="p">)</span>
</span><span id="Taulu.__init__-406"><a href="#Taulu.__init__-406"><span class="linenos">406</span></a>                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Taulu.__init__-407"><a href="#Taulu.__init__-407"><span class="linenos">407</span></a>                    <span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="Taulu.__init__-408"><a href="#Taulu.__init__-408"><span class="linenos">408</span></a>                    <span class="n">search_region</span><span class="p">,</span>
</span><span id="Taulu.__init__-409"><a href="#Taulu.__init__-409"><span class="linenos">409</span></a>                    <span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="Taulu.__init__-410"><a href="#Taulu.__init__-410"><span class="linenos">410</span></a>                    <span class="n">cross_width</span><span class="p">,</span>
</span><span id="Taulu.__init__-411"><a href="#Taulu.__init__-411"><span class="linenos">411</span></a>                    <span class="n">morph_size</span><span class="p">,</span>
</span><span id="Taulu.__init__-412"><a href="#Taulu.__init__-412"><span class="linenos">412</span></a>                    <span class="n">kernel_size</span><span class="p">,</span>
</span><span id="Taulu.__init__-413"><a href="#Taulu.__init__-413"><span class="linenos">413</span></a>                    <span class="n">processing_scale</span><span class="p">,</span>
</span><span id="Taulu.__init__-414"><a href="#Taulu.__init__-414"><span class="linenos">414</span></a>                    <span class="n">min_rows</span><span class="p">,</span>
</span><span id="Taulu.__init__-415"><a href="#Taulu.__init__-415"><span class="linenos">415</span></a>                    <span class="n">look_distance</span><span class="p">,</span>
</span><span id="Taulu.__init__-416"><a href="#Taulu.__init__-416"><span class="linenos">416</span></a>                    <span class="n">grow_threshold</span><span class="p">,</span>
</span><span id="Taulu.__init__-417"><a href="#Taulu.__init__-417"><span class="linenos">417</span></a>                    <span class="n">cell_height_factor</span><span class="p">,</span>
</span><span id="Taulu.__init__-418"><a href="#Taulu.__init__-418"><span class="linenos">418</span></a>                <span class="p">]</span>
</span><span id="Taulu.__init__-419"><a href="#Taulu.__init__-419"><span class="linenos">419</span></a>            <span class="p">):</span>
</span><span id="Taulu.__init__-420"><a href="#Taulu.__init__-420"><span class="linenos">420</span></a>                <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span>
</span><span id="Taulu.__init__-421"><a href="#Taulu.__init__-421"><span class="linenos">421</span></a>                    <span class="s2">&quot;Split parameters can only be used with split headers (tuple header_path)&quot;</span>
</span><span id="Taulu.__init__-422"><a href="#Taulu.__init__-422"><span class="linenos">422</span></a>                <span class="p">)</span>
</span><span id="Taulu.__init__-423"><a href="#Taulu.__init__-423"><span class="linenos">423</span></a>
</span><span id="Taulu.__init__-424"><a href="#Taulu.__init__-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">cell_heights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_height_factor</span><span class="p">)</span>
</span><span id="Taulu.__init__-425"><a href="#Taulu.__init__-425"><span class="linenos">425</span></a>
</span><span id="Taulu.__init__-426"><a href="#Taulu.__init__-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span> <span class="o">=</span> <span class="n">GridDetector</span><span class="p">(</span>
</span><span id="Taulu.__init__-427"><a href="#Taulu.__init__-427"><span class="linenos">427</span></a>                <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
</span><span id="Taulu.__init__-428"><a href="#Taulu.__init__-428"><span class="linenos">428</span></a>                <span class="n">cross_width</span><span class="o">=</span><span class="n">cross_width</span><span class="p">,</span>
</span><span id="Taulu.__init__-429"><a href="#Taulu.__init__-429"><span class="linenos">429</span></a>                <span class="n">morph_size</span><span class="o">=</span><span class="n">morph_size</span><span class="p">,</span>
</span><span id="Taulu.__init__-430"><a href="#Taulu.__init__-430"><span class="linenos">430</span></a>                <span class="n">search_region</span><span class="o">=</span><span class="n">search_region</span><span class="p">,</span>
</span><span id="Taulu.__init__-431"><a href="#Taulu.__init__-431"><span class="linenos">431</span></a>                <span class="n">sauvola_k</span><span class="o">=</span><span class="n">sauvola_k</span><span class="p">,</span>
</span><span id="Taulu.__init__-432"><a href="#Taulu.__init__-432"><span class="linenos">432</span></a>                <span class="n">distance_penalty</span><span class="o">=</span><span class="n">distance_penalty</span><span class="p">,</span>
</span><span id="Taulu.__init__-433"><a href="#Taulu.__init__-433"><span class="linenos">433</span></a>                <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_processing_scale</span><span class="p">,</span>
</span><span id="Taulu.__init__-434"><a href="#Taulu.__init__-434"><span class="linenos">434</span></a>                <span class="n">min_rows</span><span class="o">=</span><span class="n">min_rows</span><span class="p">,</span>
</span><span id="Taulu.__init__-435"><a href="#Taulu.__init__-435"><span class="linenos">435</span></a>                <span class="n">look_distance</span><span class="o">=</span><span class="n">look_distance</span><span class="p">,</span>
</span><span id="Taulu.__init__-436"><a href="#Taulu.__init__-436"><span class="linenos">436</span></a>                <span class="n">grow_threshold</span><span class="o">=</span><span class="n">grow_threshold</span><span class="p">,</span>
</span><span id="Taulu.__init__-437"><a href="#Taulu.__init__-437"><span class="linenos">437</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>header_image_path:</strong>  Path to the header template image(s). The header should be a cropped
image showing a clear view of the table's first row. An annotation
file (.json) must exist alongside the image, created via <code><a href="#Taulu.annotate">Taulu.annotate()</a></code>.
For split tables, provide a <code><a href="#Split">Split</a></code> containing left and right header paths.</li>
<li><p><strong>cell_height_factor:</strong>  Height of data rows relative to header height. For example, if your
header is 100px tall and data rows are 80px tall, use 0.8.</p>

<ul>
<li><strong>float</strong>: All rows have the same height</li>
<li><strong>list[float]</strong>: Different heights for different rows. The last value
is repeated for any additional rows beyond the list length. Useful when
the first data row is taller than subsequent rows.</li>
<li><strong>Split</strong>: Different height factors for left and right sides</li>
</ul>

<p>Default: [1.0]</p></li>
<li><strong>header_anno_path (PathLike[str] | str | Split[PathLike[str] | str] | None):</strong>  Optional explicit path to header annotation JSON file(s). If None,
looks for a .json file with the same name as <code>header_image_path</code>.
Default: None</li>
<li><p><strong>sauvola_k (float | Split[float]):</strong>  Threshold sensitivity for Sauvola adaptive binarization (0.0-1.0).
Controls how aggressively the algorithm converts the image to binary.</p>

<ul>
<li><strong>Lower values</strong> (0.04-0.15): Preserve faint lines, more noise</li>
<li><strong>Higher values</strong> (0.20-0.35): Remove noise, may lose faint lines</li>
</ul>

<p>Start with 0.25 and adjust based on your image quality.
Default: 0.25</p></li>
<li><p><strong>search_region (int | Split[int]):</strong>  Size in pixels of the square region to search for the next corner point.
The algorithm estimates where a corner should be, then searches within
this region for the best match.</p>

<ul>
<li><strong>Smaller values</strong> (20-40): Faster, requires well-aligned tables</li>
<li><strong>Larger values</strong> (60-100): More robust to warping and distortion</li>
</ul>

<p>Default: 60</p></li>
<li><p><strong>distance_penalty (float | Split[float]):</strong>  Weight factor [0, 1] for penalizing corners far from expected position.
Uses Gaussian weighting within the search region.</p>

<ul>
<li><strong>0.0</strong>: No penalty, any position in search region is equally valid</li>
<li><strong>0.5</strong>: Moderate preference for positions near the expected location</li>
<li><strong>1.0</strong>: Strong preference, only accepts positions very close to expected</li>
</ul>

<p>Default: 0.4</p></li>
<li><p><strong>cross_width (int | Split[int]):</strong>  Width in pixels of the cross-shaped kernel used to detect intersections.
Should approximately match the thickness of your table rules AFTER
morphological dilation.</p>

<p><strong>Tuning</strong>: Look at the dilated image in debug_view. The cross_width
should match the thickness of the black lines you see.
Default: 10</p></li>
<li><p><strong>morph_size (int | Split[int]):</strong>  Size of morphological structuring element for dilation. Controls how
much gap-bridging occurs to connect broken line segments.</p>

<ul>
<li><strong>Smaller values</strong> (2-4): Minimal connection, preserves thin lines</li>
<li><strong>Larger values</strong> (6-10): Connects larger gaps, but thickens lines</li>
</ul>

<p>Note: Increasing this requires increasing <code>cross_width</code> proportionally.
Default: 4</p></li>
<li><p><strong>kernel_size (int | Split[int]):</strong>  Size of the cross-shaped kernel (must be odd). Larger kernels are more
selective, reducing false positives but potentially missing valid corners.</p>

<ul>
<li><strong>Smaller values</strong> (21-31): More sensitive, finds more candidates</li>
<li><strong>Larger values</strong> (41-61): More selective, fewer false positives</li>
</ul>

<p>Default: 41</p></li>
<li><p><strong>processing_scale (float | Split[float]):</strong>  Image downscaling factor (0, 1] for processing speed. Processing is done
on scaled images, then results are scaled back to original size.</p>

<ul>
<li><strong>1.0</strong>: Full resolution (slowest, most accurate)</li>
<li><strong>0.5-0.75</strong>: Good balance for high-res scans (2x-4x speedup)</li>
<li><strong>0.25-0.5</strong>: Fast processing for very large images</li>
</ul>

<p>Default: 1.0</p></li>
<li><strong>min_rows (int | Split[int]):</strong>  Minimum number of rows required before the algorithm considers the
table complete. Prevents stopping too early on tables with initial
low-confidence detections.
Default: 5</li>
<li><p><strong>look_distance (int | Split[int]):</strong>  Number of adjacent rows/columns to examine when extrapolating missing
corners using polynomial regression. Higher values provide more context
but may smooth over legitimate variations.</p>

<ul>
<li><strong>2-3</strong>: Good for consistent grids</li>
<li><strong>4-6</strong>: Better for grids with some irregularity</li>
</ul>

<p>Default: 3</p></li>
<li><p><strong>grow_threshold (float | Split[float]):</strong>  Initial minimum confidence [0, 1] required to accept a detected corner
during the growing phase. The algorithm may adaptively lower this
threshold if growth stalls.</p>

<ul>
<li><strong>Higher values</strong> (0.5-0.8): Stricter, fewer errors but may miss valid corners</li>
<li><strong>Lower values</strong> (0.2-0.4): More permissive, finds more corners but more errors</li>
</ul>

<p>Default: 0.3</p></li>
<li><p><strong>smooth_grid (bool | Split[bool]):</strong>  Whether or not to apply local smoothing logic to the grid after point detection.
This may clean up rugged parts of the grid but could also lead to small inaccuracies
if the grid is actually locally _not smooth_.</p>

<p>Default: False</p></li>
</ul>
</div>


                            </div>
                            <div id="Taulu.annotate" class="classattr">
                                        <input id="Taulu.annotate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">annotate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">image_path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Taulu.annotate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Taulu.annotate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Taulu.annotate-439"><a href="#Taulu.annotate-439"><span class="linenos">439</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Taulu.annotate-440"><a href="#Taulu.annotate-440"><span class="linenos">440</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">annotate</span><span class="p">(</span><span class="n">image_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Taulu.annotate-441"><a href="#Taulu.annotate-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu.annotate-442"><a href="#Taulu.annotate-442"><span class="linenos">442</span></a><span class="sd">        Interactive tool to create header annotations for table segmentation.</span>
</span><span id="Taulu.annotate-443"><a href="#Taulu.annotate-443"><span class="linenos">443</span></a>
</span><span id="Taulu.annotate-444"><a href="#Taulu.annotate-444"><span class="linenos">444</span></a><span class="sd">        This method guides you through a two-step annotation process:</span>
</span><span id="Taulu.annotate-445"><a href="#Taulu.annotate-445"><span class="linenos">445</span></a>
</span><span id="Taulu.annotate-446"><a href="#Taulu.annotate-446"><span class="linenos">446</span></a><span class="sd">        1. **Crop the header**: Click four corners to define the header region</span>
</span><span id="Taulu.annotate-447"><a href="#Taulu.annotate-447"><span class="linenos">447</span></a><span class="sd">        2. **Annotate lines**: Click pairs of points to define each vertical and</span>
</span><span id="Taulu.annotate-448"><a href="#Taulu.annotate-448"><span class="linenos">448</span></a><span class="sd">           horizontal line in the header</span>
</span><span id="Taulu.annotate-449"><a href="#Taulu.annotate-449"><span class="linenos">449</span></a>
</span><span id="Taulu.annotate-450"><a href="#Taulu.annotate-450"><span class="linenos">450</span></a><span class="sd">        The annotations are saved as:</span>
</span><span id="Taulu.annotate-451"><a href="#Taulu.annotate-451"><span class="linenos">451</span></a><span class="sd">        - A cropped header image (.png) at `output_path`</span>
</span><span id="Taulu.annotate-452"><a href="#Taulu.annotate-452"><span class="linenos">452</span></a><span class="sd">        - A JSON file (.json) containing line coordinates</span>
</span><span id="Taulu.annotate-453"><a href="#Taulu.annotate-453"><span class="linenos">453</span></a>
</span><span id="Taulu.annotate-454"><a href="#Taulu.annotate-454"><span class="linenos">454</span></a><span class="sd">        ## Annotation Guidelines</span>
</span><span id="Taulu.annotate-455"><a href="#Taulu.annotate-455"><span class="linenos">455</span></a>
</span><span id="Taulu.annotate-456"><a href="#Taulu.annotate-456"><span class="linenos">456</span></a><span class="sd">        **Which lines to annotate:**</span>
</span><span id="Taulu.annotate-457"><a href="#Taulu.annotate-457"><span class="linenos">457</span></a><span class="sd">        - All vertical lines that extend into the table body (column separators)</span>
</span><span id="Taulu.annotate-458"><a href="#Taulu.annotate-458"><span class="linenos">458</span></a><span class="sd">        - The top horizontal line of the header</span>
</span><span id="Taulu.annotate-459"><a href="#Taulu.annotate-459"><span class="linenos">459</span></a><span class="sd">        - The bottom horizontal line of the header (top of data rows)</span>
</span><span id="Taulu.annotate-460"><a href="#Taulu.annotate-460"><span class="linenos">460</span></a>
</span><span id="Taulu.annotate-461"><a href="#Taulu.annotate-461"><span class="linenos">461</span></a><span class="sd">        **Order doesn&#39;t matter** - annotate lines in any order that&#39;s convenient.</span>
</span><span id="Taulu.annotate-462"><a href="#Taulu.annotate-462"><span class="linenos">462</span></a>
</span><span id="Taulu.annotate-463"><a href="#Taulu.annotate-463"><span class="linenos">463</span></a><span class="sd">        **To annotate a line:**</span>
</span><span id="Taulu.annotate-464"><a href="#Taulu.annotate-464"><span class="linenos">464</span></a><span class="sd">        1. Click once at one endpoint</span>
</span><span id="Taulu.annotate-465"><a href="#Taulu.annotate-465"><span class="linenos">465</span></a><span class="sd">        2. Click again at the other endpoint</span>
</span><span id="Taulu.annotate-466"><a href="#Taulu.annotate-466"><span class="linenos">466</span></a><span class="sd">        3. A green line appears showing your annotation</span>
</span><span id="Taulu.annotate-467"><a href="#Taulu.annotate-467"><span class="linenos">467</span></a>
</span><span id="Taulu.annotate-468"><a href="#Taulu.annotate-468"><span class="linenos">468</span></a><span class="sd">        **To undo:**</span>
</span><span id="Taulu.annotate-469"><a href="#Taulu.annotate-469"><span class="linenos">469</span></a><span class="sd">        - Right-click anywhere to remove the last line you drew</span>
</span><span id="Taulu.annotate-470"><a href="#Taulu.annotate-470"><span class="linenos">470</span></a>
</span><span id="Taulu.annotate-471"><a href="#Taulu.annotate-471"><span class="linenos">471</span></a><span class="sd">        **When finished:**</span>
</span><span id="Taulu.annotate-472"><a href="#Taulu.annotate-472"><span class="linenos">472</span></a><span class="sd">        - Press &#39;n&#39; to save and exit</span>
</span><span id="Taulu.annotate-473"><a href="#Taulu.annotate-473"><span class="linenos">473</span></a><span class="sd">        - Press &#39;q&#39; to quit without saving</span>
</span><span id="Taulu.annotate-474"><a href="#Taulu.annotate-474"><span class="linenos">474</span></a>
</span><span id="Taulu.annotate-475"><a href="#Taulu.annotate-475"><span class="linenos">475</span></a><span class="sd">        Args:</span>
</span><span id="Taulu.annotate-476"><a href="#Taulu.annotate-476"><span class="linenos">476</span></a><span class="sd">            image_path (PathLike[str] | str): Path to a table image containing</span>
</span><span id="Taulu.annotate-477"><a href="#Taulu.annotate-477"><span class="linenos">477</span></a><span class="sd">                a clear view of the header. This can be a full table image.</span>
</span><span id="Taulu.annotate-478"><a href="#Taulu.annotate-478"><span class="linenos">478</span></a><span class="sd">            output_path (PathLike[str] | str): Where to save the cropped header</span>
</span><span id="Taulu.annotate-479"><a href="#Taulu.annotate-479"><span class="linenos">479</span></a><span class="sd">                image. The annotation JSON will be saved with the same name but</span>
</span><span id="Taulu.annotate-480"><a href="#Taulu.annotate-480"><span class="linenos">480</span></a><span class="sd">                .json extension.</span>
</span><span id="Taulu.annotate-481"><a href="#Taulu.annotate-481"><span class="linenos">481</span></a>
</span><span id="Taulu.annotate-482"><a href="#Taulu.annotate-482"><span class="linenos">482</span></a><span class="sd">        Raises:</span>
</span><span id="Taulu.annotate-483"><a href="#Taulu.annotate-483"><span class="linenos">483</span></a><span class="sd">            TauluException: If image_path doesn&#39;t exist or output_path is a directory</span>
</span><span id="Taulu.annotate-484"><a href="#Taulu.annotate-484"><span class="linenos">484</span></a>
</span><span id="Taulu.annotate-485"><a href="#Taulu.annotate-485"><span class="linenos">485</span></a><span class="sd">        Examples:</span>
</span><span id="Taulu.annotate-486"><a href="#Taulu.annotate-486"><span class="linenos">486</span></a><span class="sd">            Annotate a single header:</span>
</span><span id="Taulu.annotate-487"><a href="#Taulu.annotate-487"><span class="linenos">487</span></a>
</span><span id="Taulu.annotate-488"><a href="#Taulu.annotate-488"><span class="linenos">488</span></a><span class="sd">            &gt;&gt;&gt; from taulu import Taulu</span>
</span><span id="Taulu.annotate-489"><a href="#Taulu.annotate-489"><span class="linenos">489</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header.png&quot;)</span>
</span><span id="Taulu.annotate-490"><a href="#Taulu.annotate-490"><span class="linenos">490</span></a><span class="sd">            # Interactive window opens</span>
</span><span id="Taulu.annotate-491"><a href="#Taulu.annotate-491"><span class="linenos">491</span></a><span class="sd">            # After annotation: creates header.png and header.json</span>
</span><span id="Taulu.annotate-492"><a href="#Taulu.annotate-492"><span class="linenos">492</span></a>
</span><span id="Taulu.annotate-493"><a href="#Taulu.annotate-493"><span class="linenos">493</span></a><span class="sd">            Annotate left and right headers for a split table:</span>
</span><span id="Taulu.annotate-494"><a href="#Taulu.annotate-494"><span class="linenos">494</span></a>
</span><span id="Taulu.annotate-495"><a href="#Taulu.annotate-495"><span class="linenos">495</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header_left.png&quot;)</span>
</span><span id="Taulu.annotate-496"><a href="#Taulu.annotate-496"><span class="linenos">496</span></a><span class="sd">            &gt;&gt;&gt; Taulu.annotate(&quot;scan_page_01.png&quot;, &quot;header_right.png&quot;)</span>
</span><span id="Taulu.annotate-497"><a href="#Taulu.annotate-497"><span class="linenos">497</span></a><span class="sd">            # Creates header_left.{png,json} and header_right.{png,json}</span>
</span><span id="Taulu.annotate-498"><a href="#Taulu.annotate-498"><span class="linenos">498</span></a>
</span><span id="Taulu.annotate-499"><a href="#Taulu.annotate-499"><span class="linenos">499</span></a><span class="sd">        Notes:</span>
</span><span id="Taulu.annotate-500"><a href="#Taulu.annotate-500"><span class="linenos">500</span></a><span class="sd">            - The header image doesn&#39;t need to be perfectly cropped initially -</span>
</span><span id="Taulu.annotate-501"><a href="#Taulu.annotate-501"><span class="linenos">501</span></a><span class="sd">              the tool will help you crop it precisely</span>
</span><span id="Taulu.annotate-502"><a href="#Taulu.annotate-502"><span class="linenos">502</span></a><span class="sd">            - Annotation accuracy is important: misaligned lines will cause</span>
</span><span id="Taulu.annotate-503"><a href="#Taulu.annotate-503"><span class="linenos">503</span></a><span class="sd">              segmentation errors</span>
</span><span id="Taulu.annotate-504"><a href="#Taulu.annotate-504"><span class="linenos">504</span></a><span class="sd">            - You can re-run this method to update annotations if needed</span>
</span><span id="Taulu.annotate-505"><a href="#Taulu.annotate-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu.annotate-506"><a href="#Taulu.annotate-506"><span class="linenos">506</span></a>
</span><span id="Taulu.annotate-507"><a href="#Taulu.annotate-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
</span><span id="Taulu.annotate-508"><a href="#Taulu.annotate-508"><span class="linenos">508</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image path </span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
</span><span id="Taulu.annotate-509"><a href="#Taulu.annotate-509"><span class="linenos">509</span></a>
</span><span id="Taulu.annotate-510"><a href="#Taulu.annotate-510"><span class="linenos">510</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
</span><span id="Taulu.annotate-511"><a href="#Taulu.annotate-511"><span class="linenos">511</span></a>            <span class="k">raise</span> <span class="n">TauluException</span><span class="p">(</span><span class="s2">&quot;Output path should be a file&quot;</span><span class="p">)</span>
</span><span id="Taulu.annotate-512"><a href="#Taulu.annotate-512"><span class="linenos">512</span></a>
</span><span id="Taulu.annotate-513"><a href="#Taulu.annotate-513"><span class="linenos">513</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</span><span id="Taulu.annotate-514"><a href="#Taulu.annotate-514"><span class="linenos">514</span></a>
</span><span id="Taulu.annotate-515"><a href="#Taulu.annotate-515"><span class="linenos">515</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">HeaderTemplate</span><span class="o">.</span><span class="n">annotate_image</span><span class="p">(</span>
</span><span id="Taulu.annotate-516"><a href="#Taulu.annotate-516"><span class="linenos">516</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span> <span class="n">crop</span><span class="o">=</span><span class="n">output_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Taulu.annotate-517"><a href="#Taulu.annotate-517"><span class="linenos">517</span></a>        <span class="p">)</span>
</span><span id="Taulu.annotate-518"><a href="#Taulu.annotate-518"><span class="linenos">518</span></a>
</span><span id="Taulu.annotate-519"><a href="#Taulu.annotate-519"><span class="linenos">519</span></a>        <span class="n">template</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Interactive tool to create header annotations for table segmentation.</p>

<p>This method guides you through a two-step annotation process:</p>

<ol>
<li><strong>Crop the header</strong>: Click four corners to define the header region</li>
<li><strong>Annotate lines</strong>: Click pairs of points to define each vertical and
horizontal line in the header</li>
</ol>

<p>The annotations are saved as:</p>

<ul>
<li>A cropped header image (.png) at <code>output_path</code></li>
<li>A JSON file (.json) containing line coordinates</li>
</ul>

<h2 id="annotation-guidelines">Annotation Guidelines</h2>

<p><strong>Which lines to annotate:</strong></p>

<ul>
<li>All vertical lines that extend into the table body (column separators)</li>
<li>The top horizontal line of the header</li>
<li>The bottom horizontal line of the header (top of data rows)</li>
</ul>

<p><strong>Order doesn't matter</strong> - annotate lines in any order that's convenient.</p>

<p><strong>To annotate a line:</strong></p>

<ol>
<li>Click once at one endpoint</li>
<li>Click again at the other endpoint</li>
<li>A green line appears showing your annotation</li>
</ol>

<p><strong>To undo:</strong></p>

<ul>
<li>Right-click anywhere to remove the last line you drew</li>
</ul>

<p><strong>When finished:</strong></p>

<ul>
<li>Press 'n' to save and exit</li>
<li>Press 'q' to quit without saving</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>image_path (PathLike[str] | str):</strong>  Path to a table image containing
a clear view of the header. This can be a full table image.</li>
<li><strong>output_path (PathLike[str] | str):</strong>  Where to save the cropped header
image. The annotation JSON will be saved with the same name but
.json extension.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>TauluException:</strong>  If image_path doesn't exist or output_path is a directory</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <p>Annotate a single header:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;scan_page_01.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header.png&quot;</span><span class="p">)</span>
<span class="go">&lt;h1 id=&quot;interactive-window-opens&quot;&gt;Interactive window opens&lt;/h1&gt;</span>
</code></pre>
  </div>
  
  <h1 id="after-annotation-creates-headerpng-and-headerjson">After annotation: creates header.png and header.json</h1>
  
  <p>Annotate left and right headers for a split table:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;scan_page_01.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header_left.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#Taulu.annotate">Taulu.annotate</a></span><span class="p">(</span><span class="s2">&quot;scan_page_01.png&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right.png&quot;</span><span class="p">)</span>
<span class="go">&lt;h1 id=&quot;creates-header_leftpngjson-and-header_rightpngjson&quot;&gt;Creates header_left.{png,json} and header_right.{png,json}&lt;/h1&gt;</span>
</code></pre>
  </div>
</blockquote>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>The header image doesn't need to be perfectly cropped initially -
  the tool will help you crop it precisely</li>
  <li>Annotation accuracy is important: misaligned lines will cause
  segmentation errors</li>
  <li>You can re-run this method to update annotations if needed</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="Taulu.segment_table" class="classattr">
                                        <input id="Taulu.segment_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">segment_table</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">filtered</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">Mat</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#TableGrid">TableGrid</a></span>:</span></span>

                <label class="view-source-button" for="Taulu.segment_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Taulu.segment_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Taulu.segment_table-521"><a href="#Taulu.segment_table-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">segment_table</span><span class="p">(</span>
</span><span id="Taulu.segment_table-522"><a href="#Taulu.segment_table-522"><span class="linenos">522</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Taulu.segment_table-523"><a href="#Taulu.segment_table-523"><span class="linenos">523</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Taulu.segment_table-524"><a href="#Taulu.segment_table-524"><span class="linenos">524</span></a>        <span class="n">filtered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatLike</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Taulu.segment_table-525"><a href="#Taulu.segment_table-525"><span class="linenos">525</span></a>        <span class="n">debug_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Taulu.segment_table-526"><a href="#Taulu.segment_table-526"><span class="linenos">526</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TableGrid</span><span class="p">:</span>
</span><span id="Taulu.segment_table-527"><a href="#Taulu.segment_table-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Taulu.segment_table-528"><a href="#Taulu.segment_table-528"><span class="linenos">528</span></a><span class="sd">        Segment a table image into a grid of cells.</span>
</span><span id="Taulu.segment_table-529"><a href="#Taulu.segment_table-529"><span class="linenos">529</span></a>
</span><span id="Taulu.segment_table-530"><a href="#Taulu.segment_table-530"><span class="linenos">530</span></a><span class="sd">        This is the main entry point for the taulu package. It orchestrates:</span>
</span><span id="Taulu.segment_table-531"><a href="#Taulu.segment_table-531"><span class="linenos">531</span></a>
</span><span id="Taulu.segment_table-532"><a href="#Taulu.segment_table-532"><span class="linenos">532</span></a><span class="sd">        1. **Header alignment**: Locates the table by matching the header template</span>
</span><span id="Taulu.segment_table-533"><a href="#Taulu.segment_table-533"><span class="linenos">533</span></a><span class="sd">           to the image using feature-based registration (ORB features + homography)</span>
</span><span id="Taulu.segment_table-534"><a href="#Taulu.segment_table-534"><span class="linenos">534</span></a><span class="sd">        2. **Grid detection**: Applies morphological filtering and cross-correlation</span>
</span><span id="Taulu.segment_table-535"><a href="#Taulu.segment_table-535"><span class="linenos">535</span></a><span class="sd">           to find corner intersections</span>
</span><span id="Taulu.segment_table-536"><a href="#Taulu.segment_table-536"><span class="linenos">536</span></a><span class="sd">        3. **Grid growing**: Iteratively detects corners row-by-row and column-by-column,</span>
</span><span id="Taulu.segment_table-537"><a href="#Taulu.segment_table-537"><span class="linenos">537</span></a><span class="sd">           starting from the aligned header position</span>
</span><span id="Taulu.segment_table-538"><a href="#Taulu.segment_table-538"><span class="linenos">538</span></a><span class="sd">        4. **Extrapolation**: Fills in any missing corners using polynomial regression</span>
</span><span id="Taulu.segment_table-539"><a href="#Taulu.segment_table-539"><span class="linenos">539</span></a><span class="sd">           based on neighboring detected points</span>
</span><span id="Taulu.segment_table-540"><a href="#Taulu.segment_table-540"><span class="linenos">540</span></a><span class="sd">        5. **Smoothing**: Refines corner positions for consistency</span>
</span><span id="Taulu.segment_table-541"><a href="#Taulu.segment_table-541"><span class="linenos">541</span></a>
</span><span id="Taulu.segment_table-542"><a href="#Taulu.segment_table-542"><span class="linenos">542</span></a><span class="sd">        ## Performance Notes</span>
</span><span id="Taulu.segment_table-543"><a href="#Taulu.segment_table-543"><span class="linenos">543</span></a>
</span><span id="Taulu.segment_table-544"><a href="#Taulu.segment_table-544"><span class="linenos">544</span></a><span class="sd">        Processing time depends on:</span>
</span><span id="Taulu.segment_table-545"><a href="#Taulu.segment_table-545"><span class="linenos">545</span></a><span class="sd">        - Image resolution (use `processing_scale &lt; 1.0` for large images)</span>
</span><span id="Taulu.segment_table-546"><a href="#Taulu.segment_table-546"><span class="linenos">546</span></a><span class="sd">        - Table complexity (more rows/columns = longer processing)</span>
</span><span id="Taulu.segment_table-547"><a href="#Taulu.segment_table-547"><span class="linenos">547</span></a><span class="sd">        - Parameter settings</span>
</span><span id="Taulu.segment_table-548"><a href="#Taulu.segment_table-548"><span class="linenos">548</span></a>
</span><span id="Taulu.segment_table-549"><a href="#Taulu.segment_table-549"><span class="linenos">549</span></a><span class="sd">        ## Troubleshooting</span>
</span><span id="Taulu.segment_table-550"><a href="#Taulu.segment_table-550"><span class="linenos">550</span></a>
</span><span id="Taulu.segment_table-551"><a href="#Taulu.segment_table-551"><span class="linenos">551</span></a><span class="sd">        **If segmentation fails (returns incomplete grid):**</span>
</span><span id="Taulu.segment_table-552"><a href="#Taulu.segment_table-552"><span class="linenos">552</span></a><span class="sd">        1. Enable `debug_view=True` to see where it stops</span>
</span><span id="Taulu.segment_table-553"><a href="#Taulu.segment_table-553"><span class="linenos">553</span></a><span class="sd">        2. Check if header alignment is correct (first debug image)</span>
</span><span id="Taulu.segment_table-554"><a href="#Taulu.segment_table-554"><span class="linenos">554</span></a><span class="sd">        3. Verify cross-correlation shows bright spots at corners</span>
</span><span id="Taulu.segment_table-555"><a href="#Taulu.segment_table-555"><span class="linenos">555</span></a><span class="sd">        4. Adjust `grow_threshold` (lower if stopping too early)</span>
</span><span id="Taulu.segment_table-556"><a href="#Taulu.segment_table-556"><span class="linenos">556</span></a><span class="sd">        5. Increase `search_region` if corners are far from expected positions</span>
</span><span id="Taulu.segment_table-557"><a href="#Taulu.segment_table-557"><span class="linenos">557</span></a>
</span><span id="Taulu.segment_table-558"><a href="#Taulu.segment_table-558"><span class="linenos">558</span></a><span class="sd">        **If segmentation is inaccurate (corners in wrong positions):**</span>
</span><span id="Taulu.segment_table-559"><a href="#Taulu.segment_table-559"><span class="linenos">559</span></a><span class="sd">        1. Check binarization quality (adjust `sauvola_k`)</span>
</span><span id="Taulu.segment_table-560"><a href="#Taulu.segment_table-560"><span class="linenos">560</span></a><span class="sd">        2. Verify cross-kernel size matches line thickness (adjust `cross_width`)</span>
</span><span id="Taulu.segment_table-561"><a href="#Taulu.segment_table-561"><span class="linenos">561</span></a><span class="sd">        3. Ensure morphology isn&#39;t over-connecting (reduce `morph_size`)</span>
</span><span id="Taulu.segment_table-562"><a href="#Taulu.segment_table-562"><span class="linenos">562</span></a><span class="sd">        4. Increase `distance_penalty` to enforce expected positions more strictly</span>
</span><span id="Taulu.segment_table-563"><a href="#Taulu.segment_table-563"><span class="linenos">563</span></a>
</span><span id="Taulu.segment_table-564"><a href="#Taulu.segment_table-564"><span class="linenos">564</span></a><span class="sd">        Args:</span>
</span><span id="Taulu.segment_table-565"><a href="#Taulu.segment_table-565"><span class="linenos">565</span></a><span class="sd">            image (MatLike | PathLike[str] | str): Table image to segment.</span>
</span><span id="Taulu.segment_table-566"><a href="#Taulu.segment_table-566"><span class="linenos">566</span></a><span class="sd">                Can be a file path or a numpy array (BGR or grayscale).</span>
</span><span id="Taulu.segment_table-567"><a href="#Taulu.segment_table-567"><span class="linenos">567</span></a>
</span><span id="Taulu.segment_table-568"><a href="#Taulu.segment_table-568"><span class="linenos">568</span></a><span class="sd">            filtered (MatLike | PathLike[str] | str | None): Optional pre-filtered</span>
</span><span id="Taulu.segment_table-569"><a href="#Taulu.segment_table-569"><span class="linenos">569</span></a><span class="sd">                binary image to use instead of computing it internally.</span>
</span><span id="Taulu.segment_table-570"><a href="#Taulu.segment_table-570"><span class="linenos">570</span></a><span class="sd">                Must be the same size as `image`. If provided, parameters related</span>
</span><span id="Taulu.segment_table-571"><a href="#Taulu.segment_table-571"><span class="linenos">571</span></a><span class="sd">                to filtering (e.g. `sauvola_k`, `morph_size`) are ignored.</span>
</span><span id="Taulu.segment_table-572"><a href="#Taulu.segment_table-572"><span class="linenos">572</span></a>
</span><span id="Taulu.segment_table-573"><a href="#Taulu.segment_table-573"><span class="linenos">573</span></a><span class="sd">                **GPU acceleration**: Use trained CNN model for corner detection:</span>
</span><span id="Taulu.segment_table-574"><a href="#Taulu.segment_table-574"><span class="linenos">574</span></a>
</span><span id="Taulu.segment_table-575"><a href="#Taulu.segment_table-575"><span class="linenos">575</span></a><span class="sd">                &gt;&gt;&gt; from taulu.gpu import DeepConvNet, apply_kernel_to_image_tiled</span>
</span><span id="Taulu.segment_table-576"><a href="#Taulu.segment_table-576"><span class="linenos">576</span></a><span class="sd">                &gt;&gt;&gt; model = DeepConvNet.load(&quot;model.pth&quot;)</span>
</span><span id="Taulu.segment_table-577"><a href="#Taulu.segment_table-577"><span class="linenos">577</span></a><span class="sd">                &gt;&gt;&gt; filtered = apply_kernel_to_image_tiled(model, image)</span>
</span><span id="Taulu.segment_table-578"><a href="#Taulu.segment_table-578"><span class="linenos">578</span></a><span class="sd">                &gt;&gt;&gt; grid = taulu.segment_table(image, filtered=filtered)</span>
</span><span id="Taulu.segment_table-579"><a href="#Taulu.segment_table-579"><span class="linenos">579</span></a>
</span><span id="Taulu.segment_table-580"><a href="#Taulu.segment_table-580"><span class="linenos">580</span></a><span class="sd">                Default: None</span>
</span><span id="Taulu.segment_table-581"><a href="#Taulu.segment_table-581"><span class="linenos">581</span></a>
</span><span id="Taulu.segment_table-582"><a href="#Taulu.segment_table-582"><span class="linenos">582</span></a><span class="sd">            debug_view (bool): If True, opens OpenCV windows showing intermediate</span>
</span><span id="Taulu.segment_table-583"><a href="#Taulu.segment_table-583"><span class="linenos">583</span></a><span class="sd">                processing steps:</span>
</span><span id="Taulu.segment_table-584"><a href="#Taulu.segment_table-584"><span class="linenos">584</span></a><span class="sd">                - Header alignment overlay</span>
</span><span id="Taulu.segment_table-585"><a href="#Taulu.segment_table-585"><span class="linenos">585</span></a><span class="sd">                - Binarized image</span>
</span><span id="Taulu.segment_table-586"><a href="#Taulu.segment_table-586"><span class="linenos">586</span></a><span class="sd">                - After morphological operations</span>
</span><span id="Taulu.segment_table-587"><a href="#Taulu.segment_table-587"><span class="linenos">587</span></a><span class="sd">                - Cross-correlation result</span>
</span><span id="Taulu.segment_table-588"><a href="#Taulu.segment_table-588"><span class="linenos">588</span></a><span class="sd">                - Growing progress (corner-by-corner)</span>
</span><span id="Taulu.segment_table-589"><a href="#Taulu.segment_table-589"><span class="linenos">589</span></a>
</span><span id="Taulu.segment_table-590"><a href="#Taulu.segment_table-590"><span class="linenos">590</span></a><span class="sd">                **Controls:**</span>
</span><span id="Taulu.segment_table-591"><a href="#Taulu.segment_table-591"><span class="linenos">591</span></a><span class="sd">                - Press &#39;n&#39; to advance to next step</span>
</span><span id="Taulu.segment_table-592"><a href="#Taulu.segment_table-592"><span class="linenos">592</span></a><span class="sd">                - Press &#39;q&#39; to quit immediately</span>
</span><span id="Taulu.segment_table-593"><a href="#Taulu.segment_table-593"><span class="linenos">593</span></a>
</span><span id="Taulu.segment_table-594"><a href="#Taulu.segment_table-594"><span class="linenos">594</span></a><span class="sd">                Useful for parameter tuning and understanding failures.</span>
</span><span id="Taulu.segment_table-595"><a href="#Taulu.segment_table-595"><span class="linenos">595</span></a><span class="sd">                Default: False</span>
</span><span id="Taulu.segment_table-596"><a href="#Taulu.segment_table-596"><span class="linenos">596</span></a>
</span><span id="Taulu.segment_table-597"><a href="#Taulu.segment_table-597"><span class="linenos">597</span></a><span class="sd">        Returns:</span>
</span><span id="Taulu.segment_table-598"><a href="#Taulu.segment_table-598"><span class="linenos">598</span></a><span class="sd">            TableGrid: A grid structure containing detected corner positions with</span>
</span><span id="Taulu.segment_table-599"><a href="#Taulu.segment_table-599"><span class="linenos">599</span></a><span class="sd">                methods for:</span>
</span><span id="Taulu.segment_table-600"><a href="#Taulu.segment_table-600"><span class="linenos">600</span></a>
</span><span id="Taulu.segment_table-601"><a href="#Taulu.segment_table-601"><span class="linenos">601</span></a><span class="sd">                **Position queries:**</span>
</span><span id="Taulu.segment_table-602"><a href="#Taulu.segment_table-602"><span class="linenos">602</span></a><span class="sd">                - `cell(point)`: Get (row, col) at pixel coordinates (x, y)</span>
</span><span id="Taulu.segment_table-603"><a href="#Taulu.segment_table-603"><span class="linenos">603</span></a><span class="sd">                - `cell_polygon(cell)`: Get 4 corners of a cell as (lt, rt, rb, lb)</span>
</span><span id="Taulu.segment_table-604"><a href="#Taulu.segment_table-604"><span class="linenos">604</span></a><span class="sd">                - `region(start, end)`: Get bounding box for a cell range</span>
</span><span id="Taulu.segment_table-605"><a href="#Taulu.segment_table-605"><span class="linenos">605</span></a>
</span><span id="Taulu.segment_table-606"><a href="#Taulu.segment_table-606"><span class="linenos">606</span></a><span class="sd">                **Image extraction:**</span>
</span><span id="Taulu.segment_table-607"><a href="#Taulu.segment_table-607"><span class="linenos">607</span></a><span class="sd">                - `crop_cell(img, cell, margin=0)`: Extract single cell with optional margin</span>
</span><span id="Taulu.segment_table-608"><a href="#Taulu.segment_table-608"><span class="linenos">608</span></a><span class="sd">                - `crop_region(img, start, end, margin=0)`: Extract rectangular region</span>
</span><span id="Taulu.segment_table-609"><a href="#Taulu.segment_table-609"><span class="linenos">609</span></a>
</span><span id="Taulu.segment_table-610"><a href="#Taulu.segment_table-610"><span class="linenos">610</span></a><span class="sd">                **Visualization:**</span>
</span><span id="Taulu.segment_table-611"><a href="#Taulu.segment_table-611"><span class="linenos">611</span></a><span class="sd">                - `show_cells(img)`: Interactive cell viewer (click to highlight)</span>
</span><span id="Taulu.segment_table-612"><a href="#Taulu.segment_table-612"><span class="linenos">612</span></a><span class="sd">                - `highlight_all_cells(img)`: Draw all cell boundaries</span>
</span><span id="Taulu.segment_table-613"><a href="#Taulu.segment_table-613"><span class="linenos">613</span></a><span class="sd">                - `visualize_points(img)`: Show detected corner points</span>
</span><span id="Taulu.segment_table-614"><a href="#Taulu.segment_table-614"><span class="linenos">614</span></a>
</span><span id="Taulu.segment_table-615"><a href="#Taulu.segment_table-615"><span class="linenos">615</span></a><span class="sd">                **Analysis:**</span>
</span><span id="Taulu.segment_table-616"><a href="#Taulu.segment_table-616"><span class="linenos">616</span></a><span class="sd">                - `text_regions(img, row)`: Find continuous text regions in a row</span>
</span><span id="Taulu.segment_table-617"><a href="#Taulu.segment_table-617"><span class="linenos">617</span></a><span class="sd">                - `cells()`: Generator yielding all (row, col) indices</span>
</span><span id="Taulu.segment_table-618"><a href="#Taulu.segment_table-618"><span class="linenos">618</span></a>
</span><span id="Taulu.segment_table-619"><a href="#Taulu.segment_table-619"><span class="linenos">619</span></a><span class="sd">                **Persistence:**</span>
</span><span id="Taulu.segment_table-620"><a href="#Taulu.segment_table-620"><span class="linenos">620</span></a><span class="sd">                - `save(path)`: Save grid to JSON file</span>
</span><span id="Taulu.segment_table-621"><a href="#Taulu.segment_table-621"><span class="linenos">621</span></a><span class="sd">                - `TableGrid.from_saved(path)`: Load grid from JSON</span>
</span><span id="Taulu.segment_table-622"><a href="#Taulu.segment_table-622"><span class="linenos">622</span></a>
</span><span id="Taulu.segment_table-623"><a href="#Taulu.segment_table-623"><span class="linenos">623</span></a><span class="sd">                **Properties:**</span>
</span><span id="Taulu.segment_table-624"><a href="#Taulu.segment_table-624"><span class="linenos">624</span></a><span class="sd">                - `rows`: Number of data rows (header not included)</span>
</span><span id="Taulu.segment_table-625"><a href="#Taulu.segment_table-625"><span class="linenos">625</span></a><span class="sd">                - `cols`: Number of columns</span>
</span><span id="Taulu.segment_table-626"><a href="#Taulu.segment_table-626"><span class="linenos">626</span></a><span class="sd">                - `points`: Raw list of detected corner coordinates</span>
</span><span id="Taulu.segment_table-627"><a href="#Taulu.segment_table-627"><span class="linenos">627</span></a>
</span><span id="Taulu.segment_table-628"><a href="#Taulu.segment_table-628"><span class="linenos">628</span></a><span class="sd">        Raises:</span>
</span><span id="Taulu.segment_table-629"><a href="#Taulu.segment_table-629"><span class="linenos">629</span></a><span class="sd">            TauluException: If image cannot be loaded, header alignment fails,</span>
</span><span id="Taulu.segment_table-630"><a href="#Taulu.segment_table-630"><span class="linenos">630</span></a><span class="sd">                or grid detection produces no results</span>
</span><span id="Taulu.segment_table-631"><a href="#Taulu.segment_table-631"><span class="linenos">631</span></a>
</span><span id="Taulu.segment_table-632"><a href="#Taulu.segment_table-632"><span class="linenos">632</span></a><span class="sd">        Examples:</span>
</span><span id="Taulu.segment_table-633"><a href="#Taulu.segment_table-633"><span class="linenos">633</span></a><span class="sd">            Basic segmentation:</span>
</span><span id="Taulu.segment_table-634"><a href="#Taulu.segment_table-634"><span class="linenos">634</span></a>
</span><span id="Taulu.segment_table-635"><a href="#Taulu.segment_table-635"><span class="linenos">635</span></a><span class="sd">            &gt;&gt;&gt; from taulu import Taulu</span>
</span><span id="Taulu.segment_table-636"><a href="#Taulu.segment_table-636"><span class="linenos">636</span></a><span class="sd">            &gt;&gt;&gt; import cv2</span>
</span><span id="Taulu.segment_table-637"><a href="#Taulu.segment_table-637"><span class="linenos">637</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu.segment_table-638"><a href="#Taulu.segment_table-638"><span class="linenos">638</span></a><span class="sd">            &gt;&gt;&gt; taulu = Taulu(&quot;header.png&quot;)</span>
</span><span id="Taulu.segment_table-639"><a href="#Taulu.segment_table-639"><span class="linenos">639</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu.segment_table-640"><a href="#Taulu.segment_table-640"><span class="linenos">640</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu.segment_table-641"><a href="#Taulu.segment_table-641"><span class="linenos">641</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Detected {grid.rows} rows and {grid.cols} columns&quot;)</span>
</span><span id="Taulu.segment_table-642"><a href="#Taulu.segment_table-642"><span class="linenos">642</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu.segment_table-643"><a href="#Taulu.segment_table-643"><span class="linenos">643</span></a><span class="sd">            &gt;&gt;&gt; # Extract first cell</span>
</span><span id="Taulu.segment_table-644"><a href="#Taulu.segment_table-644"><span class="linenos">644</span></a><span class="sd">            &gt;&gt;&gt; img = cv2.imread(&quot;table_page_01.png&quot;)</span>
</span><span id="Taulu.segment_table-645"><a href="#Taulu.segment_table-645"><span class="linenos">645</span></a><span class="sd">            &gt;&gt;&gt; cell_img = grid.crop_cell(img, (0, 0))</span>
</span><span id="Taulu.segment_table-646"><a href="#Taulu.segment_table-646"><span class="linenos">646</span></a><span class="sd">            &gt;&gt;&gt; cv2.imwrite(&quot;cell_0_0.png&quot;, cell_img)</span>
</span><span id="Taulu.segment_table-647"><a href="#Taulu.segment_table-647"><span class="linenos">647</span></a>
</span><span id="Taulu.segment_table-648"><a href="#Taulu.segment_table-648"><span class="linenos">648</span></a><span class="sd">            Debug mode for parameter tuning:</span>
</span><span id="Taulu.segment_table-649"><a href="#Taulu.segment_table-649"><span class="linenos">649</span></a>
</span><span id="Taulu.segment_table-650"><a href="#Taulu.segment_table-650"><span class="linenos">650</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table_page_01.png&quot;, debug_view=True)</span>
</span><span id="Taulu.segment_table-651"><a href="#Taulu.segment_table-651"><span class="linenos">651</span></a><span class="sd">            # Windows open showing each step</span>
</span><span id="Taulu.segment_table-652"><a href="#Taulu.segment_table-652"><span class="linenos">652</span></a><span class="sd">            # Adjust parameters based on what you see</span>
</span><span id="Taulu.segment_table-653"><a href="#Taulu.segment_table-653"><span class="linenos">653</span></a>
</span><span id="Taulu.segment_table-654"><a href="#Taulu.segment_table-654"><span class="linenos">654</span></a><span class="sd">            Process multiple images with the same header:</span>
</span><span id="Taulu.segment_table-655"><a href="#Taulu.segment_table-655"><span class="linenos">655</span></a>
</span><span id="Taulu.segment_table-656"><a href="#Taulu.segment_table-656"><span class="linenos">656</span></a><span class="sd">            &gt;&gt;&gt; taulu = Taulu(&quot;header.png&quot;, sauvola_k=0.25)</span>
</span><span id="Taulu.segment_table-657"><a href="#Taulu.segment_table-657"><span class="linenos">657</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu.segment_table-658"><a href="#Taulu.segment_table-658"><span class="linenos">658</span></a><span class="sd">            &gt;&gt;&gt; for i in range(1, 11):</span>
</span><span id="Taulu.segment_table-659"><a href="#Taulu.segment_table-659"><span class="linenos">659</span></a><span class="sd">            ...     img_path = f&quot;table_page_{i:02d}.png&quot;</span>
</span><span id="Taulu.segment_table-660"><a href="#Taulu.segment_table-660"><span class="linenos">660</span></a><span class="sd">            ...     grid = taulu.segment_table(img_path)</span>
</span><span id="Taulu.segment_table-661"><a href="#Taulu.segment_table-661"><span class="linenos">661</span></a><span class="sd">            ...     grid.save(f&quot;grid_{i:02d}.json&quot;)</span>
</span><span id="Taulu.segment_table-662"><a href="#Taulu.segment_table-662"><span class="linenos">662</span></a><span class="sd">            ...     print(f&quot;Page {i}: {grid.rows} rows detected&quot;)</span>
</span><span id="Taulu.segment_table-663"><a href="#Taulu.segment_table-663"><span class="linenos">663</span></a>
</span><span id="Taulu.segment_table-664"><a href="#Taulu.segment_table-664"><span class="linenos">664</span></a><span class="sd">            Extract all cells from a table:</span>
</span><span id="Taulu.segment_table-665"><a href="#Taulu.segment_table-665"><span class="linenos">665</span></a>
</span><span id="Taulu.segment_table-666"><a href="#Taulu.segment_table-666"><span class="linenos">666</span></a><span class="sd">            &gt;&gt;&gt; img = cv2.imread(&quot;table.png&quot;)</span>
</span><span id="Taulu.segment_table-667"><a href="#Taulu.segment_table-667"><span class="linenos">667</span></a><span class="sd">            &gt;&gt;&gt; grid = taulu.segment_table(&quot;table.png&quot;)</span>
</span><span id="Taulu.segment_table-668"><a href="#Taulu.segment_table-668"><span class="linenos">668</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Taulu.segment_table-669"><a href="#Taulu.segment_table-669"><span class="linenos">669</span></a><span class="sd">            &gt;&gt;&gt; for row, col in grid.cells():</span>
</span><span id="Taulu.segment_table-670"><a href="#Taulu.segment_table-670"><span class="linenos">670</span></a><span class="sd">            ...     cell_img = grid.crop_cell(img, (row, col), margin=5)</span>
</span><span id="Taulu.segment_table-671"><a href="#Taulu.segment_table-671"><span class="linenos">671</span></a><span class="sd">            ...     cv2.imwrite(f&quot;cell_{row}_{col}.png&quot;, cell_img)</span>
</span><span id="Taulu.segment_table-672"><a href="#Taulu.segment_table-672"><span class="linenos">672</span></a>
</span><span id="Taulu.segment_table-673"><a href="#Taulu.segment_table-673"><span class="linenos">673</span></a><span class="sd">            Find text regions for OCR:</span>
</span><span id="Taulu.segment_table-674"><a href="#Taulu.segment_table-674"><span class="linenos">674</span></a>
</span><span id="Taulu.segment_table-675"><a href="#Taulu.segment_table-675"><span class="linenos">675</span></a><span class="sd">            &gt;&gt;&gt; for row in range(grid.rows):</span>
</span><span id="Taulu.segment_table-676"><a href="#Taulu.segment_table-676"><span class="linenos">676</span></a><span class="sd">            ...     text_regions = grid.text_regions(img, row)</span>
</span><span id="Taulu.segment_table-677"><a href="#Taulu.segment_table-677"><span class="linenos">677</span></a><span class="sd">            ...     for start_cell, end_cell in text_regions:</span>
</span><span id="Taulu.segment_table-678"><a href="#Taulu.segment_table-678"><span class="linenos">678</span></a><span class="sd">            ...         # Extract region spanning multiple cells</span>
</span><span id="Taulu.segment_table-679"><a href="#Taulu.segment_table-679"><span class="linenos">679</span></a><span class="sd">            ...         region_img = grid.crop_region(img, start_cell, end_cell)</span>
</span><span id="Taulu.segment_table-680"><a href="#Taulu.segment_table-680"><span class="linenos">680</span></a><span class="sd">            ...         # Run OCR on region_img...</span>
</span><span id="Taulu.segment_table-681"><a href="#Taulu.segment_table-681"><span class="linenos">681</span></a>
</span><span id="Taulu.segment_table-682"><a href="#Taulu.segment_table-682"><span class="linenos">682</span></a><span class="sd">        See Also:</span>
</span><span id="Taulu.segment_table-683"><a href="#Taulu.segment_table-683"><span class="linenos">683</span></a><span class="sd">            - `TableGrid`: Complete documentation of the returned object</span>
</span><span id="Taulu.segment_table-684"><a href="#Taulu.segment_table-684"><span class="linenos">684</span></a><span class="sd">            - `GridDetector.find_table_points()`: Lower-level grid detection</span>
</span><span id="Taulu.segment_table-685"><a href="#Taulu.segment_table-685"><span class="linenos">685</span></a><span class="sd">            - `HeaderAligner.align()`: Lower-level header alignment</span>
</span><span id="Taulu.segment_table-686"><a href="#Taulu.segment_table-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Taulu.segment_table-687"><a href="#Taulu.segment_table-687"><span class="linenos">687</span></a>
</span><span id="Taulu.segment_table-688"><a href="#Taulu.segment_table-688"><span class="linenos">688</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">MatLike</span><span class="p">):</span>
</span><span id="Taulu.segment_table-689"><a href="#Taulu.segment_table-689"><span class="linenos">689</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="Taulu.segment_table-690"><a href="#Taulu.segment_table-690"><span class="linenos">690</span></a>
</span><span id="Taulu.segment_table-691"><a href="#Taulu.segment_table-691"><span class="linenos">691</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
</span><span id="Taulu.segment_table-692"><a href="#Taulu.segment_table-692"><span class="linenos">692</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">visual</span><span class="o">=</span><span class="n">debug_view</span><span class="p">)</span>
</span><span id="Taulu.segment_table-693"><a href="#Taulu.segment_table-693"><span class="linenos">693</span></a>        <span class="n">align_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">now</span>
</span><span id="Taulu.segment_table-694"><a href="#Taulu.segment_table-694"><span class="linenos">694</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Header alignment took </span><span class="si">{</span><span class="n">align_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="Taulu.segment_table-695"><a href="#Taulu.segment_table-695"><span class="linenos">695</span></a>
</span><span id="Taulu.segment_table-696"><a href="#Taulu.segment_table-696"><span class="linenos">696</span></a>        <span class="c1"># find the starting point for the table grid algorithm</span>
</span><span id="Taulu.segment_table-697"><a href="#Taulu.segment_table-697"><span class="linenos">697</span></a>        <span class="n">left_top_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">intersection</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Taulu.segment_table-698"><a href="#Taulu.segment_table-698"><span class="linenos">698</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu.segment_table-699"><a href="#Taulu.segment_table-699"><span class="linenos">699</span></a>            <span class="n">left_top_template</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
</span><span id="Taulu.segment_table-700"><a href="#Taulu.segment_table-700"><span class="linenos">700</span></a>                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
</span><span id="Taulu.segment_table-701"><a href="#Taulu.segment_table-701"><span class="linenos">701</span></a>                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
</span><span id="Taulu.segment_table-702"><a href="#Taulu.segment_table-702"><span class="linenos">702</span></a>            <span class="p">)</span>
</span><span id="Taulu.segment_table-703"><a href="#Taulu.segment_table-703"><span class="linenos">703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Taulu.segment_table-704"><a href="#Taulu.segment_table-704"><span class="linenos">704</span></a>            <span class="n">left_top_template</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_top_template</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Taulu.segment_table-705"><a href="#Taulu.segment_table-705"><span class="linenos">705</span></a>
</span><span id="Taulu.segment_table-706"><a href="#Taulu.segment_table-706"><span class="linenos">706</span></a>        <span class="n">left_top_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aligner</span><span class="o">.</span><span class="n">template_to_img</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">left_top_template</span><span class="p">)</span>
</span><span id="Taulu.segment_table-707"><a href="#Taulu.segment_table-707"><span class="linenos">707</span></a>
</span><span id="Taulu.segment_table-708"><a href="#Taulu.segment_table-708"><span class="linenos">708</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
</span><span id="Taulu.segment_table-709"><a href="#Taulu.segment_table-709"><span class="linenos">709</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_detector</span><span class="o">.</span><span class="n">find_table_points</span><span class="p">(</span>
</span><span id="Taulu.segment_table-710"><a href="#Taulu.segment_table-710"><span class="linenos">710</span></a>            <span class="n">image</span><span class="p">,</span>
</span><span id="Taulu.segment_table-711"><a href="#Taulu.segment_table-711"><span class="linenos">711</span></a>            <span class="n">left_top_table</span><span class="p">,</span>
</span><span id="Taulu.segment_table-712"><a href="#Taulu.segment_table-712"><span class="linenos">712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">cell_widths</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span><span id="Taulu.segment_table-713"><a href="#Taulu.segment_table-713"><span class="linenos">713</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cell_heights</span><span class="p">,</span>
</span><span id="Taulu.segment_table-714"><a href="#Taulu.segment_table-714"><span class="linenos">714</span></a>            <span class="n">visual</span><span class="o">=</span><span class="n">debug_view</span><span class="p">,</span>
</span><span id="Taulu.segment_table-715"><a href="#Taulu.segment_table-715"><span class="linenos">715</span></a>            <span class="n">filtered</span><span class="o">=</span><span class="n">filtered</span><span class="p">,</span>
</span><span id="Taulu.segment_table-716"><a href="#Taulu.segment_table-716"><span class="linenos">716</span></a>            <span class="n">smooth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_smooth</span>
</span><span id="Taulu.segment_table-717"><a href="#Taulu.segment_table-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="Taulu.segment_table-718"><a href="#Taulu.segment_table-718"><span class="linenos">718</span></a>        <span class="n">grid_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">now</span>
</span><span id="Taulu.segment_table-719"><a href="#Taulu.segment_table-719"><span class="linenos">719</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grid detection took </span><span class="si">{</span><span class="n">grid_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="Taulu.segment_table-720"><a href="#Taulu.segment_table-720"><span class="linenos">720</span></a>
</span><span id="Taulu.segment_table-721"><a href="#Taulu.segment_table-721"><span class="linenos">721</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Split</span><span class="p">):</span>
</span><span id="Taulu.segment_table-722"><a href="#Taulu.segment_table-722"><span class="linenos">722</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">TableGrid</span><span class="o">.</span><span class="n">from_split</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Taulu.segment_table-723"><a href="#Taulu.segment_table-723"><span class="linenos">723</span></a>
</span><span id="Taulu.segment_table-724"><a href="#Taulu.segment_table-724"><span class="linenos">724</span></a>        <span class="k">return</span> <span class="n">table</span>
</span></pre></div>


            <div class="docstring"><p>Segment a table image into a grid of cells.</p>

<p>This is the main entry point for the taulu package. It orchestrates:</p>

<ol>
<li><strong>Header alignment</strong>: Locates the table by matching the header template
to the image using feature-based registration (ORB features + homography)</li>
<li><strong>Grid detection</strong>: Applies morphological filtering and cross-correlation
to find corner intersections</li>
<li><strong>Grid growing</strong>: Iteratively detects corners row-by-row and column-by-column,
starting from the aligned header position</li>
<li><strong>Extrapolation</strong>: Fills in any missing corners using polynomial regression
based on neighboring detected points</li>
<li><strong>Smoothing</strong>: Refines corner positions for consistency</li>
</ol>

<h2 id="performance-notes">Performance Notes</h2>

<p>Processing time depends on:</p>

<ul>
<li>Image resolution (use <code>processing_scale &lt; 1.0</code> for large images)</li>
<li>Table complexity (more rows/columns = longer processing)</li>
<li>Parameter settings</li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<p><strong>If segmentation fails (returns incomplete grid):</strong></p>

<ol>
<li>Enable <code>debug_view=True</code> to see where it stops</li>
<li>Check if header alignment is correct (first debug image)</li>
<li>Verify cross-correlation shows bright spots at corners</li>
<li>Adjust <code>grow_threshold</code> (lower if stopping too early)</li>
<li>Increase <code>search_region</code> if corners are far from expected positions</li>
</ol>

<p><strong>If segmentation is inaccurate (corners in wrong positions):</strong></p>

<ol>
<li>Check binarization quality (adjust <code>sauvola_k</code>)</li>
<li>Verify cross-kernel size matches line thickness (adjust <code>cross_width</code>)</li>
<li>Ensure morphology isn't over-connecting (reduce <code>morph_size</code>)</li>
<li>Increase <code>distance_penalty</code> to enforce expected positions more strictly</li>
</ol>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>image (MatLike | PathLike[str] | str):</strong>  Table image to segment.
Can be a file path or a numpy array (BGR or grayscale).</li>
<li><p><strong>filtered (MatLike | PathLike[str] | str | None):</strong>  Optional pre-filtered
binary image to use instead of computing it internally.
Must be the same size as <code>image</code>. If provided, parameters related
to filtering (e.g. <code>sauvola_k</code>, <code>morph_size</code>) are ignored.</p>

<p><strong>GPU acceleration</strong>: Use trained CNN model for corner detection:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">taulu.gpu</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeepConvNet</span><span class="p">,</span> <span class="n">apply_kernel_to_image_tiled</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">DeepConvNet</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model.pth&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered</span> <span class="o">=</span> <span class="n">apply_kernel_to_image_tiled</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filtered</span><span class="o">=</span><span class="n">filtered</span><span class="p">)</span>
</code></pre>
</div>

<p>Default: None</p></li>
<li><p><strong>debug_view (bool):</strong>  If True, opens OpenCV windows showing intermediate
processing steps:</p>

<ul>
<li>Header alignment overlay</li>
<li>Binarized image</li>
<li>After morphological operations</li>
<li>Cross-correlation result</li>
<li>Growing progress (corner-by-corner)</li>
</ul>

<p><strong>Controls:</strong></p>

<ul>
<li>Press 'n' to advance to next step</li>
<li>Press 'q' to quit immediately</li>
</ul>

<p>Useful for parameter tuning and understanding failures.
Default: False</p></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>TableGrid: A grid structure containing detected corner positions with
      methods for:</p>

<pre><code>**Position queries:**
- `cell(point)`: Get (row, col) at pixel coordinates (x, y)
- `cell_polygon(cell)`: Get 4 corners of a cell as (lt, rt, rb, lb)
- `region(start, end)`: Get bounding box for a cell range

**Image extraction:**
- `crop_cell(img, cell, margin=0)`: Extract single cell with optional margin
- `crop_region(img, start, end, margin=0)`: Extract rectangular region

**Visualization:**
- `show_cells(img)`: Interactive cell viewer (click to highlight)
- `highlight_all_cells(img)`: Draw all cell boundaries
- `visualize_points(img)`: Show detected corner points

**Analysis:**
- `text_regions(img, row)`: Find continuous text regions in a row
- `cells()`: Generator yielding all (row, col) indices

**Persistence:**
- `save(path)`: Save grid to JSON file
- `<a href="#TableGrid.from_saved">TableGrid.from_saved</a>(path)`: Load grid from JSON

**Properties:**
- `rows`: Number of data rows (header not included)
- `cols`: Number of columns
- `points`: Raw list of detected corner coordinates
</code></pre>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>TauluException:</strong>  If image cannot be loaded, header alignment fails,
or grid detection produces no results</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <p>Basic segmentation:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">taulu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Taulu</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">(</span><span class="s2">&quot;header.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;table_page_01.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">rows</span><span class="si">}</span><span class="s2"> rows and </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">cols</span><span class="si">}</span><span class="s2"> columns&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Extract first cell</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;table_page_01.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell_img</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">crop_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;cell_0_0.png&quot;</span><span class="p">,</span> <span class="n">cell_img</span><span class="p">)</span>
</code></pre>
  </div>
  
  <p>Debug mode for parameter tuning:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;table_page_01.png&quot;</span><span class="p">,</span> <span class="n">debug_view</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&lt;h1 id=&quot;windows-open-showing-each-step&quot;&gt;Windows open showing each step&lt;/h1&gt;</span>
</code></pre>
  </div>
  
  <h1 id="adjust-parameters-based-on-what-you-see">Adjust parameters based on what you see</h1>
  
  <p>Process multiple images with the same header:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">taulu</span> <span class="o">=</span> <span class="n">Taulu</span><span class="p">(</span><span class="s2">&quot;header.png&quot;</span><span class="p">,</span> <span class="n">sauvola_k</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">img_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;table_page_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
<span class="gp">... </span>    <span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">grid</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grid_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">rows</span><span class="si">}</span><span class="s2"> rows detected&quot;</span><span class="p">)</span>
</code></pre>
  </div>
  
  <p>Extract all cells from a table:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;table.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">taulu</span><span class="o">.</span><span class="n">segment_table</span><span class="p">(</span><span class="s2">&quot;table.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">cells</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">cell_img</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">crop_cell</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="n">margin</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cell_</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">cell_img</span><span class="p">)</span>
</code></pre>
  </div>
  
  <p>Find text regions for OCR:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">text_regions</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">text_regions</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">start_cell</span><span class="p">,</span> <span class="n">end_cell</span> <span class="ow">in</span> <span class="n">text_regions</span><span class="p">:</span>
<span class="gp">... </span>        <span class="c1"># Extract region spanning multiple cells</span>
<span class="gp">... </span>        <span class="n">region_img</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">crop_region</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">start_cell</span><span class="p">,</span> <span class="n">end_cell</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># Run OCR on region_img...</span>
</code></pre>
  </div>
</blockquote>

<h6 id="see-also">See Also:</h6>

<blockquote>
  <ul>
  <li><code><a href="#TableGrid">TableGrid</a></code>: Complete documentation of the returned object</li>
  <li><code><a href="#GridDetector.find_table_points">GridDetector.find_table_points()</a></code>: Lower-level grid detection</li>
  <li><code><a href="#HeaderAligner.align">HeaderAligner.align()</a></code>: Lower-level header alignment</li>
  </ul>
</blockquote>
</div>


                            </div>
                </section>
    </main>
</body>
</html>